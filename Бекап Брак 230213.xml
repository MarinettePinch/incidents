<?xml version="1.0" encoding="UTF-8"?>
<V8Exch:_1CV8DtUD xmlns:V8Exch="http://www.1c.ru/V8/1CV8DtUD/" xmlns:core="http://v8.1c.ru/data" xmlns:v8="http://v8.1c.ru/8.1/data/enterprise/current-config" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
	<V8Exch:Data>
		<v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
			<v8:Ref xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">dadc519d-bbf7-11ec-bba2-00155d70bd06</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Code>000000162</v8:Code>
			<v8:Description>Ссылки на изображения</v8:Description>
			<v8:ValueType>
				<Type xmlns="http://v8.1c.ru/8.1/data/core">xs:string</Type>
				<StringQualifiers xmlns="http://v8.1c.ru/8.1/data/core">
					<Length>1024</Length>
					<AllowedLength>Variable</AllowedLength>
				</StringQualifiers>
			</v8:ValueType>
			<v8:Заголовок>Прилагаемые файлы</v8:Заголовок>
			<v8:Список>true</v8:Список>
			<v8:Таблица>false</v8:Таблица>
			<v8:Идентификатор>СсылкиНаИзображения</v8:Идентификатор>
		</v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
		<v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
			<v8:Ref xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">f6327d2c-d1c5-11ec-bbaf-00155d258b03</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Code>000000164</v8:Code>
			<v8:Description>ЗаявкаНаВозвратТовара</v8:Description>
			<v8:ValueType>
				<Type xmlns="http://v8.1c.ru/8.1/data/core">v8:DocumentRef.ЗаявкаНаВозвратТоваровОтКлиента</Type>
			</v8:ValueType>
			<v8:Заголовок>Заявка на возврат товара</v8:Заголовок>
			<v8:Список>false</v8:Список>
			<v8:Таблица>false</v8:Таблица>
			<v8:Идентификатор>ЗаявкаНаВозвратТовара</v8:Идентификатор>
		</v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
		<v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
			<v8:Ref xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">e379ced7-7eb0-11ec-bb9e-00155d70bd06</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Code>000000130</v8:Code>
			<v8:Description>Ответственный МОР</v8:Description>
			<v8:ValueType>
				<Type xmlns="http://v8.1c.ru/8.1/data/core">v8:CatalogRef.Пользователи</Type>
			</v8:ValueType>
			<v8:Заголовок>Ответственный куратор покупателя</v8:Заголовок>
			<v8:Список>false</v8:Список>
			<v8:Таблица>false</v8:Таблица>
			<v8:Идентификатор>Ответственный МОР</v8:Идентификатор>
		</v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
		<v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
			<v8:Ref xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">455e5227-8e55-11ec-bb9e-00155d70bd06</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Code>000000137</v8:Code>
			<v8:Description>ДополнитьДанныеВручную</v8:Description>
			<v8:ValueType>
				<Type xmlns="http://v8.1c.ru/8.1/data/core">xs:boolean</Type>
			</v8:ValueType>
			<v8:Заголовок>ДополнитьДанныеВручную</v8:Заголовок>
			<v8:Список>false</v8:Список>
			<v8:Таблица>false</v8:Таблица>
			<v8:Идентификатор>ДополнитьДанныеВручную</v8:Идентификатор>
		</v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
		<v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
			<v8:Ref xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">ae2bfd6f-8798-11ec-bb9e-00155d70bd06</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Code>000000135</v8:Code>
			<v8:Description>Решение обжаловано клиентом</v8:Description>
			<v8:ValueType>
				<Type xmlns="http://v8.1c.ru/8.1/data/core">xs:boolean</Type>
			</v8:ValueType>
			<v8:Заголовок>Решение обжаловано клиентом</v8:Заголовок>
			<v8:Список>false</v8:Список>
			<v8:Таблица>false</v8:Таблица>
			<v8:Идентификатор>Рекламация_РешениеОбжалованоКлиентом</v8:Идентификатор>
		</v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
		<v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
			<v8:Ref xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">b444c315-5f3e-11ed-bba5-00155d70bd06</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Code>000000168</v8:Code>
			<v8:Description>Компенсация без экспертизы</v8:Description>
			<v8:ValueType>
				<Type xmlns="http://v8.1c.ru/8.1/data/core">xs:boolean</Type>
			</v8:ValueType>
			<v8:Заголовок>Компенсация без экспертизы</v8:Заголовок>
			<v8:Список>false</v8:Список>
			<v8:Таблица>false</v8:Таблица>
			<v8:Идентификатор>КомпенсацияБезЭкспертизы</v8:Идентификатор>
		</v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
		<v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
			<v8:Ref xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">c10475bc-8798-11ec-bb9e-00155d70bd06</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Code>000000136</v8:Code>
			<v8:Description>Описание обжалования</v8:Description>
			<v8:ValueType>
				<Type xmlns="http://v8.1c.ru/8.1/data/core">xs:string</Type>
				<StringQualifiers xmlns="http://v8.1c.ru/8.1/data/core">
					<Length>0</Length>
					<AllowedLength>Variable</AllowedLength>
				</StringQualifiers>
			</v8:ValueType>
			<v8:Заголовок>Описание обжалования</v8:Заголовок>
			<v8:Список>false</v8:Список>
			<v8:Таблица>false</v8:Таблица>
			<v8:Идентификатор>Рекламация_ОписаниеОбжалования</v8:Идентификатор>
		</v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
		<v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
			<v8:Ref xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">7770acee-8e55-11ec-bb9e-00155d70bd06</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Code>000000139</v8:Code>
			<v8:Description>СреднемесячнаяВыручка</v8:Description>
			<v8:ValueType>
				<Type xmlns="http://v8.1c.ru/8.1/data/core">xs:decimal</Type>
				<NumberQualifiers xmlns="http://v8.1c.ru/8.1/data/core">
					<Digits>15</Digits>
					<FractionDigits>2</FractionDigits>
					<AllowedSign>Any</AllowedSign>
				</NumberQualifiers>
			</v8:ValueType>
			<v8:Заголовок>СреднемесячнаяВыручка</v8:Заголовок>
			<v8:Список>false</v8:Список>
			<v8:Таблица>false</v8:Таблица>
			<v8:Идентификатор>СреднемесячнаяВыручка</v8:Идентификатор>
		</v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
		<v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
			<v8:Ref xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">06421d01-b654-11ec-bba1-00155d70bd06</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Code>000000150</v8:Code>
			<v8:Description>ОтветственныйНОР</v8:Description>
			<v8:ValueType>
				<Type xmlns="http://v8.1c.ru/8.1/data/core">v8:CatalogRef.Пользователи</Type>
			</v8:ValueType>
			<v8:Заголовок>Ответственный НОР</v8:Заголовок>
			<v8:Список>false</v8:Список>
			<v8:Таблица>false</v8:Таблица>
			<v8:Идентификатор>ОтветственныйНОР</v8:Идентификатор>
		</v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
		<v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
			<v8:Ref xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">20e9e340-bc98-11ec-bbaf-00155d258b03</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Code>000000162</v8:Code>
			<v8:Description>РешениеНОР</v8:Description>
			<v8:ValueType>
				<Type xmlns="http://v8.1c.ru/8.1/data/core">v8:EnumRef.КА_РешениеНОР</Type>
			</v8:ValueType>
			<v8:Заголовок>Решение НОР</v8:Заголовок>
			<v8:Список>false</v8:Список>
			<v8:Таблица>false</v8:Таблица>
			<v8:Идентификатор>РешениеНОР</v8:Идентификатор>
		</v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
		<v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
			<v8:Ref xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">f6477028-7eb0-11ec-bb9e-00155d70bd06</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Code>000000132</v8:Code>
			<v8:Description>ОтветственныйИнженер</v8:Description>
			<v8:ValueType>
				<Type xmlns="http://v8.1c.ru/8.1/data/core">v8:CatalogRef.Пользователи</Type>
			</v8:ValueType>
			<v8:Заголовок>Ответственный инженер </v8:Заголовок>
			<v8:Список>false</v8:Список>
			<v8:Таблица>false</v8:Таблица>
			<v8:Идентификатор>ОтветственныйИнженер</v8:Идентификатор>
		</v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
		<v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
			<v8:Ref xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">0bfaa900-7eb1-11ec-bb9e-00155d70bd06</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Code>000000133</v8:Code>
			<v8:Description>ОтветственныйЗаТГ</v8:Description>
			<v8:ValueType>
				<Type xmlns="http://v8.1c.ru/8.1/data/core">v8:CatalogRef.Пользователи</Type>
			</v8:ValueType>
			<v8:Заголовок>Ответственный за ТГ</v8:Заголовок>
			<v8:Список>false</v8:Список>
			<v8:Таблица>false</v8:Таблица>
			<v8:Идентификатор>ОтветственныйЗаТГ</v8:Идентификатор>
		</v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
		<v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
			<v8:Ref xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">28c3acd3-ba33-11ec-bba2-00155d70bd06</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Code>000000152</v8:Code>
			<v8:Description>РешениеИнженера</v8:Description>
			<v8:ValueType>
				<Type xmlns="http://v8.1c.ru/8.1/data/core">v8:EnumRef.КА_РешенияИнженера</Type>
			</v8:ValueType>
			<v8:Заголовок>Решение инженера</v8:Заголовок>
			<v8:Список>false</v8:Список>
			<v8:Таблица>false</v8:Таблица>
			<v8:Идентификатор>РешениеИнженера</v8:Идентификатор>
		</v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
		<v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
			<v8:Ref xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">e5acad73-a62b-11ec-bba8-00155d258b03</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Code>000000145</v8:Code>
			<v8:Description>vendorsolution</v8:Description>
			<v8:ValueType>
				<Type xmlns="http://v8.1c.ru/8.1/data/core">v8:EnumRef.КА_РешениеЭкспертизы</Type>
			</v8:ValueType>
			<v8:Заголовок>Решение поставщика</v8:Заголовок>
			<v8:Список>false</v8:Список>
			<v8:Таблица>false</v8:Таблица>
			<v8:Идентификатор>vendorsolution</v8:Идентификатор>
		</v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
		<v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
			<v8:Ref xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">1e160f11-bca1-11ec-bba2-00155d70bd06</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Code>000000163</v8:Code>
			<v8:Description>Клиент требует вернуть деньги</v8:Description>
			<v8:ValueType>
				<Type xmlns="http://v8.1c.ru/8.1/data/core">xs:boolean</Type>
			</v8:ValueType>
			<v8:Заголовок>Клиент требует вернуть деньги</v8:Заголовок>
			<v8:Список>false</v8:Список>
			<v8:Таблица>false</v8:Таблица>
			<v8:Идентификатор>КлиентТребуетВернутьДеньги</v8:Идентификатор>
		</v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
		<v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
			<v8:Ref xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">578c447d-b974-11ec-bba2-00155d70bd06</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Code>000000151</v8:Code>
			<v8:Description>Экспертиза</v8:Description>
			<v8:ValueType>
				<Type xmlns="http://v8.1c.ru/8.1/data/core">v8:EnumRef.КА_ДоставитьТоварНаЭкспертизу</Type>
			</v8:ValueType>
			<v8:Заголовок>Доставить товар на экспертизу</v8:Заголовок>
			<v8:Список>false</v8:Список>
			<v8:Таблица>false</v8:Таблица>
			<v8:Идентификатор>Экспертиза</v8:Идентификатор>
		</v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
		<v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
			<v8:Ref xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">e983c36e-bc97-11ec-bbaf-00155d258b03</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Code>000000161</v8:Code>
			<v8:Description>РешениеЭкспертизы</v8:Description>
			<v8:ValueType>
				<Type xmlns="http://v8.1c.ru/8.1/data/core">v8:EnumRef.КА_РешениеЭкспертизы</Type>
			</v8:ValueType>
			<v8:Заголовок>Решение экспертизы</v8:Заголовок>
			<v8:Список>false</v8:Список>
			<v8:Таблица>false</v8:Таблица>
			<v8:Идентификатор>РешениеЭкспертизы</v8:Идентификатор>
		</v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
		<v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
			<v8:Ref xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">579bcceb-8e55-11ec-bb9e-00155d70bd06</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Code>000000138</v8:Code>
			<v8:Description>Товар вернуть</v8:Description>
			<v8:ValueType>
				<Type xmlns="http://v8.1c.ru/8.1/data/core">xs:boolean</Type>
			</v8:ValueType>
			<v8:Заголовок>Товар вернуть</v8:Заголовок>
			<v8:Список>false</v8:Список>
			<v8:Таблица>false</v8:Таблица>
			<v8:Идентификатор>ТоварВернуть</v8:Идентификатор>
		</v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
		<v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
			<v8:Ref xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">c9ae9a45-d6cc-11ec-bbaf-00155d258b03</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Code>000000166</v8:Code>
			<v8:Description>Склад</v8:Description>
			<v8:ValueType>
				<Type xmlns="http://v8.1c.ru/8.1/data/core">v8:CatalogRef.Склады</Type>
			</v8:ValueType>
			<v8:Заголовок>Склад</v8:Заголовок>
			<v8:Список>false</v8:Список>
			<v8:Таблица>false</v8:Таблица>
			<v8:Идентификатор>Склад</v8:Идентификатор>
		</v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
		<v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
			<v8:Ref xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">1cf61873-ba50-11ec-bba2-00155d70bd06</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Code>000000159</v8:Code>
			<v8:Description>ВозвратУтилизация</v8:Description>
			<v8:ValueType>
				<Type xmlns="http://v8.1c.ru/8.1/data/core">v8:EnumRef.КА_ВозвратУтилизация</Type>
			</v8:ValueType>
			<v8:Заголовок>Возврат и утилизация</v8:Заголовок>
			<v8:Список>false</v8:Список>
			<v8:Таблица>false</v8:Таблица>
			<v8:Идентификатор>ВозвратУтилизация</v8:Идентификатор>
		</v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
		<v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
			<v8:Ref xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">eade99cb-7eb0-11ec-bb9e-00155d70bd06</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Code>000000131</v8:Code>
			<v8:Description>ОтветственныйМКО</v8:Description>
			<v8:ValueType>
				<Type xmlns="http://v8.1c.ru/8.1/data/core">v8:CatalogRef.Пользователи</Type>
			</v8:ValueType>
			<v8:Заголовок>Ответственный МКО</v8:Заголовок>
			<v8:Список>false</v8:Список>
			<v8:Таблица>false</v8:Таблица>
			<v8:Идентификатор>ОтветственныйМКО</v8:Идентификатор>
		</v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
		<v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
			<v8:Ref xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">f9220711-8795-11ec-bb9e-00155d70bd06</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Code>000000134</v8:Code>
			<v8:Description>Способ компенсации</v8:Description>
			<v8:ValueType>
				<Type xmlns="http://v8.1c.ru/8.1/data/core">v8:CatalogRef.КА_ДополнительныеЗначенияАтрибутов</Type>
			</v8:ValueType>
			<v8:Заголовок>Способ компенсации</v8:Заголовок>
			<v8:Список>false</v8:Список>
			<v8:Таблица>false</v8:Таблица>
			<v8:Идентификатор>Рекламация_СпособКомпенсации</v8:Идентификатор>
		</v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
		<v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
			<v8:Ref xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">b41ea743-66f8-11ec-bba8-00155d258b03</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Code>000000117</v8:Code>
			<v8:Description>realizationId</v8:Description>
			<v8:ValueType>
				<Type xmlns="http://v8.1c.ru/8.1/data/core">v8:DocumentRef.РеализацияТоваровУслуг</Type>
			</v8:ValueType>
			<v8:Заголовок>Реализация Товаров и Услуг</v8:Заголовок>
			<v8:Список>false</v8:Список>
			<v8:Таблица>false</v8:Таблица>
			<v8:Идентификатор>realizationId</v8:Идентификатор>
		</v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
		<v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
			<v8:Ref xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">f94c9679-7ab8-11ed-bbb3-00155d258b03</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Code>000000170</v8:Code>
			<v8:Description>ЗаказКлиента</v8:Description>
			<v8:ValueType>
				<Type xmlns="http://v8.1c.ru/8.1/data/core">v8:DocumentRef.ЗаказКлиента</Type>
			</v8:ValueType>
			<v8:Заголовок>Заказ клиента (документ)</v8:Заголовок>
			<v8:Список>false</v8:Список>
			<v8:Таблица>false</v8:Таблица>
			<v8:Идентификатор>ЗаказКлиента</v8:Идентификатор>
		</v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
		<v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
			<v8:Ref xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">f72ce76b-2ae2-11e9-80cc-00155d049008</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Code>000000008</v8:Code>
			<v8:Description>Клиент</v8:Description>
			<v8:ValueType>
				<Type xmlns="http://v8.1c.ru/8.1/data/core">v8:CatalogRef.Партнеры</Type>
			</v8:ValueType>
			<v8:Заголовок>Контрагент</v8:Заголовок>
			<v8:Список>false</v8:Список>
			<v8:Таблица>false</v8:Таблица>
			<v8:Идентификатор>counterparty_external_id</v8:Идентификатор>
		</v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
		<v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
			<v8:Ref xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">cccbef96-673e-11ec-bba8-00155d258b03</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Code>000000118</v8:Code>
			<v8:Description>productId</v8:Description>
			<v8:ValueType>
				<Type xmlns="http://v8.1c.ru/8.1/data/core">v8:CatalogRef.Номенклатура</Type>
			</v8:ValueType>
			<v8:Заголовок>Товар из реализации</v8:Заголовок>
			<v8:Список>false</v8:Список>
			<v8:Таблица>false</v8:Таблица>
			<v8:Идентификатор>productId</v8:Идентификатор>
		</v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
		<v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
			<v8:Ref xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">413c9a50-673f-11ec-bba8-00155d258b03</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Code>000000121</v8:Code>
			<v8:Description>count</v8:Description>
			<v8:ValueType>
				<Type xmlns="http://v8.1c.ru/8.1/data/core">xs:decimal</Type>
				<NumberQualifiers xmlns="http://v8.1c.ru/8.1/data/core">
					<Digits>10</Digits>
					<FractionDigits>3</FractionDigits>
					<AllowedSign>Any</AllowedSign>
				</NumberQualifiers>
			</v8:ValueType>
			<v8:Заголовок>Количество товара к возврату</v8:Заголовок>
			<v8:Список>false</v8:Список>
			<v8:Таблица>false</v8:Таблица>
			<v8:Идентификатор>count</v8:Идентификатор>
		</v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
		<v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
			<v8:Ref xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">a40c9242-5e35-11ec-bba8-00155d258b03</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Code>000000116</v8:Code>
			<v8:Description>description</v8:Description>
			<v8:ValueType>
				<Type xmlns="http://v8.1c.ru/8.1/data/core">xs:string</Type>
				<StringQualifiers xmlns="http://v8.1c.ru/8.1/data/core">
					<Length>0</Length>
					<AllowedLength>Variable</AllowedLength>
				</StringQualifiers>
			</v8:ValueType>
			<v8:Заголовок>Описание рекламации</v8:Заголовок>
			<v8:Список>false</v8:Список>
			<v8:Таблица>false</v8:Таблица>
			<v8:Идентификатор>description</v8:Идентификатор>
		</v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
		<v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
			<v8:Ref xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">b926251e-39ba-11e9-80cc-00155d049008</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Code>000000058</v8:Code>
			<v8:Description>vin</v8:Description>
			<v8:ValueType>
				<Type xmlns="http://v8.1c.ru/8.1/data/core">xs:string</Type>
				<StringQualifiers xmlns="http://v8.1c.ru/8.1/data/core">
					<Length>1024</Length>
					<AllowedLength>Variable</AllowedLength>
				</StringQualifiers>
			</v8:ValueType>
			<v8:Заголовок>vin</v8:Заголовок>
			<v8:Список>false</v8:Список>
			<v8:Таблица>false</v8:Таблица>
			<v8:Идентификатор>vin</v8:Идентификатор>
		</v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
		<v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
			<v8:Ref xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">a7ce5483-67ef-11ec-bba8-00155d258b03</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Code>000000124</v8:Code>
			<v8:Description>model</v8:Description>
			<v8:ValueType>
				<Type xmlns="http://v8.1c.ru/8.1/data/core">xs:string</Type>
				<StringQualifiers xmlns="http://v8.1c.ru/8.1/data/core">
					<Length>1024</Length>
					<AllowedLength>Variable</AllowedLength>
				</StringQualifiers>
			</v8:ValueType>
			<v8:Заголовок>Модель автомобиля</v8:Заголовок>
			<v8:Список>false</v8:Список>
			<v8:Таблица>false</v8:Таблица>
			<v8:Идентификатор>model</v8:Идентификатор>
		</v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
		<v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
			<v8:Ref xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">c41bdd9c-67ef-11ec-bba8-00155d258b03</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Code>000000125</v8:Code>
			<v8:Description>brand</v8:Description>
			<v8:ValueType>
				<Type xmlns="http://v8.1c.ru/8.1/data/core">xs:string</Type>
				<StringQualifiers xmlns="http://v8.1c.ru/8.1/data/core">
					<Length>1024</Length>
					<AllowedLength>Variable</AllowedLength>
				</StringQualifiers>
			</v8:ValueType>
			<v8:Заголовок>Производитель автомобиля</v8:Заголовок>
			<v8:Список>false</v8:Список>
			<v8:Таблица>false</v8:Таблица>
			<v8:Идентификатор>brand</v8:Идентификатор>
		</v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
		<v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
			<v8:Ref xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">3da7cce6-6746-11ec-bba8-00155d258b03</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Code>000000122</v8:Code>
			<v8:Description>defectFound</v8:Description>
			<v8:ValueType>
				<Type xmlns="http://v8.1c.ru/8.1/data/core">v8:CatalogRef.КА_ДополнительныеЗначенияАтрибутов</Type>
			</v8:ValueType>
			<v8:Заголовок>Дефект обнаружен</v8:Заголовок>
			<v8:Список>false</v8:Список>
			<v8:Таблица>false</v8:Таблица>
			<v8:Идентификатор>defectFound</v8:Идентификатор>
		</v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
		<v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
			<v8:Ref xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">82011875-6746-11ec-bba8-00155d258b03</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Code>000000123</v8:Code>
			<v8:Description>installation</v8:Description>
			<v8:ValueType>
				<Type xmlns="http://v8.1c.ru/8.1/data/core">v8:CatalogRef.КА_ДополнительныеЗначенияАтрибутов</Type>
			</v8:ValueType>
			<v8:Заголовок>Установка</v8:Заголовок>
			<v8:Список>false</v8:Список>
			<v8:Таблица>false</v8:Таблица>
			<v8:Идентификатор>installation</v8:Идентификатор>
		</v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
		<v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
			<v8:Ref xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">edb75284-673e-11ec-bba8-00155d258b03</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Code>000000119</v8:Code>
			<v8:Description>installationDate</v8:Description>
			<v8:ValueType>
				<Type xmlns="http://v8.1c.ru/8.1/data/core">xs:dateTime</Type>
				<DateQualifiers xmlns="http://v8.1c.ru/8.1/data/core">
					<DateFractions>Date</DateFractions>
				</DateQualifiers>
			</v8:ValueType>
			<v8:Заголовок>Дата установки</v8:Заголовок>
			<v8:Список>false</v8:Список>
			<v8:Таблица>false</v8:Таблица>
			<v8:Идентификатор>installationDate</v8:Идентификатор>
		</v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
		<v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
			<v8:Ref xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">5953c67e-67f0-11ec-bba8-00155d258b03</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Code>000000126</v8:Code>
			<v8:Description>mileageInstallation</v8:Description>
			<v8:ValueType>
				<Type xmlns="http://v8.1c.ru/8.1/data/core">xs:decimal</Type>
				<NumberQualifiers xmlns="http://v8.1c.ru/8.1/data/core">
					<Digits>15</Digits>
					<FractionDigits>1</FractionDigits>
					<AllowedSign>Any</AllowedSign>
				</NumberQualifiers>
			</v8:ValueType>
			<v8:Заголовок>Пробег к установке</v8:Заголовок>
			<v8:Список>false</v8:Список>
			<v8:Таблица>false</v8:Таблица>
			<v8:Идентификатор>mileageInstallation</v8:Идентификатор>
		</v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
		<v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
			<v8:Ref xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">06653895-673f-11ec-bba8-00155d258b03</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Code>000000120</v8:Code>
			<v8:Description>dismantlingDate</v8:Description>
			<v8:ValueType>
				<Type xmlns="http://v8.1c.ru/8.1/data/core">xs:dateTime</Type>
				<DateQualifiers xmlns="http://v8.1c.ru/8.1/data/core">
					<DateFractions>Date</DateFractions>
				</DateQualifiers>
			</v8:ValueType>
			<v8:Заголовок>Дата демонтажа</v8:Заголовок>
			<v8:Список>false</v8:Список>
			<v8:Таблица>false</v8:Таблица>
			<v8:Идентификатор>dismantlingDate</v8:Идентификатор>
		</v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
		<v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
			<v8:Ref xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">6d505a82-67f0-11ec-bba8-00155d258b03</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Code>000000127</v8:Code>
			<v8:Description>mileageDismantling</v8:Description>
			<v8:ValueType>
				<Type xmlns="http://v8.1c.ru/8.1/data/core">xs:decimal</Type>
				<NumberQualifiers xmlns="http://v8.1c.ru/8.1/data/core">
					<Digits>15</Digits>
					<FractionDigits>1</FractionDigits>
					<AllowedSign>Any</AllowedSign>
				</NumberQualifiers>
			</v8:ValueType>
			<v8:Заголовок>Пробег к демонтажу</v8:Заголовок>
			<v8:Список>false</v8:Список>
			<v8:Таблица>false</v8:Таблица>
			<v8:Идентификатор>mileageDismantling</v8:Идентификатор>
		</v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
		<v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
			<v8:Ref xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">94c4c7f2-8e55-11ec-bb9e-00155d70bd06</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Code>000000140</v8:Code>
			<v8:Description>Компенсация</v8:Description>
			<v8:ValueType>
				<Type xmlns="http://v8.1c.ru/8.1/data/core">v8:CatalogRef.КА_ДополнительныеЗначенияАтрибутов</Type>
			</v8:ValueType>
			<v8:Заголовок>Компенсация</v8:Заголовок>
			<v8:Список>false</v8:Список>
			<v8:Таблица>false</v8:Таблица>
			<v8:Идентификатор>Компенсация</v8:Идентификатор>
		</v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
		<v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
			<v8:Ref xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">acfbb3b4-8e55-11ec-bb9e-00155d70bd06</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Code>000000141</v8:Code>
			<v8:Description>ВидОформленияДокументов</v8:Description>
			<v8:ValueType>
				<Type xmlns="http://v8.1c.ru/8.1/data/core">v8:EnumRef.КА_ВидыОформленияВозвратныхДокументов</Type>
			</v8:ValueType>
			<v8:Заголовок>ВидОформленияДокументов</v8:Заголовок>
			<v8:Список>false</v8:Список>
			<v8:Таблица>false</v8:Таблица>
			<v8:Идентификатор>ВидОформленияДокументов</v8:Идентификатор>
		</v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
		<v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
			<v8:Ref xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">b5cd8a51-8e55-11ec-bb9e-00155d70bd06</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Code>000000142</v8:Code>
			<v8:Description>СпособОформленияВозврата</v8:Description>
			<v8:ValueType>
				<Type xmlns="http://v8.1c.ru/8.1/data/core">v8:CatalogRef.КА_ДополнительныеЗначенияАтрибутов</Type>
			</v8:ValueType>
			<v8:Заголовок>СпособОформленияВозврата</v8:Заголовок>
			<v8:Список>false</v8:Список>
			<v8:Таблица>false</v8:Таблица>
			<v8:Идентификатор>СпособОформленияВозврата</v8:Идентификатор>
		</v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
		<v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
			<v8:Ref xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">c27fe7b5-8e55-11ec-bb9e-00155d70bd06</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Code>000000143</v8:Code>
			<v8:Description>Проверено</v8:Description>
			<v8:ValueType>
				<Type xmlns="http://v8.1c.ru/8.1/data/core">xs:boolean</Type>
			</v8:ValueType>
			<v8:Заголовок>Проверено</v8:Заголовок>
			<v8:Список>false</v8:Список>
			<v8:Таблица>false</v8:Таблица>
			<v8:Идентификатор>Проверено</v8:Идентификатор>
		</v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
		<v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
			<v8:Ref xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">cd3d1690-8e55-11ec-bb9e-00155d70bd06</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Code>000000144</v8:Code>
			<v8:Description>СтатусСогласованияЗВТК</v8:Description>
			<v8:ValueType>
				<Type xmlns="http://v8.1c.ru/8.1/data/core">v8:CatalogRef.КА_ДополнительныеЗначенияАтрибутов</Type>
			</v8:ValueType>
			<v8:Заголовок>СтатусСогласованияЗВТК</v8:Заголовок>
			<v8:Список>false</v8:Список>
			<v8:Таблица>false</v8:Таблица>
			<v8:Идентификатор>СтатусСогласованияЗВТК</v8:Идентификатор>
		</v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
		<v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
			<v8:Ref xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">7070b387-2ac0-11e9-80cc-00155d049008</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Code>000000001</v8:Code>
			<v8:Description>incident_id</v8:Description>
			<v8:ValueType>
				<Type xmlns="http://v8.1c.ru/8.1/data/core">xs:decimal</Type>
				<NumberQualifiers xmlns="http://v8.1c.ru/8.1/data/core">
					<Digits>15</Digits>
					<FractionDigits>0</FractionDigits>
					<AllowedSign>Nonnegative</AllowedSign>
				</NumberQualifiers>
			</v8:ValueType>
			<v8:Заголовок>ID</v8:Заголовок>
			<v8:Список>false</v8:Список>
			<v8:Таблица>false</v8:Таблица>
			<v8:Идентификатор>id</v8:Идентификатор>
		</v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
		<v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
			<v8:Ref xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">f50dd77c-7e9a-11ec-bb9e-00155d70bd06</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Code>000000129</v8:Code>
			<v8:Description>Файлы рекламации</v8:Description>
			<v8:ValueType>
				<Type xmlns="http://v8.1c.ru/8.1/data/core">xs:string</Type>
				<StringQualifiers xmlns="http://v8.1c.ru/8.1/data/core">
					<Length>0</Length>
					<AllowedLength>Variable</AllowedLength>
				</StringQualifiers>
			</v8:ValueType>
			<v8:Заголовок>Файлы рекламации</v8:Заголовок>
			<v8:Список>true</v8:Список>
			<v8:Таблица>false</v8:Таблица>
			<v8:Идентификатор>ФайлыРекламации</v8:Идентификатор>
		</v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
		<v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
			<v8:Ref xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">7729298e-bf2c-11ec-bba2-00155d70bd06</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Code>000000115</v8:Code>
			<v8:Description>ДокументПоступления</v8:Description>
			<v8:ValueType>
				<Type xmlns="http://v8.1c.ru/8.1/data/core">v8:DocumentRef.ПоступлениеТоваровУслуг</Type>
			</v8:ValueType>
			<v8:Заголовок>Документ Поступления</v8:Заголовок>
			<v8:Список>true</v8:Список>
			<v8:Таблица>false</v8:Таблица>
			<v8:Идентификатор>ДокументПоступления</v8:Идентификатор>
		</v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
		<v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
			<v8:Ref xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">6681ac20-7ab9-11ed-bbb3-00155d258b03</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Code>000000171</v8:Code>
			<v8:Description>Экспорт</v8:Description>
			<v8:ValueType>
				<Type xmlns="http://v8.1c.ru/8.1/data/core">xs:boolean</Type>
			</v8:ValueType>
			<v8:Заголовок>Экспорт</v8:Заголовок>
			<v8:Список>false</v8:Список>
			<v8:Таблица>false</v8:Таблица>
			<v8:Идентификатор>Экспорт</v8:Идентификатор>
		</v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
		<v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
			<v8:Ref xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">6ebbf22b-7bbc-11ed-bbb3-00155d258b03</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Code>000000172</v8:Code>
			<v8:Description>СкладскаяЯчейка</v8:Description>
			<v8:ValueType>
				<Type xmlns="http://v8.1c.ru/8.1/data/core">v8:CatalogRef.СкладскиеЯчейки</Type>
			</v8:ValueType>
			<v8:Заголовок>Складская ячейка</v8:Заголовок>
			<v8:Список>false</v8:Список>
			<v8:Таблица>false</v8:Таблица>
			<v8:Идентификатор>СкладскаяЯчейка</v8:Идентификатор>
		</v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
		<v8:CatalogObject.КА_ЭтапыИнцидентов>
			<v8:Ref xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">d4c8e7bf-8e57-11ec-bb9e-00155d70bd06</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Owner xsi:type="v8:CatalogRef.КА_ВидыИнцидентов">fe697b45-4e2c-11ec-bba8-00155d258b03</v8:Owner>
			<v8:Code>000000054</v8:Code>
			<v8:Description>Завершен. Компенсация зачтена</v8:Description>
			<v8:АвтоматическийСтартЭтапа>true</v8:АвтоматическийСтартЭтапа>
			<v8:АвтоматическоеЗавершениеЭтапа>true</v8:АвтоматическоеЗавершениеЭтапа>
			<v8:АтрибутыНедоступны>false</v8:АтрибутыНедоступны>
			<v8:АтрибутыСкрыты>false</v8:АтрибутыСкрыты>
			<v8:ЗавершающийЭтап>false</v8:ЗавершающийЭтап>
			<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">00000000-0000-0000-0000-000000000000</v8:Исполнитель>
			<v8:ОбработчикПередВыполнением/>
			<v8:ОбработчикПередЗаписью>ТаблицаАтрибутов = ЭтотОбъект.ЗначенияАтрибутов.Выгрузить();
	ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "ВозвратУтилизация"); 
	СтрИзменение = ТаблицаАтрибутов.Найти(ВыбАтрибут,"Атрибут");
	Если не ЗначениеЗаполнено(СтрИзменение) Тогда
		СтрИзменение = ТаблицаАтрибутов.Добавить();
		СтрИзменение.Атрибут = ВыбАтрибут;
	КонецЕсли;
ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "Экспертиза");
Стр = ТаблицаАтрибутов.Найти(ВыбАтрибут, "Атрибут");
ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "ТоварВернуть");
ТовВерн = ТаблицаАтрибутов.Найти(ВыбАтрибут, "Атрибут");

Если (Стр = Неопределено или Стр.Значение = Перечисления.КА_ДоставитьТоварНаЭкспертизу.Нет) и (ТовВерн = Неопределено или ТовВерн.Значение = Ложь) Тогда
	СтрИзменение.Значение = Перечисления.КА_ВозвратУтилизация.НеТребуется;
ИначеЕсли (не Стр = Неопределено и Стр.Значение = Перечисления.КА_ДоставитьТоварНаЭкспертизу.Да) и (не СтрИзменение=Неопределено и не СтрИзменение.Значение = Перечисления.КА_ВозвратУтилизация.ДетальУтилизирована) Тогда
	СтрИзменение.Значение = Перечисления.КА_ВозвратУтилизация.ОжидаетсяУтилизацииДетали;
ИначеЕсли ТовВерн = Неопределено и ТовВерн.Значение = Истина Тогда
	СтрИзменение.Значение = Перечисления.КА_ВозвратУтилизация.ОжидаетсяУтилизацииДетали;
КонецЕсли;
ЭтотОбъект.ЗначенияАтрибутов.Загрузить(ТаблицаАтрибутов);

Инцидент = ЭтотОбъект;
Если не Инцидент.Товары.Количество() = 0 Тогда
	ДокументИнцидент = Инцидент.Ссылка;
	ДокументРеализации = Инцидент.ПолучитьАтрибутИнцидента("realizationId");
	ПартнерПокупатель = ДокументРеализации.Партнер;
	ПартнерРегион = ПартнерПокупатель.БизнесРегион;
	ПартнерОсновнойМенеджер = ПартнерПокупатель.КА_ОсновнойКураторПокупателя;
	Поставщик = Справочники.Партнеры.ПустаяСсылка();
	Для каждого ТекСтр из ДокументИнцидент.СвязанныеОбъекты Цикл
		Если ТекСтр.Объект.Ссылка.Метаданные().Имя = "ПоступлениеТоваровУслуг" Тогда
			ДокПоступление = ТекСтр.Объект.Ссылка;	
			Поставщик = ДокПоступление.Партнер;	
		ИначеЕсли ТекСтр.Объект.Ссылка.Метаданные().Имя = "РеализацияТоваровУслуг" Тогда
				ДокументРеализации = ТекСтр.Объект.Ссылка;
		КонецЕсли;
	КонецЦикла;
	ТаблицаДвижений = Инцидент.ПолучитьСписокПараметровПроведения(Истина);
//Строка 16
	Для Каждого ТекСтрокаТовары Из Инцидент.Товары Цикл
		Движение = ТаблицаДвижений.Добавить();
		Движение.ВидИнцидента = Инцидент.ВидИнцидента;
		Движение.ЭтапИнцидента =  Инцидент.ТекущийЭтап;
		Движение.ВидДвижения = ВидДвиженияНакопления.Расход;
		Движение.Период = Инцидент.Ссылка.Дата;
		Движение.НоменклатураБренд = ТекСтрокаТовары.Номенклатура.Производитель;
		Движение.ТоварнаяГруппа = ТекСтрокаТовары.Номенклатура.ВидНоменклатуры;
		Движение.Номенклатура = ТекСтрокаТовары.Номенклатура;
		Движение.ДокументРеализации = ДокументРеализации;
		Движение.ДокументРекламации = ДокументИнцидент;
		Движение.Партнер = ПартнерПокупатель;
		Движение.Валюта = ТекСтрокаТовары.Валюта;
		Движение.ПартнерБизнесРегион = ПартнерРегион;
		Движение.ПартнерОсновнойМенеджер = ПартнерОсновнойМенеджер;
		Движение.АналитикаДефекта = ТекСтрокаТовары.АналитикаДефекта;
		Движение.КоличествоККомпенсации = 0;
		Движение.КоличествоКомпенсированоКлиенту = ТекСтрокаТовары.Количество;
		Движение.КоличествоПредъявленоПоставщику = 0;
		Движение.КоличествоКомпенсированоПоставщиком = 0;
		Движение.СуммаВал = ТекСтрокаТовары.Сумма;//СуммаВВалюте;
		Движение.СуммаБезНДСВал = ТекСтрокаТовары.СуммаСНДС-ТекСтрокаТовары.СуммаНДС;//СуммаВВалютеБезНДС;
		Движение.Сумма = ТекСтрокаТовары.Сумма;
		Движение.СуммаБезНДС = ТекСтрокаТовары.СуммаСНДС-ТекСтрокаТовары.СуммаНДС;
		Движение.РеализацияТоваровУслуг = ДокументРеализации;
		Движение.ДокументИнцидент = ДокументИнцидент;
		Движение.Склад = ТекСтрокаТовары.Склад;
		Движение.Регион = ТекСтрокаТовары.Склад.БизнесРегион;
		Движение.Поставщик = Поставщик;
		Движение.РешениеПоИнциденту = Инцидент.ПолучитьАтрибутИнцидента("РешениеИнженера");
	КонецЦикла;
	Инцидент. УстановитьСписокПараметровПроведения(Инцидент.ВидИнцидента, Инцидент.ТекущийЭтап, ТаблицаДвижений);
КонецЕсли;

</v8:ОбработчикПередЗаписью>
			<v8:ОбработчикПослеВыполнения/>
			<v8:ОбработчикПриЗаписи/>
			<v8:ОбработчикПриПереходе>Инцидент.СтатусИМ = Перечисления.КА_СтатусИМ.РекламацияЗавершенаКомпенсацияПредоставлена;
Инцидент.КА_СтатусЗавершен= Перечисления.КА_СтатусЗавершенияИМ.КомпенсацияЗачтена;
//Обрабатываем Пользователей  в поля инцидента по этапу 
Для Каждого Стр из Инцидент.ИсторияВыполнения Цикл
	Если ЗначениеЗаполнено(Стр.Этап) Тогда
	Если СтрНайти(Стр.Этап.Наименование,"Рекламация: Обработка инцидента") Тогда
		Инцидент.Ответственный = Стр.Исполнитель;
		Прервать;
	КонецЕсли;
	КонецЕсли;
КонецЦикла;

// Отправка статуса

НастройкаОбмена = Справочники.КА_НастройкиВыгрузкиВИМ.ПолучитьНастройку("Рекламация_СобытиеВыгрузкаСтатуса");

СоответствиеСтатусов = Новый Соответствие;
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ЗапросОтправлен, "SENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВРаботеУМенеджера, "PROCESS_BY_MANAGER");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.УточнитеДанныеОбращения, "CLARIFY_DETAILS");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВРаботеУИнженера, "PROCESS_BY_ENGINEER");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияПринятаВРаботуГарантийнымОтделом, "PROCESS_BY_WARRANTY_DEPARTMENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияПринятаУточняемСрокРассмотрения, "ACCEPTED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВозвратДеталиНаЭкспертизу, "EXPERTIZE");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОдобренаВыберитеСпособКомпенсации, "APPROVED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОтклоненаОзнакомьтесьСЗаключением, "REJECTED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ЗакрытоИПеренесеноВархивПоСрокуДавности, "CLOSED_ON_EXPIRATION");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияЗавершенаКлиентСогласен, "CLOSED_ON_AGREEMENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияЗавершенаКомпенсацияПредоставлена, "COMPENSATED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламациНаправленаВОтделКорпоративныхПродаж, "SENT_TO_SALES");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОдобрена50ВыберитеСпособКомпенсации, "APPROVED_50");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОтклоненаПовторно, "REJECTED_REPEATEDLY");

СтрДанных = Новый Структура;
СтрДанных.Вставить("complaintId", ЗначенияАтрибутов["id"]);
СтрДанных.Вставить("status", СоответствиеСтатусов[Инцидент.СтатусИМ]);

КА_Обмены.ОтправитьВСервис_Рефакторинг(СтрДанных, НастройкаОбмена, "ИМ2");

// Рассылка
Получатели = Новый Массив;
Вложения = Новый Соответствие;

ДокРТС = ЗначенияАтрибутов["realizationId"];
Партнер = ДокРТС.Партнер;

Адрес = УправлениеКонтактнойИнформацией.КонтактнаяИнформацияОбъекта(Партнер, Справочники.ВидыКонтактнойИнформации.EmailПартнера);
		
Если ЗначениеЗаполнено(Адрес) Тогда
	Получатели.Добавить(Новый Структура("Адрес, Представление", Адрес, Адрес));
КонецЕсли; 
	
Если Получатели.Количество() &gt; 0 Тогда

	Отправитель = Справочники.УчетныеЗаписиЭлектроннойПочты.СистемнаяУчетнаяЗаписьЭлектроннойПочты;
				
	Тема = "Обработка рекламации";
	ТекстПисьма = "Спасибо за обращение, надеемся Вам все понравилось.";	
			
	ПараметрыПисьма = Новый Структура;
	ПараметрыПисьма.Вставить("Кому",Получатели);
	ПараметрыПисьма.Вставить("Тема", Тема);
	ПараметрыПисьма.Вставить("Тело", ТекстПисьма);
	ПараметрыПисьма.Вставить("Вложения", Вложения);
				
	Попытка
		ИдентификаторСообщения = РаботаСПочтовымиСообщениями.ОтправитьПочтовоеСообщение(Отправитель, ПараметрыПисьма);
	Исключение
		Ошибка = ОписаниеОшибки();
		Сообщить(СтрШаблон("При отправке письма произошла ошибка: %1", Ошибка));
	КонецПопытки; 
		
КонецЕсли;

// Рассылка исполнителям
Тема = СтрШаблон("Рекламация %1 завершена", Инцидент.Номер);
ТекстПисьма = "Компенсация зачтена.";
Документы.КА_Инцидент.ОтправитьОповещениеИсполнителямЭтапа(СледующийЭтап, Тема, ТекстПисьма);</v8:ОбработчикПриПереходе>
			<v8:ОбработчикПриПринятииКИсполнению/>
			<v8:ОбработчикПроведения/>
			<v8:Описание>Завершение после оформления документа Возарат товара от клиента.</v8:Описание>
			<v8:ПроверятьРезультат>false</v8:ПроверятьРезультат>
			<v8:СрокВыполнения>1</v8:СрокВыполнения>
			<v8:СообщениеНедоступныПереходы/>
			<v8:ОбработчикПриОткрытии/>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">3ab46ee4-8b6b-4e27-b05f-aa6c943c5895</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">6547e112-2de4-4388-82f0-4b24ca0eee42</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">6d160a64-dd08-11e4-b0fd-001517ac6c09</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">f6af22ec-7751-4f7a-bc7e-df85edb3c04f</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">19daaf30-9a1a-11e8-80c5-3cfdfeaf9019</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">97eb7d45-6782-4b33-9909-457572becfa8</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">b783b0ba-74ad-11e1-b634-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">812e0c18-3beb-11e8-80d0-001e6707aaa8</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">f149ab7d-7ada-11e8-80c5-3cfdfeaf9019</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">58a84576-77c0-4e0e-b065-1be30ab00af9</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">0cafad1c-4262-11e1-b48c-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">c34b8004-ec1d-11e5-80c5-001e6707aaa8</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">ddcd8a22-00dc-11e4-9396-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">a0477a02-97f8-11e5-9a83-001517ac6c09</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">27b1b5ed-427b-11e6-80c3-0cc47a6b63cf</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Команды>
				<v8:Заголовок>Сформировать поле ЗаявкаНаВозврат</v8:Заголовок>
				<v8:УИ>75ac73c3-1e6b-425f-9b12-3a9fac603b01</v8:УИ>
				<v8:ОбработчикКлиентПеред/>
				<v8:ОбработчикСервер>НовСтр = Объект.ЗначенияАтрибутов.Добавить();
НовСтр.Атрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоНаименованию("ЗаявкаНаВозврат");
НовСтр.Значение = Документы.ЗаявкаНаВозврат.ПустаяСсылка();
Объект.Записать();
</v8:ОбработчикСервер>
				<v8:ОбработчикКлиентПосле/>
			</v8:Команды>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">ae2bfd6f-8798-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">c10475bc-8798-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">7770acee-8e55-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">20e9e340-bc98-11ec-bbaf-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">1e160f11-bca1-11ec-bba2-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">e983c36e-bc97-11ec-bbaf-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">455e5227-8e55-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">c9ae9a45-d6cc-11ec-bbaf-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
		</v8:CatalogObject.КА_ЭтапыИнцидентов>
		<v8:CatalogObject.КА_ЭтапыИнцидентов>
			<v8:Ref xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">0358fd4f-8e58-11ec-bb9e-00155d70bd06</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Owner xsi:type="v8:CatalogRef.КА_ВидыИнцидентов">fe697b45-4e2c-11ec-bba8-00155d258b03</v8:Owner>
			<v8:Code>000000055</v8:Code>
			<v8:Description>Завершен. Компенсация перечислена</v8:Description>
			<v8:АвтоматическийСтартЭтапа>true</v8:АвтоматическийСтартЭтапа>
			<v8:АвтоматическоеЗавершениеЭтапа>true</v8:АвтоматическоеЗавершениеЭтапа>
			<v8:АтрибутыНедоступны>false</v8:АтрибутыНедоступны>
			<v8:АтрибутыСкрыты>false</v8:АтрибутыСкрыты>
			<v8:ЗавершающийЭтап>false</v8:ЗавершающийЭтап>
			<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">00000000-0000-0000-0000-000000000000</v8:Исполнитель>
			<v8:ОбработчикПередВыполнением/>
			<v8:ОбработчикПередЗаписью>УстановитьПривилегированныйРежим(Истина);
ТаблицаАтрибутов = ЭтотОбъект.ЗначенияАтрибутов.Выгрузить();
	ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "ВозвратУтилизация"); 
	СтрИзменение = ТаблицаАтрибутов.Найти(ВыбАтрибут,"Атрибут");
	Если не ЗначениеЗаполнено(СтрИзменение) Тогда
		СтрИзменение = ТаблицаАтрибутов.Добавить();
		СтрИзменение.Атрибут = ВыбАтрибут;
	КонецЕсли;
ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "Экспертиза");
Стр = ТаблицаАтрибутов.Найти(ВыбАтрибут, "Атрибут");
ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "ТоварВернуть");
ТовВерн = ТаблицаАтрибутов.Найти(ВыбАтрибут, "Атрибут");

Если (Стр = Неопределено или Стр.Значение = Перечисления.КА_ДоставитьТоварНаЭкспертизу.Нет) и (ТовВерн = Неопределено или ТовВерн.Значение = Ложь) Тогда
	СтрИзменение.Значение = Перечисления.КА_ВозвратУтилизация.НеТребуется;
ИначеЕсли (не Стр = Неопределено и Стр.Значение = Перечисления.КА_ДоставитьТоварНаЭкспертизу.Да) и (не СтрИзменение=Неопределено и не СтрИзменение.Значение = Перечисления.КА_ВозвратУтилизация.ДетальУтилизирована) Тогда
	СтрИзменение.Значение = Перечисления.КА_ВозвратУтилизация.ОжидаетсяУтилизацииДетали;
ИначеЕсли ТовВерн = Неопределено и ТовВерн.Значение = Истина Тогда
	СтрИзменение.Значение = Перечисления.КА_ВозвратУтилизация.ОжидаетсяУтилизацииДетали;
КонецЕсли;
ЭтотОбъект.ЗначенияАтрибутов.Загрузить(ТаблицаАтрибутов);


Инцидент = ЭтотОбъект;
Если не Инцидент.Товары.Количество() = 0 Тогда
	ДокументИнцидент = Инцидент.Ссылка;
	ДокументРеализации = Инцидент.ПолучитьАтрибутИнцидента("realizationId");
	ПартнерПокупатель = ДокументРеализации.Партнер;
	ПартнерРегион = ПартнерПокупатель.БизнесРегион;
	ПартнерОсновнойМенеджер = ПартнерПокупатель.КА_ОсновнойКураторПокупателя;
	Поставщик = Справочники.Партнеры.ПустаяСсылка();
	Для каждого ТекСтр из ДокументИнцидент.СвязанныеОбъекты Цикл
		Если ТекСтр.Объект.Ссылка.Метаданные().Имя = "ПоступлениеТоваровУслуг" Тогда
			ДокПоступление = ТекСтр.Объект.Ссылка;	
			Поставщик = ДокПоступление.Партнер;	
		ИначеЕсли ТекСтр.Объект.Ссылка.Метаданные().Имя = "РеализацияТоваровУслуг" Тогда
				ДокументРеализации = ТекСтр.Объект.Ссылка;
		КонецЕсли;
	КонецЦикла;
	ТаблицаДвижений = Инцидент.ПолучитьСписокПараметровПроведения(Истина);
//Строка 16
	Для Каждого ТекСтрокаТовары Из Инцидент.Товары Цикл
		Движение = ТаблицаДвижений.Добавить();
		Движение.ВидИнцидента = Инцидент.ВидИнцидента;
		Движение.ЭтапИнцидента =  Инцидент.ТекущийЭтап;
		Движение.ВидДвижения = ВидДвиженияНакопления.Приход;
		Движение.Период = Инцидент.Ссылка.Дата;
		Движение.НоменклатураБренд = ТекСтрокаТовары.Номенклатура.Производитель;
		Движение.ТоварнаяГруппа = ТекСтрокаТовары.Номенклатура.ВидНоменклатуры;
		Движение.Номенклатура = ТекСтрокаТовары.Номенклатура;
		Движение.ДокументРеализации = ДокументРеализации;
		Движение.ДокументРекламации = ДокументИнцидент;
		Движение.Партнер = ПартнерПокупатель;
		Движение.Валюта = ТекСтрокаТовары.Валюта;
		Движение.ПартнерБизнесРегион = ПартнерРегион;
		Движение.ПартнерОсновнойМенеджер = ПартнерОсновнойМенеджер;
		Движение.АналитикаДефекта = ТекСтрокаТовары.АналитикаДефекта;
		Движение.КоличествоККомпенсации = 0;
		Движение.КоличествоКомпенсированоКлиенту = ТекСтрокаТовары.Количество;
		Движение.КоличествоПредъявленоПоставщику = 0;
		Движение.КоличествоКомпенсированоПоставщиком = 0;
		Движение.СуммаВал = ТекСтрокаТовары.Сумма;//СуммаВВалюте;
		Движение.СуммаБезНДСВал = ТекСтрокаТовары.СуммаСНДС-ТекСтрокаТовары.СуммаНДС;//СуммаВВалютеБезНДС;
		Движение.Сумма = ТекСтрокаТовары.Сумма;
		Движение.СуммаБезНДС = ТекСтрокаТовары.СуммаСНДС-ТекСтрокаТовары.СуммаНДС;
		Движение.РеализацияТоваровУслуг = ДокументРеализации;
		Движение.ДокументИнцидент = ДокументИнцидент;
		Движение.Склад = ТекСтрокаТовары.Склад;
		Движение.Регион = ТекСтрокаТовары.Склад.БизнесРегион;
		Движение.Поставщик = Поставщик;
		Движение.РешениеПоИнциденту = Инцидент.ПолучитьАтрибутИнцидента("РешениеИнженера");
	КонецЦикла;
	Инцидент. УстановитьСписокПараметровПроведения(Инцидент.ВидИнцидента, Инцидент.ТекущийЭтап, ТаблицаДвижений);
КонецЕсли;
УстановитьПривилегированныйРежим(Ложь);

</v8:ОбработчикПередЗаписью>
			<v8:ОбработчикПослеВыполнения/>
			<v8:ОбработчикПриЗаписи/>
			<v8:ОбработчикПриПереходе>Инцидент.СтатусИМ = Перечисления.КА_СтатусИМ.РекламацияЗавершенаКомпенсацияПредоставлена;
Инцидент.КА_СтатусЗавершен= Перечисления.КА_СтатусЗавершенияИМ.КомпенсацияПеречислена;
//Обрабатываем Пользователей  в поля инцидента по этапу 
Для Каждого Стр из Инцидент.ИсторияВыполнения Цикл
	Если ЗначениеЗаполнено(Стр.Этап) Тогда
	Если СтрНайти(Стр.Этап.Наименование,"Рекламация: Обработка инцидента") Тогда
		Инцидент.Ответственный = Стр.Исполнитель;
		Прервать;
	КонецЕсли;
	КонецЕсли;
КонецЦикла;

// Отправка статуса

НастройкаОбмена = Справочники.КА_НастройкиВыгрузкиВИМ.ПолучитьНастройку("Рекламация_СобытиеВыгрузкаСтатуса");

СоответствиеСтатусов = Новый Соответствие;
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ЗапросОтправлен, "SENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВРаботеУМенеджера, "PROCESS_BY_MANAGER");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.УточнитеДанныеОбращения, "CLARIFY_DETAILS");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВРаботеУИнженера, "PROCESS_BY_ENGINEER");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияПринятаВРаботуГарантийнымОтделом, "PROCESS_BY_WARRANTY_DEPARTMENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияПринятаУточняемСрокРассмотрения, "ACCEPTED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВозвратДеталиНаЭкспертизу, "EXPERTIZE");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОдобренаВыберитеСпособКомпенсации, "APPROVED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОтклоненаОзнакомьтесьСЗаключением, "REJECTED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ЗакрытоИПеренесеноВархивПоСрокуДавности, "CLOSED_ON_EXPIRATION");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияЗавершенаКлиентСогласен, "CLOSED_ON_AGREEMENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияЗавершенаКомпенсацияПредоставлена, "COMPENSATED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламациНаправленаВОтделКорпоративныхПродаж, "SENT_TO_SALES");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОдобрена50ВыберитеСпособКомпенсации, "APPROVED_50");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОтклоненаПовторно, "REJECTED_REPEATEDLY");

СтрДанных = Новый Структура;
СтрДанных.Вставить("complaintId", ЗначенияАтрибутов["id"]);
СтрДанных.Вставить("status", СоответствиеСтатусов[Инцидент.СтатусИМ]);

КА_Обмены.ОтправитьВСервис_Рефакторинг(СтрДанных, НастройкаОбмена, "ИМ2");

// Рассылка
Получатели = Новый Массив;
Вложения = Новый Соответствие;

ДокРТС = ЗначенияАтрибутов["realizationId"];
Партнер = ДокРТС.Партнер;

Адрес = УправлениеКонтактнойИнформацией.КонтактнаяИнформацияОбъекта(Партнер, Справочники.ВидыКонтактнойИнформации.EmailПартнера);
		
Если ЗначениеЗаполнено(Адрес) Тогда
	Получатели.Добавить(Новый Структура("Адрес, Представление", Адрес, Адрес));
КонецЕсли; 
	
Если Получатели.Количество() &gt; 0 Тогда

	Отправитель = Справочники.УчетныеЗаписиЭлектроннойПочты.СистемнаяУчетнаяЗаписьЭлектроннойПочты;
				
	Тема = "Обработка рекламации";
	ТекстПисьма = "Спасибо за обращение, надеемся Вам все понравилось.";	
			
	ПараметрыПисьма = Новый Структура;
	ПараметрыПисьма.Вставить("Кому",Получатели);
	ПараметрыПисьма.Вставить("Тема", Тема);
	ПараметрыПисьма.Вставить("Тело", ТекстПисьма);
	ПараметрыПисьма.Вставить("Вложения", Вложения);
				
	Попытка
		ИдентификаторСообщения = РаботаСПочтовымиСообщениями.ОтправитьПочтовоеСообщение(Отправитель, ПараметрыПисьма);
	Исключение
		Ошибка = ОписаниеОшибки();
		Сообщить(СтрШаблон("При отправке письма произошла ошибка: %1", Ошибка));
	КонецПопытки; 
		
КонецЕсли;

// Рассылка исполнителям
Тема = СтрШаблон("Рекламация %1 завершена", Инцидент.Номер);
ТекстПисьма = "Компенсация перечислена.";
Документы.КА_Инцидент.ОтправитьОповещениеИсполнителямЭтапа(СледующийЭтап, Тема, ТекстПисьма);</v8:ОбработчикПриПереходе>
			<v8:ОбработчикПриПринятииКИсполнению/>
			<v8:ОбработчикПроведения/>
			<v8:Описание>Завершение после оформления документа Возарат товара от клиента и перечисления средств клиенту</v8:Описание>
			<v8:ПроверятьРезультат>false</v8:ПроверятьРезультат>
			<v8:СрокВыполнения>1</v8:СрокВыполнения>
			<v8:СообщениеНедоступныПереходы/>
			<v8:ОбработчикПриОткрытии/>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">f149ab7d-7ada-11e8-80c5-3cfdfeaf9019</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">c9ae9a45-d6cc-11ec-bbaf-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
		</v8:CatalogObject.КА_ЭтапыИнцидентов>
		<v8:CatalogObject.КА_ЭтапыИнцидентов>
			<v8:Ref xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">7e7bc00e-8e58-11ec-bb9e-00155d70bd06</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Owner xsi:type="v8:CatalogRef.КА_ВидыИнцидентов">fe697b45-4e2c-11ec-bba8-00155d258b03</v8:Owner>
			<v8:Code>000000057</v8:Code>
			<v8:Description>Завершен. Компенсировано товаром</v8:Description>
			<v8:АвтоматическийСтартЭтапа>true</v8:АвтоматическийСтартЭтапа>
			<v8:АвтоматическоеЗавершениеЭтапа>true</v8:АвтоматическоеЗавершениеЭтапа>
			<v8:АтрибутыНедоступны>false</v8:АтрибутыНедоступны>
			<v8:АтрибутыСкрыты>false</v8:АтрибутыСкрыты>
			<v8:ЗавершающийЭтап>false</v8:ЗавершающийЭтап>
			<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">00000000-0000-0000-0000-000000000000</v8:Исполнитель>
			<v8:ОбработчикПередВыполнением/>
			<v8:ОбработчикПередЗаписью>УстановитьПривилегированныйРежим(Истина);

ТаблицаАтрибутов = ЭтотОбъект.ЗначенияАтрибутов.Выгрузить();
	ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "ВозвратУтилизация"); 
	СтрИзменение = ТаблицаАтрибутов.Найти(ВыбАтрибут,"Атрибут");
	Если не ЗначениеЗаполнено(СтрИзменение) Тогда
		СтрИзменение = ТаблицаАтрибутов.Добавить();
		СтрИзменение.Атрибут = ВыбАтрибут;
	КонецЕсли;
ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "Экспертиза");
Стр = ТаблицаАтрибутов.Найти(ВыбАтрибут, "Атрибут");
ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "ТоварВернуть");
ТовВерн = ТаблицаАтрибутов.Найти(ВыбАтрибут, "Атрибут");

Если (Стр = Неопределено или Стр.Значение = Перечисления.КА_ДоставитьТоварНаЭкспертизу.Нет) и (ТовВерн = Неопределено или ТовВерн.Значение = Ложь) Тогда
	СтрИзменение.Значение = Перечисления.КА_ВозвратУтилизация.НеТребуется;
ИначеЕсли (не Стр = Неопределено и Стр.Значение = Перечисления.КА_ДоставитьТоварНаЭкспертизу.Да) и (не СтрИзменение=Неопределено и не СтрИзменение.Значение = Перечисления.КА_ВозвратУтилизация.ДетальУтилизирована) Тогда
	СтрИзменение.Значение = Перечисления.КА_ВозвратУтилизация.ОжидаетсяУтилизацииДетали;
ИначеЕсли ТовВерн = Неопределено и ТовВерн.Значение = Истина Тогда
	СтрИзменение.Значение = Перечисления.КА_ВозвратУтилизация.ОжидаетсяУтилизацииДетали;
КонецЕсли;
ЭтотОбъект.ЗначенияАтрибутов.Загрузить(ТаблицаАтрибутов);

Инцидент = ЭтотОбъект;
Если не Инцидент.Товары.Количество() = 0 Тогда
	ДокументИнцидент = Инцидент.Ссылка;
	ДокументРеализации = Инцидент.ПолучитьАтрибутИнцидента("realizationId");
	ПартнерПокупатель = ДокументРеализации.Партнер;
	ПартнерРегион = ПартнерПокупатель.БизнесРегион;
	ПартнерОсновнойМенеджер = ПартнерПокупатель.КА_ОсновнойКураторПокупателя;
	Поставщик = Справочники.Партнеры.ПустаяСсылка();
	Для каждого ТекСтр из ДокументИнцидент.СвязанныеОбъекты Цикл
		Если ТекСтр.Объект.Ссылка.Метаданные().Имя = "ПоступлениеТоваровУслуг" Тогда
			ДокПоступление = ТекСтр.Объект.Ссылка;	
			Поставщик = ДокПоступление.Партнер;	
		ИначеЕсли ТекСтр.Объект.Ссылка.Метаданные().Имя = "РеализацияТоваровУслуг" Тогда
				ДокументРеализации = ТекСтр.Объект.Ссылка;
		КонецЕсли;
	КонецЦикла;
	ТаблицаДвижений = Инцидент.ПолучитьСписокПараметровПроведения(Истина);
//Строка 16
	Для Каждого ТекСтрокаТовары Из Инцидент.Товары Цикл
		Движение = ТаблицаДвижений.Добавить();
		Движение.ВидИнцидента = Инцидент.ВидИнцидента;
		Движение.ЭтапИнцидента =  Инцидент.ТекущийЭтап;
		Движение.ВидДвижения = ВидДвиженияНакопления.Приход;
		Движение.Период = Инцидент.Ссылка.Дата;
		Движение.НоменклатураБренд = ТекСтрокаТовары.Номенклатура.Производитель;
		Движение.ТоварнаяГруппа = ТекСтрокаТовары.Номенклатура.ВидНоменклатуры;
		Движение.Номенклатура = ТекСтрокаТовары.Номенклатура;
		Движение.ДокументРеализации = ДокументРеализации;
		Движение.ДокументРекламации = ДокументИнцидент;
		Движение.Партнер = ПартнерПокупатель;
		Движение.Валюта = ТекСтрокаТовары.Валюта;
		Движение.ПартнерБизнесРегион = ПартнерРегион;
		Движение.ПартнерОсновнойМенеджер = ПартнерОсновнойМенеджер;
		Движение.АналитикаДефекта = ТекСтрокаТовары.АналитикаДефекта;
		Движение.КоличествоККомпенсации = 0;
		Движение.КоличествоКомпенсированоКлиенту = ТекСтрокаТовары.Количество;
		Движение.КоличествоПредъявленоПоставщику = 0;
		Движение.КоличествоКомпенсированоПоставщиком = 0;
		Движение.СуммаВал = ТекСтрокаТовары.Сумма;//СуммаВВалюте;
		Движение.СуммаБезНДСВал = ТекСтрокаТовары.СуммаСНДС-ТекСтрокаТовары.СуммаНДС;//СуммаВВалютеБезНДС;
		Движение.Сумма = ТекСтрокаТовары.Сумма;
		Движение.СуммаБезНДС = ТекСтрокаТовары.СуммаСНДС-ТекСтрокаТовары.СуммаНДС;
		Движение.РеализацияТоваровУслуг = ДокументРеализации;
		Движение.ДокументИнцидент = ДокументИнцидент;
		Движение.Склад = ТекСтрокаТовары.Склад;
		Движение.Регион = ТекСтрокаТовары.Склад.БизнесРегион;
		Движение.Поставщик = Поставщик;
		Движение.РешениеПоИнциденту = Инцидент.ПолучитьАтрибутИнцидента("РешениеИнженера");
	КонецЦикла;
	Инцидент. УстановитьСписокПараметровПроведения(Инцидент.ВидИнцидента, Инцидент.ТекущийЭтап, ТаблицаДвижений);
КонецЕсли;
УстановитьПривилегированныйРежим(Ложь);

</v8:ОбработчикПередЗаписью>
			<v8:ОбработчикПослеВыполнения/>
			<v8:ОбработчикПриЗаписи/>
			<v8:ОбработчикПриПереходе>Инцидент.СтатусИМ = Перечисления.КА_СтатусИМ.РекламацияЗавершенаКомпенсацияПредоставлена;
Инцидент.КА_СтатусЗавершен= Перечисления.КА_СтатусЗавершенияИМ.КомпенсированоТоваром;  
//Обрабатываем Пользователей  в поля инцидента по этапу 
Для Каждого Стр из Инцидент.ИсторияВыполнения Цикл
	Если ЗначениеЗаполнено(Стр.Этап) Тогда
	Если СтрНайти(Стр.Этап.Наименование,"Рекламация: Обработка инцидента") Тогда
		Инцидент.Ответственный = Стр.Исполнитель;
		Прервать;
	КонецЕсли;
	КонецЕсли;
КонецЦикла;

// Отправка статуса

НастройкаОбмена = Справочники.КА_НастройкиВыгрузкиВИМ.ПолучитьНастройку("Рекламация_СобытиеВыгрузкаСтатуса");

СоответствиеСтатусов = Новый Соответствие;
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ЗапросОтправлен, "SENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВРаботеУМенеджера, "PROCESS_BY_MANAGER");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.УточнитеДанныеОбращения, "CLARIFY_DETAILS");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВРаботеУИнженера, "PROCESS_BY_ENGINEER");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияПринятаВРаботуГарантийнымОтделом, "PROCESS_BY_WARRANTY_DEPARTMENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияПринятаУточняемСрокРассмотрения, "ACCEPTED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВозвратДеталиНаЭкспертизу, "EXPERTIZE");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОдобренаВыберитеСпособКомпенсации, "APPROVED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОтклоненаОзнакомьтесьСЗаключением, "REJECTED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ЗакрытоИПеренесеноВархивПоСрокуДавности, "CLOSED_ON_EXPIRATION");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияЗавершенаКлиентСогласен, "CLOSED_ON_AGREEMENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияЗавершенаКомпенсацияПредоставлена, "COMPENSATED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламациНаправленаВОтделКорпоративныхПродаж, "SENT_TO_SALES");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОдобрена50ВыберитеСпособКомпенсации, "APPROVED_50");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОтклоненаПовторно, "REJECTED_REPEATEDLY");

СтрДанных = Новый Структура;
СтрДанных.Вставить("complaintId", ЗначенияАтрибутов["id"]);
СтрДанных.Вставить("status", СоответствиеСтатусов[Инцидент.СтатусИМ]);

КА_Обмены.ОтправитьВСервис_Рефакторинг(СтрДанных, НастройкаОбмена, "ИМ2");

// Рассылка
Получатели = Новый Массив;
Вложения = Новый Соответствие;

ДокРТС = ЗначенияАтрибутов["realizationId"];
Партнер = ДокРТС.Партнер;

Адрес = УправлениеКонтактнойИнформацией.КонтактнаяИнформацияОбъекта(Партнер, Справочники.ВидыКонтактнойИнформации.EmailПартнера);
		
Если ЗначениеЗаполнено(Адрес) Тогда
	Получатели.Добавить(Новый Структура("Адрес, Представление", Адрес, Адрес));
КонецЕсли; 
	
Если Получатели.Количество() &gt; 0 Тогда

	Отправитель = Справочники.УчетныеЗаписиЭлектроннойПочты.СистемнаяУчетнаяЗаписьЭлектроннойПочты;
				
	Тема = "Обработка рекламации";
	ТекстПисьма = "Спасибо за обращение, надеемся Вам все понравилось.";	
			
	ПараметрыПисьма = Новый Структура;
	ПараметрыПисьма.Вставить("Кому",Получатели);
	ПараметрыПисьма.Вставить("Тема", Тема);
	ПараметрыПисьма.Вставить("Тело", ТекстПисьма);
	ПараметрыПисьма.Вставить("Вложения", Вложения);
				
	Попытка
		ИдентификаторСообщения = РаботаСПочтовымиСообщениями.ОтправитьПочтовоеСообщение(Отправитель, ПараметрыПисьма);
	Исключение
		Ошибка = ОписаниеОшибки();
		Сообщить(СтрШаблон("При отправке письма произошла ошибка: %1", Ошибка));
	КонецПопытки; 
		
КонецЕсли;

// Рассылка исполнителям
Тема = СтрШаблон("Рекламация %1 завершена", Инцидент.Номер);
ТекстПисьма = "Компенсировано товаром.";
Документы.КА_Инцидент.ОтправитьОповещениеИсполнителямЭтапа(СледующийЭтап, Тема, ТекстПисьма);</v8:ОбработчикПриПереходе>
			<v8:ОбработчикПриПринятииКИсполнению/>
			<v8:ОбработчикПроведения/>
			<v8:Описание>Завершение после оформления документа Возарат товара от клиента с последующей отгрузкой (РТу)</v8:Описание>
			<v8:ПроверятьРезультат>false</v8:ПроверятьРезультат>
			<v8:СрокВыполнения>1</v8:СрокВыполнения>
			<v8:СообщениеНедоступныПереходы/>
			<v8:ОбработчикПриОткрытии/>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">6d160a64-dd08-11e4-b0fd-001517ac6c09</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">27b1b5ed-427b-11e6-80c3-0cc47a6b63cf</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">3ab46ee4-8b6b-4e27-b05f-aa6c943c5895</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">6547e112-2de4-4388-82f0-4b24ca0eee42</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">f6af22ec-7751-4f7a-bc7e-df85edb3c04f</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">19daaf30-9a1a-11e8-80c5-3cfdfeaf9019</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">97eb7d45-6782-4b33-9909-457572becfa8</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">b783b0ba-74ad-11e1-b634-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">812e0c18-3beb-11e8-80d0-001e6707aaa8</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">f149ab7d-7ada-11e8-80c5-3cfdfeaf9019</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">58a84576-77c0-4e0e-b065-1be30ab00af9</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">0cafad1c-4262-11e1-b48c-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">c34b8004-ec1d-11e5-80c5-001e6707aaa8</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">ddcd8a22-00dc-11e4-9396-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">c9ae9a45-d6cc-11ec-bbaf-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
		</v8:CatalogObject.КА_ЭтапыИнцидентов>
		<v8:CatalogObject.КА_ЭтапыИнцидентов>
			<v8:Ref xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">1a70361f-81fe-11ec-bb9e-00155d70bd06</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Owner xsi:type="v8:CatalogRef.КА_ВидыИнцидентов">fe697b45-4e2c-11ec-bba8-00155d258b03</v8:Owner>
			<v8:Code>000000045</v8:Code>
			<v8:Description>Замена товара. Ожидание доставки</v8:Description>
			<v8:АвтоматическийСтартЭтапа>false</v8:АвтоматическийСтартЭтапа>
			<v8:АвтоматическоеЗавершениеЭтапа>false</v8:АвтоматическоеЗавершениеЭтапа>
			<v8:АтрибутыНедоступны>false</v8:АтрибутыНедоступны>
			<v8:АтрибутыСкрыты>false</v8:АтрибутыСкрыты>
			<v8:ЗавершающийЭтап>false</v8:ЗавершающийЭтап>
			<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">00000000-0000-0000-0000-000000000000</v8:Исполнитель>
			<v8:ОбработчикПередВыполнением/>
			<v8:ОбработчикПередЗаписью>
ТаблицаАтрибутов = ЭтотОбъект.ЗначенияАтрибутов.Выгрузить();
	ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "ВозвратУтилизация"); 
	СтрИзменение = ТаблицаАтрибутов.Найти(ВыбАтрибут,"Атрибут");
	Если не ЗначениеЗаполнено(СтрИзменение) Тогда
		СтрИзменение = ТаблицаАтрибутов.Добавить();
		СтрИзменение.Атрибут = ВыбАтрибут;
	КонецЕсли;
ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "ТоварВернуть");
Стр = ТаблицаАтрибутов.Найти(ВыбАтрибут, "Атрибут");
Если Стр = Неопределено или Стр.Значение = Ложь Тогда
	СтрИзменение.Значение = Перечисления.КА_ВозвратУтилизация.ОжидаетсяУтилизацииДетали;
Иначе
	СтрИзменение.Значение = Перечисления.КА_ВозвратУтилизация.НеТребуется;
КонецЕсли;
ЭтотОбъект.ЗначенияАтрибутов.Загрузить(ТаблицаАтрибутов);
</v8:ОбработчикПередЗаписью>
			<v8:ОбработчикПослеВыполнения/>
			<v8:ОбработчикПриЗаписи/>
			<v8:ОбработчикПриПереходе>Инцидент.СтатусИМ = Перечисления.КА_СтатусИМ.ЗапросОтправлен;
//Обрабатываем Пользователей  в поля инцидента по этапу 
Инцидент.Ответственный  = ЗначенияАтрибутов["ОтветственныйМКО"];

// Отправка статуса

НастройкаОбмена = Справочники.КА_НастройкиВыгрузкиВИМ.ПолучитьНастройку("Рекламация_СобытиеВыгрузкаСтатуса");

СоответствиеСтатусов = Новый Соответствие;
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ЗапросОтправлен, "SENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВРаботеУМенеджера, "PROCESS_BY_MANAGER");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.УточнитеДанныеОбращения, "CLARIFY_DETAILS");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВРаботеУИнженера, "PROCESS_BY_ENGINEER");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияПринятаВРаботуГарантийнымОтделом, "PROCESS_BY_WARRANTY_DEPARTMENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияПринятаУточняемСрокРассмотрения, "ACCEPTED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВозвратДеталиНаЭкспертизу, "EXPERTIZE");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОдобренаВыберитеСпособКомпенсации, "APPROVED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОтклоненаОзнакомьтесьСЗаключением, "REJECTED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ЗакрытоИПеренесеноВархивПоСрокуДавности, "CLOSED_ON_EXPIRATION");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияЗавершенаКлиентСогласен, "CLOSED_ON_AGREEMENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияЗавершенаКомпенсацияПредоставлена, "COMPENSATED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламациНаправленаВОтделКорпоративныхПродаж, "SENT_TO_SALES");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОдобрена50ВыберитеСпособКомпенсации, "APPROVED_50");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОтклоненаПовторно, "REJECTED_REPEATEDLY");

СтрДанных = Новый Структура;
СтрДанных.Вставить("complaintId", ЗначенияАтрибутов["id"]);
СтрДанных.Вставить("status", СоответствиеСтатусов[Инцидент.СтатусИМ]);

КА_Обмены.ОтправитьВСервис_Рефакторинг(СтрДанных, НастройкаОбмена, "ИМ2");</v8:ОбработчикПриПереходе>
			<v8:ОбработчикПриПринятииКИсполнению/>
			<v8:ОбработчикПроведения/>
			<v8:Описание>Ожидается отгрузка товара
МКО, получив информацию об отгрузке, завершает инцидент</v8:Описание>
			<v8:ПроверятьРезультат>false</v8:ПроверятьРезультат>
			<v8:СрокВыполнения>48</v8:СрокВыполнения>
			<v8:СообщениеНедоступныПереходы/>
			<v8:ОбработчикПриОткрытии/>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">27b1b5ed-427b-11e6-80c3-0cc47a6b63cf</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">6d160a64-dd08-11e4-b0fd-001517ac6c09</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">3ab46ee4-8b6b-4e27-b05f-aa6c943c5895</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">6547e112-2de4-4388-82f0-4b24ca0eee42</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">f6af22ec-7751-4f7a-bc7e-df85edb3c04f</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">19daaf30-9a1a-11e8-80c5-3cfdfeaf9019</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">97eb7d45-6782-4b33-9909-457572becfa8</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">b783b0ba-74ad-11e1-b634-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">812e0c18-3beb-11e8-80d0-001e6707aaa8</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">f149ab7d-7ada-11e8-80c5-3cfdfeaf9019</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">58a84576-77c0-4e0e-b065-1be30ab00af9</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">0cafad1c-4262-11e1-b48c-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">c34b8004-ec1d-11e5-80c5-001e6707aaa8</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">ddcd8a22-00dc-11e4-9396-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">a0477a02-97f8-11e5-9a83-001517ac6c09</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">7e7bc00e-8e58-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода/>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">455e5227-8e55-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">c9ae9a45-d6cc-11ec-bbaf-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">b444c315-5f3e-11ed-bba5-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>true</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
		</v8:CatalogObject.КА_ЭтапыИнцидентов>
		<v8:CatalogObject.КА_ЭтапыИнцидентов>
			<v8:Ref xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">66c30864-d807-11ec-bbaf-00155d258b03</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Owner xsi:type="v8:CatalogRef.КА_ВидыИнцидентов">fe697b45-4e2c-11ec-bba8-00155d258b03</v8:Owner>
			<v8:Code>000000079</v8:Code>
			<v8:Description>Согласование размещения</v8:Description>
			<v8:АвтоматическийСтартЭтапа>false</v8:АвтоматическийСтартЭтапа>
			<v8:АвтоматическоеЗавершениеЭтапа>false</v8:АвтоматическоеЗавершениеЭтапа>
			<v8:АтрибутыНедоступны>false</v8:АтрибутыНедоступны>
			<v8:АтрибутыСкрыты>false</v8:АтрибутыСкрыты>
			<v8:ЗавершающийЭтап>false</v8:ЗавершающийЭтап>
			<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">00000000-0000-0000-0000-000000000000</v8:Исполнитель>
			<v8:ОбработчикПередВыполнением/>
			<v8:ОбработчикПередЗаписью>ТаблицаАтрибутов = ЭтотОбъект.ЗначенияАтрибутов.Выгрузить();
	ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "ВозвратУтилизация");
	ИзмСтр = ТаблицаАтрибутов.Найти(ВыбАтрибут, "Атрибут");
	Если ИзмСтр = Неопределено Тогда
		ИзмСтр = ТаблицаАтрибутов.Добавить();
		ИзмСтр.Атрибут = ВыбАтрибут;
	КонецЕсли;
	ИзмСтр.Значение = Перечисления.КА_ВозвратУтилизация.ОжидаетсяУтилизацииДетали;

ЭтотОбъект.ЗначенияАтрибутов.Загрузить(ТаблицаАтрибутов);
</v8:ОбработчикПередЗаписью>
			<v8:ОбработчикПослеВыполнения/>
			<v8:ОбработчикПриЗаписи/>
			<v8:ОбработчикПриПереходе>
//Обрабатываем Пользователей  в поля инцидента по этапу 
Для Каждого Стр из Инцидент.ИсторияВыполнения Цикл
	Если ЗначениеЗаполнено(Стр.Этап) Тогда
	Если СтрНайти(Стр.Этап.Наименование,"В работе у Инженера.") Тогда
		Инцидент.Ответственный = Стр.Исполнитель;
		Прервать;
	КонецЕсли;
	КонецЕсли;
КонецЦикла;
</v8:ОбработчикПриПереходе>
			<v8:ОбработчикПриПринятииКИсполнению/>
			<v8:ОбработчикПроведения/>
			<v8:Описание>Инженер нажимает кнопку «Принять к исполнению».

Находит в системе документе Размещения и перевода, проверяет корректность выбора ячейки оператором.

Если всё в порядке, инженер переводит его в статус "Выполнено без ошибок".
После этого нажимает "Выполнено", выбирает вариант "Согласовано", и в результате выполнения пишет "Согласовано". Инцидент переходит на следующий этап.

Если товар размещён ошибочно, инжинер описывает ошибку в комментарии к инциденту, нажимает "+", и комментарий фиксируется в нижнем поле.

После этого нажимает "Выполнено", выбирает вариант "Ошибка в Размещении", и в результате выполнения пишут Ошибка. Инцидент переходит на предидущий этап тому оператору, который отправлял запрос.</v8:Описание>
			<v8:ПроверятьРезультат>true</v8:ПроверятьРезультат>
			<v8:СрокВыполнения>1</v8:СрокВыполнения>
			<v8:СообщениеНедоступныПереходы/>
			<v8:ОбработчикПриОткрытии/>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">06509fbe-a8c9-11e2-bca0-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">5fe94a47-f3ca-11e8-80d4-3cfdfeaf9019</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">9514bbf0-4093-426e-a611-7f991186491c</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">3066ae6a-9659-4e7d-a45f-557d5426b02e</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">f7b00092-b399-41f7-ac3c-2ba79dd50491</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">35290563-4385-49bb-9833-7888d3e3d008</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">e24afe68-d9cf-4843-9264-2a6d70bff964</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">408f3bee-cea7-4a35-ab09-ade297d74fe3</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">173f8a86-a96f-442c-aebc-0169f09cd575</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">140dd032-0800-4ae1-8106-a94e677b3ad8</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">83bc516c-049a-4240-9a87-85e11a6f5d82</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">5cc4d533-3991-11e9-80dd-3cfdfeaf9019</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">76d24d9f-5efc-4b38-9320-26b572d76abb</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">b85c30e2-daa0-4f6c-b6da-a68c5bece7c6</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">d4c8e7bf-8e57-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды>Согласовано</v8:ИмяКоманды>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>// Способ компенсации = Оставить в качестве аванса

Если НЕ РольДоступна("ПолныеПрава") Тогда

	Атр = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "Рекламация_СпособКомпенсации");
	ЗначениеАтр = Справочники.КА_ДополнительныеЗначенияАтрибутов.НайтиПоРеквизиту("Ключ", "AS_PREPAYMENT", , Атр);

	УсловияПроверки = ЗначенияАтрибутов["Рекламация_СпособКомпенсации"] = ЗначениеАтр;
	
	Если НЕ УсловияПроверки Тогда
		//Отказ = Истина;
	КонецЕсли;

КонецЕсли;</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">633abd82-d806-11ec-bbaf-00155d258b03</v8:Этап>
				<v8:ИмяКоманды>Ошибка в Размещении</v8:ИмяКоманды>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода/>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">0358fd4f-8e58-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды>Согласовано</v8:ИмяКоманды>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>// Клиент требует вернуть деньги = ИСТИНА

Если НЕ РольДоступна("ПолныеПрава") Тогда

	УсловияПроверки = ЗначенияАтрибутов["КлиентТребуетВернутьДеньги"] = Истина;
	
	Если НЕ УсловияПроверки Тогда
		//Отказ = Истина;
	КонецЕсли;

КонецЕсли;</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">1a70361f-81fe-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды>Согласовано</v8:ИмяКоманды>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>// Способ компенсации = Замена товара

Если НЕ РольДоступна("ПолныеПрава") Тогда

	Атр = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "Рекламация_СпособКомпенсации");
	ЗначениеАтр = Справочники.КА_ДополнительныеЗначенияАтрибутов.НайтиПоРеквизиту("Ключ", "REPLACE_ITEMS", , Атр);

	УсловияПроверки = ЗначенияАтрибутов["Рекламация_СпособКомпенсации"] = ЗначениеАтр;
	
	Если НЕ УсловияПроверки Тогда
		//Отказ = Истина;
	КонецЕсли;

КонецЕсли;</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">455e5227-8e55-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">c10475bc-8798-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">20e9e340-bc98-11ec-bbaf-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">ae2bfd6f-8798-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">1e160f11-bca1-11ec-bba2-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">b444c315-5f3e-11ed-bba5-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
		</v8:CatalogObject.КА_ЭтапыИнцидентов>
		<v8:CatalogObject.КА_ЭтапыИнцидентов>
			<v8:Ref xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">633abd82-d806-11ec-bbaf-00155d258b03</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Owner xsi:type="v8:CatalogRef.КА_ВидыИнцидентов">fe697b45-4e2c-11ec-bba8-00155d258b03</v8:Owner>
			<v8:Code>000000078</v8:Code>
			<v8:Description>Размещение на проверку ОС</v8:Description>
			<v8:АвтоматическийСтартЭтапа>false</v8:АвтоматическийСтартЭтапа>
			<v8:АвтоматическоеЗавершениеЭтапа>false</v8:АвтоматическоеЗавершениеЭтапа>
			<v8:АтрибутыНедоступны>false</v8:АтрибутыНедоступны>
			<v8:АтрибутыСкрыты>false</v8:АтрибутыСкрыты>
			<v8:ЗавершающийЭтап>false</v8:ЗавершающийЭтап>
			<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">00000000-0000-0000-0000-000000000000</v8:Исполнитель>
			<v8:ОбработчикПередВыполнением/>
			<v8:ОбработчикПередЗаписью>УстановитьПривилегированныйРежим(Истина);
ТаблицаАтрибутов = ЭтотОбъект.ЗначенияАтрибутов.Выгрузить();
	ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "ВозвратУтилизация");
	ИзмСтр = ТаблицаАтрибутов.Найти(ВыбАтрибут, "Атрибут");
	Если ИзмСтр = Неопределено Тогда
		ИзмСтр = ТаблицаАтрибутов.Добавить();
		ИзмСтр.Атрибут = ВыбАтрибут;
	КонецЕсли;
	ИзмСтр.Значение = Перечисления.КА_ВозвратУтилизация.ОжидаетсяУтилизацииДетали;

ЭтотОбъект.ЗначенияАтрибутов.Загрузить(ТаблицаАтрибутов);
УстановитьПривилегированныйРежим(Ложь);

</v8:ОбработчикПередЗаписью>
			<v8:ОбработчикПослеВыполнения/>
			<v8:ОбработчикПриЗаписи/>
			<v8:ОбработчикПриПереходе>//Поиск ответственного по складу
Запрос = Новый Запрос;
Запрос.Текст = "ВЫБРАТЬ
		               |	Пользователи.Ссылка
		               |ИЗ
		               |	Справочник.Пользователи КАК Пользователи
		               |ГДЕ
		               |	Пользователи.Подразделение = &amp;ВыбПодразделение
		               |	И Пользователи.ПометкаУдаления = ЛОЖЬ
		               |	И Пользователи.Недействителен = ЛОЖЬ
		               |	И Пользователи.Ссылка В ИЕРАРХИИ(&amp;ВыбПользователи)";
ТабАтр = Инцидент.ЗначенияАтрибутов.Выгрузить();
АтрибутПоиск = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоНаименованию("Склад");
Стр = ТабАтр.Найти(АтрибутПоиск, "Атрибут");
Если (не Стр = Неопределено) и ЗначениеЗаполнено(Стр.Значение) Тогда
	Склад = Стр.Значение;
	ТекЭтап = Инцидент.ТекущийЭтап;
	мИсполнители = Новый Массив;
	Запрос.УстановитьПараметр("ВыбПодразделение", Склад.Подразделение.Ссылка); 
	Для Каждого Исп Из ТекЭтап.Исполнители Цикл
		мИсполнители.Добавить(Исп.Исполнитель);
	КонецЦикла;
	Запрос.УстановитьПараметр("ВыбПользователи", мИсполнители);
	Результат = Запрос.Выполнить().Выгрузить();
	Если Результат.Количество() &gt; 0 Тогда 
		Инцидент.Ответственный = Результат[0].Ссылка;
	КонецЕсли; 
КонецЕсли;
</v8:ОбработчикПриПереходе>
			<v8:ОбработчикПриПринятииКИсполнению/>
			<v8:ОбработчикПроведения/>
			<v8:Описание>Оператор системы управления складом принимает инцидент в работу после формирования документа Размещения и перевода его в статус "В работе".

ОСУС нажимает кнопку «Принять к исполнению», пишет в комментарии номер и дату размещения, после чего нажимает "+". Комментарий появляется в нижнем поле.

После фиксации комментария ОСУС нажимает кнопку "Выполнено" и инцидент переходит на следующий этап.
________________________________________________________________________________________________
Также, ОСУС может получить инциндент на доработку, если в документе Размещение сделана ошибка.
Он появится в АРМ Инциденты с ответсвенным, который запрашивал согласование.

ОСУС нажимает кнопку «Принять к исполнению», изучает ошибки, которые описаны в комментарии. после Затем он исправляет ошибку и отписывается в об этом в комментарии.

После фиксации комментария ОСУС нажимает кнопку "Выполнено" и инцидент переходит на следующий этап.</v8:Описание>
			<v8:ПроверятьРезультат>false</v8:ПроверятьРезультат>
			<v8:СрокВыполнения>85</v8:СрокВыполнения>
			<v8:СообщениеНедоступныПереходы/>
			<v8:ОбработчикПриОткрытии/>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">5becca70-26cd-4442-be1c-2aa0c8768c0f</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">482f9816-37bc-48de-a535-1adf7e3bc6ea</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">cf824260-22b9-41cd-869b-7ba3e54813b0</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">f683feb2-a173-48af-b784-be07748062e9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">54a98a3d-b5c8-40d7-978f-66e85dd08751</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">d573edca-2f92-41c7-a96e-812bfb516002</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">1069751f-c8ab-497c-b986-22ebeb7543a9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">f6332373-5d93-11e8-80be-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">301bc31d-8656-11e2-a40a-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">42bc2777-c6f8-4712-aead-f898f743edd0</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">73172a16-242e-408b-8ea1-c47ce0755f4d</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">aa0d65f9-949a-11e8-80c5-3cfdfeaf9019</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">aeaa6930-0e45-11e7-80cd-001e6707aaa8</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">523b01d7-a3f2-44f2-8b5f-c3d4f074366b</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">2ad9984f-a3a2-4dcc-a4c8-de397bd390c8</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">10da9edc-2753-4c48-bcb0-44f81fe57141</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">23e2d8cf-4ca5-4664-89bf-1bc478a4e67d</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">e4c55e83-be98-11e5-8e64-001517ac6c09</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">1e424723-df03-4236-a506-3cde8a7907ff</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">c292a3ce-64f5-4f87-8a89-b1d10c908071</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">01d1e502-2ebe-4775-b4e5-73ba3206ab03</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">66c30864-d807-11ec-bbaf-00155d258b03</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода/>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">c41bdd9c-67ef-11ec-bba8-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">413c9a50-673f-11ec-bba8-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">3da7cce6-6746-11ec-bba8-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">a40c9242-5e35-11ec-bba8-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">06653895-673f-11ec-bba8-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">7070b387-2ac0-11e9-80cc-00155d049008</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">82011875-6746-11ec-bba8-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">edb75284-673e-11ec-bba8-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">6d505a82-67f0-11ec-bba8-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">5953c67e-67f0-11ec-bba8-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">a7ce5483-67ef-11ec-bba8-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">b41ea743-66f8-11ec-bba8-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">e5acad73-a62b-11ec-bba8-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">b926251e-39ba-11e9-80cc-00155d049008</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">7729298e-bf2c-11ec-bba2-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">455e5227-8e55-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">f72ce76b-2ae2-11e9-80cc-00155d049008</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">1e160f11-bca1-11ec-bba2-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">c10475bc-8798-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">ae2bfd6f-8798-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">28c3acd3-ba33-11ec-bba2-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">20e9e340-bc98-11ec-bbaf-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">e983c36e-bc97-11ec-bbaf-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">f9220711-8795-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">7770acee-8e55-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">c9ae9a45-d6cc-11ec-bbaf-00155d258b03</v8:Атрибут>
				<v8:Недоступен>true</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">578c447d-b974-11ec-bba2-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>true</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">b444c315-5f3e-11ed-bba5-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
		</v8:CatalogObject.КА_ЭтапыИнцидентов>
		<v8:CatalogObject.КА_ЭтапыИнцидентов>
			<v8:Ref xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">129df58a-81fe-11ec-bb9e-00155d70bd06</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Owner xsi:type="v8:CatalogRef.КА_ВидыИнцидентов">fe697b45-4e2c-11ec-bba8-00155d258b03</v8:Owner>
			<v8:Code>000000042</v8:Code>
			<v8:Description>Компенсация. Вернуть денежные средства</v8:Description>
			<v8:АвтоматическийСтартЭтапа>false</v8:АвтоматическийСтартЭтапа>
			<v8:АвтоматическоеЗавершениеЭтапа>false</v8:АвтоматическоеЗавершениеЭтапа>
			<v8:АтрибутыНедоступны>false</v8:АтрибутыНедоступны>
			<v8:АтрибутыСкрыты>false</v8:АтрибутыСкрыты>
			<v8:ЗавершающийЭтап>false</v8:ЗавершающийЭтап>
			<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">00000000-0000-0000-0000-000000000000</v8:Исполнитель>
			<v8:ОбработчикПередВыполнением/>
			<v8:ОбработчикПередЗаписью>
ТаблицаАтрибутов = ЭтотОбъект.ЗначенияАтрибутов.Выгрузить();
	ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "ВозвратУтилизация"); 
	СтрИзменение = ТаблицаАтрибутов.Найти(ВыбАтрибут,"Атрибут");
	Если не ЗначениеЗаполнено(СтрИзменение) Тогда
		СтрИзменение = ТаблицаАтрибутов.Добавить();
		СтрИзменение.Атрибут = ВыбАтрибут;
	КонецЕсли;
ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "ТоварВернуть");
Стр = ТаблицаАтрибутов.Найти(ВыбАтрибут, "Атрибут");
Если Стр = Неопределено или Стр.Значение = Ложь Тогда
	СтрИзменение.Значение = Перечисления.КА_ВозвратУтилизация.ОжидаетсяУтилизацииДетали;
Иначе
	СтрИзменение.Значение = Перечисления.КА_ВозвратУтилизация.НеТребуется;
КонецЕсли;
ЭтотОбъект.ЗначенияАтрибутов.Загрузить(ТаблицаАтрибутов);
</v8:ОбработчикПередЗаписью>
			<v8:ОбработчикПослеВыполнения/>
			<v8:ОбработчикПриЗаписи/>
			<v8:ОбработчикПриПереходе>Инцидент.СтатусИМ = Перечисления.КА_СтатусИМ.ЗапросОтправлен;

// Отправка статуса

НастройкаОбмена = Справочники.КА_НастройкиВыгрузкиВИМ.ПолучитьНастройку("Рекламация_СобытиеВыгрузкаСтатуса");

СоответствиеСтатусов = Новый Соответствие;
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ЗапросОтправлен, "SENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВРаботеУМенеджера, "PROCESS_BY_MANAGER");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.УточнитеДанныеОбращения, "CLARIFY_DETAILS");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВРаботеУИнженера, "PROCESS_BY_ENGINEER");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияПринятаВРаботуГарантийнымОтделом, "PROCESS_BY_WARRANTY_DEPARTMENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияПринятаУточняемСрокРассмотрения, "ACCEPTED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВозвратДеталиНаЭкспертизу, "EXPERTIZE");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОдобренаВыберитеСпособКомпенсации, "APPROVED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОтклоненаОзнакомьтесьСЗаключением, "REJECTED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ЗакрытоИПеренесеноВархивПоСрокуДавности, "CLOSED_ON_EXPIRATION");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияЗавершенаКлиентСогласен, "CLOSED_ON_AGREEMENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияЗавершенаКомпенсацияПредоставлена, "COMPENSATED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламациНаправленаВОтделКорпоративныхПродаж, "SENT_TO_SALES");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОдобрена50ВыберитеСпособКомпенсации, "APPROVED_50");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОтклоненаПовторно, "REJECTED_REPEATEDLY");

СтрДанных = Новый Структура;
СтрДанных.Вставить("complaintId", ЗначенияАтрибутов["id"]);
СтрДанных.Вставить("status", СоответствиеСтатусов[Инцидент.СтатусИМ]);

КА_Обмены.ОтправитьВСервис_Рефакторинг(СтрДанных, НастройкаОбмена, "ИМ2");


//Обрабатываем Пользователей  в поля инцидента по этапу 
Инцидент.Ответственный  = ЗначенияАтрибутов["ОтветственныйМКО"];

// Рассылка
Получатели = Новый Массив;
Вложения = Новый Соответствие;

ДокРТС = ЗначенияАтрибутов["realizationId"];
Партнер = ДокРТС.Партнер;

Адрес = УправлениеКонтактнойИнформацией.КонтактнаяИнформацияОбъекта(Партнер, Справочники.ВидыКонтактнойИнформации.EmailПартнера);
		
Если ЗначениеЗаполнено(Адрес) Тогда
	Получатели.Добавить(Новый Структура("Адрес, Представление", Адрес, Адрес));
КонецЕсли; 
	
Если Получатели.Количество() &gt; 0 Тогда

	Отправитель = Справочники.УчетныеЗаписиЭлектроннойПочты.СистемнаяУчетнаяЗаписьЭлектроннойПочты;
				
	Тема = "Обработка рекламации";
	ТекстПисьма = "Мы вернём Вам деньги в ближайшее время.";	
			
	ПараметрыПисьма = Новый Структура;
	ПараметрыПисьма.Вставить("Кому",Получатели);
	ПараметрыПисьма.Вставить("Тема", Тема);
	ПараметрыПисьма.Вставить("Тело", ТекстПисьма);
	ПараметрыПисьма.Вставить("Вложения", Вложения);
				
	Попытка
		ИдентификаторСообщения = РаботаСПочтовымиСообщениями.ОтправитьПочтовоеСообщение(Отправитель, ПараметрыПисьма);
	Исключение
		Ошибка = ОписаниеОшибки();
		Сообщить(СтрШаблон("При отправке письма произошла ошибка: %1", Ошибка));
	КонецПопытки; 
		
КонецЕсли;</v8:ОбработчикПриПереходе>
			<v8:ОбработчикПриПринятииКИсполнению/>
			<v8:ОбработчикПроведения/>
			<v8:Описание>МКО по настоятельной просьбе клиента переходит в связанную с Инцидентом Заявку на возврат товаров от клиента и инициирует возврат денег</v8:Описание>
			<v8:ПроверятьРезультат>false</v8:ПроверятьРезультат>
			<v8:СрокВыполнения>9</v8:СрокВыполнения>
			<v8:СообщениеНедоступныПереходы/>
			<v8:ОбработчикПриОткрытии/>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">3ab46ee4-8b6b-4e27-b05f-aa6c943c5895</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">6547e112-2de4-4388-82f0-4b24ca0eee42</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">6d160a64-dd08-11e4-b0fd-001517ac6c09</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">f6af22ec-7751-4f7a-bc7e-df85edb3c04f</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">19daaf30-9a1a-11e8-80c5-3cfdfeaf9019</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">97eb7d45-6782-4b33-9909-457572becfa8</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">b783b0ba-74ad-11e1-b634-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">812e0c18-3beb-11e8-80d0-001e6707aaa8</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">f149ab7d-7ada-11e8-80c5-3cfdfeaf9019</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">58a84576-77c0-4e0e-b065-1be30ab00af9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">0cafad1c-4262-11e1-b48c-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">c34b8004-ec1d-11e5-80c5-001e6707aaa8</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">ddcd8a22-00dc-11e4-9396-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">a0477a02-97f8-11e5-9a83-001517ac6c09</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">0358fd4f-8e58-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>// Товар вернуть != ИСТИНА

Если НЕ РольДоступна("ПолныеПрава") Тогда

	УсловияПроверки = ЗначенияАтрибутов["ТоварВернуть"] &lt;&gt; Истина;
	
	Если НЕ УсловияПроверки Тогда
		Отказ = Истина;
	КонецЕсли;

КонецЕсли;</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">633abd82-d806-11ec-bbaf-00155d258b03</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>// Товар вернуть = ИСТИНА

Если НЕ РольДоступна("ПолныеПрава") Тогда

	УсловияПроверки = ЗначенияАтрибутов["ТоварВернуть"] = Истина;
	
	Если НЕ УсловияПроверки Тогда
		Отказ = Истина;
	КонецЕсли;

КонецЕсли;</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">ae2bfd6f-8798-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">c10475bc-8798-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">7770acee-8e55-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">20e9e340-bc98-11ec-bbaf-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">455e5227-8e55-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">b444c315-5f3e-11ed-bba5-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>true</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
		</v8:CatalogObject.КА_ЭтапыИнцидентов>
		<v8:CatalogObject.КА_ЭтапыИнцидентов>
			<v8:Ref xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">0a67f065-81fe-11ec-bb9e-00155d70bd06</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Owner xsi:type="v8:CatalogRef.КА_ВидыИнцидентов">fe697b45-4e2c-11ec-bba8-00155d258b03</v8:Owner>
			<v8:Code>000000041</v8:Code>
			<v8:Description>Компенсация. Оставить в качестве аванса</v8:Description>
			<v8:АвтоматическийСтартЭтапа>false</v8:АвтоматическийСтартЭтапа>
			<v8:АвтоматическоеЗавершениеЭтапа>false</v8:АвтоматическоеЗавершениеЭтапа>
			<v8:АтрибутыНедоступны>false</v8:АтрибутыНедоступны>
			<v8:АтрибутыСкрыты>false</v8:АтрибутыСкрыты>
			<v8:ЗавершающийЭтап>false</v8:ЗавершающийЭтап>
			<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">00000000-0000-0000-0000-000000000000</v8:Исполнитель>
			<v8:ОбработчикПередВыполнением/>
			<v8:ОбработчикПередЗаписью>
//ТаблицаАтрибутов = ЭтотОбъект.ЗначенияАтрибутов.Выгрузить();
//	ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "ВозвратУтилизация"); 
//	СтрИзменение = ТаблицаАтрибутов.Найти(ВыбАтрибут,"Атрибут");
//	Если не ЗначениеЗаполнено(СтрИзменение) Тогда
//		СтрИзменение = ТаблицаАтрибутов.Добавить();
//		СтрИзменение.Атрибут = ВыбАтрибут;
//	КонецЕсли;
//ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "ТоварВернуть");
//Стр = ТаблицаАтрибутов.Найти(ВыбАтрибут, "Атрибут");
//Если Стр = Неопределено или Стр.Значение = Ложь Тогда
//	СтрИзменение.Значение = Перечисления.КА_ВозвратУтилизация.ОжидаетсяУтилизацииДетали;
//Иначе
//	СтрИзменение.Значение = Перечисления.КА_ВозвратУтилизация.ОжидаетсяВозвратДетали;
//КонецЕсли;
//ЭтотОбъект.ЗначенияАтрибутов.Загрузить(ТаблицаАтрибутов);
</v8:ОбработчикПередЗаписью>
			<v8:ОбработчикПослеВыполнения/>
			<v8:ОбработчикПриЗаписи/>
			<v8:ОбработчикПриПереходе>Инцидент.СтатусИМ = Перечисления.КА_СтатусИМ.ЗапросОтправлен;

// Отправка статуса

НастройкаОбмена = Справочники.КА_НастройкиВыгрузкиВИМ.ПолучитьНастройку("Рекламация_СобытиеВыгрузкаСтатуса");

СоответствиеСтатусов = Новый Соответствие;
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ЗапросОтправлен, "SENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВРаботеУМенеджера, "PROCESS_BY_MANAGER");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.УточнитеДанныеОбращения, "CLARIFY_DETAILS");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВРаботеУИнженера, "PROCESS_BY_ENGINEER");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияПринятаВРаботуГарантийнымОтделом, "PROCESS_BY_WARRANTY_DEPARTMENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияПринятаУточняемСрокРассмотрения, "ACCEPTED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВозвратДеталиНаЭкспертизу, "EXPERTIZE");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОдобренаВыберитеСпособКомпенсации, "APPROVED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОтклоненаОзнакомьтесьСЗаключением, "REJECTED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ЗакрытоИПеренесеноВархивПоСрокуДавности, "CLOSED_ON_EXPIRATION");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияЗавершенаКлиентСогласен, "CLOSED_ON_AGREEMENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияЗавершенаКомпенсацияПредоставлена, "COMPENSATED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламациНаправленаВОтделКорпоративныхПродаж, "SENT_TO_SALES");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОдобрена50ВыберитеСпособКомпенсации, "APPROVED_50");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОтклоненаПовторно, "REJECTED_REPEATEDLY");

СтрДанных = Новый Структура;
СтрДанных.Вставить("complaintId", ЗначенияАтрибутов["id"]);
СтрДанных.Вставить("status", СоответствиеСтатусов[Инцидент.СтатусИМ]);

КА_Обмены.ОтправитьВСервис_Рефакторинг(СтрДанных, НастройкаОбмена, "ИМ2");

//Обрабатываем Пользователей  в поля инцидента по этапу 
Инцидент.Ответственный  = ЗначенияАтрибутов["ОтветственныйМКО"];

// Рассылка
Получатели = Новый Массив;
Вложения = Новый Соответствие;

ДокРТС = ЗначенияАтрибутов["realizationId"];
Партнер = ДокРТС.Партнер;

Адрес = УправлениеКонтактнойИнформацией.КонтактнаяИнформацияОбъекта(Партнер, Справочники.ВидыКонтактнойИнформации.EmailПартнера);
		
Если ЗначениеЗаполнено(Адрес) Тогда
	Получатели.Добавить(Новый Структура("Адрес, Представление", Адрес, Адрес));
КонецЕсли; 
	
Если Получатели.Количество() &gt; 0 Тогда

	Отправитель = Справочники.УчетныеЗаписиЭлектроннойПочты.СистемнаяУчетнаяЗаписьЭлектроннойПочты;
				
	Тема = "Обработка рекламации";
	ТекстПисьма = "Вы выбрали вариант компенсации ""Оставить в качестве аванса"". За разъяснениями Вы всегда можете обратиться к Вашему менеджеру.";	
			
	ПараметрыПисьма = Новый Структура;
	ПараметрыПисьма.Вставить("Кому",Получатели);
	ПараметрыПисьма.Вставить("Тема", Тема);
	ПараметрыПисьма.Вставить("Тело", ТекстПисьма);
	ПараметрыПисьма.Вставить("Вложения", Вложения);
				
	Попытка
		ИдентификаторСообщения = РаботаСПочтовымиСообщениями.ОтправитьПочтовоеСообщение(Отправитель, ПараметрыПисьма);
	Исключение
		Ошибка = ОписаниеОшибки();
		Сообщить(СтрШаблон("При отправке письма произошла ошибка: %1", Ошибка));
	КонецПопытки; 
		
КонецЕсли;

// Рассылка исполнителям
Тема = СтрШаблон("Обновлен статус рекламации %1 %2", Инцидент.Номер, ЗначенияАтрибутов["counterparty_external_id"]);
ТекстПисьма = "Клиент выбрал компенсацию - оставить ДС в качестве аванса.";
М = Новый Массив;
М.Добавить(Инцидент.Ответственный);
Документы.КА_Инцидент.ОтправитьОповещение(М, Тема, ТекстПисьма);
//Документы.КА_Инцидент.ОтправитьОповещениеИсполнителямЭтапа(СледующийЭтап, Тема, ТекстПисьма);;</v8:ОбработчикПриПереходе>
			<v8:ОбработчикПриПринятииКИсполнению/>
			<v8:ОбработчикПроведения/>
			<v8:Описание>МКО переходит в связанную с Инцидентом Заявку на возврат товаров от клиента и проверяет наличие документа Возврат товара от клиента</v8:Описание>
			<v8:ПроверятьРезультат>false</v8:ПроверятьРезультат>
			<v8:СрокВыполнения>2</v8:СрокВыполнения>
			<v8:СообщениеНедоступныПереходы/>
			<v8:ОбработчикПриОткрытии/>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">3ab46ee4-8b6b-4e27-b05f-aa6c943c5895</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">6547e112-2de4-4388-82f0-4b24ca0eee42</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">6d160a64-dd08-11e4-b0fd-001517ac6c09</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">f6af22ec-7751-4f7a-bc7e-df85edb3c04f</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">19daaf30-9a1a-11e8-80c5-3cfdfeaf9019</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">97eb7d45-6782-4b33-9909-457572becfa8</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">b783b0ba-74ad-11e1-b634-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">812e0c18-3beb-11e8-80d0-001e6707aaa8</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">f149ab7d-7ada-11e8-80c5-3cfdfeaf9019</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">58a84576-77c0-4e0e-b065-1be30ab00af9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">0cafad1c-4262-11e1-b48c-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">c34b8004-ec1d-11e5-80c5-001e6707aaa8</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">ddcd8a22-00dc-11e4-9396-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">a0477a02-97f8-11e5-9a83-001517ac6c09</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">d4c8e7bf-8e57-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>// Товар вернуть != ИСТИНА

Если НЕ РольДоступна("ПолныеПрава") Тогда

	УсловияПроверки = ЗначенияАтрибутов["ТоварВернуть"] &lt;&gt; Истина;
	
	Если НЕ УсловияПроверки Тогда
		Отказ = Истина;
	КонецЕсли;

КонецЕсли;</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">129df58a-81fe-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>// Товар вернуть != ИСТИНА

Если НЕ РольДоступна("ПолныеПрава") Тогда

	УсловияПроверки = ЗначенияАтрибутов["ТоварВернуть"] &lt;&gt; Истина;
	
	Если НЕ УсловияПроверки Тогда
		Отказ = Истина;
	КонецЕсли;

КонецЕсли;</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">633abd82-d806-11ec-bbaf-00155d258b03</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>// Товар вернуть = ИСТИНА

Если НЕ РольДоступна("ПолныеПрава") Тогда

	УсловияПроверки = ЗначенияАтрибутов["ТоварВернуть"] = Истина;
	
	Если НЕ УсловияПроверки Тогда
		Отказ = Истина;
	КонецЕсли;

КонецЕсли;</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">c10475bc-8798-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">ae2bfd6f-8798-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">7770acee-8e55-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">20e9e340-bc98-11ec-bbaf-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">455e5227-8e55-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">c9ae9a45-d6cc-11ec-bbaf-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">b444c315-5f3e-11ed-bba5-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>true</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
		</v8:CatalogObject.КА_ЭтапыИнцидентов>
		<v8:CatalogObject.КА_ЭтапыИнцидентов>
			<v8:Ref xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">291059d6-81fe-11ec-bb9e-00155d70bd06</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Owner xsi:type="v8:CatalogRef.КА_ВидыИнцидентов">fe697b45-4e2c-11ec-bba8-00155d258b03</v8:Owner>
			<v8:Code>000000049</v8:Code>
			<v8:Description>Компенсировать за счёт компании 50%</v8:Description>
			<v8:АвтоматическийСтартЭтапа>false</v8:АвтоматическийСтартЭтапа>
			<v8:АвтоматическоеЗавершениеЭтапа>false</v8:АвтоматическоеЗавершениеЭтапа>
			<v8:АтрибутыНедоступны>false</v8:АтрибутыНедоступны>
			<v8:АтрибутыСкрыты>false</v8:АтрибутыСкрыты>
			<v8:ЗавершающийЭтап>false</v8:ЗавершающийЭтап>
			<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">00000000-0000-0000-0000-000000000000</v8:Исполнитель>
			<v8:ОбработчикПередВыполнением/>
			<v8:ОбработчикПередЗаписью>УстановитьПривилегированныйРежим(Истина);

ТабАтр = ЭтотОбъект.ЗначенияАтрибутов.Выгрузить();
Атр =  ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "ОтветственныйМКО");
Стр = ТабАтр.Найти(Атр, "Атрибут");  
Если не Стр = Неопределено и не (ЭтотОбъект.Ответственный = Стр.Значение) Тогда
	ЭтотОбъект.Ответственный = Стр.Значение;
КонецЕсли; 

ТаблицаАтрибутов = ЭтотОбъект.ЗначенияАтрибутов.Выгрузить();
	ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "ВозвратУтилизация"); 
	СтрИзменение = ТаблицаАтрибутов.Найти(ВыбАтрибут,"Атрибут");
	Если не ЗначениеЗаполнено(СтрИзменение) Тогда
		СтрИзменение = ТаблицаАтрибутов.Добавить();
		СтрИзменение.Атрибут = ВыбАтрибут;
	КонецЕсли;
ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "Экспертиза");
Стр = ТаблицаАтрибутов.Найти(ВыбАтрибут, "Атрибут");
Если Стр = Неопределено или Стр.Значение = Перечисления.КА_ДоставитьТоварНаЭкспертизу.Нет Тогда
	СтрИзменение.Значение = Перечисления.КА_ВозвратУтилизация.НеТребуется;
Иначе
	СтрИзменение.Значение = Перечисления.КА_ВозвратУтилизация.ОжидаетсяУтилизацииДетали;
КонецЕсли;
ЭтотОбъект.ЗначенияАтрибутов.Загрузить(ТаблицаАтрибутов);

ИнцидентЗапрос = Неопределено;
ЗаявкаНаВозврат = ЭтотОбъект.ПолучитьАтрибутИнцидента("ЗаявкаНаВозврат");
Для Каждого Стр из ЭтотОбъект.СвязанныеОбъекты Цикл
	Если СтрНайти(Строка(Стр.Объект), "запрос поставщику") Тогда
		ИнцидентЗапрос = Стр.Объект.ПолучитьОбъект();
		ТаблицаСвязанных = ИнцидентЗапрос.СвязанныеОбъекты.Выгрузить();
		ЗаявкаНаВозвратЗапрос = ТаблицаСвязанных.Найти(ЗаявкаНаВозврат, "Объект"); 
		Если ЗаявкаНаВозвратЗапрос = Неопределено Тогда
			НовСтр = ТаблицаСвязанных.Добавить();
			НовСтр.Объект = ЗаявкаНаВозврат;
			ИнцидентЗапрос.СвязанныеОбъекты.Загрузить(ТаблицаСвязанных);
		КонецЕсли;
		ТаблицаАтрибутов = ИнцидентЗапрос.ЗначенияАтрибутов.Выгрузить();
		ЕстьАтрибут = ТаблицаАтрибутов.Найти(ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоНаименованию("ЗаявкаНаВозврат"), "Атрибут");
		Если ЕстьАтрибут = Неопределено Тогда
			ЕстьЗначение = ТаблицаАтрибутов.Найти(ЗаявкаНаВозвратЗапрос, "Значение");
			Если не ЕстьЗначение = Неопределено Тогда
				НовСтр = ТаблицаАтрибутов.Добавить();
				НовСтр.Атрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоНаименованию("ЗаявкаНаВозврат");
				НовСтр.Значение = ЗаявкаНаВозврат;
				ИнцидентЗапрос.ЗначенияАтрибутов.Загрузить(ТаблицаАтрибутов);
				ИнцидентЗапрос.Записать();
			Иначе
				ЕстьЗначение.Атрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоНаименованию("ЗаявкаНаВозврат");
				ИнцидентЗапрос.ЗначенияАтрибутов.Загрузить(ТаблицаАтрибутов);
				ИнцидентЗапрос.Записать();
			КонецЕсли;
		Иначе
			ЕстьАтрибут.Значение = ЗаявкаНаВозврат;
			ИнцидентЗапрос.ЗначенияАтрибутов.Загрузить(ТаблицаАтрибутов);
			ИнцидентЗапрос.Записать();
		КонецЕсли;
		Прервать;
	КонецЕсли;
КонецЦикла;
УстановитьПривилегированныйРежим(Ложь);
Инцидент = ЭтотОбъект;
Если не Инцидент.Товары.Количество() = 0 Тогда
	ДокументИнцидент = Инцидент.Ссылка;
	ДокументРеализации = Инцидент.ПолучитьАтрибутИнцидента("realizationId");
	ПартнерПокупатель = ДокументРеализации.Партнер;
	ПартнерРегион = ПартнерПокупатель.БизнесРегион;
	ПартнерОсновнойМенеджер = ПартнерПокупатель.КА_ОсновнойКураторПокупателя;
	Поставщик = Справочники.Партнеры.ПустаяСсылка();
	Для каждого ТекСтр из ДокументИнцидент.СвязанныеОбъекты Цикл
		Если ТекСтр.Объект.Ссылка.Метаданные().Имя = "ПоступлениеТоваровУслуг" Тогда
			ДокПоступление = ТекСтр.Объект.Ссылка;	
			Поставщик = ДокПоступление.Партнер;	
		ИначеЕсли ТекСтр.Объект.Ссылка.Метаданные().Имя = "РеализацияТоваровУслуг" Тогда
				ДокументРеализации = ТекСтр.Объект.Ссылка;
		КонецЕсли;
	КонецЦикла;
	ТаблицаДвижений = Инцидент.ПолучитьСписокПараметровПроведения(Истина);
//Строка 16
	Для Каждого ТекСтрокаТовары Из Инцидент.Товары Цикл
		Движение = ТаблицаДвижений.Добавить();
		Движение.ВидИнцидента = Инцидент.ВидИнцидента;
		Движение.ЭтапИнцидента =  Инцидент.ТекущийЭтап;
		Движение.ВидДвижения = ВидДвиженияНакопления.Приход;
		Движение.Период = Инцидент.Ссылка.Дата;
		Движение.НоменклатураБренд = ТекСтрокаТовары.Номенклатура.Производитель;
		Движение.ТоварнаяГруппа = ТекСтрокаТовары.Номенклатура.ВидНоменклатуры;
		Движение.Номенклатура = ТекСтрокаТовары.Номенклатура;
		Движение.ДокументРеализации = ДокументРеализации;
		Движение.ДокументРекламации = ДокументИнцидент;
		Движение.Партнер = ПартнерПокупатель;
		Движение.Валюта = ТекСтрокаТовары.Валюта;
		Движение.ПартнерБизнесРегион = ПартнерРегион;
		Движение.ПартнерОсновнойМенеджер = ПартнерОсновнойМенеджер;
		Движение.АналитикаДефекта = ТекСтрокаТовары.АналитикаДефекта;
		Движение.КоличествоККомпенсации = 0;
		Движение.КоличествоКомпенсированоКлиенту = ТекСтрокаТовары.Количество;
		Движение.КоличествоПредъявленоПоставщику = 0;
		Движение.КоличествоКомпенсированоПоставщиком = 0;
		Движение.СуммаВал = ТекСтрокаТовары.Сумма;//СуммаВВалюте;
		Движение.СуммаБезНДСВал = ТекСтрокаТовары.СуммаСНДС-ТекСтрокаТовары.СуммаНДС;//СуммаВВалютеБезНДС;
		Движение.Сумма = ТекСтрокаТовары.Сумма;
		Движение.СуммаБезНДС = ТекСтрокаТовары.СуммаСНДС-ТекСтрокаТовары.СуммаНДС;
		Движение.РеализацияТоваровУслуг = ДокументРеализации;
		Движение.ДокументИнцидент = ДокументИнцидент;
		Движение.Склад = ТекСтрокаТовары.Склад;
		Движение.Регион = ТекСтрокаТовары.Склад.БизнесРегион;
		Движение.Поставщик = Поставщик;
		Движение.РешениеПоИнциденту = Инцидент.ПолучитьАтрибутИнцидента("РешениеИнженера");
	КонецЦикла;
	Инцидент. УстановитьСписокПараметровПроведения(Инцидент.ВидИнцидента, Инцидент.ТекущийЭтап, ТаблицаДвижений);
КонецЕсли;

</v8:ОбработчикПередЗаписью>
			<v8:ОбработчикПослеВыполнения/>
			<v8:ОбработчикПриЗаписи/>
			<v8:ОбработчикПриПереходе>Инцидент.СтатусИМ = Перечисления.КА_СтатусИМ.РекламацияОдобрена50ВыберитеСпособКомпенсации;

// Отправка статуса

НастройкаОбмена = Справочники.КА_НастройкиВыгрузкиВИМ.ПолучитьНастройку("Рекламация_СобытиеВыгрузкаСтатуса");

СоответствиеСтатусов = Новый Соответствие;
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ЗапросОтправлен, "SENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВРаботеУМенеджера, "PROCESS_BY_MANAGER");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.УточнитеДанныеОбращения, "CLARIFY_DETAILS");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВРаботеУИнженера, "PROCESS_BY_ENGINEER");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияПринятаВРаботуГарантийнымОтделом, "PROCESS_BY_WARRANTY_DEPARTMENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияПринятаУточняемСрокРассмотрения, "ACCEPTED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВозвратДеталиНаЭкспертизу, "EXPERTIZE");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОдобренаВыберитеСпособКомпенсации, "APPROVED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОтклоненаОзнакомьтесьСЗаключением, "REJECTED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ЗакрытоИПеренесеноВархивПоСрокуДавности, "CLOSED_ON_EXPIRATION");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияЗавершенаКлиентСогласен, "CLOSED_ON_AGREEMENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияЗавершенаКомпенсацияПредоставлена, "COMPENSATED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламациНаправленаВОтделКорпоративныхПродаж, "SENT_TO_SALES");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОдобрена50ВыберитеСпособКомпенсации, "APPROVED_50");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОтклоненаПовторно, "REJECTED_REPEATEDLY");

СтрДанных = Новый Структура;
СтрДанных.Вставить("complaintId", ЗначенияАтрибутов["id"]);
СтрДанных.Вставить("status", СоответствиеСтатусов[Инцидент.СтатусИМ]);

КА_Обмены.ОтправитьВСервис_Рефакторинг(СтрДанных, НастройкаОбмена, "ИМ2");

Инцидент.Ответственный = ЗначенияАтрибутов["ОтветственныйМКО"];

// Рассылка
Получатели = Новый Массив;
Вложения = Новый Соответствие;

ДокРТС = ЗначенияАтрибутов["realizationId"];
Партнер = ДокРТС.Партнер;

Адрес = УправлениеКонтактнойИнформацией.КонтактнаяИнформацияОбъекта(Партнер, Справочники.ВидыКонтактнойИнформации.EmailПартнера);
		
Если ЗначениеЗаполнено(Адрес) Тогда
	Получатели.Добавить(Новый Структура("Адрес, Представление", Адрес, Адрес));
КонецЕсли; 
	
Если Получатели.Количество() &gt; 0 Тогда

	Отправитель = Справочники.УчетныеЗаписиЭлектроннойПочты.СистемнаяУчетнаяЗаписьЭлектроннойПочты;
				
	Тема = "Обработка рекламации";
	ТекстПисьма = "Одобрена компенсация 50%. За разъяснениями Вы всегда можете обратиться к Вашему менеджеру.";	
			
	ПараметрыПисьма = Новый Структура;
	ПараметрыПисьма.Вставить("Кому",Получатели);
	ПараметрыПисьма.Вставить("Тема", Тема);
	ПараметрыПисьма.Вставить("Тело", ТекстПисьма);
	ПараметрыПисьма.Вставить("Вложения", Вложения);
				
	Попытка
		ИдентификаторСообщения = РаботаСПочтовымиСообщениями.ОтправитьПочтовоеСообщение(Отправитель, ПараметрыПисьма);
	Исключение
		Ошибка = ОписаниеОшибки();
		Сообщить(СтрШаблон("При отправке письма произошла ошибка: %1", Ошибка));
	КонецПопытки; 
		
КонецЕсли;

// Рассылка исполнителям
Тема = СтрШаблон("Обновлен статус рекламации %1 %2", Инцидент.Номер, ЗначенияАтрибутов["counterparty_external_id"]);
ТекстПисьма = Инцидент.ИсторияВыполнения[Инцидент.ИсторияВыполнения.Количество()-1].Результат;
М = Новый Массив;
М.Добавить(Инцидент.Ответственный);
Документы.КА_Инцидент.ОтправитьОповещение(М, Тема, ТекстПисьма);
//Документы.КА_Инцидент.ОтправитьОповещениеИсполнителямЭтапа(СледующийЭтап, Тема, ТекстПисьма);;</v8:ОбработчикПриПереходе>
			<v8:ОбработчикПриПринятииКИсполнению/>
			<v8:ОбработчикПроведения/>
			<v8:Описание>Это вариант компенсации без возврата товара. Он идёт либо после экспертизы, по которой был отказ, либо после прямого отказа инженера, который клиент оспорил, а НОР - согласовал возмещение.

В первом случае - после экспертизы - МКО переходит на созданный документ Заявка на возврат товаров от клиента по кнопке вверху формы, проверяет его реквизиты и продолжает соответствующий процесс.

Во втором случае, когда экспертизы не было - МКО создаёт документ Заявка на возврат товаров клиента, также проверяет его реквизиты и запускает соответствующий процесс с 50% скидкой на товар.

Когда в процессе возникает потребность в решении клиента - какую компенсацию он предпочтёт, МКО выбирет "Зачесть аванс".</v8:Описание>
			<v8:ПроверятьРезультат>false</v8:ПроверятьРезультат>
			<v8:СрокВыполнения>24</v8:СрокВыполнения>
			<v8:СообщениеНедоступныПереходы/>
			<v8:ОбработчикПриОткрытии/>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">3ab46ee4-8b6b-4e27-b05f-aa6c943c5895</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">6547e112-2de4-4388-82f0-4b24ca0eee42</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">6d160a64-dd08-11e4-b0fd-001517ac6c09</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">f6af22ec-7751-4f7a-bc7e-df85edb3c04f</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">19daaf30-9a1a-11e8-80c5-3cfdfeaf9019</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">97eb7d45-6782-4b33-9909-457572becfa8</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">b783b0ba-74ad-11e1-b634-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">812e0c18-3beb-11e8-80d0-001e6707aaa8</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">f149ab7d-7ada-11e8-80c5-3cfdfeaf9019</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">58a84576-77c0-4e0e-b065-1be30ab00af9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">0cafad1c-4262-11e1-b48c-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">c34b8004-ec1d-11e5-80c5-001e6707aaa8</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">ddcd8a22-00dc-11e4-9396-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">a0477a02-97f8-11e5-9a83-001517ac6c09</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">0a67f065-81fe-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>НайденаЗаявка = Ложь;
	Для каждого ТекСтр из Инцидент.СвязанныеОбъекты Цикл
		Если ТекСтр.Объект.Ссылка.Метаданные().Имя = "ЗаявкаНаВозвратТоваровОтКлиента" Тогда
			НайденаЗаявка = (Истина И ТекСтр.Объект.Проведен) или Отказ;
		КонецЕсли;
	КонецЦикла;
Отказ = не НайденаЗаявка;
Если Отказ Тогда
	Сообщить("Для завершения этапа убедитесь, что документ Зявка на возват товаров от клиента создан и проведен или корректно указано Решение Инженера");
КонецЕсли;
</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:Команды>
				<v8:Заголовок>Оформить Заявку на возврат</v8:Заголовок>
				<v8:УИ>dbe4cc95-0605-4511-b75d-5c667645747b</v8:УИ>
				<v8:ОбработчикКлиентПеред/>
				<v8:ОбработчикСервер>СпкДатаНачалаУчетаПослеСвертки = КА_СлужебныеПараметры.ПолучитьЗначение(ПланыВидовХарактеристик.КА_СлужебныеПараметры.ДатаНачалаУчетаПослеСверткиБазы); 
ДатаНУПС = СпкДатаНачалаУчетаПослеСвертки.Получить(0); 

ДатаДень = Число(Сред(ДатаНУПС,1,2));
ДатаМесяц= Число(Сред(ДатаНУПС,4,2));
ДатаГод  = Число(Сред(ДатаНУПС,7,4));
ДатаНУПС = (Дата(ДатаГод, ДатаМесяц, ДатаДень));

ЗаявкаНаВозврат = Документы.ЗаявкаНаВозвратТоваровОтКлиента.ПустаяСсылка();
ДокРТС = Документы.РеализацияТоваровУслуг.ПустаяСсылка();

Для каждого ТекСтр из Объект.СвязанныеОбъекты Цикл
	Если ТекСтр.Объект.Ссылка.Метаданные().Имя = "ЗаявкаНаВозвратТоваровОтКлиента" Тогда
		ЗаявкаНаВозврат = ТекСтр.Объект.Ссылка;
	ИначеЕсли ТекСтр.Объект.Ссылка.Метаданные().Имя = "РеализацияТоваровУслуг" Тогда 
		ДокРТС = ТекСтр.Объект.Ссылка;
	КонецЕсли;
КонецЦикла;
//Стр 19 
ТаблицаТоваров = Объект.Товары.Выгрузить();
ТаблицаТоваров.Колонки.Добавить("ДокументРеализации");
ТаблицаТоваров.Колонки.Добавить("КА_ЗаказКлиента");
ИнцидентОбъект = РеквизитФормыВЗначение("Объект");
СпособОформленияВозврата = ИнцидентОбъект.ПолучитьАтрибутИнцидента("СпособОформленияВозврата");
ВидОформленияВозвратныхДокументов = ИнцидентОбъект.ПолучитьАтрибутИнцидента("ВидОформленияДокументов");

//++Задача 234706 - берем РТУ из [realiztionid] Значений Атрибутов
ДокРТС = ИнцидентОбъект.ПолучитьАтрибутИнцидента("realizationId");
//--Задача 234706 - берем РТУ из [realiztionid] Значений Атрибутов

ТоварыРТС = ДокРТС.Товары.Выгрузить();  
Для каждого ТекСтр из ТаблицаТоваров Цикл
	ТекСтр.КоличествоУпаковок = ТекСтр.Количество;
	ТоварыРТСНоменклатура = ТоварыРТС.Скопировать(,"Номенклатура,КоличествоУпаковок");
	ТоварыРТСНоменклатура.Свернуть("Номенклатура", "КоличествоУпаковок"); 
	СтрНом = ТоварыРТСНоменклатура.Найти(ТекСтр.Номенклатура,"Номенклатура");
	Если не СтрНом = Неопределено Тогда 
		ТекСтр.КА_КоличествоПродано = СтрНом.КоличествоУпаковок;
	КонецЕсли; 
	ТекСтр.ДокументРеализации = ДокРТС;
	ТекСтр.КА_ЗаказКлиента = ДокРТС.ЗаказКлиента;
	ТекСтр.Цена = ТекСтр.Цена/2;
	ТекСтр.Сумма = ТекСтр.Сумма/2;
	ТекСтр.СуммаНДС =  ТекСтр.СуммаНДС /2;
	ТекСтр.СуммаСНДС = ТекСтр.СуммаСНДС/2;
КонецЦикла;

Если не (ЗаявкаНаВозврат =  Документы.ЗаявкаНаВозвратТоваровОтКлиента.ПустаяСсылка()) Тогда
//	Сообщить(Строка(ЗаявкаНаВозврат) + " уже сформирована в документе"); 	
ИначеЕсли ЗаявкаНаВозврат =  Документы.ЗаявкаНаВозвратТоваровОтКлиента.ПустаяСсылка() и не (ДокРТС = Документы.РеализацияТоваровУслуг.ПустаяСсылка())Тогда
	ЗаявкаНаВозврат = Документы.ЗаявкаНаВозвратТоваровОтКлиента.СоздатьДокумент();
	ЗаявкаНаВозврат.Дата = ТекущаяДата();
//	В связи с проблематикой непровденных РТУ ветвление заполнения ЗВТК на основании РТУ  05.10.2022 Лупонос Д.В.
	Если ДатаНУПС &lt; ДокРтс.Дата Тогда
		ЗаявкаНаВозврат.Заполнить(ДокРТС.Ссылка);
	ИначеЕсли не ДокРТС.Проведен Тогда 
		ЗаполнитьЗначенияСвойств(ЗаявкаНаВозврат, ДокРТС.Ссылка,,"Дата,Номер");
//		ЗаявкаНаВозврат.Дата = ТекущаяДата();
		ЗаявкаНаВозврат.Номер = ""; 
		ЗаявкаНаВозврат.Организация = ДокРТС.Организация; 
		ЗаявкаНаВозврат.Договор = ДокРТС.Договор; 
		ЗаявкаНаВозврат.Валюта = ДокРТС.Валюта; 
		ЗаявкаНаВозврат.Партнер = ДокРТС.Партнер; 
		ЗаявкаНаВозврат.Склад = ДокРТС.Склад; 
		ЗаявкаНаВозврат.Контрагент = ДокРТС.Контрагент; 
		ЗаявкаНаВозврат.Соглашение = ДокРТС.Соглашение; 
	КонецЕсли; 
//	В связи с проблематикой непровденных РТУ ветвление заполнения ЗВТК на основании РТУ  05.10.2022 Лупонос Д.В.
	ЗаявкаНаВозврат.Приоритет = Справочники.Приоритеты.НайтиПоНаименованию("Средний"); 
	ЗаявкаНаВозврат.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.ВозвратТоваровОтКлиента;
	ЗаявкаНаВозврат.Менеджер = ИнцидентОбъект.ПолучитьАтрибутИнцидента("ОтветственныйМКО");
	ЗаявкаНаВозврат.Подразделение = ЗаявкаНаВозврат.Менеджер.Подразделение; 
	ЗаявкаНаВозврат.КА_СпособДоставкиОтКлиента = Перечисления.СпособыДоставки.ДоКлиента;
	ЗаявкаНаВозврат.Комментарий = Строка(Объект.Ссылка);
		
	ЗаявкаНаВозврат.КА_Причина=Справочники.ПричиныВозникновенияПретензий.НайтиПоНаименованию("Брак").Ссылка;
	ЗаявкаНаВозврат.КА_АналитикаПричинБрака = Справочники.КА_АналитикаПричинБрака.НайтиПоНаименованию("Брак, компенсация за счет Бюджета НОР").Ссылка;
	ЗаявкаНаВозврат.КА_Фиктивный=Истина;//ИнцидентОбъект.ПолучитьАтрибутИнцидента("Товар вернуть");
//	
	ЗаявкаНаВозврат.КА_СпособОформленияВозврата = СпособОформленияВозврата;
	ЗаявкаНаВозврат.КА_ВидОформленияВозвратныхДокументов = ВидОформленияВозвратныхДокументов;
	ЗаявкаНаВозврат.ДокументРеализации = ДокРТС.Ссылка;
	ЗаявкаНаВозврат.КА_Инцидент = Объект.Ссылка;
	ЗаявкаНаВозврат.ВозвращаемыеТовары.Загрузить(ТаблицаТоваров);

//	В связи с проблематикой непровденных РТУ для корректного проведения установим признак КА_Проверено в каждой строке ТЧ ЗВТК 05.10.2022 Лупонос Д.В.
	Сч = 1;
	Если не ДокРТС.Проведен и ДатаНУПС &gt; ДокРтс.Дата Тогда 	
		ТаблицаТоваров = ЗаявкаНаВозврат.ВозвращаемыеТовары.Выгрузить();
		Для Каждого Стр из ТаблицаТоваров Цикл
			Стр.КА_Проверено = Истина;
//			Стр.КодСтроки = Сч; 
//			Сч = Сч + 1; 
		КонецЦикла;
		ЗаявкаНаВозврат.ВозвращаемыеТовары.Загрузить(ТаблицаТоваров);
	КонецЕсли; 
//	В связи с проблематикой непровденных РТУ для корректного проведения установим признак КА_Проверено в каждой строке ТЧ ЗВТК 05.10.2022 Лупонос Д.В.

	ЭкспертизаТут = ИнцидентОбъект.ПолучитьАтрибутИнцидента("Экспертиза");
	Если ЭкспертизаТут = Перечисления.КА_ДоставитьТоварНаЭкспертизу.Да Тогда
		ЗаявкаНаВозврат.КА_ДоставитьТоварНаЭкспертизу = Истина;
	Иначе
		ЗаявкаНаВозврат.КА_ДоставитьТоварНаЭкспертизу = Ложь;
	КонецЕсли;
//++Задача 234706 РТУ является экспортной 
	Запрос = Новый Запрос; 
	Запрос.Текст = "ВЫБРАТЬ
	|	РеализацияТоваровУслуг.Ссылка КАК Ссылка
	|ИЗ
	|	Документ.РеализацияТоваровУслуг КАК РеализацияТоваровУслуг
	|ГДЕ
	|	РеализацияТоваровУслуг.Соглашение.Наименование ПОДОБНО ""Соглашение К""
	|	И РеализацияТоваровУслуг.Ссылка = &amp;Ссылка"; 
	Запрос.УстановитьПараметр("Ссылка", ДокРТС.Ссылка);
	Рез = Запрос.Выполнить().Выгрузить(); 
	Если Рез.Количество() &gt; 0 Тогда 
		ЗаявкаНаВозврат.СпособКомпенсации = Перечисления.СпособыКомпенсацииВозвратовТоваров.ЗаменитьТовары; 
		ЗаявкаНаВозврат.КА_СпособОформленияВозврата = Перечисления.КА_СпособыОформленияВозврата.ЗаменаДокументов; 
	КонецЕсли; 
//--Задача 234706  РТУ является экспортной
	Попытка 
		ЗаявкаНаВозврат.Записать();
	Исключение
		ЗаявкаНаВозврат.Записать(Ложь);
	КонецПопытки; 
	СвязатьСОбъектомИзФормыНаСервере(ЗаявкаНаВозврат.Ссылка);
	ТаблицаАтрибутовДокумента = Объект.ЗначенияАтрибутов.Выгрузить();
	АтрибутИнцидента=ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоНаименованию("ЗаявкаНаВозврат");
	ТаблицаАтрибутовДокумента = Объект.ЗначенияАтрибутов.Выгрузить();
	СтрокаИзм = ТаблицаАтрибутовДокумента.Найти(АтрибутИнцидента,"Атрибут");
	Если СтрокаИзм = Неопределено Тогда
		СтрокаИзм = ТаблицаАтрибутовДокумента.Добавить();
		СтрокаИзм.Атрибут = АтрибутИнцидента;
	КонецЕсли;
	СтрокаИзм.Значение = ЗаявкаНаВозврат.Ссылка;
	Объект.ЗначенияАтрибутов.Загрузить(ТаблицаАтрибутовДокумента);
КонецЕсли;
</v8:ОбработчикСервер>
				<v8:ОбработчикКлиентПосле>ЗаявкаНаВозврат = Неопределено;
Для каждого ТекСтр из Объект.СвязанныеОбъекты Цикл
	Если СтрНайти(Строка(ТекСтр.Объект), "Заявка на возврат товаров от клиента") Тогда
		ЗаявкаНаВозврат = ТекСтр.Объект;
	КонецЕсли;
КонецЦикла;

Если не ЗаявкаНаВозврат=Неопределено тогда
	ОткрытьФорму("Документ.ЗаявкаНаВозвратТоваровОтКлиента.ФормаОбъекта", новый Структура("Ключ",ЗаявкаНаВозврат));
КонецЕсли;</v8:ОбработчикКлиентПосле>
			</v8:Команды>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">f9220711-8795-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">455e5227-8e55-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">b444c315-5f3e-11ed-bba5-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>true</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
		</v8:CatalogObject.КА_ЭтапыИнцидентов>
		<v8:CatalogObject.КА_ЭтапыИнцидентов>
			<v8:Ref xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">0a485bfa-d7c4-11ec-bbaf-00155d258b03</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Owner xsi:type="v8:CatalogRef.КА_ВидыИнцидентов">fe697b45-4e2c-11ec-bba8-00155d258b03</v8:Owner>
			<v8:Code>000000076</v8:Code>
			<v8:Description>Завершен. Отказано. Деталь возвращена</v8:Description>
			<v8:АвтоматическийСтартЭтапа>true</v8:АвтоматическийСтартЭтапа>
			<v8:АвтоматическоеЗавершениеЭтапа>true</v8:АвтоматическоеЗавершениеЭтапа>
			<v8:АтрибутыНедоступны>false</v8:АтрибутыНедоступны>
			<v8:АтрибутыСкрыты>false</v8:АтрибутыСкрыты>
			<v8:ЗавершающийЭтап>false</v8:ЗавершающийЭтап>
			<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">00000000-0000-0000-0000-000000000000</v8:Исполнитель>
			<v8:ОбработчикПередВыполнением/>
			<v8:ОбработчикПередЗаписью>ТаблицаАтрибутов = ЭтотОбъект.ЗначенияАтрибутов.Выгрузить();
	ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "ВозвратУтилизация");
	ИзмСтр = ТаблицаАтрибутов.Найти(ВыбАтрибут, "Атрибут");
	Если ИзмСтр = Неопределено Тогда
		ИзмСтр = ТаблицаАтрибутов.Добавить();
		ИзмСтр.Атрибут = ВыбАтрибут;
	КонецЕсли;
	ИзмСтр.Значение = Перечисления.КА_ВозвратУтилизация.ВозвратПроведен;

ЭтотОбъект.ЗначенияАтрибутов.Загрузить(ТаблицаАтрибутов);
</v8:ОбработчикПередЗаписью>
			<v8:ОбработчикПослеВыполнения/>
			<v8:ОбработчикПриЗаписи/>
			<v8:ОбработчикПриПереходе>Инцидент.КА_СтатусЗавершен= Перечисления.КА_СтатусЗавершенияИМ.ЗавершенОтказаноКлиентСогласен;
Для Каждого Стр из Инцидент.ИсторияВыполнения Цикл
	Если ЗначениеЗаполнено(Стр.Этап) Тогда
	Если СтрНайти(Стр.Этап.Наименование,"Рекламация: Обработка инцидента") Тогда
		Инцидент.Ответственный = Стр.Исполнитель;
		Прервать;
	КонецЕсли;
	КонецЕсли;
КонецЦикла;

</v8:ОбработчикПриПереходе>
			<v8:ОбработчикПриПринятииКИсполнению/>
			<v8:ОбработчикПроведения/>
			<v8:Описание>Автоматическое завершение инцидента, если клиент согласился с отказом, но товар попросил вернуть.
Завершаентся при отгрузки товара со склада в своём регионе.</v8:Описание>
			<v8:ПроверятьРезультат>false</v8:ПроверятьРезультат>
			<v8:СрокВыполнения>1</v8:СрокВыполнения>
			<v8:СообщениеНедоступныПереходы/>
			<v8:ОбработчикПриОткрытии/>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">27b1b5ed-427b-11e6-80c3-0cc47a6b63cf</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
		</v8:CatalogObject.КА_ЭтапыИнцидентов>
		<v8:CatalogObject.КА_ЭтапыИнцидентов>
			<v8:Ref xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">99c177aa-d7c3-11ec-bbaf-00155d258b03</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Owner xsi:type="v8:CatalogRef.КА_ВидыИнцидентов">fe697b45-4e2c-11ec-bba8-00155d258b03</v8:Owner>
			<v8:Code>000000075</v8:Code>
			<v8:Description>Организация возврата детали с экспертизы</v8:Description>
			<v8:АвтоматическийСтартЭтапа>false</v8:АвтоматическийСтартЭтапа>
			<v8:АвтоматическоеЗавершениеЭтапа>false</v8:АвтоматическоеЗавершениеЭтапа>
			<v8:АтрибутыНедоступны>false</v8:АтрибутыНедоступны>
			<v8:АтрибутыСкрыты>false</v8:АтрибутыСкрыты>
			<v8:ЗавершающийЭтап>false</v8:ЗавершающийЭтап>
			<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">00000000-0000-0000-0000-000000000000</v8:Исполнитель>
			<v8:ОбработчикПередВыполнением/>
			<v8:ОбработчикПередЗаписью/>
			<v8:ОбработчикПослеВыполнения/>
			<v8:ОбработчикПриЗаписи/>
			<v8:ОбработчикПриПереходе>Инцидент.Ответственный = ЗначенияАтрибутов["ОтветственныйМКО"]; 
//ТаблицаАтрибутов = Инцидент.ЗначенияАтрибутов.Выгрузить();
//	ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "ВозвратУтилизация");
//	ИзмСтр = ТаблицаАтрибутов.Найти(ВыбАтрибут, "Атрибут");
//	Если ИзмСтр = Неопределено Тогда
//		ИзмСтр = ТаблицаАтрибутов.Добавить();
//		ИзмСтр.Атрибут = ВыбАтрибут;
//	КонецЕсли;
//	ИзмСтр.Значение = Перечисления.КА_ВозвратУтилизация.ОжидаетсяВозвратДетали;

//Инцидент.ЗначенияАтрибутов.Загрузить(ТаблицаАтрибутов);
</v8:ОбработчикПриПереходе>
			<v8:ОбработчикПриПринятииКИсполнению/>
			<v8:ОбработчикПроведения/>
			<v8:Описание>МКО принимает инцидент в работу и организует возврат детали с ответственного хранения.

По получению уведомления об отгрузки товара со склада-отправителя, МКО в атрибуте "Возврат и утилизация" на вкладке "Дополнительно" выбирает пункт "Возврат проведен"

После этого МКО нажимает кнопку «Выполнить» на вкладке «Основное» и инцидент переходит на завершающий этап</v8:Описание>
			<v8:ПроверятьРезультат>false</v8:ПроверятьРезультат>
			<v8:СрокВыполнения>8</v8:СрокВыполнения>
			<v8:СообщениеНедоступныПереходы/>
			<v8:ОбработчикПриОткрытии/>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">58a84576-77c0-4e0e-b065-1be30ab00af9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">3ab46ee4-8b6b-4e27-b05f-aa6c943c5895</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">6547e112-2de4-4388-82f0-4b24ca0eee42</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">6d160a64-dd08-11e4-b0fd-001517ac6c09</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">f6af22ec-7751-4f7a-bc7e-df85edb3c04f</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">19daaf30-9a1a-11e8-80c5-3cfdfeaf9019</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">97eb7d45-6782-4b33-9909-457572becfa8</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">b783b0ba-74ad-11e1-b634-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">812e0c18-3beb-11e8-80d0-001e6707aaa8</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">f149ab7d-7ada-11e8-80c5-3cfdfeaf9019</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">0cafad1c-4262-11e1-b48c-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">c34b8004-ec1d-11e5-80c5-001e6707aaa8</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">ddcd8a22-00dc-11e4-9396-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">a0477a02-97f8-11e5-9a83-001517ac6c09</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">0a485bfa-d7c4-11ec-bbaf-00155d258b03</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>Если НЕ РольДоступна("ПолныеПрава") Тогда

	Если НЕ ЗначенияАтрибутов["ВозвратУтилизация"] = Перечисления.КА_ВозвратУтилизация.ВозвратПроведен Тогда
	
		Отказ = Истина;
	
	КонецЕсли;

КонецЕсли;</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">20e9e340-bc98-11ec-bbaf-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
		</v8:CatalogObject.КА_ЭтапыИнцидентов>
		<v8:CatalogObject.КА_ЭтапыИнцидентов>
			<v8:Ref xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">b39a8a2d-d7c2-11ec-bbaf-00155d258b03</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Owner xsi:type="v8:CatalogRef.КА_ВидыИнцидентов">fe697b45-4e2c-11ec-bba8-00155d258b03</v8:Owner>
			<v8:Code>000000074</v8:Code>
			<v8:Description>Завершен. Отказано. Деталь возвращать не требуется</v8:Description>
			<v8:АвтоматическийСтартЭтапа>true</v8:АвтоматическийСтартЭтапа>
			<v8:АвтоматическоеЗавершениеЭтапа>true</v8:АвтоматическоеЗавершениеЭтапа>
			<v8:АтрибутыНедоступны>false</v8:АтрибутыНедоступны>
			<v8:АтрибутыСкрыты>false</v8:АтрибутыСкрыты>
			<v8:ЗавершающийЭтап>false</v8:ЗавершающийЭтап>
			<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">00000000-0000-0000-0000-000000000000</v8:Исполнитель>
			<v8:ОбработчикПередВыполнением/>
			<v8:ОбработчикПередЗаписью>ТаблицаАтрибутов = ЭтотОбъект.ЗначенияАтрибутов.Выгрузить();

	ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "ВозвратУтилизация");
	ИзмСтр = ТаблицаАтрибутов.Найти(ВыбАтрибут, "Атрибут");
	Если ИзмСтр = Неопределено Тогда
		ИзмСтр = ТаблицаАтрибутов.Добавить();
		ИзмСтр.Атрибут = ВыбАтрибут;
	КонецЕсли;
	ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "РешениеИнженера");
	ПоискСтр = ТаблицаАтрибутов.Найти(ВыбАтрибут, "Атрибут");
	Если ПоискСтр = Неопределено или не ПоискСтр.Значение = Перечисления.КА_РешенияИнженера.НеБракОтказ Тогда 
		ИзмСтр.Значение = Перечисления.КА_ВозвратУтилизация.ОжидаетсяУтилизацииДетали;
 	Иначе
		ИзмСтр.Значение = Перечисления.КА_ВозвратУтилизация.ОжидаетсяВозвратДетали;
 	КонецЕсли; 
ЭтотОбъект.ЗначенияАтрибутов.Загрузить(ТаблицаАтрибутов);
</v8:ОбработчикПередЗаписью>
			<v8:ОбработчикПослеВыполнения/>
			<v8:ОбработчикПриЗаписи/>
			<v8:ОбработчикПриПереходе>Инцидент.КА_СтатусЗавершен= Перечисления.КА_СтатусЗавершенияИМ.ЗавершенОтказаноКлиентСогласен;
Для Каждого Стр из Инцидент.ИсторияВыполнения Цикл
	Если ЗначениеЗаполнено(Стр.Этап) Тогда
	Если СтрНайти(Стр.Этап.Наименование,"Рекламация: Обработка инцидента") Тогда
		Инцидент.Ответственный = Стр.Исполнитель;
		Прервать;
	КонецЕсли;
	КонецЕсли;
КонецЦикла;

</v8:ОбработчикПриПереходе>
			<v8:ОбработчикПриПринятииКИсполнению/>
			<v8:ОбработчикПроведения/>
			<v8:Описание>Автоматическое завершение инцидента, если клиент согласился с отказом и деталь обратно не просит.</v8:Описание>
			<v8:ПроверятьРезультат>false</v8:ПроверятьРезультат>
			<v8:СрокВыполнения>1</v8:СрокВыполнения>
			<v8:СообщениеНедоступныПереходы/>
			<v8:ОбработчикПриОткрытии/>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">27b1b5ed-427b-11e6-80c3-0cc47a6b63cf</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">1cf61873-ba50-11ec-bba2-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
		</v8:CatalogObject.КА_ЭтапыИнцидентов>
		<v8:CatalogObject.КА_ЭтапыИнцидентов>
			<v8:Ref xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">4a3602ca-8e59-11ec-bb9e-00155d70bd06</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Owner xsi:type="v8:CatalogRef.КА_ВидыИнцидентов">fe697b45-4e2c-11ec-bba8-00155d258b03</v8:Owner>
			<v8:Code>000000059</v8:Code>
			<v8:Description>Завершен. Отказ в компенсации НОР</v8:Description>
			<v8:АвтоматическийСтартЭтапа>false</v8:АвтоматическийСтартЭтапа>
			<v8:АвтоматическоеЗавершениеЭтапа>false</v8:АвтоматическоеЗавершениеЭтапа>
			<v8:АтрибутыНедоступны>false</v8:АтрибутыНедоступны>
			<v8:АтрибутыСкрыты>false</v8:АтрибутыСкрыты>
			<v8:ЗавершающийЭтап>false</v8:ЗавершающийЭтап>
			<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">00000000-0000-0000-0000-000000000000</v8:Исполнитель>
			<v8:ОбработчикПередВыполнением/>
			<v8:ОбработчикПередЗаписью>ТаблицаАтрибутов = ЭтотОбъект.ЗначенияАтрибутов.Выгрузить();
	ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "ВозвратУтилизация"); 
	СтрИзменение = ТаблицаАтрибутов.Найти(ВыбАтрибут,"Атрибут");
	Если не ЗначениеЗаполнено(СтрИзменение) Тогда
		СтрИзменение = ТаблицаАтрибутов.Добавить();
		СтрИзменение.Атрибут = ВыбАтрибут;
	КонецЕсли;
ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "Экспертиза");
Стр = ТаблицаАтрибутов.Найти(ВыбАтрибут, "Атрибут");
ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "ТоварВернуть");
ТовВерн = ТаблицаАтрибутов.Найти(ВыбАтрибут, "Атрибут");

Если (Стр = Неопределено или Стр.Значение = Перечисления.КА_ДоставитьТоварНаЭкспертизу.Нет) Тогда
	СтрИзменение.Значение = Перечисления.КА_ВозвратУтилизация.НеТребуется;
ИначеЕсли (не Стр = Неопределено и Стр.Значение = Перечисления.КА_ДоставитьТоварНаЭкспертизу.Да) и (не СтрИзменение=Неопределено и не СтрИзменение.Значение = Перечисления.КА_ВозвратУтилизация.ДетальУтилизирована) Тогда
	СтрИзменение.Значение = Перечисления.КА_ВозвратУтилизация.ОжидаетсяВозвратДетали;
КонецЕсли;
ЭтотОбъект.ЗначенияАтрибутов.Загрузить(ТаблицаАтрибутов);
</v8:ОбработчикПередЗаписью>
			<v8:ОбработчикПослеВыполнения/>
			<v8:ОбработчикПриЗаписи/>
			<v8:ОбработчикПриПереходе>Инцидент.СтатусИМ = Перечисления.КА_СтатусИМ.РекламацияОтклоненаПовторно;
//Обрабатываем Пользователей  в поля инцидента по этапу 
Инцидент.Ответственный  = ЗначенияАтрибутов["ОтветственныйМКО"];

// Отправка статуса

НастройкаОбмена = Справочники.КА_НастройкиВыгрузкиВИМ.ПолучитьНастройку("Рекламация_СобытиеВыгрузкаСтатуса");

СоответствиеСтатусов = Новый Соответствие;
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ЗапросОтправлен, "SENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВРаботеУМенеджера, "PROCESS_BY_MANAGER");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.УточнитеДанныеОбращения, "CLARIFY_DETAILS");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВРаботеУИнженера, "PROCESS_BY_ENGINEER");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияПринятаВРаботуГарантийнымОтделом, "PROCESS_BY_WARRANTY_DEPARTMENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияПринятаУточняемСрокРассмотрения, "ACCEPTED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВозвратДеталиНаЭкспертизу, "EXPERTIZE");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОдобренаВыберитеСпособКомпенсации, "APPROVED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОтклоненаОзнакомьтесьСЗаключением, "REJECTED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ЗакрытоИПеренесеноВархивПоСрокуДавности, "CLOSED_ON_EXPIRATION");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияЗавершенаКлиентСогласен, "CLOSED_ON_AGREEMENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияЗавершенаКомпенсацияПредоставлена, "COMPENSATED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламациНаправленаВОтделКорпоративныхПродаж, "SENT_TO_SALES");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОдобрена50ВыберитеСпособКомпенсации, "APPROVED_50");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОтклоненаПовторно, "REJECTED_REPEATEDLY");

СтрДанных = Новый Структура;
СтрДанных.Вставить("complaintId", ЗначенияАтрибутов["id"]);
СтрДанных.Вставить("status", СоответствиеСтатусов[Инцидент.СтатусИМ]);

КА_Обмены.ОтправитьВСервис_Рефакторинг(СтрДанных, НастройкаОбмена, "ИМ2");

// Рассылка
Получатели = Новый Массив;
Вложения = Новый Соответствие;

ДокРТС = ЗначенияАтрибутов["realizationId"];
Партнер = ДокРТС.Партнер;

Адрес = УправлениеКонтактнойИнформацией.КонтактнаяИнформацияОбъекта(Партнер, Справочники.ВидыКонтактнойИнформации.EmailПартнера);
		
Если ЗначениеЗаполнено(Адрес) Тогда
	Получатели.Добавить(Новый Структура("Адрес, Представление", Адрес, Адрес));
КонецЕсли; 
	
Если Получатели.Количество() &gt; 0 Тогда

	Отправитель = Справочники.УчетныеЗаписиЭлектроннойПочты.СистемнаяУчетнаяЗаписьЭлектроннойПочты;
				
	Тема = "Обработка рекламации";
	ТекстПисьма = "Мы еще раз подробно рассмотрели Вашу рекламацию, но так и не нашли заводских дефектов (брака).";	
			
	ПараметрыПисьма = Новый Структура;
	ПараметрыПисьма.Вставить("Кому",Получатели);
	ПараметрыПисьма.Вставить("Тема", Тема);
	ПараметрыПисьма.Вставить("Тело", ТекстПисьма);
	ПараметрыПисьма.Вставить("Вложения", Вложения);
				
	Попытка
		ИдентификаторСообщения = РаботаСПочтовымиСообщениями.ОтправитьПочтовоеСообщение(Отправитель, ПараметрыПисьма);
	Исключение
		Ошибка = ОписаниеОшибки();
		Сообщить(СтрШаблон("При отправке письма произошла ошибка: %1", Ошибка));
	КонецПопытки; 
		
КонецЕсли;

// Рассылка исполнителям
Тема = СтрШаблон("Рекламация %1 завершена", Инцидент.Номер);
ТекстПисьма = "Отказ в компенсации НОР.";
Документы.КА_Инцидент.ОтправитьОповещениеИсполнителямЭтапа(СледующийЭтап, Тема, ТекстПисьма);</v8:ОбработчикПриПереходе>
			<v8:ОбработчикПриПринятииКИсполнению/>
			<v8:ОбработчикПроведения/>
			<v8:Описание>МКО принимает инцидент в работу и проверяет, была ли доставлена деталь на экспертизу.

Если возврат детали был (атрибут "Доставить деталь на экспертизу "=Да), МКО выясняет (по телефону или электронной почте), нужна ли деталь клиенту.

После получения ответа, МКО переходит на вкладку Дополнительно и в атрибуте "Возврт и утилизация детали" выбирает значение 
- "Ожидается утилизация детали" - если деталь клиенту не нужна
или 
- "Ожидается возврат детали" - если клиент просит деталь вернуть.

После заполнения атрибутов МКО нажимает кнопку «Выполнить» на вкладке «Основное» и инцидент автоматически перейдёт на нужный этап.
_______________________________________________________________________________________________
Если возврата детали не было, МКО нажимает кнопку «Выполнить» на вкладке «Основное» без заполнения каких-либо атрибутов.
</v8:Описание>
			<v8:ПроверятьРезультат>false</v8:ПроверятьРезультат>
			<v8:СрокВыполнения>2</v8:СрокВыполнения>
			<v8:СообщениеНедоступныПереходы/>
			<v8:ОбработчикПриОткрытии/>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">3ab46ee4-8b6b-4e27-b05f-aa6c943c5895</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">a0477a02-97f8-11e5-9a83-001517ac6c09</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">6547e112-2de4-4388-82f0-4b24ca0eee42</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">6d160a64-dd08-11e4-b0fd-001517ac6c09</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">f6af22ec-7751-4f7a-bc7e-df85edb3c04f</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">19daaf30-9a1a-11e8-80c5-3cfdfeaf9019</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">97eb7d45-6782-4b33-9909-457572becfa8</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">b783b0ba-74ad-11e1-b634-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">812e0c18-3beb-11e8-80d0-001e6707aaa8</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">f149ab7d-7ada-11e8-80c5-3cfdfeaf9019</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">58a84576-77c0-4e0e-b065-1be30ab00af9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">0cafad1c-4262-11e1-b48c-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">c34b8004-ec1d-11e5-80c5-001e6707aaa8</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">ddcd8a22-00dc-11e4-9396-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">99c177aa-d7c3-11ec-bbaf-00155d258b03</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>Если НЕ РольДоступна("ПолныеПрава") Тогда

	Если НЕ ЗначенияАтрибутов["ВозвратУтилизация"] = Перечисления.КА_ВозвратУтилизация.ОжидаетсяВозвратДетали Тогда
	
		Отказ = Истина;
	
	КонецЕсли;

КонецЕсли;</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">b39a8a2d-d7c2-11ec-bbaf-00155d258b03</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>Если НЕ РольДоступна("ПолныеПрава") Тогда

	Если НЕ ЗначенияАтрибутов["ВозвратУтилизация"] = Перечисления.КА_ВозвратУтилизация.ОжидаетсяУтилизацииДетали Тогда
	
		Отказ = Истина;
	
	КонецЕсли;

КонецЕсли;</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">20e9e340-bc98-11ec-bbaf-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
		</v8:CatalogObject.КА_ЭтапыИнцидентов>
		<v8:CatalogObject.КА_ЭтапыИнцидентов>
			<v8:Ref xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">129df58b-81fe-11ec-bb9e-00155d70bd06</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Owner xsi:type="v8:CatalogRef.КА_ВидыИнцидентов">fe697b45-4e2c-11ec-bba8-00155d258b03</v8:Owner>
			<v8:Code>000000043</v8:Code>
			<v8:Description>Компенсация. Заменить товары</v8:Description>
			<v8:АвтоматическийСтартЭтапа>false</v8:АвтоматическийСтартЭтапа>
			<v8:АвтоматическоеЗавершениеЭтапа>false</v8:АвтоматическоеЗавершениеЭтапа>
			<v8:АтрибутыНедоступны>false</v8:АтрибутыНедоступны>
			<v8:АтрибутыСкрыты>false</v8:АтрибутыСкрыты>
			<v8:ЗавершающийЭтап>false</v8:ЗавершающийЭтап>
			<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">00000000-0000-0000-0000-000000000000</v8:Исполнитель>
			<v8:ОбработчикПередВыполнением/>
			<v8:ОбработчикПередЗаписью>
ТаблицаАтрибутов = ЭтотОбъект.ЗначенияАтрибутов.Выгрузить();
	ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "ВозвратУтилизация"); 
	СтрИзменение = ТаблицаАтрибутов.Найти(ВыбАтрибут,"Атрибут");
	Если не ЗначениеЗаполнено(СтрИзменение) Тогда
		СтрИзменение = ТаблицаАтрибутов.Добавить();
		СтрИзменение.Атрибут = ВыбАтрибут;
	КонецЕсли;
ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "ТоварВернуть");
Стр = ТаблицаАтрибутов.Найти(ВыбАтрибут, "Атрибут");
Если Стр = Неопределено или Стр.Значение = Ложь Тогда
	СтрИзменение.Значение = Перечисления.КА_ВозвратУтилизация.ОжидаетсяУтилизацииДетали;
Иначе
	СтрИзменение.Значение = Перечисления.КА_ВозвратУтилизация.НеТребуется;
КонецЕсли;
ЭтотОбъект.ЗначенияАтрибутов.Загрузить(ТаблицаАтрибутов);
</v8:ОбработчикПередЗаписью>
			<v8:ОбработчикПослеВыполнения/>
			<v8:ОбработчикПриЗаписи/>
			<v8:ОбработчикПриПереходе>Инцидент.СтатусИМ = Перечисления.КА_СтатусИМ.ЗапросОтправлен;

// Отправка статуса

НастройкаОбмена = Справочники.КА_НастройкиВыгрузкиВИМ.ПолучитьНастройку("Рекламация_СобытиеВыгрузкаСтатуса");

СоответствиеСтатусов = Новый Соответствие;
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ЗапросОтправлен, "SENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВРаботеУМенеджера, "PROCESS_BY_MANAGER");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.УточнитеДанныеОбращения, "CLARIFY_DETAILS");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВРаботеУИнженера, "PROCESS_BY_ENGINEER");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияПринятаВРаботуГарантийнымОтделом, "PROCESS_BY_WARRANTY_DEPARTMENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияПринятаУточняемСрокРассмотрения, "ACCEPTED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВозвратДеталиНаЭкспертизу, "EXPERTIZE");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОдобренаВыберитеСпособКомпенсации, "APPROVED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОтклоненаОзнакомьтесьСЗаключением, "REJECTED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ЗакрытоИПеренесеноВархивПоСрокуДавности, "CLOSED_ON_EXPIRATION");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияЗавершенаКлиентСогласен, "CLOSED_ON_AGREEMENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияЗавершенаКомпенсацияПредоставлена, "COMPENSATED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламациНаправленаВОтделКорпоративныхПродаж, "SENT_TO_SALES");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОдобрена50ВыберитеСпособКомпенсации, "APPROVED_50");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОтклоненаПовторно, "REJECTED_REPEATEDLY");

СтрДанных = Новый Структура;
СтрДанных.Вставить("complaintId", ЗначенияАтрибутов["id"]);
СтрДанных.Вставить("status", СоответствиеСтатусов[Инцидент.СтатусИМ]);

КА_Обмены.ОтправитьВСервис_Рефакторинг(СтрДанных, НастройкаОбмена, "ИМ2");

//Обрабатываем Пользователей  в поля инцидента по этапу 
Инцидент.Ответственный  = ЗначенияАтрибутов["ОтветственныйМКО"];

// Рассылка
Получатели = Новый Массив;
Вложения = Новый Соответствие;

ДокРТС = ЗначенияАтрибутов["realizationId"];
Партнер = ДокРТС.Партнер;

Адрес = УправлениеКонтактнойИнформацией.КонтактнаяИнформацияОбъекта(Партнер, Справочники.ВидыКонтактнойИнформации.EmailПартнера);
		
Если ЗначениеЗаполнено(Адрес) Тогда
	Получатели.Добавить(Новый Структура("Адрес, Представление", Адрес, Адрес));
КонецЕсли; 
	
Если Получатели.Количество() &gt; 0 Тогда

	Отправитель = Справочники.УчетныеЗаписиЭлектроннойПочты.СистемнаяУчетнаяЗаписьЭлектроннойПочты;
				
	Тема = "Обработка рекламации";
	ТекстПисьма = "Вы выбрали вариант компенсации ""Заменить товары"". За разъяснениями Вы всегда можете обратиться к Вашему менеджеру.";	
			
	ПараметрыПисьма = Новый Структура;
	ПараметрыПисьма.Вставить("Кому",Получатели);
	ПараметрыПисьма.Вставить("Тема", Тема);
	ПараметрыПисьма.Вставить("Тело", ТекстПисьма);
	ПараметрыПисьма.Вставить("Вложения", Вложения);
				
	Попытка
		ИдентификаторСообщения = РаботаСПочтовымиСообщениями.ОтправитьПочтовоеСообщение(Отправитель, ПараметрыПисьма);
	Исключение
		Ошибка = ОписаниеОшибки();
		Сообщить(СтрШаблон("При отправке письма произошла ошибка: %1", Ошибка));
	КонецПопытки; 
		
КонецЕсли;

// Рассылка исполнителям
Тема = СтрШаблон("Обновлен статус рекламации %1 %2", Инцидент.Номер, ЗначенияАтрибутов["counterparty_external_id"]);
ТекстПисьма = "Клиент выбрал компенсацию - заменить бракованную деталь.";
М = Новый Массив;
М.Добавить(Инцидент.Ответственный);
Документы.КА_Инцидент.ОтправитьОповещение(М, Тема, ТекстПисьма);
//Документы.КА_Инцидент.ОтправитьОповещениеИсполнителямЭтапа(СледующийЭтап, Тема, ТекстПисьма);;</v8:ОбработчикПриПереходе>
			<v8:ОбработчикПриПринятииКИсполнению/>
			<v8:ОбработчикПроведения/>
			<v8:Описание>МКО переходит в связанную с Инцидентом Заявку на возврат товаров от клиента (вкладка Связанные документы) и инициирует отгрузку товара со склада</v8:Описание>
			<v8:ПроверятьРезультат>false</v8:ПроверятьРезультат>
			<v8:СрокВыполнения>4</v8:СрокВыполнения>
			<v8:СообщениеНедоступныПереходы/>
			<v8:ОбработчикПриОткрытии/>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">3ab46ee4-8b6b-4e27-b05f-aa6c943c5895</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">6547e112-2de4-4388-82f0-4b24ca0eee42</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">6d160a64-dd08-11e4-b0fd-001517ac6c09</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">f6af22ec-7751-4f7a-bc7e-df85edb3c04f</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">19daaf30-9a1a-11e8-80c5-3cfdfeaf9019</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">97eb7d45-6782-4b33-9909-457572becfa8</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">b783b0ba-74ad-11e1-b634-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">812e0c18-3beb-11e8-80d0-001e6707aaa8</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">f149ab7d-7ada-11e8-80c5-3cfdfeaf9019</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">58a84576-77c0-4e0e-b065-1be30ab00af9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">0cafad1c-4262-11e1-b48c-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">c34b8004-ec1d-11e5-80c5-001e6707aaa8</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">ddcd8a22-00dc-11e4-9396-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">a0477a02-97f8-11e5-9a83-001517ac6c09</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">1a70361f-81fe-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>// Товар вернуть != ИСТИНА

Если НЕ РольДоступна("ПолныеПрава") Тогда

	УсловияПроверки = ЗначенияАтрибутов["ТоварВернуть"] &lt;&gt; Истина;
	
	Если НЕ УсловияПроверки Тогда
		Отказ = Истина;
	КонецЕсли;

КонецЕсли;</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">129df58a-81fe-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>// Товар вернуть != ИСТИНА

Если НЕ РольДоступна("ПолныеПрава") Тогда

	УсловияПроверки = ЗначенияАтрибутов["ТоварВернуть"] &lt;&gt; Истина;
	
	Если НЕ УсловияПроверки Тогда
		Отказ = Истина;
	КонецЕсли;

КонецЕсли;</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">633abd82-d806-11ec-bbaf-00155d258b03</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>// Товар вернуть = ИСТИНА

Если НЕ РольДоступна("ПолныеПрава") Тогда

	УсловияПроверки = ЗначенияАтрибутов["ТоварВернуть"] = Истина;
	
	Если НЕ УсловияПроверки Тогда
		Отказ = Истина;
	КонецЕсли;

КонецЕсли;</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">7770acee-8e55-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">c10475bc-8798-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">ae2bfd6f-8798-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">455e5227-8e55-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">b444c315-5f3e-11ed-bba5-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>true</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
		</v8:CatalogObject.КА_ЭтапыИнцидентов>
		<v8:CatalogObject.КА_ЭтапыИнцидентов>
			<v8:Ref xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">0a67f064-81fe-11ec-bb9e-00155d70bd06</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Owner xsi:type="v8:CatalogRef.КА_ВидыИнцидентов">fe697b45-4e2c-11ec-bba8-00155d258b03</v8:Owner>
			<v8:Code>000000040</v8:Code>
			<v8:Description>В работе у клиента. Выбор способа компенсации</v8:Description>
			<v8:АвтоматическийСтартЭтапа>false</v8:АвтоматическийСтартЭтапа>
			<v8:АвтоматическоеЗавершениеЭтапа>false</v8:АвтоматическоеЗавершениеЭтапа>
			<v8:АтрибутыНедоступны>false</v8:АтрибутыНедоступны>
			<v8:АтрибутыСкрыты>false</v8:АтрибутыСкрыты>
			<v8:ЗавершающийЭтап>false</v8:ЗавершающийЭтап>
			<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">00000000-0000-0000-0000-000000000000</v8:Исполнитель>
			<v8:ОбработчикПередВыполнением/>
			<v8:ОбработчикПередЗаписью>

ТаблицаАтрибутов = ЭтотОбъект.ЗначенияАтрибутов.Выгрузить();
	ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "ВозвратУтилизация"); 
	СтрИзменение = ТаблицаАтрибутов.Найти(ВыбАтрибут,"Атрибут");
	Если не ЗначениеЗаполнено(СтрИзменение) Тогда
		СтрИзменение = ТаблицаАтрибутов.Добавить();
		СтрИзменение.Атрибут = ВыбАтрибут;
	КонецЕсли;
ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "ТоварВернуть");
Стр = ТаблицаАтрибутов.Найти(ВыбАтрибут, "Атрибут");
Если Стр = Неопределено или Стр.Значение = Ложь Тогда
	СтрИзменение.Значение = Перечисления.КА_ВозвратУтилизация.ОжидаетсяУтилизацииДетали;
Иначе
	СтрИзменение.Значение = Перечисления.КА_ВозвратУтилизация.НеТребуется;
КонецЕсли;
ЭтотОбъект.ЗначенияАтрибутов.Загрузить(ТаблицаАтрибутов);



ВыбранныйСпособ = ДополнительныеСвойства.ЗначенияАтрибутов["Рекламация_СпособКомпенсации"];

Если ЗначениеЗаполнено(ВыбранныйСпособ) 
	И НЕ ДополнительныеСвойства.Свойство("ПроверкаРекурсии") Тогда
		
	ДополнительныеСвойства.Вставить("ПроверкаРекурсии", Истина);
	
	Если ВыбранныйСпособ.Ключ = "REPLACE_ITEMS" Тогда
	
		ПринятьКИсполнению();
		
		П = Новый Структура;
		П.Вставить("СледующийЭтап", Справочники.КА_ЭтапыИнцидентов.ПолучитьСсылку(Новый УникальныйИдентификатор("129df58b-81fe-11ec-bb9e-00155d70bd06")));
		
		ВыполнитьТекущийЭтап("Автозавершение", П);	

	ИначеЕсли ВыбранныйСпособ.Ключ = "AS_PREPAYMENT" Тогда

		ПринятьКИсполнению();
		
		П = Новый Структура;
		П.Вставить("СледующийЭтап", Справочники.КА_ЭтапыИнцидентов.ПолучитьСсылку(Новый УникальныйИдентификатор("0a67f065-81fe-11ec-bb9e-00155d70bd06")));
		
		ВыполнитьТекущийЭтап("Автозавершение", П);	
	
	Иначе
	
		Сообщить("Неизвестный способо компенсации, автовыполнение этапа невозможно");
	
	КонецЕсли
	
КонецЕсли;

УстановитьПривилегированныйРежим(Истина);
ИнцидентЗапрос = Неопределено;
ЗаявкаНаВозврат = ЭтотОбъект.ПолучитьАтрибутИнцидента("ЗаявкаНаВозврат");
Для Каждого Стр из ЭтотОбъект.СвязанныеОбъекты Цикл
	Если СтрНайти(Строка(Стр.Объект), "запрос поставщику") Тогда
		ИнцидентЗапрос = Стр.Объект.ПолучитьОбъект();
		ТаблицаСвязанных = ИнцидентЗапрос.СвязанныеОбъекты.Выгрузить();
		ЗаявкаНаВозвратЗапрос = ТаблицаСвязанных.Найти(ЗаявкаНаВозврат, "Объект"); 
		Если ЗаявкаНаВозвратЗапрос = Неопределено Тогда
			НовСтр = ТаблицаСвязанных.Добавить();
			НовСтр.Объект = ЗаявкаНаВозврат;
			ИнцидентЗапрос.СвязанныеОбъекты.Загрузить(ТаблицаСвязанных);
		КонецЕсли;
		ТаблицаАтрибутов = ИнцидентЗапрос.ЗначенияАтрибутов.Выгрузить();
		ЕстьАтрибут = ТаблицаАтрибутов.Найти(ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоНаименованию("ЗаявкаНаВозврат"), "Атрибут");
		Если ЕстьАтрибут = Неопределено Тогда
			ЕстьЗначение = ТаблицаАтрибутов.Найти(ЗаявкаНаВозвратЗапрос, "Значение");
			Если не ЕстьЗначение = Неопределено Тогда
				НовСтр = ТаблицаАтрибутов.Добавить();
				НовСтр.Атрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоНаименованию("ЗаявкаНаВозврат");
				НовСтр.Значение = ЗаявкаНаВозврат;
				ИнцидентЗапрос.ЗначенияАтрибутов.Загрузить(ТаблицаАтрибутов);
				ИнцидентЗапрос.Записать();
			Иначе
				ЕстьЗначение.Атрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоНаименованию("ЗаявкаНаВозврат");
				ИнцидентЗапрос.ЗначенияАтрибутов.Загрузить(ТаблицаАтрибутов);
				ИнцидентЗапрос.Записать();
			КонецЕсли;
		Иначе
			ЕстьАтрибут.Значение = ЗаявкаНаВозврат;
			ИнцидентЗапрос.ЗначенияАтрибутов.Загрузить(ТаблицаАтрибутов);
			ИнцидентЗапрос.Записать();
		КонецЕсли;
		Прервать;
	КонецЕсли;
КонецЦикла;
УстановитьПривилегированныйРежим(Ложь);</v8:ОбработчикПередЗаписью>
			<v8:ОбработчикПослеВыполнения/>
			<v8:ОбработчикПриЗаписи/>
			<v8:ОбработчикПриПереходе>Инцидент.СтатусИМ = Перечисления.КА_СтатусИМ.РекламацияОдобренаВыберитеСпособКомпенсации;

// Отправка статуса

НастройкаОбмена = Справочники.КА_НастройкиВыгрузкиВИМ.ПолучитьНастройку("Рекламация_СобытиеВыгрузкаСтатуса");

СоответствиеСтатусов = Новый Соответствие;
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ЗапросОтправлен, "SENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВРаботеУМенеджера, "PROCESS_BY_MANAGER");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.УточнитеДанныеОбращения, "CLARIFY_DETAILS");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВРаботеУИнженера, "PROCESS_BY_ENGINEER");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияПринятаВРаботуГарантийнымОтделом, "PROCESS_BY_WARRANTY_DEPARTMENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияПринятаУточняемСрокРассмотрения, "ACCEPTED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВозвратДеталиНаЭкспертизу, "EXPERTIZE");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОдобренаВыберитеСпособКомпенсации, "APPROVED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОтклоненаОзнакомьтесьСЗаключением, "REJECTED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ЗакрытоИПеренесеноВархивПоСрокуДавности, "CLOSED_ON_EXPIRATION");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияЗавершенаКлиентСогласен, "CLOSED_ON_AGREEMENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияЗавершенаКомпенсацияПредоставлена, "COMPENSATED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламациНаправленаВОтделКорпоративныхПродаж, "SENT_TO_SALES");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОдобрена50ВыберитеСпособКомпенсации, "APPROVED_50");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОтклоненаПовторно, "REJECTED_REPEATEDLY");

СтрДанных = Новый Структура;
СтрДанных.Вставить("complaintId", ЗначенияАтрибутов["id"]);
СтрДанных.Вставить("status", СоответствиеСтатусов[Инцидент.СтатусИМ]);

КА_Обмены.ОтправитьВСервис_Рефакторинг(СтрДанных, НастройкаОбмена, "ИМ2");

//Обрабатываем Пользователей  в поля инцидента по этапу 
Инцидент.Ответственный  = ЗначенияАтрибутов["ОтветственныйМКО"];

// Рассылка
Получатели = Новый Массив;
Вложения = Новый Соответствие;

ДокРТС = ЗначенияАтрибутов["realizationId"];
Партнер = ДокРТС.Партнер;

Адрес = УправлениеКонтактнойИнформацией.КонтактнаяИнформацияОбъекта(Партнер, Справочники.ВидыКонтактнойИнформации.EmailПартнера);
		
Если ЗначениеЗаполнено(Адрес) Тогда
	Получатели.Добавить(Новый Структура("Адрес, Представление", Адрес, Адрес));
КонецЕсли; 
	
Если Получатели.Количество() &gt; 0 Тогда

	Отправитель = Справочники.УчетныеЗаписиЭлектроннойПочты.СистемнаяУчетнаяЗаписьЭлектроннойПочты;
				
	Тема = "Обработка рекламации";
	ТекстПисьма = "Мы свое дело сделали, Ваш ход!";	
			
	ПараметрыПисьма = Новый Структура;
	ПараметрыПисьма.Вставить("Кому",Получатели);
	ПараметрыПисьма.Вставить("Тема", Тема);
	ПараметрыПисьма.Вставить("Тело", ТекстПисьма);
	ПараметрыПисьма.Вставить("Вложения", Вложения);
				
	Попытка
		ИдентификаторСообщения = РаботаСПочтовымиСообщениями.ОтправитьПочтовоеСообщение(Отправитель, ПараметрыПисьма);
	Исключение
		Ошибка = ОписаниеОшибки();
		Сообщить(СтрШаблон("При отправке письма произошла ошибка: %1", Ошибка));
	КонецПопытки; 
		
КонецЕсли;</v8:ОбработчикПриПереходе>
			<v8:ОбработчикПриПринятииКИсполнению/>
			<v8:ОбработчикПроведения/>
			<v8:Описание>Клиент выбирает удобный ему способ коменсации. У него есть месяц сроку.</v8:Описание>
			<v8:ПроверятьРезультат>false</v8:ПроверятьРезультат>
			<v8:СрокВыполнения>255</v8:СрокВыполнения>
			<v8:СообщениеНедоступныПереходы/>
			<v8:ОбработчикПриОткрытии/>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">27b1b5ed-427b-11e6-80c3-0cc47a6b63cf</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">0a67f065-81fe-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>Если НЕ РольДоступна("ПолныеПрава") Тогда
	Отказ = Истина;
КонецЕсли;
</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">129df58b-81fe-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>Если НЕ РольДоступна("ПолныеПрава") Тогда
	Отказ = Истина;
КонецЕсли;
</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">ae2bfd6f-8798-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">c10475bc-8798-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">7770acee-8e55-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">455e5227-8e55-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">1e160f11-bca1-11ec-bba2-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">20e9e340-bc98-11ec-bbaf-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">c9ae9a45-d6cc-11ec-bbaf-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">b444c315-5f3e-11ed-bba5-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
		</v8:CatalogObject.КА_ЭтапыИнцидентов>
		<v8:CatalogObject.КА_ЭтапыИнцидентов>
			<v8:Ref xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">291059d5-81fe-11ec-bb9e-00155d70bd06</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Owner xsi:type="v8:CatalogRef.КА_ВидыИнцидентов">fe697b45-4e2c-11ec-bba8-00155d258b03</v8:Owner>
			<v8:Code>000000048</v8:Code>
			<v8:Description>Компенсировать за счёт компании 100%</v8:Description>
			<v8:АвтоматическийСтартЭтапа>false</v8:АвтоматическийСтартЭтапа>
			<v8:АвтоматическоеЗавершениеЭтапа>false</v8:АвтоматическоеЗавершениеЭтапа>
			<v8:АтрибутыНедоступны>false</v8:АтрибутыНедоступны>
			<v8:АтрибутыСкрыты>false</v8:АтрибутыСкрыты>
			<v8:ЗавершающийЭтап>false</v8:ЗавершающийЭтап>
			<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">00000000-0000-0000-0000-000000000000</v8:Исполнитель>
			<v8:ОбработчикПередВыполнением/>
			<v8:ОбработчикПередЗаписью>УстановитьПривилегированныйРежим(Истина);

ТабАтр = ЭтотОбъект.ЗначенияАтрибутов.Выгрузить();
Атр =  ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "ОтветственныйМКО");
Стр = ТабАтр.Найти(Атр, "Атрибут");  
Если не Стр = Неопределено и не (ЭтотОбъект.Ответственный = Стр.Значение) Тогда
	ЭтотОбъект.Ответственный = Стр.Значение;
КонецЕсли; 
ТаблицаАтрибутов = ЭтотОбъект.ЗначенияАтрибутов.Выгрузить();
	ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "ВозвратУтилизация"); 
	СтрИзменение = ТаблицаАтрибутов.Найти(ВыбАтрибут,"Атрибут");
	Если не ЗначениеЗаполнено(СтрИзменение) Тогда
		СтрИзменение = ТаблицаАтрибутов.Добавить();
		СтрИзменение.Атрибут = ВыбАтрибут;
	КонецЕсли;
ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "Экспертиза");
Стр = ТаблицаАтрибутов.Найти(ВыбАтрибут, "Атрибут");
Если Стр = Неопределено или Стр.Значение = Перечисления.КА_ДоставитьТоварНаЭкспертизу.Нет Тогда
	СтрИзменение.Значение = Перечисления.КА_ВозвратУтилизация.НеТребуется;
Иначе
	СтрИзменение.Значение = Перечисления.КА_ВозвратУтилизация.ОжидаетсяУтилизацииДетали;
КонецЕсли;
ЭтотОбъект.ЗначенияАтрибутов.Загрузить(ТаблицаАтрибутов);

ИнцидентЗапрос = Неопределено;
ЗаявкаНаВозврат = ЭтотОбъект.ПолучитьАтрибутИнцидента("ЗаявкаНаВозврат");
Для Каждого Стр из ЭтотОбъект.СвязанныеОбъекты Цикл
	Если СтрНайти(Строка(Стр.Объект), "запрос поставщику") Тогда
		ИнцидентЗапрос = Стр.Объект.ПолучитьОбъект();
		ТаблицаСвязанных = ИнцидентЗапрос.СвязанныеОбъекты.Выгрузить();
		ЗаявкаНаВозвратЗапрос = ТаблицаСвязанных.Найти(ЗаявкаНаВозврат, "Объект"); 
		Если ЗаявкаНаВозвратЗапрос = Неопределено Тогда
			НовСтр = ТаблицаСвязанных.Добавить();
			НовСтр.Объект = ЗаявкаНаВозврат;
			ИнцидентЗапрос.СвязанныеОбъекты.Загрузить(ТаблицаСвязанных);
		КонецЕсли;
		ТаблицаАтрибутов = ИнцидентЗапрос.ЗначенияАтрибутов.Выгрузить();
		ЕстьАтрибут = ТаблицаАтрибутов.Найти(ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоНаименованию("ЗаявкаНаВозврат"), "Атрибут");
		Если ЕстьАтрибут = Неопределено Тогда
			ЕстьЗначение = ТаблицаАтрибутов.Найти(ЗаявкаНаВозвратЗапрос, "Значение");
			Если не ЕстьЗначение = Неопределено Тогда
				НовСтр = ТаблицаАтрибутов.Добавить();
				НовСтр.Атрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоНаименованию("ЗаявкаНаВозврат");
				НовСтр.Значение = ЗаявкаНаВозврат;
				ИнцидентЗапрос.ЗначенияАтрибутов.Загрузить(ТаблицаАтрибутов);
				ИнцидентЗапрос.Записать();
			Иначе
				ЕстьЗначение.Атрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоНаименованию("ЗаявкаНаВозврат");
				ИнцидентЗапрос.ЗначенияАтрибутов.Загрузить(ТаблицаАтрибутов);
				ИнцидентЗапрос.Записать();
			КонецЕсли;
		Иначе
			ЕстьАтрибут.Значение = ЗаявкаНаВозврат;
			ИнцидентЗапрос.ЗначенияАтрибутов.Загрузить(ТаблицаАтрибутов);
			ИнцидентЗапрос.Записать();
		КонецЕсли;
		Прервать;
	КонецЕсли;
КонецЦикла;
Инцидент = ЭтотОбъект;
Если не Инцидент.Товары.Количество() = 0 Тогда
	ДокументИнцидент = Инцидент.Ссылка;
	ДокументРеализации = Инцидент.ПолучитьАтрибутИнцидента("realizationId");
	ПартнерПокупатель = ДокументРеализации.Партнер;
	ПартнерРегион = ПартнерПокупатель.БизнесРегион;
	ПартнерОсновнойМенеджер = ПартнерПокупатель.КА_ОсновнойКураторПокупателя;
	Поставщик = Справочники.Партнеры.ПустаяСсылка();
	Для каждого ТекСтр из ДокументИнцидент.СвязанныеОбъекты Цикл
		Если ТекСтр.Объект.Ссылка.Метаданные().Имя = "ПоступлениеТоваровУслуг" Тогда
			ДокПоступление = ТекСтр.Объект.Ссылка;	
			Поставщик = ДокПоступление.Партнер;	
		ИначеЕсли ТекСтр.Объект.Ссылка.Метаданные().Имя = "РеализацияТоваровУслуг" Тогда
				ДокументРеализации = ТекСтр.Объект.Ссылка;
		КонецЕсли;
	КонецЦикла;
	ТаблицаДвижений = Инцидент.ПолучитьСписокПараметровПроведения(Истина);
//Строка 16
	Для Каждого ТекСтрокаТовары Из Инцидент.Товары Цикл
		Движение = ТаблицаДвижений.Добавить();
		Движение.ВидИнцидента = Инцидент.ВидИнцидента;
		Движение.ЭтапИнцидента =  Инцидент.ТекущийЭтап;
		Движение.ВидДвижения = ВидДвиженияНакопления.Приход;
		Движение.Период = Инцидент.Ссылка.Дата;
		Движение.НоменклатураБренд = ТекСтрокаТовары.Номенклатура.Производитель;
		Движение.ТоварнаяГруппа = ТекСтрокаТовары.Номенклатура.ВидНоменклатуры;
		Движение.Номенклатура = ТекСтрокаТовары.Номенклатура;
		Движение.ДокументРеализации = ДокументРеализации;
		Движение.ДокументРекламации = ДокументИнцидент;
		Движение.Партнер = ПартнерПокупатель;
		Движение.Валюта = ТекСтрокаТовары.Валюта;
		Движение.ПартнерБизнесРегион = ПартнерРегион;
		Движение.ПартнерОсновнойМенеджер = ПартнерОсновнойМенеджер;
		Движение.АналитикаДефекта = ТекСтрокаТовары.АналитикаДефекта;
		Движение.КоличествоККомпенсации = 0;
		Движение.КоличествоКомпенсированоКлиенту = ТекСтрокаТовары.Количество;
		Движение.КоличествоПредъявленоПоставщику = 0;
		Движение.КоличествоКомпенсированоПоставщиком = 0;
		Движение.СуммаВал = ТекСтрокаТовары.Сумма;//СуммаВВалюте;
		Движение.СуммаБезНДСВал = ТекСтрокаТовары.СуммаСНДС-ТекСтрокаТовары.СуммаНДС;//СуммаВВалютеБезНДС;
		Движение.Сумма = ТекСтрокаТовары.Сумма;
		Движение.СуммаБезНДС = ТекСтрокаТовары.СуммаСНДС-ТекСтрокаТовары.СуммаНДС;
		Движение.РеализацияТоваровУслуг = ДокументРеализации;
		Движение.ДокументИнцидент = ДокументИнцидент;
		Движение.Склад = ТекСтрокаТовары.Склад;
		Движение.Регион = ТекСтрокаТовары.Склад.БизнесРегион;
		Движение.Поставщик = Поставщик;
		Движение.РешениеПоИнциденту = Инцидент.ПолучитьАтрибутИнцидента("РешениеИнженера");
	КонецЦикла;
	Инцидент. УстановитьСписокПараметровПроведения(Инцидент.ВидИнцидента, Инцидент.ТекущийЭтап, ТаблицаДвижений);
КонецЕсли;

УстановитьПривилегированныйРежим(Ложь);
</v8:ОбработчикПередЗаписью>
			<v8:ОбработчикПослеВыполнения/>
			<v8:ОбработчикПриЗаписи/>
			<v8:ОбработчикПриПереходе>Инцидент.СтатусИМ = Перечисления.КА_СтатусИМ.РекламациНаправленаВОтделКорпоративныхПродаж;

// Отправка статуса

НастройкаОбмена = Справочники.КА_НастройкиВыгрузкиВИМ.ПолучитьНастройку("Рекламация_СобытиеВыгрузкаСтатуса");

СоответствиеСтатусов = Новый Соответствие;
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ЗапросОтправлен, "SENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВРаботеУМенеджера, "PROCESS_BY_MANAGER");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.УточнитеДанныеОбращения, "CLARIFY_DETAILS");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВРаботеУИнженера, "PROCESS_BY_ENGINEER");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияПринятаВРаботуГарантийнымОтделом, "PROCESS_BY_WARRANTY_DEPARTMENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияПринятаУточняемСрокРассмотрения, "ACCEPTED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВозвратДеталиНаЭкспертизу, "EXPERTIZE");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОдобренаВыберитеСпособКомпенсации, "APPROVED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОтклоненаОзнакомьтесьСЗаключением, "REJECTED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ЗакрытоИПеренесеноВархивПоСрокуДавности, "CLOSED_ON_EXPIRATION");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияЗавершенаКлиентСогласен, "CLOSED_ON_AGREEMENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияЗавершенаКомпенсацияПредоставлена, "COMPENSATED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламациНаправленаВОтделКорпоративныхПродаж, "SENT_TO_SALES");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОдобрена50ВыберитеСпособКомпенсации, "APPROVED_50");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОтклоненаПовторно, "REJECTED_REPEATEDLY");

СтрДанных = Новый Структура;
СтрДанных.Вставить("complaintId", ЗначенияАтрибутов["id"]);
СтрДанных.Вставить("status", СоответствиеСтатусов[Инцидент.СтатусИМ]);

КА_Обмены.ОтправитьВСервис_Рефакторинг(СтрДанных, НастройкаОбмена, "ИМ2");

//Обрабатываем Пользователей  в поля инцидента по этапу 
//Для Каждого Стр из Инцидент.ИсторияВыполнения Цикл
//	Если не Стр = Неопределено и ЗначениеЗаполнено(Стр.Этап) Тогда
//		Если СтрНайти(Стр.Этап.Наименование,"В работе у НОРа") Тогда
//		СтрНаим = СтрНайти(Стр.Этап.Наименование,"В работе у НОРа");
//		Если не СтрНаим = 0 Тогда
//			Инцидент.Ответственный = Стр.Исполнитель;
//			Прервать;
//		КонецЕсли;
//	КонецЕсли;
//КонецЦикла;
Инцидент.Ответственный = ЗначенияАтрибутов["ОтветственныйМКО"]; 

// Рассылка исполнителям
Тема = СтрШаблон("Обновлен статус рекламации %1 %2", Инцидент.Номер, ЗначенияАтрибутов["counterparty_external_id"]);
ТекстПисьма = Инцидент.ИсторияВыполнения[Инцидент.ИсторияВыполнения.Количество()-1].Результат;
М = Новый Массив;
М.Добавить(Инцидент.Ответственный);
Документы.КА_Инцидент.ОтправитьОповещение(М, Тема, ТекстПисьма);
//Документы.КА_Инцидент.ОтправитьОповещениеИсполнителямЭтапа(СледующийЭтап, Тема, ТекстПисьма);;</v8:ОбработчикПриПереходе>
			<v8:ОбработчикПриПринятииКИсполнению/>
			<v8:ОбработчикПроведения/>
			<v8:Описание>Это вариант компенсации без возврата товара. Он идёт либо после экспертизы, по которой был отказ, либо после прямого отказа инженера, который клиент оспорил, а НОР - согласовал возмещение.

В первом случае - после экспертизы - МКО переходит на созданный документ Заявка на возврат товаров от клиента по кнопке вверху формы, проверяет его реквизиты и продолжает соответствующий процесс.

Во втором случае, когда экспертизы не было - МКО создаёт документ Заявка на возврат товаров клиента, также проверяет его реквизиты и запускает соответствующий процесс.

Когда в процессе возникает потребность в решении клиента - какую компенсацию он предпочтёт, МКО нажимает кнопку "Выполнить" и переводт инцидент на следующий этап.</v8:Описание>
			<v8:ПроверятьРезультат>false</v8:ПроверятьРезультат>
			<v8:СрокВыполнения>24</v8:СрокВыполнения>
			<v8:СообщениеНедоступныПереходы/>
			<v8:ОбработчикПриОткрытии/>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">3ab46ee4-8b6b-4e27-b05f-aa6c943c5895</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">6547e112-2de4-4388-82f0-4b24ca0eee42</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">6d160a64-dd08-11e4-b0fd-001517ac6c09</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">f6af22ec-7751-4f7a-bc7e-df85edb3c04f</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">19daaf30-9a1a-11e8-80c5-3cfdfeaf9019</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">97eb7d45-6782-4b33-9909-457572becfa8</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">b783b0ba-74ad-11e1-b634-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">812e0c18-3beb-11e8-80d0-001e6707aaa8</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">f149ab7d-7ada-11e8-80c5-3cfdfeaf9019</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">58a84576-77c0-4e0e-b065-1be30ab00af9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">0cafad1c-4262-11e1-b48c-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">c34b8004-ec1d-11e5-80c5-001e6707aaa8</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">ddcd8a22-00dc-11e4-9396-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">a0477a02-97f8-11e5-9a83-001517ac6c09</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">0a67f064-81fe-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>Если НЕ РольДоступна("ПолныеПрава") Тогда
	Если ЗначенияАтрибутов["ДополнитьДанныеВручную"] = Истина 
		Тогда
		Отказ = Истина;
		Иначе
		НайденаЗаявка = Ложь;
			Для каждого ТекСтр из Инцидент.СвязанныеОбъекты Цикл
				Если ТекСтр.Объект.Ссылка.Метаданные().Имя = "ЗаявкаНаВозвратТоваровОтКлиента" Тогда
					НайденаЗаявка = (Истина И ТекСтр.Объект.Проведен) или Отказ;
				КонецЕсли;
			КонецЦикла;
		Отказ = не НайденаЗаявка;
		Если Отказ Тогда
			Сообщить("Для завершения этапа убедитесь, что документ Зявка на возват товаров от клиента создан и проведен или корректно указано Решение Инженера");
		КонецЕсли;
		
					ДокРТУ = ЗначенияАтрибутов["realizationId"];

		УсловияПроверки = СтрНайти(ДокРТУ.Ссылка.Соглашение,"Соглашение К");

			Если УсловияПроверки Тогда
					Отказ = Истина;
			КонецЕсли;	

			
	КонецЕсли;
КонецЕсли;


</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">2152ab23-81fe-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода/>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">129df58b-81fe-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>Если НЕ РольДоступна("ПолныеПрава") Тогда
	Если ЗначенияАтрибутов["ДополнитьДанныеВручную"] = Истина 
		Тогда
		Отказ = Истина;
		Иначе
		НайденаЗаявка = Ложь;
			Для каждого ТекСтр из Инцидент.СвязанныеОбъекты Цикл
				Если ТекСтр.Объект.Ссылка.Метаданные().Имя = "ЗаявкаНаВозвратТоваровОтКлиента" Тогда
					НайденаЗаявка = (Истина И ТекСтр.Объект.Проведен) или Отказ;
				КонецЕсли;
			КонецЦикла;
		Отказ = не НайденаЗаявка;
		Если Отказ Тогда
			Сообщить("Для завершения этапа убедитесь, что документ Зявка на возват товаров от клиента создан и проведен или корректно указано Решение Инженера");
		КонецЕсли;
		
					ДокРТУ = ЗначенияАтрибутов["realizationId"];

		УсловияПроверки = СтрНайти(ДокРТУ.Ссылка.Соглашение,"Соглашение К");

			Если НЕ УсловияПроверки Тогда
					Отказ = Истина;
			КонецЕсли;	

			
	КонецЕсли;
КонецЕсли;


</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:Команды>
				<v8:Заголовок>Оформить Заявку на возврат</v8:Заголовок>
				<v8:УИ>546300bc-d933-4e4f-817f-b05493c719fe</v8:УИ>
				<v8:ОбработчикКлиентПеред/>
				<v8:ОбработчикСервер>СпкДатаНачалаУчетаПослеСвертки = КА_СлужебныеПараметры.ПолучитьЗначение(ПланыВидовХарактеристик.КА_СлужебныеПараметры.ДатаНачалаУчетаПослеСверткиБазы); 
ДатаНУПС = СпкДатаНачалаУчетаПослеСвертки.Получить(0); 

ДатаДень = Число(Сред(ДатаНУПС,1,2));
ДатаМесяц= Число(Сред(ДатаНУПС,4,2));
ДатаГод  = Число(Сред(ДатаНУПС,7,4));
ДатаНУПС = (Дата(ДатаГод, ДатаМесяц, ДатаДень));

ЗаявкаНаВозврат = Документы.ЗаявкаНаВозвратТоваровОтКлиента.ПустаяСсылка();
ДокРТС = Документы.РеализацияТоваровУслуг.ПустаяСсылка();

Для каждого ТекСтр из Объект.СвязанныеОбъекты Цикл
	Если ТекСтр.Объект.Ссылка.Метаданные().Имя = "ЗаявкаНаВозвратТоваровОтКлиента" Тогда
		ЗаявкаНаВозврат = ТекСтр.Объект.Ссылка;
	ИначеЕсли ТекСтр.Объект.Ссылка.Метаданные().Имя = "РеализацияТоваровУслуг" Тогда 
		ДокРТС = ТекСтр.Объект.Ссылка;
	КонецЕсли;
КонецЦикла;
//Стр 19 
ТаблицаТоваров = Объект.Товары.Выгрузить();
ТаблицаТоваров.Колонки.Добавить("ДокументРеализации");
ТаблицаТоваров.Колонки.Добавить("КА_ЗаказКлиента");
ИнцидентОбъект = РеквизитФормыВЗначение("Объект");
СпособОформленияВозврата = ИнцидентОбъект.ПолучитьАтрибутИнцидента("СпособОформленияВозврата");
Если не ЗначениеЗаполнено(СпособОформленияВозврата) Тогда
	СпособОформленияВозврата = Перечисления.КА_СпособыОформленияВозврата.ВозвратныеДокументы;
КонецЕсли; 

//++Задача 234706 - берем РТУ из [realiztionid] Значений Атрибутов
ДокРТС = ИнцидентОбъект.ПолучитьАтрибутИнцидента("realizationId");
//--Задача 234706 - берем РТУ из [realiztionid] Значений Атрибутов

ВидОформленияВозвратныхДокументов = ИнцидентОбъект.ПолучитьАтрибутИнцидента("ВидОформленияДокументов");
Если СпособОформленияВозврата = Перечисления.КА_СпособыОформленияВозврата.ВозвратныеДокументы и не ЗначениеЗаполнено(ВидОформленияВозвратныхДокументов) Тогда 
	ВидОформленияВозвратныхДокументов = Перечисления.КА_ВидыОформленияВозвратныхДокументов.КлиентНеПринялТоварСОформлениемТорг2;
КонецЕсли;  
 
ТоварыРТС = ДокРТС.Товары.Выгрузить();  

Для каждого ТекСтр из ТаблицаТоваров Цикл
	ТекСтр.КоличествоУпаковок = ТекСтр.Количество;
	ТоварыРТСНоменклатура = ТоварыРТС.Скопировать(,"Номенклатура,КоличествоУпаковок");
	ТоварыРТСНоменклатура.Свернуть("Номенклатура", "КоличествоУпаковок"); 
	СтрНом = ТоварыРТСНоменклатура.Найти(ТекСтр.Номенклатура,"Номенклатура");
	Если не СтрНом = Неопределено Тогда 
		ТекСтр.КА_КоличествоПродано = СтрНом.КоличествоУпаковок;
	КонецЕсли; 
	ТекСтр.ДокументРеализации = ДокРТС;
	ТекСтр.КА_ЗаказКлиента = ДокРТС.ЗаказКлиента;
КонецЦикла;

Если не (ЗаявкаНаВозврат =  Документы.ЗаявкаНаВозвратТоваровОтКлиента.ПустаяСсылка()) Тогда
//	Сообщить(Строка(ЗаявкаНаВозврат) + " уже сформирована в документе"); 	
ИначеЕсли ЗаявкаНаВозврат =  Документы.ЗаявкаНаВозвратТоваровОтКлиента.ПустаяСсылка() и не (ДокРТС = Документы.РеализацияТоваровУслуг.ПустаяСсылка())Тогда
	ЗаявкаНаВозврат = Документы.ЗаявкаНаВозвратТоваровОтКлиента.СоздатьДокумент();
	ЗаявкаНаВозврат.Дата = ТекущаяДата();
//	В связи с проблематикой непровденных РТУ ветвление заполнения ЗВТК на основании РТУ  05.10.2022 Лупонос Д.В.
	Если ДатаНУПС &lt; ДокРтс.Дата Тогда
		ЗаявкаНаВозврат.Заполнить(ДокРТС.Ссылка);
	ИначеЕсли не ДокРТС.Проведен Тогда 
		ЗаполнитьЗначенияСвойств(ЗаявкаНаВозврат, ДокРТС.Ссылка,,"Дата,Номер");
//		ЗаявкаНаВозврат.Дата = ТекущаяДата();
		ЗаявкаНаВозврат.Номер = ""; 
		ЗаявкаНаВозврат.Организация = ДокРТС.Организация; 
		ЗаявкаНаВозврат.Договор = ДокРТС.Договор; 
		ЗаявкаНаВозврат.Валюта = ДокРТС.Валюта; 
		ЗаявкаНаВозврат.Партнер = ДокРТС.Партнер; 
		ЗаявкаНаВозврат.Склад = ДокРТС.Склад; 
		ЗаявкаНаВозврат.Контрагент = ДокРТС.Контрагент; 
		ЗаявкаНаВозврат.Соглашение = ДокРТС.Соглашение; 
	КонецЕсли; 
//	В связи с проблематикой непровденных РТУ ветвление заполнения ЗВТК на основании РТУ  05.10.2022 Лупонос Д.В.
	ЗаявкаНаВозврат.Приоритет = Справочники.Приоритеты.НайтиПоНаименованию("Средний"); 
	ЗаявкаНаВозврат.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.ВозвратТоваровОтКлиента;
	ЗаявкаНаВозврат.Менеджер = ИнцидентОбъект.ПолучитьАтрибутИнцидента("ОтветственныйМКО");
	ЗаявкаНаВозврат.Подразделение = ЗаявкаНаВозврат.Менеджер.Подразделение; 
	ЗаявкаНаВозврат.КА_СпособДоставкиОтКлиента = Перечисления.СпособыДоставки.ДоКлиента;
	ЗаявкаНаВозврат.Комментарий = Строка(Объект.Ссылка);
		
	ЗаявкаНаВозврат.КА_Причина=Справочники.ПричиныВозникновенияПретензий.НайтиПоНаименованию("Брак").Ссылка;
	ЗаявкаНаВозврат.КА_АналитикаПричинБрака = Справочники.КА_АналитикаПричинБрака.НайтиПоНаименованию("Брак, компенсация за счет Бюджета НОР").Ссылка;
	ЗаявкаНаВозврат.КА_Фиктивный=Истина;//ИнцидентОбъект.ПолучитьАтрибутИнцидента("Товар вернуть");
//	
	ЗаявкаНаВозврат.КА_СпособОформленияВозврата = СпособОформленияВозврата;
	ЗаявкаНаВозврат.КА_ВидОформленияВозвратныхДокументов = ВидОформленияВозвратныхДокументов;
	ЗаявкаНаВозврат.ДокументРеализации = ДокРТС.Ссылка;
	ЗаявкаНаВозврат.КА_Инцидент = Объект.Ссылка;
	ЗаявкаНаВозврат.ВозвращаемыеТовары.Загрузить(ТаблицаТоваров);

	ЭкспертизаТут = ИнцидентОбъект.ПолучитьАтрибутИнцидента("Экспертиза");
	Если ЭкспертизаТут = Перечисления.КА_ДоставитьТоварНаЭкспертизу.Да Тогда
		ЗаявкаНаВозврат.КА_ДоставитьТоварНаЭкспертизу = Истина;
	Иначе
		ЗаявкаНаВозврат.КА_ДоставитьТоварНаЭкспертизу = Ложь;
	КонецЕсли;


//	В связи с проблематикой непровденных РТУ для корректного проведения установим признак КА_Проверено в каждой строке ТЧ ЗВТК 05.10.2022 Лупонос Д.В.
	Сч = 1;
	Если не ДокРТС.Проведен и ДатаНУПС &gt; ДокРтс.Дата Тогда 	
		ТаблицаТоваров = ЗаявкаНаВозврат.ВозвращаемыеТовары.Выгрузить();
		Для Каждого Стр из ТаблицаТоваров Цикл
			Стр.КА_Проверено = Истина;
//			Стр.КодСтроки = Сч; 
//			Сч = Сч + 1; 
		КонецЦикла;
		ЗаявкаНаВозврат.ВозвращаемыеТовары.Загрузить(ТаблицаТоваров);
	КонецЕсли; 
//	В связи с проблематикой непровденных РТУ для корректного проведения установим признак КА_Проверено в каждой строке ТЧ ЗВТК 05.10.2022 Лупонос Д.В.
//++Задача 234706 РТУ является экспортной 
	Запрос = Новый Запрос; 
	Запрос.Текст = "ВЫБРАТЬ
	|	РеализацияТоваровУслуг.Ссылка КАК Ссылка
	|ИЗ
	|	Документ.РеализацияТоваровУслуг КАК РеализацияТоваровУслуг
	|ГДЕ
	|	РеализацияТоваровУслуг.Соглашение.Наименование ПОДОБНО ""Соглашение К""
	|	И РеализацияТоваровУслуг.Ссылка = &amp;Ссылка"; 
	Запрос.УстановитьПараметр("Ссылка", ДокРТС.Ссылка);
	Рез = Запрос.Выполнить().Выгрузить(); 
	Если Рез.Количество() &gt; 0 Тогда 
		ЗаявкаНаВозврат.СпособКомпенсации = Перечисления.СпособыКомпенсацииВозвратовТоваров.ЗаменитьТовары; 
		ЗаявкаНаВозврат.КА_СпособОформленияВозврата = Перечисления.КА_СпособыОформленияВозврата.ЗаменаДокументов; 
	КонецЕсли; 
//--Задача 234706  РТУ является экспортной

	Попытка 
		ЗаявкаНаВозврат.Записать();
	Исключение
		ЗаявкаНаВозврат.Записать(Ложь);
	КонецПопытки; 
	СвязатьСОбъектомИзФормыНаСервере(ЗаявкаНаВозврат.Ссылка);
	ТаблицаАтрибутовДокумента = Объект.ЗначенияАтрибутов.Выгрузить();
	АтрибутИнцидента=ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоНаименованию("ЗаявкаНаВозврат");
	ТаблицаАтрибутовДокумента = Объект.ЗначенияАтрибутов.Выгрузить();
	СтрокаИзм = ТаблицаАтрибутовДокумента.Найти(АтрибутИнцидента,"Атрибут");
	Если СтрокаИзм = Неопределено Тогда
		СтрокаИзм = ТаблицаАтрибутовДокумента.Добавить();
		СтрокаИзм.Атрибут = АтрибутИнцидента;
	КонецЕсли;
	СтрокаИзм.Значение = ЗаявкаНаВозврат.Ссылка;
	Объект.ЗначенияАтрибутов.Загрузить(ТаблицаАтрибутовДокумента);
КонецЕсли;
</v8:ОбработчикСервер>
				<v8:ОбработчикКлиентПосле>ЗаявкаНаВозврат = Неопределено;
Для каждого ТекСтр из Объект.СвязанныеОбъекты Цикл
	Если СтрНайти(Строка(ТекСтр.Объект), "Заявка на возврат товаров от клиента") Тогда
		ЗаявкаНаВозврат = ТекСтр.Объект;
	КонецЕсли;
КонецЦикла;

Если не ЗаявкаНаВозврат=Неопределено тогда
	ОткрытьФорму("Документ.ЗаявкаНаВозвратТоваровОтКлиента.ФормаОбъекта", новый Структура("Ключ",ЗаявкаНаВозврат));
КонецЕсли;</v8:ОбработчикКлиентПосле>
			</v8:Команды>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">f9220711-8795-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">455e5227-8e55-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">b444c315-5f3e-11ed-bba5-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>true</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
		</v8:CatalogObject.КА_ЭтапыИнцидентов>
		<v8:CatalogObject.КА_ЭтапыИнцидентов>
			<v8:Ref xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">fba53040-81fd-11ec-bb9e-00155d70bd06</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Owner xsi:type="v8:CatalogRef.КА_ВидыИнцидентов">fe697b45-4e2c-11ec-bba8-00155d258b03</v8:Owner>
			<v8:Code>000000037</v8:Code>
			<v8:Description>Брак. Компенсация</v8:Description>
			<v8:АвтоматическийСтартЭтапа>false</v8:АвтоматическийСтартЭтапа>
			<v8:АвтоматическоеЗавершениеЭтапа>false</v8:АвтоматическоеЗавершениеЭтапа>
			<v8:АтрибутыНедоступны>false</v8:АтрибутыНедоступны>
			<v8:АтрибутыСкрыты>false</v8:АтрибутыСкрыты>
			<v8:ЗавершающийЭтап>false</v8:ЗавершающийЭтап>
			<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">00000000-0000-0000-0000-000000000000</v8:Исполнитель>
			<v8:ОбработчикПередВыполнением/>
			<v8:ОбработчикПередЗаписью>УстановитьПривилегированныйРежим(Истина);

ТаблицаАтрибутов = ЭтотОбъект.ЗначенияАтрибутов.Выгрузить();
ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "Экспертиза");
Эксп = ТаблицаАтрибутов.Найти(ВыбАтрибут, "Атрибут");
ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "ВозвратУтилизация");
ВозврУтил = ТаблицаАтрибутов.Найти(ВыбАтрибут, "Атрибут");
Если ВозврУтил = Неопределено Тогда
	ВозврУтил = ТаблицаАтрибутов.Добавить();
	ВозврУтил.Атрибут = ВыбАтрибут;
КонецЕсли;
Если Эксп = Неопределено или Эксп.Значение = Перечисления.КА_ДоставитьТоварНаЭкспертизу.Нет Тогда
	ВозврУтил.Значение = Перечисления.КА_ВозвратУтилизация.НеТребуется; 
ИначеЕсли не ВозврУтил.Значение = Перечисления.КА_ВозвратУтилизация.ДетальУтилизирована Тогда
	ВозврУтил.Значение = Перечисления.КА_ВозвратУтилизация.ОжидаетсяУтилизацииДетали; 
КонецЕсли; 
ЭтотОбъект.ЗначенияАтрибутов.Загрузить(ТаблицаАтрибутов);

ИнцидентЗапрос = Неопределено;
ЗаявкаНаВозврат = ЭтотОбъект.ПолучитьАтрибутИнцидента("ЗаявкаНаВозврат");
Для Каждого Стр из ЭтотОбъект.СвязанныеОбъекты Цикл
	Если СтрНайти(Строка(Стр.Объект), "запрос поставщику") Тогда
		ИнцидентЗапрос = Стр.Объект.ПолучитьОбъект();
		ТаблицаСвязанных = ИнцидентЗапрос.СвязанныеОбъекты.Выгрузить();
		ЗаявкаНаВозвратЗапрос = ТаблицаСвязанных.Найти(ЗаявкаНаВозврат, "Объект"); 
		Если ЗаявкаНаВозвратЗапрос = Неопределено Тогда
			НовСтр = ТаблицаСвязанных.Добавить();
			НовСтр.Объект = ЗаявкаНаВозврат;
			ИнцидентЗапрос.СвязанныеОбъекты.Загрузить(ТаблицаСвязанных);
		КонецЕсли;
		ТаблицаАтрибутов = ИнцидентЗапрос.ЗначенияАтрибутов.Выгрузить();
		ЕстьАтрибут = ТаблицаАтрибутов.Найти(ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоНаименованию("ЗаявкаНаВозврат"), "Атрибут");
		Если ЕстьАтрибут = Неопределено Тогда
			ЕстьЗначение = ТаблицаАтрибутов.Найти(ЗаявкаНаВозвратЗапрос, "Значение");
			Если не ЕстьЗначение = Неопределено Тогда
				НовСтр = ТаблицаАтрибутов.Добавить();
				НовСтр.Атрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоНаименованию("ЗаявкаНаВозврат");
				НовСтр.Значение = ЗаявкаНаВозврат;
				ИнцидентЗапрос.ЗначенияАтрибутов.Загрузить(ТаблицаАтрибутов);
				ИнцидентЗапрос.Записать();
			Иначе
				ЕстьЗначение.Атрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоНаименованию("ЗаявкаНаВозврат");
				ИнцидентЗапрос.ЗначенияАтрибутов.Загрузить(ТаблицаАтрибутов);
				ИнцидентЗапрос.Записать();
			КонецЕсли;
		Иначе
			ЕстьАтрибут.Значение = ЗаявкаНаВозврат;
			ИнцидентЗапрос.ЗначенияАтрибутов.Загрузить(ТаблицаАтрибутов);
			ИнцидентЗапрос.Записать();
		КонецЕсли;
		Прервать;
	КонецЕсли;
КонецЦикла;
УстановитьПривилегированныйРежим(Ложь);</v8:ОбработчикПередЗаписью>
			<v8:ОбработчикПослеВыполнения/>
			<v8:ОбработчикПриЗаписи/>
			<v8:ОбработчикПриПереходе>Инцидент.СтатусИМ = Перечисления.КА_СтатусИМ.РекламацияПринятаВРаботуГарантийнымОтделом;

ЗначенияАтрибутов["ДополнитьДанныеВручную"]=Неопределено;

// Отправка статуса

НастройкаОбмена = Справочники.КА_НастройкиВыгрузкиВИМ.ПолучитьНастройку("Рекламация_СобытиеВыгрузкаСтатуса");

СоответствиеСтатусов = Новый Соответствие;
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ЗапросОтправлен, "SENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВРаботеУМенеджера, "PROCESS_BY_MANAGER");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.УточнитеДанныеОбращения, "CLARIFY_DETAILS");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВРаботеУИнженера, "PROCESS_BY_ENGINEER");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияПринятаВРаботуГарантийнымОтделом, "PROCESS_BY_WARRANTY_DEPARTMENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияПринятаУточняемСрокРассмотрения, "ACCEPTED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВозвратДеталиНаЭкспертизу, "EXPERTIZE");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОдобренаВыберитеСпособКомпенсации, "APPROVED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОтклоненаОзнакомьтесьСЗаключением, "REJECTED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ЗакрытоИПеренесеноВархивПоСрокуДавности, "CLOSED_ON_EXPIRATION");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияЗавершенаКлиентСогласен, "CLOSED_ON_AGREEMENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияЗавершенаКомпенсацияПредоставлена, "COMPENSATED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламациНаправленаВОтделКорпоративныхПродаж, "SENT_TO_SALES");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОдобрена50ВыберитеСпособКомпенсации, "APPROVED_50");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОтклоненаПовторно, "REJECTED_REPEATEDLY");

СтрДанных = Новый Структура;
СтрДанных.Вставить("complaintId", ЗначенияАтрибутов["id"]);
СтрДанных.Вставить("status", СоответствиеСтатусов[Инцидент.СтатусИМ]);



КА_Обмены.ОтправитьВСервис_Рефакторинг(СтрДанных, НастройкаОбмена, "ИМ2");

//Обрабатываем Пользователей  в поля инцидента по этапу 
Инцидент.Ответственный  = ЗначенияАтрибутов["ОтветственныйМКО"];

// Рассылка исполнителям
Тема = СтрШаблон("Обновлен статус рекламации %1 %2", Инцидент.Номер, ЗначенияАтрибутов["counterparty_external_id"]);
ТекстПисьма = "Брак подтвержден. Возврат товара не нужен.";
М = Новый Массив;
М.Добавить(Инцидент.Ответственный);
Документы.КА_Инцидент.ОтправитьОповещение(М, Тема, ТекстПисьма);
//Документы.КА_Инцидент.ОтправитьОповещениеИсполнителямЭтапа(СледующийЭтап, Тема, ТекстПисьма);; ЗначенияАтрибутов</v8:ОбработчикПриПереходе>
			<v8:ОбработчикПриПринятииКИсполнению>//Пинчук М.Н. 09.11.2022
АтрибутСсылка = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор","ДополнитьДанныеВручную");
    
  НС = Инцидент.ЗначенияАтрибутов.НайтиСтроки(Новый Структура("Атрибут",АтрибутСсылка));
  Для каждого ТекАтр из НС Цикл
    Инцидент.ЗначенияАтрибутов.Удалить(ТекАтр);      
  КонецЦикла;
  НовАтр = Инцидент.ЗначенияАтрибутов.Добавить();  
  НовАтр.Атрибут = АтрибутСсылка;
  НовАтр.Значение = Неопределено;
</v8:ОбработчикПриПринятииКИсполнению>
			<v8:ОбработчикПроведения/>
			<v8:Описание>Это вариант компенсации без возврата товара. Он идёт либо после экспертизы, либо после очевидного брака, решение по которому принято без доставки товара инженеру.

В первом случае – после очной экспертизы – МКО переходит на созданный документ Заявка на возврат товаров от клиента по кнопке вверху формы, проверяет его реквизиты и продолжает соответствующий процесс.

Во втором случае, когда экспертиза была без доставки товара – МКО создаёт документ Заявка на возврат товаров клиента, также проверяет его реквизиты и запускает соответствующий процесс.

Когда в процессе ДО возникает потребность в решении клиента – какую компенсацию он предпочтёт, МКО нажимает кнопку "Выполнить" и переводит инцидент на следующий этап.
</v8:Описание>
			<v8:ПроверятьРезультат>false</v8:ПроверятьРезультат>
			<v8:СрокВыполнения>2</v8:СрокВыполнения>
			<v8:СообщениеНедоступныПереходы/>
			<v8:ОбработчикПриОткрытии/>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">3ab46ee4-8b6b-4e27-b05f-aa6c943c5895</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">6547e112-2de4-4388-82f0-4b24ca0eee42</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">6d160a64-dd08-11e4-b0fd-001517ac6c09</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">f6af22ec-7751-4f7a-bc7e-df85edb3c04f</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">19daaf30-9a1a-11e8-80c5-3cfdfeaf9019</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">97eb7d45-6782-4b33-9909-457572becfa8</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">b783b0ba-74ad-11e1-b634-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">812e0c18-3beb-11e8-80d0-001e6707aaa8</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">f149ab7d-7ada-11e8-80c5-3cfdfeaf9019</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">58a84576-77c0-4e0e-b065-1be30ab00af9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">0cafad1c-4262-11e1-b48c-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">c34b8004-ec1d-11e5-80c5-001e6707aaa8</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">ddcd8a22-00dc-11e4-9396-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">a0477a02-97f8-11e5-9a83-001517ac6c09</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">07d158b7-54ba-11e7-80ce-001e6707aaa8</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">0a67f064-81fe-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>Если НЕ РольДоступна("ПолныеПрава") Тогда
	Если ЗначенияАтрибутов["ДополнитьДанныеВручную"] = Истина 
		Тогда
		Отказ = Истина;
		Иначе
		НайденаЗаявка = Ложь;
			Для каждого ТекСтр из Инцидент.СвязанныеОбъекты Цикл
				Если ТекСтр.Объект.Ссылка.Метаданные().Имя = "ЗаявкаНаВозвратТоваровОтКлиента" Тогда
					НайденаЗаявка = (Истина И ТекСтр.Объект.Проведен) или Отказ;
				КонецЕсли;
			КонецЦикла;
		Отказ = не НайденаЗаявка;
		Если Отказ Тогда
			Сообщить("Для завершения этапа убедитесь, что документ Зявка на возват товаров от клиента создан и проведен или корректно указано Решение Инженера");
		КонецЕсли;
		
					ДокРТУ = ЗначенияАтрибутов["realizationId"];

		УсловияПроверки = СтрНайти(ДокРТУ.Ссылка.Соглашение,"Соглашение К");

			Если УсловияПроверки Тогда
					Отказ = Истина;
			КонецЕсли;	

			
	КонецЕсли;
КонецЕсли;


</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">d912235d-81fd-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>Если НЕ РольДоступна("ПолныеПрава") Тогда
	Если ЗначенияАтрибутов["ДополнитьДанныеВручную"] &lt;&gt; Истина 
		Тогда
		Отказ = Истина;
	КонецЕсли;
КонецЕсли;
</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">129df58b-81fe-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>Если НЕ РольДоступна("ПолныеПрава") Тогда
	Если ЗначенияАтрибутов["ДополнитьДанныеВручную"] = Истина 
		Тогда
		Отказ = Истина;
		Иначе
		НайденаЗаявка = Ложь;
			Для каждого ТекСтр из Инцидент.СвязанныеОбъекты Цикл
				Если ТекСтр.Объект.Ссылка.Метаданные().Имя = "ЗаявкаНаВозвратТоваровОтКлиента" Тогда
					НайденаЗаявка = (Истина И ТекСтр.Объект.Проведен) или Отказ;
				КонецЕсли;
			КонецЦикла;
		Отказ = не НайденаЗаявка;
		Если Отказ Тогда
			Сообщить("Для завершения этапа убедитесь, что документ Зявка на возват товаров от клиента создан и проведен или корректно указано Решение Инженера");
		КонецЕсли;
		
			ДокРТУ = ЗначенияАтрибутов["realizationId"];

		УсловияПроверки = СтрНайти(ДокРТУ.Ссылка.Соглашение,"Соглашение К");

			Если НЕ УсловияПроверки Тогда
					Отказ = Истина;
			КонецЕсли;	
			
	КонецЕсли;
КонецЕсли;
</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:Команды>
				<v8:Заголовок>Оформить Заявку на возврат</v8:Заголовок>
				<v8:УИ>1b293a6c-f9dd-4b90-96ef-f1df3333f1b5</v8:УИ>
				<v8:ОбработчикКлиентПеред/>
				<v8:ОбработчикСервер>СпкДатаНачалаУчетаПослеСвертки = КА_СлужебныеПараметры.ПолучитьЗначение(ПланыВидовХарактеристик.КА_СлужебныеПараметры.ДатаНачалаУчетаПослеСверткиБазы); 
ДатаНУПС = СпкДатаНачалаУчетаПослеСвертки.Получить(0); 

ДатаДень = Число(Сред(ДатаНУПС,1,2));
ДатаМесяц= Число(Сред(ДатаНУПС,4,2));
ДатаГод  = Число(Сред(ДатаНУПС,7,4));
ДатаНУПС = (Дата(ДатаГод, ДатаМесяц, ДатаДень));

ЗаявкаНаВозврат = Документы.ЗаявкаНаВозвратТоваровОтКлиента.ПустаяСсылка();
ДокРТС = Документы.РеализацияТоваровУслуг.ПустаяСсылка();

Для каждого ТекСтр из Объект.СвязанныеОбъекты Цикл
	Если ТекСтр.Объект.Ссылка.Метаданные().Имя = "ЗаявкаНаВозвратТоваровОтКлиента" Тогда
		ЗаявкаНаВозврат = ТекСтр.Объект.Ссылка;
	ИначеЕсли ТекСтр.Объект.Ссылка.Метаданные().Имя = "РеализацияТоваровУслуг" Тогда 
		ДокРТС = ТекСтр.Объект.Ссылка;
	КонецЕсли;
КонецЦикла;

//Стр 19 
ТаблицаТоваров = Объект.Товары.Выгрузить();
ТаблицаТоваров.Колонки.Добавить("ДокументРеализации");
ТаблицаТоваров.Колонки.Добавить("КА_ЗаказКлиента");
ИнцидентОбъект = РеквизитФормыВЗначение("Объект");
СпособОформленияВозврата = ИнцидентОбъект.ПолучитьАтрибутИнцидента("СпособОформленияВозврата");
Если не ЗначениеЗаполнено(СпособОформленияВозврата) Тогда
	СпособОформленияВозврата = Перечисления.КА_СпособыОформленияВозврата.ВозвратныеДокументы;
КонецЕсли; 

//++Задача 234706 - берем РТУ из [realiztionid] Значений Атрибутов
ДокРТС = ИнцидентОбъект.ПолучитьАтрибутИнцидента("realizationId");
//--Задача 234706 - берем РТУ из [realiztionid] Значений Атрибутов

ВидОформленияВозвратныхДокументов = ИнцидентОбъект.ПолучитьАтрибутИнцидента("ВидОформленияДокументов");
Если СпособОформленияВозврата = Перечисления.КА_СпособыОформленияВозврата.ВозвратныеДокументы и не ЗначениеЗаполнено(ВидОформленияВозвратныхДокументов) Тогда 
	ВидОформленияВозвратныхДокументов = Перечисления.КА_ВидыОформленияВозвратныхДокументов.КлиентНеПринялТоварСОформлениемТорг2;
КонецЕсли;  

ТоварыРТС = ДокРТС.Товары.Выгрузить();  

Для каждого ТекСтр из ТаблицаТоваров Цикл
	ТекСтр.КоличествоУпаковок = ТекСтр.Количество;
	ТоварыРТСНоменклатура = ТоварыРТС.Скопировать(,"Номенклатура,КоличествоУпаковок");
	ТоварыРТСНоменклатура.Свернуть("Номенклатура", "КоличествоУпаковок"); 
	СтрНом = ТоварыРТСНоменклатура.Найти(ТекСтр.Номенклатура, "Номенклатура");
	Если не СтрНом = Неопределено Тогда 
		ТекСтр.КА_КоличествоПродано = СтрНом.КоличествоУпаковок;
	КонецЕсли; 
	ТекСтр.ДокументРеализации = ДокРТС;
	ТекСтр.КА_ЗаказКлиента = ДокРТС.ЗаказКлиента;
КонецЦикла;
//Стр 31

Если не (ЗаявкаНаВозврат =  Документы.ЗаявкаНаВозвратТоваровОтКлиента.ПустаяСсылка()) Тогда
//	Сообщить(Строка(ЗаявкаНаВозврат) + " уже сформирована в документе"); 	
ИначеЕсли ЗаявкаНаВозврат =  Документы.ЗаявкаНаВозвратТоваровОтКлиента.ПустаяСсылка() и не (ДокРТС = Документы.РеализацияТоваровУслуг.ПустаяСсылка())Тогда
	ЗаявкаНаВозврат = Документы.ЗаявкаНаВозвратТоваровОтКлиента.СоздатьДокумент();
	ЗаявкаНаВозврат.Дата = ТекущаяДата();
//	В связи с проблематикой непровденных РТУ ветвление заполнения ЗВТК на основании РТУ  05.10.2022 Лупонос Д.В.
	Если ДатаНУПС &lt; ДокРтс.Дата Тогда
		ЗаявкаНаВозврат.Заполнить(ДокРТС.Ссылка);
	ИначеЕсли не ДокРТС.Проведен Тогда 
		ЗаполнитьЗначенияСвойств(ЗаявкаНаВозврат, ДокРТС.Ссылка,,"Дата,Номер");
//		ЗаявкаНаВозврат.Дата = ТекущаяДата();
		ЗаявкаНаВозврат.Номер = ""; 
		ЗаявкаНаВозврат.Организация = ДокРТС.Организация; 
		ЗаявкаНаВозврат.Договор = ДокРТС.Договор; 
		ЗаявкаНаВозврат.Валюта = ДокРТС.Валюта; 
		ЗаявкаНаВозврат.Партнер = ДокРТС.Партнер; 
		ЗаявкаНаВозврат.Склад = ДокРТС.Склад; 
		ЗаявкаНаВозврат.Контрагент = ДокРТС.Контрагент; 
		ЗаявкаНаВозврат.Соглашение = ДокРТС.Соглашение; 
	КонецЕсли; 
//	В связи с проблематикой непровденных РТУ ветвление заполнения ЗВТК на основании РТУ  05.10.2022 Лупонос Д.В.
	ЗаявкаНаВозврат.Приоритет = Справочники.Приоритеты.НайтиПоНаименованию("Средний"); 
	ЗаявкаНаВозврат.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.ВозвратТоваровОтКлиента;
	ЗаявкаНаВозврат.Менеджер = ИнцидентОбъект.ПолучитьАтрибутИнцидента("ОтветственныйМКО");
	ЗаявкаНаВозврат.Подразделение = ЗаявкаНаВозврат.Менеджер.Подразделение; 
	ЗаявкаНаВозврат.КА_СпособДоставкиОтКлиента = Перечисления.СпособыДоставки.ДоКлиента;
	ЗаявкаНаВозврат.Комментарий = Строка(Объект.Ссылка);
		
	ЗаявкаНаВозврат.КА_Причина=Справочники.ПричиныВозникновенияПретензий.НайтиПоНаименованию("Брак").Ссылка;
	ЗаявкаНаВозврат.КА_АналитикаПричинБрака = Справочники.КА_АналитикаПричинБрака.НайтиПоНаименованию("Компенсация брака").Ссылка;
	ЗаявкаНаВозврат.КА_Фиктивный=Истина;//ИнцидентОбъект.ПолучитьАтрибутИнцидента("Товар вернуть");
//	
	ЗаявкаНаВозврат.КА_СпособОформленияВозврата = СпособОформленияВозврата;
	ЗаявкаНаВозврат.КА_ВидОформленияВозвратныхДокументов = ВидОформленияВозвратныхДокументов;
	ЗаявкаНаВозврат.ДокументРеализации = ДокРТС.Ссылка;
	ЗаявкаНаВозврат.КА_Инцидент = Объект.Ссылка;
	ЗаявкаНаВозврат.ВозвращаемыеТовары.Загрузить(ТаблицаТоваров);

	ЭкспертизаТут = ИнцидентОбъект.ПолучитьАтрибутИнцидента("Экспертиза");
	Если ЭкспертизаТут = Перечисления.КА_ДоставитьТоварНаЭкспертизу.Да Тогда
		ЗаявкаНаВозврат.КА_ДоставитьТоварНаЭкспертизу = Истина;
	Иначе
		ЗаявкаНаВозврат.КА_ДоставитьТоварНаЭкспертизу = Ложь;
	КонецЕсли;

//	В связи с проблематикой непровденных РТУ для корректного проведения установим признак КА_Проверено в каждой строке ТЧ ЗВТК 05.10.2022 Лупонос Д.В.
	Сч = 1;
	Если не ДокРТС.Проведен и ДатаНУПС &gt; ДокРтс.Дата Тогда 	
		ТаблицаТоваров = ЗаявкаНаВозврат.ВозвращаемыеТовары.Выгрузить();
		Для Каждого Стр из ТаблицаТоваров Цикл
			Стр.КА_Проверено = Истина;
//			Стр.КодСтроки = Сч; 
//			Сч = Сч + 1; 
			Сообщить(Строка(Стр.КоличествоУпаковок));
		КонецЦикла;
		ЗаявкаНаВозврат.ВозвращаемыеТовары.Загрузить(ТаблицаТоваров);
	КонецЕсли; 
//	В связи с проблематикой непровденных РТУ для корректного проведения установим признак КА_Проверено в каждой строке ТЧ ЗВТК 05.10.2022 Лупонос Д.В.

//++Задача 234706 РТУ является экспортной 
	Запрос = Новый Запрос; 
	Запрос.Текст = "ВЫБРАТЬ
	|	РеализацияТоваровУслуг.Ссылка КАК Ссылка
	|ИЗ
	|	Документ.РеализацияТоваровУслуг КАК РеализацияТоваровУслуг
	|ГДЕ
	|	РеализацияТоваровУслуг.Соглашение.Наименование ПОДОБНО ""Соглашение К""
	|	И РеализацияТоваровУслуг.Ссылка = &amp;Ссылка"; 
	Запрос.УстановитьПараметр("Ссылка", ДокРТС.Ссылка);
	Рез = Запрос.Выполнить().Выгрузить(); 
	Если Рез.Количество() &gt; 0 Тогда 
		ЗаявкаНаВозврат.СпособКомпенсации = Перечисления.СпособыКомпенсацииВозвратовТоваров.ЗаменитьТовары; 
		ЗаявкаНаВозврат.КА_СпособОформленияВозврата = Перечисления.КА_СпособыОформленияВозврата.ЗаменаДокументов; 
	КонецЕсли; 
//--Задача 234706  РТУ является экспортной
	Попытка 
		ЗаявкаНаВозврат.Записать();
	Исключение
		ЗаявкаНаВозврат.Записать(Ложь);
	КонецПопытки; 
	СвязатьСОбъектомИзФормыНаСервере(ЗаявкаНаВозврат.Ссылка);
	ТаблицаАтрибутовДокумента = Объект.ЗначенияАтрибутов.Выгрузить();
	АтрибутИнцидента=ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоНаименованию("ЗаявкаНаВозврат");
	ТаблицаАтрибутовДокумента = Объект.ЗначенияАтрибутов.Выгрузить();
	СтрокаИзм = ТаблицаАтрибутовДокумента.Найти(АтрибутИнцидента,"Атрибут");
	Если СтрокаИзм = Неопределено Тогда
		СтрокаИзм = ТаблицаАтрибутовДокумента.Добавить();
		СтрокаИзм.Атрибут = АтрибутИнцидента;
	КонецЕсли;
	СтрокаИзм.Значение = ЗаявкаНаВозврат.Ссылка;
	Объект.ЗначенияАтрибутов.Загрузить(ТаблицаАтрибутовДокумента);
КонецЕсли;
</v8:ОбработчикСервер>
				<v8:ОбработчикКлиентПосле>ЗаявкаНаВозврат = Неопределено;
Для каждого ТекСтр из Объект.СвязанныеОбъекты Цикл
	Если СтрНайти(Строка(ТекСтр.Объект), "Заявка на возврат товаров от клиента") Тогда
		ЗаявкаНаВозврат = ТекСтр.Объект;
	КонецЕсли;
КонецЦикла;

Если не ЗаявкаНаВозврат=Неопределено тогда
	ОткрытьФорму("Документ.ЗаявкаНаВозвратТоваровОтКлиента.ФормаОбъекта", новый Структура("Ключ",ЗаявкаНаВозврат));
КонецЕсли;</v8:ОбработчикКлиентПосле>
			</v8:Команды>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">7770acee-8e55-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">ae2bfd6f-8798-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">c10475bc-8798-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">f9220711-8795-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">28c3acd3-ba33-11ec-bba2-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>true</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">20e9e340-bc98-11ec-bbaf-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">e983c36e-bc97-11ec-bbaf-00155d258b03</v8:Атрибут>
				<v8:Недоступен>true</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">578c447d-b974-11ec-bba2-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>true</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">1e160f11-bca1-11ec-bba2-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">579bcceb-8e55-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>true</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">455e5227-8e55-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">c9ae9a45-d6cc-11ec-bbaf-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">b41ea743-66f8-11ec-bba8-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">b444c315-5f3e-11ed-bba5-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
		</v8:CatalogObject.КА_ЭтапыИнцидентов>
		<v8:CatalogObject.КА_ЭтапыИнцидентов>
			<v8:Ref xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">024c7838-81fe-11ec-bb9e-00155d70bd06</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Owner xsi:type="v8:CatalogRef.КА_ВидыИнцидентов">fe697b45-4e2c-11ec-bba8-00155d258b03</v8:Owner>
			<v8:Code>000000038</v8:Code>
			<v8:Description>Брак. Компенсация. Возврат детали</v8:Description>
			<v8:АвтоматическийСтартЭтапа>false</v8:АвтоматическийСтартЭтапа>
			<v8:АвтоматическоеЗавершениеЭтапа>false</v8:АвтоматическоеЗавершениеЭтапа>
			<v8:АтрибутыНедоступны>false</v8:АтрибутыНедоступны>
			<v8:АтрибутыСкрыты>false</v8:АтрибутыСкрыты>
			<v8:ЗавершающийЭтап>false</v8:ЗавершающийЭтап>
			<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">00000000-0000-0000-0000-000000000000</v8:Исполнитель>
			<v8:ОбработчикПередВыполнением/>
			<v8:ОбработчикПередЗаписью>УстановитьПривилегированныйРежим(Истина);

ТаблицаАтрибутов = ЭтотОбъект.ЗначенияАтрибутов.Выгрузить();
ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "ВозвратУтилизация");
ВозврУтил = ТаблицаАтрибутов.Найти(ВыбАтрибут, "Атрибут");
Если ВозврУтил = Неопределено Тогда
	ВозврУтил = ТаблицаАтрибутов.Добавить();
	ВозврУтил.Атрибут = ВыбАтрибут;
КонецЕсли;
ВозврУтил.Значение = Перечисления.КА_ВозвратУтилизация.ОжидаетсяУтилизацииДетали; 
ЭтотОбъект.ЗначенияАтрибутов.Загрузить(ТаблицаАтрибутов);


ИнцидентЗапрос = Неопределено;
ЗаявкаНаВозврат = ЭтотОбъект.ПолучитьАтрибутИнцидента("ЗаявкаНаВозврат");
Для Каждого Стр из ЭтотОбъект.СвязанныеОбъекты Цикл
	Если СтрНайти(Строка(Стр.Объект), "запрос поставщику") Тогда
		ИнцидентЗапрос = Стр.Объект.ПолучитьОбъект();
		ТаблицаСвязанных = ИнцидентЗапрос.СвязанныеОбъекты.Выгрузить();
		ЗаявкаНаВозвратЗапрос = ТаблицаСвязанных.Найти(ЗаявкаНаВозврат, "Объект"); 
		Если ЗаявкаНаВозвратЗапрос = Неопределено Тогда
			НовСтр = ТаблицаСвязанных.Добавить();
			НовСтр.Объект = ЗаявкаНаВозврат;
			ИнцидентЗапрос.СвязанныеОбъекты.Загрузить(ТаблицаСвязанных);
		КонецЕсли;
		ТаблицаАтрибутов = ИнцидентЗапрос.ЗначенияАтрибутов.Выгрузить();
		ЕстьАтрибут = ТаблицаАтрибутов.Найти(ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоНаименованию("ЗаявкаНаВозврат"), "Атрибут");
		Если ЕстьАтрибут = Неопределено Тогда
			ЕстьЗначение = ТаблицаАтрибутов.Найти(ЗаявкаНаВозвратЗапрос, "Значение");
			Если не ЕстьЗначение = Неопределено Тогда
				НовСтр = ТаблицаАтрибутов.Добавить();
				НовСтр.Атрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоНаименованию("ЗаявкаНаВозврат");
				НовСтр.Значение = ЗаявкаНаВозврат;
				ИнцидентЗапрос.ЗначенияАтрибутов.Загрузить(ТаблицаАтрибутов);
				ИнцидентЗапрос.Записать();
			Иначе
				ЕстьЗначение.Атрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоНаименованию("ЗаявкаНаВозврат");
				ИнцидентЗапрос.ЗначенияАтрибутов.Загрузить(ТаблицаАтрибутов);
				ИнцидентЗапрос.Записать();
			КонецЕсли;
		Иначе
			ЕстьАтрибут.Значение = ЗаявкаНаВозврат;
			ИнцидентЗапрос.ЗначенияАтрибутов.Загрузить(ТаблицаАтрибутов);
			ИнцидентЗапрос.Записать();
		КонецЕсли;
		Прервать;
	КонецЕсли;
КонецЦикла;
УстановитьПривилегированныйРежим(Ложь);</v8:ОбработчикПередЗаписью>
			<v8:ОбработчикПослеВыполнения/>
			<v8:ОбработчикПриЗаписи/>
			<v8:ОбработчикПриПереходе>Инцидент.СтатусИМ = Перечисления.КА_СтатусИМ.РекламацияПринятаВРаботуГарантийнымОтделом;

// Отправка статуса

НастройкаОбмена = Справочники.КА_НастройкиВыгрузкиВИМ.ПолучитьНастройку("Рекламация_СобытиеВыгрузкаСтатуса");

СоответствиеСтатусов = Новый Соответствие;
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ЗапросОтправлен, "SENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВРаботеУМенеджера, "PROCESS_BY_MANAGER");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.УточнитеДанныеОбращения, "CLARIFY_DETAILS");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВРаботеУИнженера, "PROCESS_BY_ENGINEER");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияПринятаВРаботуГарантийнымОтделом, "PROCESS_BY_WARRANTY_DEPARTMENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияПринятаУточняемСрокРассмотрения, "ACCEPTED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВозвратДеталиНаЭкспертизу, "EXPERTIZE");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОдобренаВыберитеСпособКомпенсации, "APPROVED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОтклоненаОзнакомьтесьСЗаключением, "REJECTED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ЗакрытоИПеренесеноВархивПоСрокуДавности, "CLOSED_ON_EXPIRATION");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияЗавершенаКлиентСогласен, "CLOSED_ON_AGREEMENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияЗавершенаКомпенсацияПредоставлена, "COMPENSATED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламациНаправленаВОтделКорпоративныхПродаж, "SENT_TO_SALES");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОдобрена50ВыберитеСпособКомпенсации, "APPROVED_50");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОтклоненаПовторно, "REJECTED_REPEATEDLY");

СтрДанных = Новый Структура;
СтрДанных.Вставить("complaintId", ЗначенияАтрибутов["id"]);
СтрДанных.Вставить("status", СоответствиеСтатусов[Инцидент.СтатусИМ]);

КА_Обмены.ОтправитьВСервис_Рефакторинг(СтрДанных, НастройкаОбмена, "ИМ2");


//Обрабатываем Пользователей  в поля инцидента по этапу 
Инцидент.Ответственный  = ЗначенияАтрибутов["ОтветственныйМКО"];

// Рассылка исполнителям
Тема = СтрШаблон("Обновлен статус рекламации %1 %2", Инцидент.Номер, ЗначенияАтрибутов["counterparty_external_id"]);
ТекстПисьма = "Брак подтвержден. Возврат товара нужен.";
М = Новый Массив;
М.Добавить(Инцидент.Ответственный);
Документы.КА_Инцидент.ОтправитьОповещение(М, Тема, ТекстПисьма);
//Документы.КА_Инцидент.ОтправитьОповещениеИсполнителямЭтапа(СледующийЭтап, Тема, ТекстПисьма);;</v8:ОбработчикПриПереходе>
			<v8:ОбработчикПриПринятииКИсполнению>//Пинчук М.Н. 09.11.2022
АтрибутСсылка = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор","ДополнитьДанныеВручную");
    
  НС = Инцидент.ЗначенияАтрибутов.НайтиСтроки(Новый Структура("Атрибут",АтрибутСсылка));
  Для каждого ТекАтр из НС Цикл
    Инцидент.ЗначенияАтрибутов.Удалить(ТекАтр);      
  КонецЦикла;
  НовАтр = Инцидент.ЗначенияАтрибутов.Добавить();  
  НовАтр.Атрибут = АтрибутСсылка;
  НовАтр.Значение = Неопределено;
</v8:ОбработчикПриПринятииКИсполнению>
			<v8:ОбработчикПроведения/>
			<v8:Описание>Необходимо нажать "Принять к исполнению"

Это вариант компенсации с возвратом товара.Он идёт после очевидного брака, решение по которому принято без доставки товара на экспертизу, но инженер посчитал необходимым товар забрать.

МКО создаёт документ Заявка на возврат товаров клиента по кнопке в шапке формы, проверяет его реквизиты и запускает соответствующий процесс.

Когда в процессе возникает потребность в решении клиента – какую компенсацию он предпочтёт, МКО нажимает кнопку "Выполнить" и переводит инцидент на следующий этап.

После решения клиента будет доступен процесс возврата товара.
</v8:Описание>
			<v8:ПроверятьРезультат>false</v8:ПроверятьРезультат>
			<v8:СрокВыполнения>2</v8:СрокВыполнения>
			<v8:СообщениеНедоступныПереходы/>
			<v8:ОбработчикПриОткрытии/>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">3ab46ee4-8b6b-4e27-b05f-aa6c943c5895</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">6547e112-2de4-4388-82f0-4b24ca0eee42</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">6d160a64-dd08-11e4-b0fd-001517ac6c09</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">f6af22ec-7751-4f7a-bc7e-df85edb3c04f</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">19daaf30-9a1a-11e8-80c5-3cfdfeaf9019</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">97eb7d45-6782-4b33-9909-457572becfa8</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">b783b0ba-74ad-11e1-b634-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">812e0c18-3beb-11e8-80d0-001e6707aaa8</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">f149ab7d-7ada-11e8-80c5-3cfdfeaf9019</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">58a84576-77c0-4e0e-b065-1be30ab00af9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">0cafad1c-4262-11e1-b48c-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">c34b8004-ec1d-11e5-80c5-001e6707aaa8</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">ddcd8a22-00dc-11e4-9396-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">a0477a02-97f8-11e5-9a83-001517ac6c09</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">0a67f064-81fe-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>Если НЕ РольДоступна("ПолныеПрава") Тогда
	Если ЗначенияАтрибутов["ДополнитьДанныеВручную"] = Истина 
		Тогда
		Отказ = Истина;
		Иначе
		НайденаЗаявка = Ложь;
			Для каждого ТекСтр из Инцидент.СвязанныеОбъекты Цикл
				Если ТекСтр.Объект.Ссылка.Метаданные().Имя = "ЗаявкаНаВозвратТоваровОтКлиента" Тогда
					НайденаЗаявка = (Истина И ТекСтр.Объект.Проведен) или Отказ;
				КонецЕсли;
			КонецЦикла;
		Отказ = не НайденаЗаявка;
		Если Отказ Тогда
			Сообщить("Для завершения этапа убедитесь, что документ Зявка на возват товаров от клиента создан и проведен или корректно указано Решение Инженера");
		КонецЕсли;
		
					ДокРТУ = ЗначенияАтрибутов["realizationId"];

		УсловияПроверки = СтрНайти(ДокРТУ.Ссылка.Соглашение,"Соглашение К");

			Если УсловияПроверки Тогда
					Отказ = Истина;
			КонецЕсли;	

			
	КонецЕсли;
КонецЕсли;



</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">d912235d-81fd-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>Если НЕ РольДоступна("ПолныеПрава") Тогда
	Если ЗначенияАтрибутов["ДополнитьДанныеВручную"] &lt;&gt; Истина 
		Тогда
		Отказ = Истина;
	КонецЕсли;
КонецЕсли;
</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">129df58b-81fe-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>Если НЕ РольДоступна("ПолныеПрава") Тогда
	Если ЗначенияАтрибутов["ДополнитьДанныеВручную"] = Истина 
		Тогда
		Отказ = Истина;
		Иначе
		НайденаЗаявка = Ложь;
			Для каждого ТекСтр из Инцидент.СвязанныеОбъекты Цикл
				Если ТекСтр.Объект.Ссылка.Метаданные().Имя = "ЗаявкаНаВозвратТоваровОтКлиента" Тогда
					НайденаЗаявка = (Истина И ТекСтр.Объект.Проведен) или Отказ;
				КонецЕсли;
			КонецЦикла;
		Отказ = не НайденаЗаявка;
		Если Отказ Тогда
			Сообщить("Для завершения этапа убедитесь, что документ Зявка на возват товаров от клиента создан и проведен или корректно указано Решение Инженера");
		КонецЕсли;
		
					ДокРТУ = ЗначенияАтрибутов["realizationId"];

		УсловияПроверки = СтрНайти(ДокРТУ.Ссылка.Соглашение,"Соглашение К");

			Если НЕ УсловияПроверки Тогда
					Отказ = Истина;
			КонецЕсли;	

			
	КонецЕсли;
КонецЕсли;


</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:Команды>
				<v8:Заголовок>Оформить Заявку на возврат</v8:Заголовок>
				<v8:УИ>6887d0b3-a7fb-46b5-97e3-627826844673</v8:УИ>
				<v8:ОбработчикКлиентПеред/>
				<v8:ОбработчикСервер>СпкДатаНачалаУчетаПослеСвертки = КА_СлужебныеПараметры.ПолучитьЗначение(ПланыВидовХарактеристик.КА_СлужебныеПараметры.ДатаНачалаУчетаПослеСверткиБазы); 
ДатаНУПС = СпкДатаНачалаУчетаПослеСвертки.Получить(0); 

ДатаДень = Число(Сред(ДатаНУПС,1,2));
ДатаМесяц= Число(Сред(ДатаНУПС,4,2));
ДатаГод  = Число(Сред(ДатаНУПС,7,4));
ДатаНУПС = (Дата(ДатаГод, ДатаМесяц, ДатаДень));

ЗаявкаНаВозврат = Документы.ЗаявкаНаВозвратТоваровОтКлиента.ПустаяСсылка();
ДокРТС = Документы.РеализацияТоваровУслуг.ПустаяСсылка();

Для каждого ТекСтр из Объект.СвязанныеОбъекты Цикл
	Если ТекСтр.Объект.Ссылка.Метаданные().Имя = "ЗаявкаНаВозвратТоваровОтКлиента" Тогда
		ЗаявкаНаВозврат = ТекСтр.Объект.Ссылка;
	ИначеЕсли ТекСтр.Объект.Ссылка.Метаданные().Имя = "РеализацияТоваровУслуг" Тогда 
		ДокРТС = ТекСтр.Объект.Ссылка;
	КонецЕсли;
КонецЦикла;
//Стр 19 
ТаблицаТоваров = Объект.Товары.Выгрузить();
ТаблицаТоваров.Колонки.Добавить("ДокументРеализации");
ТаблицаТоваров.Колонки.Добавить("КА_ЗаказКлиента");
ИнцидентОбъект = РеквизитФормыВЗначение("Объект");
СпособОформленияВозврата = ИнцидентОбъект.ПолучитьАтрибутИнцидента("СпособОформленияВозврата");
Если не ЗначениеЗаполнено(СпособОформленияВозврата) Тогда
	СпособОформленияВозврата = Перечисления.КА_СпособыОформленияВозврата.ВозвратныеДокументы;
КонецЕсли; 

//++Задача 234706 - берем РТУ из [realiztionid] Значений Атрибутов
ДокРТС = ИнцидентОбъект.ПолучитьАтрибутИнцидента("realizationId");
//--Задача 234706 - берем РТУ из [realiztionid] Значений Атрибутов

ВидОформленияВозвратныхДокументов = ИнцидентОбъект.ПолучитьАтрибутИнцидента("ВидОформленияДокументов");
Если СпособОформленияВозврата = Перечисления.КА_СпособыОформленияВозврата.ВозвратныеДокументы и не ЗначениеЗаполнено(ВидОформленияВозвратныхДокументов) Тогда 
	ВидОформленияВозвратныхДокументов = Перечисления.КА_ВидыОформленияВозвратныхДокументов.КлиентНеПринялТоварСОформлениемТорг2;
КонецЕсли;  
 
ТоварыРТС = ДокРТС.Товары.Выгрузить();  

Для каждого ТекСтр из ТаблицаТоваров Цикл
	ТекСтр.КоличествоУпаковок = ТекСтр.Количество;
	ТоварыРТСНоменклатура = ТоварыРТС.Скопировать(,"Номенклатура,КоличествоУпаковок");
	ТоварыРТСНоменклатура.Свернуть("Номенклатура", "КоличествоУпаковок"); 
	СтрНом = ТоварыРТСНоменклатура.Найти(ТекСтр.Номенклатура,"Номенклатура");
	Если не СтрНом = Неопределено Тогда 
		ТекСтр.КА_КоличествоПродано = СтрНом.КоличествоУпаковок;
	КонецЕсли; 
	ТекСтр.ДокументРеализации = ДокРТС;
	ТекСтр.КА_ЗаказКлиента = ДокРТС.ЗаказКлиента;
КонецЦикла;
//Стр 31

Если не (ЗаявкаНаВозврат =  Документы.ЗаявкаНаВозвратТоваровОтКлиента.ПустаяСсылка()) Тогда
//	Сообщить(Строка(ЗаявкаНаВозврат) + " уже сформирована в документе"); 	
ИначеЕсли ЗаявкаНаВозврат =  Документы.ЗаявкаНаВозвратТоваровОтКлиента.ПустаяСсылка() и не (ДокРТС = Документы.РеализацияТоваровУслуг.ПустаяСсылка())Тогда
	ЗаявкаНаВозврат = Документы.ЗаявкаНаВозвратТоваровОтКлиента.СоздатьДокумент();
	ЗаявкаНаВозврат.Дата = ТекущаяДата();
//	В связи с проблематикой непровденных РТУ ветвление заполнения ЗВТК на основании РТУ  05.10.2022 Лупонос Д.В.
	Если ДатаНУПС &lt; ДокРтс.Дата Тогда
		ЗаявкаНаВозврат.Заполнить(ДокРТС.Ссылка);
	ИначеЕсли не ДокРТС.Проведен Тогда 
		ЗаполнитьЗначенияСвойств(ЗаявкаНаВозврат, ДокРТС.Ссылка,,"Дата,Номер");
//		ЗаявкаНаВозврат.Дата = ТекущаяДата();
		ЗаявкаНаВозврат.Номер = ""; 
		ЗаявкаНаВозврат.Организация = ДокРТС.Организация; 
		ЗаявкаНаВозврат.Договор = ДокРТС.Договор; 
		ЗаявкаНаВозврат.Валюта = ДокРТС.Валюта; 
		ЗаявкаНаВозврат.Партнер = ДокРТС.Партнер; 
		ЗаявкаНаВозврат.Склад = ДокРТС.Склад; 
		ЗаявкаНаВозврат.Контрагент = ДокРТС.Контрагент; 
		ЗаявкаНаВозврат.Соглашение = ДокРТС.Соглашение; 
	КонецЕсли; 
//	В связи с проблематикой непровденных РТУ ветвление заполнения ЗВТК на основании РТУ  05.10.2022 Лупонос Д.В.
	ЗаявкаНаВозврат.Приоритет = Справочники.Приоритеты.НайтиПоНаименованию("Средний"); 
	ЗаявкаНаВозврат.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.ВозвратТоваровОтКлиента;
	ЗаявкаНаВозврат.Менеджер = ИнцидентОбъект.ПолучитьАтрибутИнцидента("ОтветственныйМКО");
	ЗаявкаНаВозврат.Подразделение = ЗаявкаНаВозврат.Менеджер.Подразделение; 
	ЗаявкаНаВозврат.КА_СпособДоставкиОтКлиента = Перечисления.СпособыДоставки.ДоКлиента;
	ЗаявкаНаВозврат.Комментарий = Строка(Объект.Ссылка);
		
	ЗаявкаНаВозврат.КА_Причина=Справочники.ПричиныВозникновенияПретензий.НайтиПоНаименованию("Брак").Ссылка;
	ЗаявкаНаВозврат.КА_АналитикаПричинБрака = Справочники.КА_АналитикаПричинБрака.НайтиПоНаименованию("Компенсация брака").Ссылка;
//	ЗаявкаНаВозврат.КА_Фиктивный=Истина;//ИнцидентОбъект.ПолучитьАтрибутИнцидента("Товар вернуть");

	ЗаявкаНаВозврат.КА_СпособОформленияВозврата = СпособОформленияВозврата;
	ЗаявкаНаВозврат.КА_ВидОформленияВозвратныхДокументов = ВидОформленияВозвратныхДокументов;
	ЗаявкаНаВозврат.ДокументРеализации = ДокРТС.Ссылка;
	ЗаявкаНаВозврат.КА_Инцидент = Объект.Ссылка;
	ЗаявкаНаВозврат.ВозвращаемыеТовары.Загрузить(ТаблицаТоваров);

//	В связи с проблематикой непровденных РТУ для корректного проведения установим признак КА_Проверено в каждой строке ТЧ ЗВТК 05.10.2022 Лупонос Д.В.
	Сч = 1;
	Если не ДокРТС.Проведен и ДатаНУПС &gt; ДокРтс.Дата Тогда 	
		ТаблицаТоваров = ЗаявкаНаВозврат.ВозвращаемыеТовары.Выгрузить();
		Для Каждого Стр из ТаблицаТоваров Цикл
			Стр.КА_Проверено = Истина;
//			Стр.КодСтроки = Сч; 
//			Сч = Сч + 1; 
		КонецЦикла;
		ЗаявкаНаВозврат.ВозвращаемыеТовары.Загрузить(ТаблицаТоваров);
	КонецЕсли; 
//	В связи с проблематикой непровденных РТУ для корректного проведения установим признак КА_Проверено в каждой строке ТЧ ЗВТК 05.10.2022 Лупонос Д.В.
//++Задача 234706 РТУ является экспортной 
	Запрос = Новый Запрос; 
	Запрос.Текст = "ВЫБРАТЬ
	|	РеализацияТоваровУслуг.Ссылка КАК Ссылка
	|ИЗ
	|	Документ.РеализацияТоваровУслуг КАК РеализацияТоваровУслуг
	|ГДЕ
	|	РеализацияТоваровУслуг.Соглашение.Наименование ПОДОБНО ""Соглашение К""
	|	И РеализацияТоваровУслуг.Ссылка = &amp;Ссылка"; 
	Запрос.УстановитьПараметр("Ссылка", ДокРТС.Ссылка);
	Рез = Запрос.Выполнить().Выгрузить(); 
	Если Рез.Количество() &gt; 0 Тогда 
		ЗаявкаНаВозврат.СпособКомпенсации = Перечисления.СпособыКомпенсацииВозвратовТоваров.ЗаменитьТовары; 
		ЗаявкаНаВозврат.КА_СпособОформленияВозврата = Перечисления.КА_СпособыОформленияВозврата.ЗаменаДокументов; 
	КонецЕсли; 
//--Задача 234706  РТУ является экспортной

	Попытка 
		ЗаявкаНаВозврат.Записать();
	Исключение
		ЗаявкаНаВозврат.Записать(Ложь);
	КонецПопытки; 
	СвязатьСОбъектомИзФормыНаСервере(ЗаявкаНаВозврат.Ссылка);
	ТаблицаАтрибутовДокумента = Объект.ЗначенияАтрибутов.Выгрузить();
	АтрибутИнцидента=ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоНаименованию("ЗаявкаНаВозврат");
	ТаблицаАтрибутовДокумента = Объект.ЗначенияАтрибутов.Выгрузить();
	СтрокаИзм = ТаблицаАтрибутовДокумента.Найти(АтрибутИнцидента,"Атрибут");
	Если СтрокаИзм = Неопределено Тогда
		СтрокаИзм = ТаблицаАтрибутовДокумента.Добавить();
		СтрокаИзм.Атрибут = АтрибутИнцидента;
	КонецЕсли;
	СтрокаИзм.Значение = ЗаявкаНаВозврат.Ссылка;
	Объект.ЗначенияАтрибутов.Загрузить(ТаблицаАтрибутовДокумента);
КонецЕсли;
</v8:ОбработчикСервер>
				<v8:ОбработчикКлиентПосле>ЗаявкаНаВозврат = Неопределено;
Для каждого ТекСтр из Объект.СвязанныеОбъекты Цикл
	Если СтрНайти(Строка(ТекСтр.Объект), "Заявка на возврат товаров от клиента") Тогда
		ЗаявкаНаВозврат = ТекСтр.Объект;
	КонецЕсли;
КонецЦикла;

Если не ЗаявкаНаВозврат=Неопределено тогда
	ОткрытьФорму("Документ.ЗаявкаНаВозвратТоваровОтКлиента.ФормаОбъекта", новый Структура("Ключ",ЗаявкаНаВозврат));
КонецЕсли;</v8:ОбработчикКлиентПосле>
			</v8:Команды>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">f9220711-8795-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">c10475bc-8798-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">ae2bfd6f-8798-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">7770acee-8e55-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">20e9e340-bc98-11ec-bbaf-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">e983c36e-bc97-11ec-bbaf-00155d258b03</v8:Атрибут>
				<v8:Недоступен>true</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">28c3acd3-ba33-11ec-bba2-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>true</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">578c447d-b974-11ec-bba2-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>true</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">579bcceb-8e55-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>true</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>true</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">1e160f11-bca1-11ec-bba2-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">c9ae9a45-d6cc-11ec-bbaf-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">413c9a50-673f-11ec-bba8-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">b444c315-5f3e-11ed-bba5-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
		</v8:CatalogObject.КА_ЭтапыИнцидентов>
		<v8:CatalogObject.КА_ЭтапыИнцидентов>
			<v8:Ref xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">046ca2f2-7abf-11ed-bbb3-00155d258b03</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Owner xsi:type="v8:CatalogRef.КА_ВидыИнцидентов">fe697b45-4e2c-11ec-bba8-00155d258b03</v8:Owner>
			<v8:Code>000000086</v8:Code>
			<v8:Description>Компенсация. Экспортный клиент</v8:Description>
			<v8:АвтоматическийСтартЭтапа>false</v8:АвтоматическийСтартЭтапа>
			<v8:АвтоматическоеЗавершениеЭтапа>false</v8:АвтоматическоеЗавершениеЭтапа>
			<v8:АтрибутыНедоступны>false</v8:АтрибутыНедоступны>
			<v8:АтрибутыСкрыты>false</v8:АтрибутыСкрыты>
			<v8:ЗавершающийЭтап>false</v8:ЗавершающийЭтап>
			<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">00000000-0000-0000-0000-000000000000</v8:Исполнитель>
			<v8:ОбработчикПередВыполнением>АтрибутЗаказ = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "ЗаказКлиента");
Стр = Инцидент.Ссылка.ЗначенияАтрибутов.Найти(АтрибутЗаказ, "Атрибут");
Отказ = (Стр = Неопределено или не ЗначениеЗаполнено(Стр.Значение)); 
	</v8:ОбработчикПередВыполнением>
			<v8:ОбработчикПередЗаписью/>
			<v8:ОбработчикПослеВыполнения/>
			<v8:ОбработчикПриЗаписи/>
			<v8:ОбработчикПриПереходе>УстановитьПривилегированныйРежим(Истина);
//АтрибутКлиент = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "Клиент");
//Стр = Инцидент.Ссылка.ЗначенияАтрибутов.Найти(АтрибутКлиент, "Атрибут");
//Отказ=Истина; 
//Для Каждого Стр из Инцидент.Товары Цикл
//	Если СтрНайти(ВРЕГ(Стр.Соглашение.Наименование), "СОГЛАШЕНИЕ К") Тогда
//		Отказ=Ложь;
//		Прервать; 
//	КонецЕсли; 
//КонецЦикла; 

//Если не Отказ И Стр = Неопределено Тогда 
//	Сообщить("Не выбран атрибут ""Клиент"""); 
//	Отказ = Истина;
//ИначеЕсли не Отказ И не ЗначениеЗаполнено(Стр.Значение) Тогда 
//	Сообщить("Не заполнен атрибут ""Клиент"""); 
//	Отказ = Истина; 
//ИначеЕсли не Отказ И не Стр.Значение.КА_Экспорт=Истина Тогда 
//	Сообщить("У клиента не установлен статус ""Экспорт"""); 
//	Отказ = Истина;
//КонецЕсли; 
УсловиеВыполнения = Ложь;  
ТабИнцидентКлиенты = Инцидент.Товары.Выгрузить(); 
ТабИнцидентКлиенты.Свернуть("Клиент"); 
Для Каждого Стр из ТабИнцидентКлиенты Цикл
    Если Отказ = Ложь и Стр.Клиент.КА_Экспорт=Истина Тогда 
       УсловиеВыполнения = Истина;  
   КонецЕсли; 
КонецЦикла;
Если НЕ Отказ и УсловиеВыполнения Тогда 
	Инцидент.Ответственный =  ЗначенияАтрибутов["ОтветственныйМКО"];
	АтрибутСК = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "Рекламация_СпособКомпенсации");
//	СтрСК = Инцидент.Ссылка.ЗначенияАтрибутов.Найти(АтрибутКлиент, "Атрибут");
//	Если СтрСК = Неопределено Тогда 
//		СтрСК = Инцидент.Ссылка.ЗначенияАтрибутов.Добавить();
//		СтрСК.Атрибут = АтрибутСК; 
//	КонецЕсли;
//	СтрСК.Значение = Справочники.КА_ДополнительныеЗначенияАтрибутов.НайтиПоНаименованию("Оставить в качестве аванса");
КонецЕсли; 

УстановитьПривилегированныйРежим(Ложь);
</v8:ОбработчикПриПереходе>
			<v8:ОбработчикПриПринятииКИсполнению/>
			<v8:ОбработчикПроведения/>
			<v8:Описание>МКО принимает этап в работу.

Для отгрузки товара клиенту МКО создаёт Заказ клиенту по соотрвтствующей кнопке и дозаполняет необходимые реквизиты.

Дальнейшая отгрузка происходит в рамках типового процесса.

Когда товар отгружается со склада, МКО заходит в инцидент и нажимает кнопку "Обновить РТУ", которая изменяет документ основание на реализацию по новому заказу по договору К.

После этого МКО нажимает Выполнено и инцидент автоматически перейдёт на нужный этап.</v8:Описание>
			<v8:ПроверятьРезультат>false</v8:ПроверятьРезультат>
			<v8:СрокВыполнения>0</v8:СрокВыполнения>
			<v8:СообщениеНедоступныПереходы/>
			<v8:ОбработчикПриОткрытии/>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">6547e112-2de4-4388-82f0-4b24ca0eee42</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">3ab46ee4-8b6b-4e27-b05f-aa6c943c5895</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">6d160a64-dd08-11e4-b0fd-001517ac6c09</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">f6af22ec-7751-4f7a-bc7e-df85edb3c04f</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">19daaf30-9a1a-11e8-80c5-3cfdfeaf9019</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">97eb7d45-6782-4b33-9909-457572becfa8</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">b783b0ba-74ad-11e1-b634-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">812e0c18-3beb-11e8-80d0-001e6707aaa8</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">f149ab7d-7ada-11e8-80c5-3cfdfeaf9019</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">58a84576-77c0-4e0e-b065-1be30ab00af9</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">0cafad1c-4262-11e1-b48c-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">c34b8004-ec1d-11e5-80c5-001e6707aaa8</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">ddcd8a22-00dc-11e4-9396-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">a0477a02-97f8-11e5-9a83-001517ac6c09</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">fba53040-81fd-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>Если НЕ РольДоступна("ПолныеПрава") Тогда

ДокРТУ = ЗначенияАтрибутов["realizationId"];

УсловияПроверки = СтрНайти(ДокРТУ.Ссылка.Соглашение,"Соглашение К");

	Если НЕ УсловияПроверки Тогда
			Отказ = Истина;
	КонецЕсли;

	Если (ЗначенияАтрибутов["РешениеИнженера"] = Перечисления.КА_РешенияИнженера.БракКомпенсация 
		ИЛИ ЗначенияАтрибутов["РешениеИнженера"] = Перечисления.КА_РешенияИнженера.НеизвестноКомпенсация)
		И ЗначенияАтрибутов["ТоварВернуть"] &lt;&gt; Истина Тогда
		// Все ок
	Иначе	
		Отказ = Истина;
	КонецЕсли;


КонецЕсли;</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">291059d5-81fe-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>Если НЕ РольДоступна("ПолныеПрава") Тогда

ДокРТУ = ЗначенияАтрибутов["realizationId"];

УсловияПроверки = СтрНайти(ДокРТУ.Ссылка.Соглашение,"Соглашение К");

	Если НЕ УсловияПроверки Тогда
			Отказ = Истина;
	КонецЕсли;

	Если ЗначенияАтрибутов["РешениеНОР"] &lt;&gt; Перечисления.КА_РешениеНОР.КомпенсацияЗаСчетКомпании100 Тогда
		Отказ = Истина;
	КонецЕсли;
КонецЕсли;
</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">291059d6-81fe-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>Если НЕ РольДоступна("ПолныеПрава") Тогда

ДокРТУ = ЗначенияАтрибутов["realizationId"];

УсловияПроверки = СтрНайти(ДокРТУ.Ссылка.Соглашение,"Соглашение К");

	Если НЕ УсловияПроверки Тогда
			Отказ = Истина;
	КонецЕсли;

	Если ЗначенияАтрибутов["РешениеНОР"] &lt;&gt; Перечисления.КА_РешениеНОР.КомпенсацияЗаСчетКомпании50 Тогда
		Отказ = Истина;
	КонецЕсли;
КонецЕсли;
</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">024c7838-81fe-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>Если НЕ РольДоступна("ПолныеПрава") Тогда

ДокРТУ = ЗначенияАтрибутов["realizationId"];

УсловияПроверки = СтрНайти(ДокРТУ.Ссылка.Соглашение,"Соглашение К");

	Если НЕ УсловияПроверки Тогда
			Отказ = Истина;
	КонецЕсли;

	Если (ЗначенияАтрибутов["РешениеИнженера"] = Перечисления.КА_РешенияИнженера.БракКомпенсация 
		ИЛИ ЗначенияАтрибутов["РешениеИнженера"] = Перечисления.КА_РешенияИнженера.НеизвестноКомпенсация)
		И ЗначенияАтрибутов["ТоварВернуть"] = Истина Тогда
		// Все ок
	Иначе	
		Отказ = Истина;
	КонецЕсли;


КонецЕсли;</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:Команды>
				<v8:Заголовок>Создать заказ клиента</v8:Заголовок>
				<v8:УИ>1354b78a-bab2-4f02-b722-ba78840f5643</v8:УИ>
				<v8:ОбработчикКлиентПеред/>
				<v8:ОбработчикСервер>//УстановитьПривилегированныйРежим(Истина);
ТабТовары = Объект.Товары.Выгрузить(); 
//ТабТовары.Колонки.Добавить("ВариантОбеспечения");
//ТабТовары.Колонки.Добавить("ДатаОтгрузки"); 
ВыбВалюта = Неопределено; 
Для Каждого Стр из ТабТовары Цикл
//	Стр.ВариантОбеспечения = Перечисления.ВариантыОбеспечения.Отгрузить; 
	Если ЗначениеЗаполнено(Стр.Валюта) Тогда 
		ВыбВалюта = Стр.Валюта; 
	КонецЕсли; 
КонецЦикла; 

ЗначАтрибутов = Объект.ЗначенияАтрибутов.Выгрузить(); 
ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "ОтветственныйМКО");
Стр = ЗначАтрибутов.Найти(ВыбАтрибут,"Атрибут");
ВыбМенеджер = Неопределено; 
Если не Стр = Неопределено Тогда 
	ВыбМенеджер=Стр.Значение; 
КонецЕсли; 
ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "ЗаказКлиента");
Стр = ЗначАтрибутов.Найти(ВыбАтрибут,"Атрибут");
Если (Стр = Неопределено или не ЗначениеЗаполнено(Стр.Значение)) и ТабТовары.Количество() &gt; 0 Тогда 
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
		|	ПартнерыСегмента.Сегмент КАК Сегмент,
		|	ПартнерыСегмента.Партнер КАК Партнер
		|ИЗ
		|	РегистрСведений.ПартнерыСегмента КАК ПартнерыСегмента
		|ГДЕ
		|	ПартнерыСегмента.Сегмент.Родитель = &amp;Родитель
		|	И ПартнерыСегмента.Партнер = &amp;Партнер"; 
	Запрос.УстановитьПараметр("Партнер",ТабТовары[0].Клиент);
	Запрос.УстановитьПараметр("Родитель",Справочники.СегментыПартнеров.НайтиПоКоду("ЦБ-00000035")); 
	РезСегмент = Запрос.Выполнить().Выгрузить();; 
	
	Если РезСегмент.Количество() &gt; 0 Тогда  
		
		Запрос = Новый Запрос;
		Запрос.Текст = "ВЫБРАТЬ
			|	СоглашенияСКлиентами.Ссылка КАК Ссылка
			|ИЗ
			|	Справочник.СоглашенияСКлиентами КАК СоглашенияСКлиентами
			|ГДЕ
			|	СоглашенияСКлиентами.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыСоглашенийСКлиентами.Действует)
			|	И СоглашенияСКлиентами.СегментПартнеров = &amp;СегментПартнеров
			|	И СоглашенияСКлиентами.Наименование ПОДОБНО &amp;Наименование"; 
		Запрос.УстановитьПараметр("Наименование","%соглашение к"); 
		Запрос.УстановитьПараметр("СегментПартнеров",РезСегмент[0].Сегмент); 
		РезСоглашение = Запрос.Выполнить().Выгрузить(); 
	Иначе
		Сообщить("Внимание, для партнера: " + Строка(ТабТовары[0].Клиент) + ", по организации: " + Строка(ТабТовары[0].Организация) + ", не найден Сегмент Партнера для отбора Соглашения К");
		Запрос = Новый Запрос;
		Запрос.Текст = "ВЫБРАТЬ
			|	СоглашенияСКлиентами.Ссылка КАК Ссылка
			|ИЗ
			|	Справочник.СоглашенияСКлиентами КАК СоглашенияСКлиентами
			|ГДЕ
			|	СоглашенияСКлиентами.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыСоглашенийСКлиентами.Действует)
			|	И СоглашенияСКлиентами.Партнер = &amp;Партнер
			|	И СоглашенияСКлиентами.Наименование ПОДОБНО &amp;Наименование"; 
		Запрос.УстановитьПараметр("Наименование","%соглашение к"); 
		Запрос.УстановитьПараметр("Партнер", ТабТовары[0].Клиент); 
		РезСоглашение = Запрос.Выполнить().Выгрузить(); 

	КонецЕсли; 
		
	Запрос = Новый Запрос; 
	Запрос.Текст = "ВЫБРАТЬ
		|	ДоговорыКонтрагентов.Ссылка КАК Ссылка
		|ИЗ
		|	Справочник.ДоговорыКонтрагентов КАК ДоговорыКонтрагентов
		|ГДЕ
		|	ДоговорыКонтрагентов.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыДоговоровКонтрагентов.Действует)
		|	И ДоговорыКонтрагентов.Наименование ПОДОБНО &amp;Наименование
		|	И ДоговорыКонтрагентов.Контрагент = &amp;Контрагент
		|	И ДоговорыКонтрагентов.Организация = &amp;Организация
		|	И ДоговорыКонтрагентов.Партнер = &amp;Партнер"; 
	
	Запрос.УстановитьПараметр("Наименование","%договор к"); 
	Запрос.УстановитьПараметр("Партнер",ТабТовары[0].Клиент); 
	Запрос.УстановитьПараметр("Контрагент",ТабТовары[0].Контрагент); 
	Запрос.УстановитьПараметр("Организация",ТабТовары[0].Организация); 
	
	РезДоговор = Запрос.Выполнить().Выгрузить(); 
	
	Если РезСоглашение.Количество() = 0 Тогда 
		Сообщить("Внимание, для партнера: " + Строка(ТабТовары[0].Клиент) + ", по организации: " + Строка(ТабТовары[0].Организация) + ", не найдено Соглашение К");
	ИначеЕсли РезДоговор.Количество() = 0 Тогда 
		Сообщить("Внимание, для контрагента: " + Строка(ТабТовары[0].Контрагент) + ", по организации: " + Строка(ТабТовары[0].Организация) + ", не найден Договор К");
	КонецЕсли; 	

	Запрос = Новый Запрос; 
	Запрос.Текст = "ВЫБРАТЬ РАЗРЕШЕННЫЕ ПЕРВЫЕ 5
		|	ЗаказКлиента.АдресДоставки КАК АдресДоставки,
		|	ЗаказКлиента.КонтактноеЛицо КАК КонтактноеЛицо,
		|	ЗаказКлиента.СпособДоставки КАК СпособДоставки,
		|	ЗаказКлиента.КА_ПользовательИМ КАК КА_ПользовательИМ,
		|	ЗаказКлиента.КА_Маршрут КАК КА_Маршрут,
		|	ЗаказКлиента.КА_ДоставкаДоАдресаДоставкиКлиента КАК КА_ДоставкаДоАдресаДоставкиКлиента,
		|	ЗаказКлиента.КА_ЗонаДоставкиДоКлиентаТЭК КАК КА_ЗонаДоставкиДоКлиентаТЭК,
		|	ЗаказКлиента.ДополнительнаяИнформацияПоДоставке
		|ИЗ
		|	Документ.ЗаказКлиента КАК ЗаказКлиента
		|ГДЕ
		|	ЗаказКлиента.Контрагент = &amp;Контрагент
		|	И ЗаказКлиента.Проведен
		|	И НЕ ЗаказКлиента.АдресДоставки ПОДОБНО &amp;АдресДоставки
		|	И НЕ ЗаказКлиента.Ссылка ЕСТЬ NULL"; 
	Запрос.УстановитьПараметр("Контрагент",ТабТовары[0].Контрагент);
	Запрос.УстановитьПараметр("АдресДоставки","Проставить адрес"); 
	РезЗаказы = Запрос.Выполнить().Выгрузить(); 

	ДокЗаказ = Документы.ЗаказКлиента.СоздатьДокумент();
	ДокЗаказ.Дата = ТекущаяДатаСеанса(); 
	ДокЗаказ.Партнер = ТабТовары[0].Клиент;
	ДокЗаказ.Контрагент = ТабТовары[0].Контрагент;
	ДокЗаказ.Организация = ТабТовары[0].Организация;
	Для Каждого СтрСогл из РезСоглашение Цикл
		ДокЗаказ.Соглашение = СтрСогл.Ссылка;//ТабТовары[0].Соглашение;
		Прервать; 
	КонецЦикла; 
	Для Каждого СтрДог из РезДоговор Цикл
		ДокЗаказ.Договор = СтрДог.Ссылка;//ТабТовары[0].Договор;
		Прервать; 
	КонецЦикла; 
	ДокЗаказ.Склад = ТабТовары[0].Склад;
	ДокЗаказ.Комментарий = "Бесплатная замена брака по " + Строка(Объект.Ссылка);
	ДокЗаказ.Товары.Загрузить(ТабТовары.Скопировать()); 
	ДокЗаказ.Статус = Перечисления.СтатусыЗаказовКлиентов.НеСогласован; 
	ДокЗаказ.Приоритет = Справочники.Приоритеты.НайтиПоНаименованию("Средний");
	ДокЗаказ.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.РеализацияКлиенту;
	ДокЗаказ.СпособДоставки = Перечисления.СпособыДоставки.ДоКлиента; 
	ДокЗаказ.НалогообложениеНДС = Перечисления.ТипыНалогообложенияНДС.ПродажаНеОблагаетсяНДС; 
	ДокЗаказ.Валюта = ВыбВалюта;  
	ДокЗаказ.ЦенаВключаетНДС = Истина; 
	ДокЗаказ.Менеджер = ВыбМенеджер;
	Для Каждого СтрЗаказ из РезЗаказы Цикл
		Если ЗначениеЗаполнено(СтрЗаказ.АдресДоставки) Тогда 
			ЗаполнитьЗначенияСвойств(ДокЗаказ,СтрЗаказ); 
			Прервать; 
		КонецЕсли; 
	КонецЦикла; 
	ДокЗаказ.КА_ОтказПриНаличииРекламации = Истина; 
	ЗаполнитьЗначенияСвойств(ДокЗаказ,ДокЗаказ.Соглашение,"НалогообложениеНДС,ЦенаВключаетНДС,ГрафикОплаты");
	Если ЗначениеЗаполнено(ДокЗаказ.ГрафикОплаты) Тогда 
		ДокЗаказ.ФормаОплаты = ДокЗаказ.ГрафикОплаты.ФормаОплаты
	Иначе 
		ДокЗаказ.ФормаОплаты = ДокЗаказ.Соглашение.ФормаОплаты; 
	КонецЕсли; 
	ДокЗаказ.БанковскийСчет = ДокЗаказ.Организация.КА_ОсновнойСчетОрганизации;
	ДокЗаказ.Записать(); 
	
	НовДок = Объект.СвязанныеОбъекты.Добавить(); 
	НовДок.Объект = ДокЗаказ.Ссылка; 
	
	ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "ЗаказКлиента");
	СтрАтрибут = ЗначАтрибутов.Найти(ВыбАтрибут,"Атрибут");
	Если СтрАтрибут = Неопределено Тогда 
		СтрАтрибут = ЗначАтрибутов.Добавить(); 
		СтрАтрибут.Атрибут = ВыбАтрибут; 
	КонецЕсли; 
	СтрАтрибут.Значение = ДокЗаказ.Ссылка;
	Объект.ЗначенияАтрибутов.Загрузить(ЗначАтрибутов); 
КонецЕсли; 
//УстановитьПривилегированныйРежим(Ложь);
</v8:ОбработчикСервер>
				<v8:ОбработчикКлиентПосле>ДокЗаказ = Неопределено;
Для каждого ТекСтр из Объект.ЗначенияАтрибутов Цикл
	Если ТипЗнч(ТекСтр.Значение)=Тип("ДокументСсылка.ЗаказКлиента") Тогда
		ДокЗаказ = ТекСтр.Значение;
	КонецЕсли;
КонецЦикла;

Если не ДокЗаказ=Неопределено тогда
	ОткрытьФорму("Документ.ЗаказКлиента.Форма.ФормаДокумента", новый Структура("Ключ",ДокЗаказ));
КонецЕсли;</v8:ОбработчикКлиентПосле>
			</v8:Команды>
			<v8:Команды>
				<v8:Заголовок>Обновить РТУ</v8:Заголовок>
				<v8:УИ>49212098-b775-4a3b-8396-b2f13d2da3fe</v8:УИ>
				<v8:ОбработчикКлиентПеред/>
				<v8:ОбработчикСервер>//УстановитьПривилегированныйРежим(Истина);

ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "ЗаказКлиента");
СтрЗаказ = Объект.Ссылка.ЗначенияАтрибутов.Найти(ВыбАтрибут,"Атрибут");

ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "productId");
СтрТовар = Объект.Ссылка.ЗначенияАтрибутов.Найти(ВыбАтрибут,"Атрибут");

ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "count");
СтрКоличество = Объект.Ссылка.ЗначенияАтрибутов.Найти(ВыбАтрибут,"Атрибут");

Если не СтрЗаказ = Неопределено и не СтрТовар = Неопределено и не СтрКоличество = Неопределено Тогда 
	Если ЗначениеЗаполнено(СтрЗаказ.Значение) и ЗначениеЗаполнено(СтрТовар.Значение) Тогда 
		Запрос = Новый Запрос; 
		Запрос.Текст = "ВЫБРАТЬ
			|	СвязанныеДокументы.Ссылка КАК Ссылка
			|ИЗ
			|	КритерийОтбора.СвязанныеДокументы(&amp;ВыбЗаказ) КАК СвязанныеДокументы
			|ГДЕ
			|	ТИПЗНАЧЕНИЯ(СвязанныеДокументы.Ссылка) = ТИП(Документ.РеализацияТоваровУслуг)"; 
		Запрос.УстановитьПараметр("ВыбЗаказ", СтрЗаказ.Значение); 
		Рез = Запрос.Выполнить().Выгрузить();
		
		Если Рез.Количество()=0 Тогда 
			Сообщить("Реализация Товаров и Услуг ещё не оформлена, дождитесь окончания отгрузки"); 
		КонецЕсли; 
		
		Номенклатура = СтрТовар.Значение; 
		КоличествоНом = СтрКоличество.Значение; 
		
		Для Каждого Стр из Рез Цикл
			
			ТоварыРТУ = Стр.Ссылка.Товары.Выгрузить();
			ТоварыРТУСверн = ТоварыРТУ.Скопировать(,"Номенклатура,КоличествоУпаковок");
			ТоварыРТУСверн.Свернуть("Номенклатура", "КоличествоУпаковок");
			ЕстьНоменклатураВРТУ = ТоварыРТУСверн.НайтиСтроки(Новый Структура("Номенклатура",Номенклатура));
			Если ЕстьНоменклатураВРТУ = Неопределено Тогда 
				Продолжить; 
			КонецЕсли; 
			Для Каждого СтрРТУ из ЕстьНоменклатураВРТУ Цикл
				Если СтрРТУ.КоличествоУпаковок &lt; КоличествоНом Тогда 
					Продолжить;
				КонецЕсли; 
			КонецЦикла; 
			ТЗСвязОбъект = Объект.СвязанныеОбъекты.Выгрузить();
			НовРТУ = ТЗСвязОбъект.Найти(Рез[0].Ссылка, "Объект");
			Если НовРТУ = Неопределено Тогда 
				НовРТУ = ТЗСвязОбъект.Добавить();
				НовРТУ.Объект = Рез[0].Ссылка; 
				Объект.СвязанныеОбъекты.Загрузить(ТЗСвязОбъект); 
			КонецЕсли; 

			ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "realizationId");
			ТабЗначАтрибутов = Объект.ЗначенияАтрибутов.Выгрузить();
			СтрРТУ = ТабЗначАтрибутов.Найти(ВыбАтрибут,"Атрибут");
			Если СтрРТУ = Неопределено Тогда
				СтрРТУ = Объект.Ссылка.ЗначенияАтрибутов.Добавить();
				СтрРТУ.Атрибут = ВыбАтрибут;
			КонецЕсли;
			СтрРТУ.Значение = Рез[0].Ссылка;//.УникальныйИдентификатор();
			Объект.ЗначенияАтрибутов.Загрузить(ТабЗначАтрибутов);
			СтрокиРТУ = ТоварыРТУ.НайтиСтроки(Новый Структура("Номенклатура",Номенклатура)); 
			Сч = КоличествоНом; 
			ТоварыИнцидента = Объект.Товары.Выгрузить(); 
			ТоварыИнцидента.Очистить();
			Для Каждого Стр из СтрокиРТУ Цикл
				Если не Сч &gt; 0 Тогда 
					Продолжить;
				КонецЕсли; 
				НовСтр = ТоварыИнцидента.Добавить(); 
				ЗаполнитьЗначенияСвойств(НовСтр, НовРТУ.Объект);
				ЗаполнитьЗначенияСвойств(НовСтр, Стр);
				Если Стр.КоличествоУпаковок - Сч &gt; 0 Тогда 
					НовСтр.Количество = Сч;
					НовСтр.КоличествоУпаковок = Сч;
					Сч = 0; 
				Иначе	
					НовСтр.Количество = Стр.КоличествоУпаковок;
					НовСтр.КоличествоУпаковок = Стр.КоличествоУпаковок;
					Сч = Сч - Стр.КоличествоУпаковок; 
				КонецЕсли; 
				НовСтр.СуммаСНДС = (НовСтр.СуммаСНДС/Стр.КоличествоУпаковок)*НовСтр.КоличествоУпаковок; 
				НовСтр.СуммаНДС = (НовСтр.СуммаНДС/Стр.КоличествоУпаковок)*НовСтр.КоличествоУпаковок; 
				НовСтр.Клиент = Рез[0].Ссылка.Партнер; 
			КонецЦикла; 
			Объект.Товары.Загрузить(ТоварыИнцидента); 
		КонецЦикла; 
	Иначе 
		Отказ = Истина; 
	КонецЕсли; 
Иначе 
	Отказ = Истина; 
КонецЕсли; 

//УстановитьПривилегированныйРежим(Ложь);

</v8:ОбработчикСервер>
				<v8:ОбработчикКлиентПосле/>
			</v8:Команды>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">7770acee-8e55-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">c10475bc-8798-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">455e5227-8e55-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">1e160f11-bca1-11ec-bba2-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">f9220711-8795-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">ae2bfd6f-8798-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">b444c315-5f3e-11ed-bba5-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
		</v8:CatalogObject.КА_ЭтапыИнцидентов>
		<v8:CatalogObject.КА_ЭтапыИнцидентов>
			<v8:Ref xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">2152ab23-81fe-11ec-bb9e-00155d70bd06</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Owner xsi:type="v8:CatalogRef.КА_ВидыИнцидентов">fe697b45-4e2c-11ec-bba8-00155d258b03</v8:Owner>
			<v8:Code>000000047</v8:Code>
			<v8:Description>На рассмотрении у НКО</v8:Description>
			<v8:АвтоматическийСтартЭтапа>false</v8:АвтоматическийСтартЭтапа>
			<v8:АвтоматическоеЗавершениеЭтапа>false</v8:АвтоматическоеЗавершениеЭтапа>
			<v8:АтрибутыНедоступны>false</v8:АтрибутыНедоступны>
			<v8:АтрибутыСкрыты>false</v8:АтрибутыСкрыты>
			<v8:ЗавершающийЭтап>false</v8:ЗавершающийЭтап>
			<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">00000000-0000-0000-0000-000000000000</v8:Исполнитель>
			<v8:ОбработчикПередВыполнением/>
			<v8:ОбработчикПередЗаписью>
ТаблицаАтрибутов = ЭтотОбъект.ЗначенияАтрибутов.Выгрузить();
	ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "РешениеНОР"); 
	СтрРешНОР = ТаблицаАтрибутов.Найти(ВыбАтрибут,"Атрибут"); 
	ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "ВозвратУтилизация"); 
	СтрИзменение = ТаблицаАтрибутов.Найти(ВыбАтрибут,"Атрибут");
	Если не ЗначениеЗаполнено(СтрИзменение) Тогда
		СтрИзменение = ТаблицаАтрибутов.Добавить();
		СтрИзменение.Атрибут = ВыбАтрибут;
	КонецЕсли;
ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "Экспертиза");
Стр = ТаблицаАтрибутов.Найти(ВыбАтрибут, "Атрибут");
Если Стр = Неопределено или Стр.Значение = Перечисления.КА_ДоставитьТоварНаЭкспертизу.Нет Тогда
	СтрИзменение.Значение = Перечисления.КА_ВозвратУтилизация.НеТребуется;
ИначеЕсли СтрРешНОР = Неопределено или (не СтрРешНОР.Значение = Перечисления.КА_РешениеНОР.ОтказНОР) Тогда 
	СтрИзменение.Значение = Перечисления.КА_ВозвратУтилизация.ОжидаетсяУтилизацииДетали;
ИначеЕсли (не СтрРешНОР = Неопределено) и (СтрРешНОР.Значение = Перечисления.КА_РешениеНОР.ОтказНОР) Тогда 
	СтрИзменение.Значение = Перечисления.КА_ВозвратУтилизация.ОжидаетсяВозвратДетали;
КонецЕсли;
ЭтотОбъект.ЗначенияАтрибутов.Загрузить(ТаблицаАтрибутов);
</v8:ОбработчикПередЗаписью>
			<v8:ОбработчикПослеВыполнения/>
			<v8:ОбработчикПриЗаписи/>
			<v8:ОбработчикПриПереходе>Инцидент.СтатусИМ = Перечисления.КА_СтатусИМ.РекламациНаправленаВОтделКорпоративныхПродаж;
//Обрабатываем Пользователей  в поля инцидента по этапу 
Инцидент.Ответственный  = Справочники.Пользователи.НайтиПоНаименованию("Бабенко В. А.");

// Отправка статуса

НастройкаОбмена = Справочники.КА_НастройкиВыгрузкиВИМ.ПолучитьНастройку("Рекламация_СобытиеВыгрузкаСтатуса");

СоответствиеСтатусов = Новый Соответствие;
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ЗапросОтправлен, "SENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВРаботеУМенеджера, "PROCESS_BY_MANAGER");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.УточнитеДанныеОбращения, "CLARIFY_DETAILS");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВРаботеУИнженера, "PROCESS_BY_ENGINEER");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияПринятаВРаботуГарантийнымОтделом, "PROCESS_BY_WARRANTY_DEPARTMENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияПринятаУточняемСрокРассмотрения, "ACCEPTED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВозвратДеталиНаЭкспертизу, "EXPERTIZE");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОдобренаВыберитеСпособКомпенсации, "APPROVED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОтклоненаОзнакомьтесьСЗаключением, "REJECTED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ЗакрытоИПеренесеноВархивПоСрокуДавности, "CLOSED_ON_EXPIRATION");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияЗавершенаКлиентСогласен, "CLOSED_ON_AGREEMENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияЗавершенаКомпенсацияПредоставлена, "COMPENSATED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламациНаправленаВОтделКорпоративныхПродаж, "SENT_TO_SALES");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОдобрена50ВыберитеСпособКомпенсации, "APPROVED_50");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОтклоненаПовторно, "REJECTED_REPEATEDLY");

СтрДанных = Новый Структура;
СтрДанных.Вставить("complaintId", ЗначенияАтрибутов["id"]);
СтрДанных.Вставить("status", СоответствиеСтатусов[Инцидент.СтатусИМ]);

КА_Обмены.ОтправитьВСервис_Рефакторинг(СтрДанных, НастройкаОбмена, "ИМ2");

// Рассылка исполнителям
Тема = СтрШаблон("Обновлен статус рекламации %1", Инцидент.Номер);
ТекстПисьма = "Клиент не согласен с решением инженера. МКО вышел на компенсацию за счет компании. Требуется принять решение.";
Документы.КА_Инцидент.ОтправитьОповещениеИсполнителямЭтапа(СледующийЭтап, Тема, ТекстПисьма);</v8:ОбработчикПриПереходе>
			<v8:ОбработчикПриПринятииКИсполнению/>
			<v8:ОбработчикПроведения/>
			<v8:Описание>НКО принимает инцидент в работу от МКО и рассматривает обращение в двух случаях:
1) клиент не согласен с решением и просит проявить лояльность (оспорил решение инженера)
2) МКО попросил согласовать у НКО компенсацию без экспертизы

В первом случае в инциденте будут заполнены 
- атрибут Решение обжаловано клиентом: "Да";
- атрибут Решение инженера "Не брак, отказ"

НКО может ознакомится с описанием брака на вкладке Основное, с заключением инженера, прикреплённого к документу по ссылке Файлы, а при наличии - с описанием обжалования клиентом и комментариями МКО.

НКО может оставить комментарий к инциденту, нажав знак "+".

Когда решение принято, НКО переходит на вкладку Дополнительно и выбирает решение:
- Компенсация за счёт компании 100%,
- Компенсация за счёт компании 50%,
- Отказ НОР (в случе отказа, его требуется обосновать в комментарии к инциденту)

После этого он нажимает кнопку "Выполнить" и инцидент автоматически перейдёт на следующий этап
_____________________________________________________________________________________________
Во втором случае ни решения инженера, ни обжалование заполнено не будет.

НКО изучает аргументы МКО в комментарии к инциденту. 
Он выносит окончательное решение, будет компенсация без экспертизы или товар всё-таки лучше забрать для изучения.

Когда решение принято, НКО переходит на вкладку Дополнительно и выбирает решение:
- Компенсация за счёт компании 100%,
- Компенсация за счёт компании 50%,
- Отказ НОР
- Согласована доставка на экспертиза по межскладу (Инцидент возвращается к МКО, который организует возврат товара для проведения очной экспертизы)

После этого он нажимает кнопку "Выполнить" и инцидент автоматически перейдёт на следующий этап</v8:Описание>
			<v8:ПроверятьРезультат>true</v8:ПроверятьРезультат>
			<v8:СрокВыполнения>9</v8:СрокВыполнения>
			<v8:СообщениеНедоступныПереходы/>
			<v8:ОбработчикПриОткрытии/>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">df08b5fa-7e84-11e8-80c5-3cfdfeaf9019</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">07d158b7-54ba-11e7-80ce-001e6707aaa8</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">0cafad1c-4262-11e1-b48c-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">291059d6-81fe-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>Если НЕ РольДоступна("ПолныеПрава") Тогда
	Если ЗначенияАтрибутов["РешениеНОР"] &lt;&gt; Перечисления.КА_РешениеНОР.КомпенсацияЗаСчетКомпании50 Тогда
		Отказ = Истина;
	КонецЕсли;
	
		УсловиеПроверки = Инцидент.Товары[0].СтавкаНДС = Перечисления.СтавкиНДС.НДС0;

	Если УсловиеПроверки Тогда
		Отказ = Истина;
	КонецЕсли;
	
КонецЕсли;
</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">4a3602ca-8e59-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>Если НЕ РольДоступна("ПолныеПрава") Тогда
	Если ЗначенияАтрибутов["РешениеНОР"] &lt;&gt; Перечисления.КА_РешениеНОР.ОтказНОР Тогда
		Отказ = Истина;
	КонецЕсли;
КонецЕсли;
</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">eab3acfb-81fd-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды>Согласована доставка на экспертизу по межскладу</v8:ИмяКоманды>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>Если НЕ РольДоступна("ПолныеПрава") Тогда
	Если  ЗначенияАтрибутов["РешениеНОР"] &lt;&gt; Перечисления.КА_РешениеНОР.СогласованаДоставкаНаЭкспертизуПоМежскладу Тогда
		Отказ = Истина;
	КонецЕсли;
КонецЕсли;</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">291059d5-81fe-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>Если НЕ РольДоступна("ПолныеПрава") Тогда
	Если ЗначенияАтрибутов["РешениеНОР"] &lt;&gt; Перечисления.КА_РешениеНОР.КомпенсацияЗаСчетКомпании100 Тогда
		Отказ = Истина;
	КонецЕсли;
	
		УсловиеПроверки = Инцидент.Товары[0].СтавкаНДС = Перечисления.СтавкиНДС.НДС0;

	Если УсловиеПроверки Тогда
		Отказ = Истина;
	КонецЕсли;
	
КонецЕсли;
</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">046ca2f2-7abf-11ed-bbb3-00155d258b03</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>Если НЕ РольДоступна("ПолныеПрава") Тогда

	УсловиеКомпенсации = ЗначенияАтрибутов["РешениеНОР"] = Перечисления.КА_РешениеНОР.КомпенсацияЗаСчетКомпании100 
							ИЛИ 
						ЗначенияАтрибутов["РешениеНОР"] = Перечисления.КА_РешениеНОР.КомпенсацияЗаСчетКомпании50;


	Если НЕ УсловиеКомпенсации Тогда
		Отказ = Истина;
	КонецЕсли;
	
	УсловиеПроверки = Инцидент.Товары[0].СтавкаНДС = Перечисления.СтавкиНДС.НДС0;

	Если НЕ УсловиеПроверки Тогда
		Отказ = Истина;
	КонецЕсли;
	
	

КонецЕсли;

</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">f9220711-8795-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">455e5227-8e55-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">1e160f11-bca1-11ec-bba2-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">28c3acd3-ba33-11ec-bba2-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>true</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">e983c36e-bc97-11ec-bbaf-00155d258b03</v8:Атрибут>
				<v8:Недоступен>true</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">578c447d-b974-11ec-bba2-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>true</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
		</v8:CatalogObject.КА_ЭтапыИнцидентов>
		<v8:CatalogObject.КА_ЭтапыИнцидентов>
			<v8:Ref xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">2152ab22-81fe-11ec-bb9e-00155d70bd06</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Owner xsi:type="v8:CatalogRef.КА_ВидыИнцидентов">fe697b45-4e2c-11ec-bba8-00155d258b03</v8:Owner>
			<v8:Code>000000046</v8:Code>
			<v8:Description>На рассмотрении у МКО</v8:Description>
			<v8:АвтоматическийСтартЭтапа>false</v8:АвтоматическийСтартЭтапа>
			<v8:АвтоматическоеЗавершениеЭтапа>false</v8:АвтоматическоеЗавершениеЭтапа>
			<v8:АтрибутыНедоступны>false</v8:АтрибутыНедоступны>
			<v8:АтрибутыСкрыты>false</v8:АтрибутыСкрыты>
			<v8:ЗавершающийЭтап>false</v8:ЗавершающийЭтап>
			<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">00000000-0000-0000-0000-000000000000</v8:Исполнитель>
			<v8:ОбработчикПередВыполнением/>
			<v8:ОбработчикПередЗаписью>
ТаблицаАтрибутов = ЭтотОбъект.ЗначенияАтрибутов.Выгрузить();
	ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "ВозвратУтилизация"); 
	СтрИзменение = ТаблицаАтрибутов.Найти(ВыбАтрибут,"Атрибут");
	Если не ЗначениеЗаполнено(СтрИзменение) Тогда
		СтрИзменение = ТаблицаАтрибутов.Добавить();
		СтрИзменение.Атрибут = ВыбАтрибут;
	КонецЕсли;
ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "Экспертиза");
Стр = ТаблицаАтрибутов.Найти(ВыбАтрибут, "Атрибут");
Если Стр = Неопределено или Стр.Значение = Перечисления.КА_ДоставитьТоварНаЭкспертизу.Нет Тогда
	СтрИзменение.Значение = Перечисления.КА_ВозвратУтилизация.НеТребуется;
Иначе
	СтрИзменение.Значение = Перечисления.КА_ВозвратУтилизация.ОжидаетсяВозвратДетали;
КонецЕсли;
ЭтотОбъект.ЗначенияАтрибутов.Загрузить(ТаблицаАтрибутов);
</v8:ОбработчикПередЗаписью>
			<v8:ОбработчикПослеВыполнения/>
			<v8:ОбработчикПриЗаписи/>
			<v8:ОбработчикПриПереходе>Инцидент.СтатусИМ = Перечисления.КА_СтатусИМ.РекламациНаправленаВОтделКорпоративныхПродаж;

//Обрабатываем Пользователей  в поля инцидента по этапу 
Инцидент.Ответственный  = ЗначенияАтрибутов["ОтветственныйМКО"];

// Отправка статуса

НастройкаОбмена = Справочники.КА_НастройкиВыгрузкиВИМ.ПолучитьНастройку("Рекламация_СобытиеВыгрузкаСтатуса");

СоответствиеСтатусов = Новый Соответствие;
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ЗапросОтправлен, "SENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВРаботеУМенеджера, "PROCESS_BY_MANAGER");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.УточнитеДанныеОбращения, "CLARIFY_DETAILS");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВРаботеУИнженера, "PROCESS_BY_ENGINEER");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияПринятаВРаботуГарантийнымОтделом, "PROCESS_BY_WARRANTY_DEPARTMENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияПринятаУточняемСрокРассмотрения, "ACCEPTED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВозвратДеталиНаЭкспертизу, "EXPERTIZE");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОдобренаВыберитеСпособКомпенсации, "APPROVED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОтклоненаОзнакомьтесьСЗаключением, "REJECTED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ЗакрытоИПеренесеноВархивПоСрокуДавности, "CLOSED_ON_EXPIRATION");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияЗавершенаКлиентСогласен, "CLOSED_ON_AGREEMENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияЗавершенаКомпенсацияПредоставлена, "COMPENSATED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламациНаправленаВОтделКорпоративныхПродаж, "SENT_TO_SALES");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОдобрена50ВыберитеСпособКомпенсации, "APPROVED_50");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОтклоненаПовторно, "REJECTED_REPEATEDLY");

СтрДанных = Новый Структура;
СтрДанных.Вставить("complaintId", ЗначенияАтрибутов["id"]);
СтрДанных.Вставить("status", СоответствиеСтатусов[Инцидент.СтатусИМ]);

КА_Обмены.ОтправитьВСервис_Рефакторинг(СтрДанных, НастройкаОбмена, "ИМ2");

// Рассылка
Получатели = Новый Массив;
Вложения = Новый Соответствие;

ДокРТС = ЗначенияАтрибутов["realizationId"];
Партнер = ДокРТС.Партнер;

Адрес = УправлениеКонтактнойИнформацией.КонтактнаяИнформацияОбъекта(Партнер, Справочники.ВидыКонтактнойИнформации.EmailПартнера);
		
Если ЗначениеЗаполнено(Адрес) Тогда
	Получатели.Добавить(Новый Структура("Адрес, Представление", Адрес, Адрес));
КонецЕсли; 
	
Если Получатели.Количество() &gt; 0 Тогда

	Отправитель = Справочники.УчетныеЗаписиЭлектроннойПочты.СистемнаяУчетнаяЗаписьЭлектроннойПочты;
				
	Тема = "Обработка рекламации";
	ТекстПисьма = "Ваша рекламция направлена на повторное рассмотрение.
				|За разъяснениями Вы всегда можете обратиться к Вашему менеджеру.";	
			
	ПараметрыПисьма = Новый Структура;
	ПараметрыПисьма.Вставить("Кому",Получатели);
	ПараметрыПисьма.Вставить("Тема", Тема);
	ПараметрыПисьма.Вставить("Тело", ТекстПисьма);
	ПараметрыПисьма.Вставить("Вложения", Вложения);
				
	Попытка
		ИдентификаторСообщения = РаботаСПочтовымиСообщениями.ОтправитьПочтовоеСообщение(Отправитель, ПараметрыПисьма);
	Исключение
		Ошибка = ОписаниеОшибки();
		Сообщить(СтрШаблон("При отправке письма произошла ошибка: %1", Ошибка));
	КонецПопытки; 
		
КонецЕсли;

// Рассылка исполнителям
Тема = СтрШаблон("Обновлен статус рекламации %1", Инцидент.Номер);
ТекстПисьма = "Клиент не согласен с решением инженера. Требуется урегулировать вопрос с Клиентом или получить дополнительные аргументы для обжалования.";
Документы.КА_Инцидент.ОтправитьОповещениеИсполнителямЭтапа(СледующийЭтап, Тема, ТекстПисьма);</v8:ОбработчикПриПереходе>
			<v8:ОбработчикПриПринятииКИсполнению/>
			<v8:ОбработчикПроведения/>
			<v8:Описание>МКО принимает инцидент в работу и рассматривает обращение, если клиент не согласен с решением и просит проявить лояльность (Клиент оспотил )

МКО знакомится с описанием брака на вкладке Основное, с заключением инженера, прикреплённого к документу по ссылке Файлы, а при наличии - с описанием обжалования клиентом. Также он оценивает ключевые показатели клиента. 

Свои выводы МКО  фиксирует в комментарии, нажав знак "+".

После этого он нажимает кнопку "Выполнить" и инцидент перейдёт ев следующий этап



</v8:Описание>
			<v8:ПроверятьРезультат>false</v8:ПроверятьРезультат>
			<v8:СрокВыполнения>9</v8:СрокВыполнения>
			<v8:СообщениеНедоступныПереходы/>
			<v8:ОбработчикПриОткрытии/>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">3ab46ee4-8b6b-4e27-b05f-aa6c943c5895</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">6547e112-2de4-4388-82f0-4b24ca0eee42</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">a0477a02-97f8-11e5-9a83-001517ac6c09</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">6d160a64-dd08-11e4-b0fd-001517ac6c09</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">f6af22ec-7751-4f7a-bc7e-df85edb3c04f</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">19daaf30-9a1a-11e8-80c5-3cfdfeaf9019</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">97eb7d45-6782-4b33-9909-457572becfa8</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">b783b0ba-74ad-11e1-b634-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">812e0c18-3beb-11e8-80d0-001e6707aaa8</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">f149ab7d-7ada-11e8-80c5-3cfdfeaf9019</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">58a84576-77c0-4e0e-b065-1be30ab00af9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">0cafad1c-4262-11e1-b48c-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">c34b8004-ec1d-11e5-80c5-001e6707aaa8</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">ddcd8a22-00dc-11e4-9396-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">07d158b7-54ba-11e7-80ce-001e6707aaa8</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">df08b5fa-7e84-11e8-80c5-3cfdfeaf9019</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">2152ab23-81fe-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода/>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">579bcceb-8e55-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">f9220711-8795-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">455e5227-8e55-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">1e160f11-bca1-11ec-bba2-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">e983c36e-bc97-11ec-bbaf-00155d258b03</v8:Атрибут>
				<v8:Недоступен>true</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">28c3acd3-ba33-11ec-bba2-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>true</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">578c447d-b974-11ec-bba2-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>true</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">c10475bc-8798-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">c9ae9a45-d6cc-11ec-bbaf-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">b444c315-5f3e-11ed-bba5-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
		</v8:CatalogObject.КА_ЭтапыИнцидентов>
		<v8:CatalogObject.КА_ЭтапыИнцидентов>
			<v8:Ref xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">353b40c4-8e59-11ec-bb9e-00155d70bd06</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Owner xsi:type="v8:CatalogRef.КА_ВидыИнцидентов">fe697b45-4e2c-11ec-bba8-00155d258b03</v8:Owner>
			<v8:Code>000000058</v8:Code>
			<v8:Description>Завершен. Отказано. Клиент согласен</v8:Description>
			<v8:АвтоматическийСтартЭтапа>false</v8:АвтоматическийСтартЭтапа>
			<v8:АвтоматическоеЗавершениеЭтапа>false</v8:АвтоматическоеЗавершениеЭтапа>
			<v8:АтрибутыНедоступны>false</v8:АтрибутыНедоступны>
			<v8:АтрибутыСкрыты>false</v8:АтрибутыСкрыты>
			<v8:ЗавершающийЭтап>false</v8:ЗавершающийЭтап>
			<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">00000000-0000-0000-0000-000000000000</v8:Исполнитель>
			<v8:ОбработчикПередВыполнением/>
			<v8:ОбработчикПередЗаписью>ТаблицаАтрибутов = ЭтотОбъект.ЗначенияАтрибутов.Выгрузить();
	ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "ВозвратУтилизация"); 
	СтрИзменение = ТаблицаАтрибутов.Найти(ВыбАтрибут,"Атрибут");
	Если не ЗначениеЗаполнено(СтрИзменение) Тогда
		СтрИзменение = ТаблицаАтрибутов.Добавить();
		СтрИзменение.Атрибут = ВыбАтрибут;
	КонецЕсли;
ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "Экспертиза");
Стр = ТаблицаАтрибутов.Найти(ВыбАтрибут, "Атрибут");
ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "ТоварВернуть");
ТовВерн = ТаблицаАтрибутов.Найти(ВыбАтрибут, "Атрибут");

Если (Стр = Неопределено или Стр.Значение = Перечисления.КА_ДоставитьТоварНаЭкспертизу.Нет) Тогда
	СтрИзменение.Значение = Перечисления.КА_ВозвратУтилизация.НеТребуется;
ИначеЕсли (не Стр = Неопределено и Стр.Значение = Перечисления.КА_ДоставитьТоварНаЭкспертизу.Да) и (не СтрИзменение=Неопределено и не СтрИзменение.Значение = Перечисления.КА_ВозвратУтилизация.ДетальУтилизирована) Тогда
	СтрИзменение.Значение = Перечисления.КА_ВозвратУтилизация.ОжидаетсяВозвратДетали;
КонецЕсли;
ЭтотОбъект.ЗначенияАтрибутов.Загрузить(ТаблицаАтрибутов);
</v8:ОбработчикПередЗаписью>
			<v8:ОбработчикПослеВыполнения/>
			<v8:ОбработчикПриЗаписи/>
			<v8:ОбработчикПриПереходе>Инцидент.СтатусИМ = Перечисления.КА_СтатусИМ.РекламацияЗавершенаКлиентСогласен;
//Инцидент.КА_СтатусЗавершен= Перечисления.КА_СтатусЗавершенияИМ.ЗавершенОтказаноКлиентСогласен;
//Инцидент.КА_СтатусЗавершен= Перечисления.КА_СтатусЗавершенияИМ.КомпенсацияЗачтена;
//Обрабатываем Пользователей  в поля инцидента по этапу 
Инцидент.Ответственный  = ЗначенияАтрибутов["ОтветственныйМКО"];

// Отправка статуса

НастройкаОбмена = Справочники.КА_НастройкиВыгрузкиВИМ.ПолучитьНастройку("Рекламация_СобытиеВыгрузкаСтатуса");

СоответствиеСтатусов = Новый Соответствие;
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ЗапросОтправлен, "SENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВРаботеУМенеджера, "PROCESS_BY_MANAGER");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.УточнитеДанныеОбращения, "CLARIFY_DETAILS");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВРаботеУИнженера, "PROCESS_BY_ENGINEER");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияПринятаВРаботуГарантийнымОтделом, "PROCESS_BY_WARRANTY_DEPARTMENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияПринятаУточняемСрокРассмотрения, "ACCEPTED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВозвратДеталиНаЭкспертизу, "EXPERTIZE");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОдобренаВыберитеСпособКомпенсации, "APPROVED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОтклоненаОзнакомьтесьСЗаключением, "REJECTED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ЗакрытоИПеренесеноВархивПоСрокуДавности, "CLOSED_ON_EXPIRATION");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияЗавершенаКлиентСогласен, "CLOSED_ON_AGREEMENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияЗавершенаКомпенсацияПредоставлена, "COMPENSATED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламациНаправленаВОтделКорпоративныхПродаж, "SENT_TO_SALES");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОдобрена50ВыберитеСпособКомпенсации, "APPROVED_50");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОтклоненаПовторно, "REJECTED_REPEATEDLY");

СтрДанных = Новый Структура;
СтрДанных.Вставить("complaintId", ЗначенияАтрибутов["id"]);
СтрДанных.Вставить("status", СоответствиеСтатусов[Инцидент.СтатусИМ]);

КА_Обмены.ОтправитьВСервис_Рефакторинг(СтрДанных, НастройкаОбмена, "ИМ2");

// Рассылка
Получатели = Новый Массив;
Вложения = Новый Соответствие;

ДокРТС = ЗначенияАтрибутов["realizationId"];
Партнер = ДокРТС.Партнер;

Адрес = УправлениеКонтактнойИнформацией.КонтактнаяИнформацияОбъекта(Партнер, Справочники.ВидыКонтактнойИнформации.EmailПартнера);
		
Если ЗначениеЗаполнено(Адрес) Тогда
	Получатели.Добавить(Новый Структура("Адрес, Представление", Адрес, Адрес));
КонецЕсли; 
	
Если Получатели.Количество() &gt; 0 Тогда

	Отправитель = Справочники.УчетныеЗаписиЭлектроннойПочты.СистемнаяУчетнаяЗаписьЭлектроннойПочты;
				
	Тема = "Обработка рекламации";
	ТекстПисьма = "Спасибо за обращение, надеемся Вам все понравилось.";	
			
	ПараметрыПисьма = Новый Структура;
	ПараметрыПисьма.Вставить("Кому",Получатели);
	ПараметрыПисьма.Вставить("Тема", Тема);
	ПараметрыПисьма.Вставить("Тело", ТекстПисьма);
	ПараметрыПисьма.Вставить("Вложения", Вложения);
				
	Попытка
		ИдентификаторСообщения = РаботаСПочтовымиСообщениями.ОтправитьПочтовоеСообщение(Отправитель, ПараметрыПисьма);
	Исключение
		Ошибка = ОписаниеОшибки();
		Сообщить(СтрШаблон("При отправке письма произошла ошибка: %1", Ошибка));
	КонецПопытки; 
		
КонецЕсли;

// Рассылка исполнителям
Тема = СтрШаблон("Рекламация %1 завершена", Инцидент.Номер);
ТекстПисьма = "Отказано. Клиент согласен с нашим отказом.";
Документы.КА_Инцидент.ОтправитьОповещениеИсполнителямЭтапа(СледующийЭтап, Тема, ТекстПисьма);</v8:ОбработчикПриПереходе>
			<v8:ОбработчикПриПринятииКИсполнению/>
			<v8:ОбработчикПроведения/>
			<v8:Описание>После получения согласия с отрицательным решением инженера клиента, МКО принимает инцидент в работу и проверяет, была ли доставлена деталь на экспертизу.

Если возврат детали был (атрибут "Доставить деталь на экспертизу "=Да), МКО выясняет (по телефону или электронной почте), нужна ли деталь клиенту.

После получения ответа, МКО переходит на вкладку Дополнительно и в атрибуте "Возврт и утилизация детали" выбирает значение 
- "Ожидается утилизация детали" - если деталь клиенту не нужна
или 
- "Ожидается возврат детали" - если клиент просит деталь вернуть.

После заполнения атрибутов МКО нажимает кнопку «Выполнить» на вкладке «Основное» и инцидент автоматически перейдёт на нужный этап.
_______________________________________________________________________________________________
Если возврата детали не было, МКО нажимает кнопку «Выполнить» на вкладке «Основное» без заполнения каких-либо атрибутов.


</v8:Описание>
			<v8:ПроверятьРезультат>false</v8:ПроверятьРезультат>
			<v8:СрокВыполнения>2</v8:СрокВыполнения>
			<v8:СообщениеНедоступныПереходы/>
			<v8:ОбработчикПриОткрытии/>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">58a84576-77c0-4e0e-b065-1be30ab00af9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">3ab46ee4-8b6b-4e27-b05f-aa6c943c5895</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">6547e112-2de4-4388-82f0-4b24ca0eee42</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">a0477a02-97f8-11e5-9a83-001517ac6c09</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">6d160a64-dd08-11e4-b0fd-001517ac6c09</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">f6af22ec-7751-4f7a-bc7e-df85edb3c04f</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">19daaf30-9a1a-11e8-80c5-3cfdfeaf9019</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">97eb7d45-6782-4b33-9909-457572becfa8</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">b783b0ba-74ad-11e1-b634-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">b783b0ba-74ad-11e1-b634-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">812e0c18-3beb-11e8-80d0-001e6707aaa8</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">f149ab7d-7ada-11e8-80c5-3cfdfeaf9019</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">0cafad1c-4262-11e1-b48c-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">c34b8004-ec1d-11e5-80c5-001e6707aaa8</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">ddcd8a22-00dc-11e4-9396-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">b39a8a2d-d7c2-11ec-bbaf-00155d258b03</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>Если НЕ РольДоступна("ПолныеПрава") Тогда

	Если НЕ ЗначенияАтрибутов["ВозвратУтилизация"] = Перечисления.КА_ВозвратУтилизация.ОжидаетсяУтилизацииДетали Тогда
		Сообщить("Для перехода на следующий этап необходимо, чтобы статус поля Возврат утилизация был ""Ожидается утилизация детали""");	
		Отказ = Истина;
	
	КонецЕсли;

КонецЕсли;</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">99c177aa-d7c3-11ec-bbaf-00155d258b03</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>Если НЕ РольДоступна("ПолныеПрава") Тогда

	Если НЕ ЗначенияАтрибутов["ВозвратУтилизация"] = Перечисления.КА_ВозвратУтилизация.ОжидаетсяВозвратДетали Тогда
		Сообщить("Для перехода на следующий этап необходимо, чтобы статус поля Возврат утилизация был ""Ожидается возврат детали""");
		Отказ = Истина;
	
	КонецЕсли;

КонецЕсли;</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">20e9e340-bc98-11ec-bbaf-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">ae2bfd6f-8798-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">455e5227-8e55-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">1e160f11-bca1-11ec-bba2-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">c10475bc-8798-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">f9220711-8795-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">579bcceb-8e55-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">7770acee-8e55-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
		</v8:CatalogObject.КА_ЭтапыИнцидентов>
		<v8:CatalogObject.КА_ЭтапыИнцидентов>
			<v8:Ref xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">b512a77b-8e56-11ec-bb9e-00155d70bd06</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Owner xsi:type="v8:CatalogRef.КА_ВидыИнцидентов">fe697b45-4e2c-11ec-bba8-00155d258b03</v8:Owner>
			<v8:Code>000000053</v8:Code>
			<v8:Description>Завершен. Истечение срока давности</v8:Description>
			<v8:АвтоматическийСтартЭтапа>true</v8:АвтоматическийСтартЭтапа>
			<v8:АвтоматическоеЗавершениеЭтапа>true</v8:АвтоматическоеЗавершениеЭтапа>
			<v8:АтрибутыНедоступны>false</v8:АтрибутыНедоступны>
			<v8:АтрибутыСкрыты>false</v8:АтрибутыСкрыты>
			<v8:ЗавершающийЭтап>false</v8:ЗавершающийЭтап>
			<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">00000000-0000-0000-0000-000000000000</v8:Исполнитель>
			<v8:ОбработчикПередВыполнением/>
			<v8:ОбработчикПередЗаписью>ТаблицаАтрибутов = ЭтотОбъект.ЗначенияАтрибутов.Выгрузить();
	ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "ВозвратУтилизация"); 
	СтрИзменение = ТаблицаАтрибутов.Найти(ВыбАтрибут,"Атрибут");
	Если не ЗначениеЗаполнено(СтрИзменение) Тогда
		СтрИзменение = ТаблицаАтрибутов.Добавить();
		СтрИзменение.Атрибут = ВыбАтрибут;
	КонецЕсли;
ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "Экспертиза");
Стр = ТаблицаАтрибутов.Найти(ВыбАтрибут, "Атрибут");
ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "ТоварВернуть");
ТовВерн = ТаблицаАтрибутов.Найти(ВыбАтрибут, "Атрибут");

Если (Стр = Неопределено или Стр.Значение = Перечисления.КА_ДоставитьТоварНаЭкспертизу.Нет) и (ТовВерн = Неопределено или ТовВерн.Значение = Ложь) Тогда
	СтрИзменение.Значение = Перечисления.КА_ВозвратУтилизация.НеТребуется;
ИначеЕсли (не Стр = Неопределено и Стр.Значение = Перечисления.КА_ДоставитьТоварНаЭкспертизу.Да) и (не СтрИзменение=Неопределено и не СтрИзменение.Значение = Перечисления.КА_ВозвратУтилизация.ДетальУтилизирована) Тогда
	СтрИзменение.Значение = Перечисления.КА_ВозвратУтилизация.ОжидаетсяУтилизацииДетали;
ИначеЕсли ТовВерн = Неопределено и ТовВерн.Значение = Истина Тогда
	СтрИзменение.Значение = Перечисления.КА_ВозвратУтилизация.ОжидаетсяУтилизацииДетали;
КонецЕсли;
ЭтотОбъект.ЗначенияАтрибутов.Загрузить(ТаблицаАтрибутов);
</v8:ОбработчикПередЗаписью>
			<v8:ОбработчикПослеВыполнения/>
			<v8:ОбработчикПриЗаписи/>
			<v8:ОбработчикПриПереходе>УстановитьПривилегированныйРежим(Истина);
Инцидент.СтатусИМ = Перечисления.КА_СтатусИМ.ЗакрытоИПеренесеноВархивПоСрокуДавности;
Инцидент.КА_СтатусЗавершен= Перечисления.КА_СтатусЗавершенияИМ.ИстечениеCрокаДавности;

//++Добавим завершение инцидента: запрос поставщику
ИнцидентЗапрос = Неопределено; 
Для Каждого Стр из Инцидент.СвязанныеОбъекты Цикл
	Если ТипЗнч(Стр.Объект) = Тип("ДокументСсылка.КА_Инцидент") Тогда 
		Если Стр.Объект.ВидИнцидента = Справочники.КА_ВидыИнцидентов.НайтиПоНаименованию("Рекламация от клиента: запрос поставщику") Тогда
			ИнцидентЗапрос = Стр.Объект.Ссылка; 
		КонецЕсли; 
	КонецЕсли; 
КонецЦикла;

Если не ИнцидентЗапрос = Неопределено Тогда
	ИЗОбъект = ИнцидентЗапрос.ПолучитьОбъект(); 
	ИЗОбъект.КА_СтатусЗавершен= Перечисления.КА_СтатусЗавершенияИМ.ИстечениеCрокаДавности;
	ИЗОбъект.СтатусИМ = Перечисления.КА_СтатусИМ.ЗакрытоИПеренесеноВархивПоСрокуДавности;
	ИЗОбъект.Статус = Перечисления.КА_СтатусыИнцидентов.Завершен; 
	ИЗОбъект.Записать();
	РегКоммИнц = РегистрыСведений.КА_КомментарииИнцидентов.СоздатьМенеджерЗаписи(); 
	РегКоммИнц.Инцидент = ИнцидентЗапрос;
	РегКоммИнц.Период = ТекущаяДатаСеанса(); 
	РегКоммИнц.Автор = Пользователи.ТекущийПользователь(); 
	РегКоммИнц.Текст = "Закрыто по сроку давности"; 
	РегКоммИнц.Записать();
КонецЕсли; 
УстановитьПривилегированныйРежим(Ложь);

//--Добавим завершение инцидента: запрос поставщику

// Отправка статуса

НастройкаОбмена = Справочники.КА_НастройкиВыгрузкиВИМ.ПолучитьНастройку("Рекламация_СобытиеВыгрузкаСтатуса");

СоответствиеСтатусов = Новый Соответствие;
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ЗапросОтправлен, "SENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВРаботеУМенеджера, "PROCESS_BY_MANAGER");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.УточнитеДанныеОбращения, "CLARIFY_DETAILS");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВРаботеУИнженера, "PROCESS_BY_ENGINEER");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияПринятаВРаботуГарантийнымОтделом, "PROCESS_BY_WARRANTY_DEPARTMENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияПринятаУточняемСрокРассмотрения, "ACCEPTED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВозвратДеталиНаЭкспертизу, "EXPERTIZE");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОдобренаВыберитеСпособКомпенсации, "APPROVED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОтклоненаОзнакомьтесьСЗаключением, "REJECTED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ЗакрытоИПеренесеноВархивПоСрокуДавности, "CLOSED_ON_EXPIRATION");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияЗавершенаКлиентСогласен, "CLOSED_ON_AGREEMENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияЗавершенаКомпенсацияПредоставлена, "COMPENSATED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламациНаправленаВОтделКорпоративныхПродаж, "SENT_TO_SALES");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОдобрена50ВыберитеСпособКомпенсации, "APPROVED_50");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОтклоненаПовторно, "REJECTED_REPEATEDLY");

СтрДанных = Новый Структура;
СтрДанных.Вставить("complaintId", ЗначенияАтрибутов["id"]);
СтрДанных.Вставить("status", СоответствиеСтатусов[Инцидент.СтатусИМ]);

КА_Обмены.ОтправитьВСервис_Рефакторинг(СтрДанных, НастройкаОбмена, "ИМ2");

//Обрабатываем Пользователей  в поля инцидента по этапу 
Для Каждого Стр из Инцидент.ИсторияВыполнения Цикл
	Если ЗначениеЗаполнено(Стр.Этап) Тогда
	Если СтрНайти(Стр.Этап.Наименование,"Рекламация: Обработка инцидента") Тогда
		Инцидент.Ответственный = Стр.Исполнитель;
		Прервать;
	КонецЕсли;
	КонецЕсли;
КонецЦикла;

// Рассылка
Получатели = Новый Массив;
Вложения = Новый Соответствие;

ДокРТС = ЗначенияАтрибутов["realizationId"];
Партнер = ДокРТС.Партнер;

Адрес = УправлениеКонтактнойИнформацией.КонтактнаяИнформацияОбъекта(Партнер, Справочники.ВидыКонтактнойИнформации.EmailПартнера);
		
Если ЗначениеЗаполнено(Адрес) Тогда
	Получатели.Добавить(Новый Структура("Адрес, Представление", Адрес, Адрес));
КонецЕсли; 
	
Если Получатели.Количество() &gt; 0 Тогда

	Отправитель = Справочники.УчетныеЗаписиЭлектроннойПочты.СистемнаяУчетнаяЗаписьЭлектроннойПочты;
				
	Тема = "Обработка рекламации";
	ТекстПисьма = "Данное обращение закрыто и перенесено в Архив, т.к. вся необходимая информация не была предоставлена вовремя.";	
			
	ПараметрыПисьма = Новый Структура;
	ПараметрыПисьма.Вставить("Кому",Получатели);
	ПараметрыПисьма.Вставить("Тема", Тема);
	ПараметрыПисьма.Вставить("Тело", ТекстПисьма);
	ПараметрыПисьма.Вставить("Вложения", Вложения);
				
	Попытка
		ИдентификаторСообщения = РаботаСПочтовымиСообщениями.ОтправитьПочтовоеСообщение(Отправитель, ПараметрыПисьма);
	Исключение
		Ошибка = ОписаниеОшибки();
		Сообщить(СтрШаблон("При отправке письма произошла ошибка: %1", Ошибка));
	КонецПопытки; 
		
КонецЕсли;

// Рассылка исполнителям
Тема = СтрШаблон("Рекламация %1 завершена", Инцидент.Номер);
ТекстПисьма = "Истечение срока давности.";
Документы.КА_Инцидент.ОтправитьОповещениеИсполнителямЭтапа(СледующийЭтап, Тема, ТекстПисьма);</v8:ОбработчикПриПереходе>
			<v8:ОбработчикПриПринятииКИсполнению/>
			<v8:ОбработчикПроведения/>
			<v8:Описание>Все инциденты, находящиеся на этапах запроса решения от клиента более 30 дней, закрываются автоматически отказом. </v8:Описание>
			<v8:ПроверятьРезультат>false</v8:ПроверятьРезультат>
			<v8:СрокВыполнения>1</v8:СрокВыполнения>
			<v8:СообщениеНедоступныПереходы/>
			<v8:ОбработчикПриОткрытии/>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">27b1b5ed-427b-11e6-80c3-0cc47a6b63cf</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
		</v8:CatalogObject.КА_ЭтапыИнцидентов>
		<v8:CatalogObject.КА_ЭтапыИнцидентов>
			<v8:Ref xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">bd95854f-db3f-11ec-bbaf-00155d258b03</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Owner xsi:type="v8:CatalogRef.КА_ВидыИнцидентов">fe697b45-4e2c-11ec-bba8-00155d258b03</v8:Owner>
			<v8:Code>000000081</v8:Code>
			<v8:Description>Имитация обжалования</v8:Description>
			<v8:АвтоматическийСтартЭтапа>false</v8:АвтоматическийСтартЭтапа>
			<v8:АвтоматическоеЗавершениеЭтапа>false</v8:АвтоматическоеЗавершениеЭтапа>
			<v8:АтрибутыНедоступны>false</v8:АтрибутыНедоступны>
			<v8:АтрибутыСкрыты>false</v8:АтрибутыСкрыты>
			<v8:ЗавершающийЭтап>false</v8:ЗавершающийЭтап>
			<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">00000000-0000-0000-0000-000000000000</v8:Исполнитель>
			<v8:ОбработчикПередВыполнением/>
			<v8:ОбработчикПередЗаписью/>
			<v8:ОбработчикПослеВыполнения/>
			<v8:ОбработчикПриЗаписи/>
			<v8:ОбработчикПриПереходе/>
			<v8:ОбработчикПриПринятииКИсполнению/>
			<v8:ОбработчикПроведения/>
			<v8:Описание/>
			<v8:ПроверятьРезультат>false</v8:ПроверятьРезультат>
			<v8:СрокВыполнения>0</v8:СрокВыполнения>
			<v8:СообщениеНедоступныПереходы/>
			<v8:ОбработчикПриОткрытии/>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">27b1b5ed-427b-11e6-80c3-0cc47a6b63cf</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">2152ab22-81fe-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода/>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">353b40c4-8e59-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода/>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
		</v8:CatalogObject.КА_ЭтапыИнцидентов>
		<v8:CatalogObject.КА_ЭтапыИнцидентов>
			<v8:Ref xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">024c7839-81fe-11ec-bb9e-00155d70bd06</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Owner xsi:type="v8:CatalogRef.КА_ВидыИнцидентов">fe697b45-4e2c-11ec-bba8-00155d258b03</v8:Owner>
			<v8:Code>000000039</v8:Code>
			<v8:Description>Отказ инженера. В работе у клиента</v8:Description>
			<v8:АвтоматическийСтартЭтапа>false</v8:АвтоматическийСтартЭтапа>
			<v8:АвтоматическоеЗавершениеЭтапа>false</v8:АвтоматическоеЗавершениеЭтапа>
			<v8:АтрибутыНедоступны>false</v8:АтрибутыНедоступны>
			<v8:АтрибутыСкрыты>false</v8:АтрибутыСкрыты>
			<v8:ЗавершающийЭтап>false</v8:ЗавершающийЭтап>
			<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">00000000-0000-0000-0000-000000000000</v8:Исполнитель>
			<v8:ОбработчикПередВыполнением/>
			<v8:ОбработчикПередЗаписью>
ТаблицаАтрибутов = ЭтотОбъект.ЗначенияАтрибутов.Выгрузить();
	ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "ВозвратУтилизация"); 
	СтрИзменение = ТаблицаАтрибутов.Найти(ВыбАтрибут,"Атрибут");
	Если не ЗначениеЗаполнено(СтрИзменение) Тогда
		СтрИзменение = ТаблицаАтрибутов.Добавить();
		СтрИзменение.Атрибут = ВыбАтрибут;
	КонецЕсли;
ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "Экспертиза");
Стр = ТаблицаАтрибутов.Найти(ВыбАтрибут, "Атрибут");
Если Стр = Неопределено или Стр.Значение = Перечисления.КА_ДоставитьТоварНаЭкспертизу.Нет Тогда
	СтрИзменение.Значение = Перечисления.КА_ВозвратУтилизация.НеТребуется;
Иначе
	СтрИзменение.Значение = Перечисления.КА_ВозвратУтилизация.ОжидаетсяВозвратДетали;
КонецЕсли;
ЭтотОбъект.ЗначенияАтрибутов.Загрузить(ТаблицаАтрибутов);


Если СтатусИМ = Перечисления.КА_СтатусИМ.РекламацияЗавершенаКлиентСогласен И НЕ ДополнительныеСвойства.Свойство("ПроверкаРекурсии") Тогда
		
	ДополнительныеСвойства.Вставить("ПроверкаРекурсии", Истина);
	
	ПринятьКИсполнению();
	
	П = Новый Структура;
	П.Вставить("СледующийЭтап", Справочники.КА_ЭтапыИнцидентов.ПолучитьСсылку(Новый УникальныйИдентификатор("353b40c4-8e59-11ec-bb9e-00155d70bd06")));
	
	ВыполнитьТекущийЭтап("Автозавершение", П);	

ИначеЕсли СтатусИМ = Перечисления.КА_СтатусИМ.РекламациНаправленаВОтделКорпоративныхПродаж И НЕ ДополнительныеСвойства.Свойство("ПроверкаРекурсии") Тогда

	ДополнительныеСвойства.Вставить("ПроверкаРекурсии", Истина);
	
	ПринятьКИсполнению();
	
	П = Новый Структура;
	П.Вставить("СледующийЭтап", Справочники.КА_ЭтапыИнцидентов.ПолучитьСсылку(Новый УникальныйИдентификатор("2152ab22-81fe-11ec-bb9e-00155d70bd06")));
	
	ВыполнитьТекущийЭтап("Автозавершение", П);	
	
КонецЕсли;

</v8:ОбработчикПередЗаписью>
			<v8:ОбработчикПослеВыполнения/>
			<v8:ОбработчикПриЗаписи/>
			<v8:ОбработчикПриПереходе>Инцидент.СтатусИМ = Перечисления.КА_СтатусИМ.РекламацияОтклоненаОзнакомьтесьСЗаключением;

// Отправка статуса

НастройкаОбмена = Справочники.КА_НастройкиВыгрузкиВИМ.ПолучитьНастройку("Рекламация_СобытиеВыгрузкаСтатуса");

СоответствиеСтатусов = Новый Соответствие;
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ЗапросОтправлен, "SENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВРаботеУМенеджера, "PROCESS_BY_MANAGER");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.УточнитеДанныеОбращения, "CLARIFY_DETAILS");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВРаботеУИнженера, "PROCESS_BY_ENGINEER");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияПринятаВРаботуГарантийнымОтделом, "PROCESS_BY_WARRANTY_DEPARTMENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияПринятаУточняемСрокРассмотрения, "ACCEPTED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВозвратДеталиНаЭкспертизу, "EXPERTIZE");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОдобренаВыберитеСпособКомпенсации, "APPROVED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОтклоненаОзнакомьтесьСЗаключением, "REJECTED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ЗакрытоИПеренесеноВархивПоСрокуДавности, "CLOSED_ON_EXPIRATION");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияЗавершенаКлиентСогласен, "CLOSED_ON_AGREEMENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияЗавершенаКомпенсацияПредоставлена, "COMPENSATED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламациНаправленаВОтделКорпоративныхПродаж, "SENT_TO_SALES");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОдобрена50ВыберитеСпособКомпенсации, "APPROVED_50");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОтклоненаПовторно, "REJECTED_REPEATEDLY");

СтрДанных = Новый Структура;
СтрДанных.Вставить("complaintId", ЗначенияАтрибутов["id"]);
СтрДанных.Вставить("status", СоответствиеСтатусов[Инцидент.СтатусИМ]);

КА_Обмены.ОтправитьВСервис_Рефакторинг(СтрДанных, НастройкаОбмена, "ИМ2");

//Обрабатываем Пользователей  в поля инцидента по этапу 
Инцидент.Ответственный  = ЗначенияАтрибутов["ОтветственныйМКО"];

// Рассылка
Получатели = Новый Массив;
Вложения = Новый Соответствие;

ДокРТС = ЗначенияАтрибутов["realizationId"];
Партнер = ДокРТС.Партнер;

Адрес = УправлениеКонтактнойИнформацией.КонтактнаяИнформацияОбъекта(Партнер, Справочники.ВидыКонтактнойИнформации.EmailПартнера);
		
Если ЗначениеЗаполнено(Адрес) Тогда
	Получатели.Добавить(Новый Структура("Адрес, Представление", Адрес, Адрес));
КонецЕсли; 
	
Если Получатели.Количество() &gt; 0 Тогда

	Отправитель = Справочники.УчетныеЗаписиЭлектроннойПочты.СистемнаяУчетнаяЗаписьЭлектроннойПочты;
				
	Тема = "Обработка рекламации";
	ТекстПисьма = "Мы подробно рассмотрели Вашу рекламацию и не нашли заводских дефектов (брака).";	
			
	ПараметрыПисьма = Новый Структура;
	ПараметрыПисьма.Вставить("Кому",Получатели);
	ПараметрыПисьма.Вставить("Тема", Тема);
	ПараметрыПисьма.Вставить("Тело", ТекстПисьма);
	ПараметрыПисьма.Вставить("Вложения", Вложения);
				
	Попытка
		ИдентификаторСообщения = РаботаСПочтовымиСообщениями.ОтправитьПочтовоеСообщение(Отправитель, ПараметрыПисьма);
	Исключение
		Ошибка = ОписаниеОшибки();
		Сообщить(СтрШаблон("При отправке письма произошла ошибка: %1", Ошибка));
	КонецПопытки; 
		
КонецЕсли;</v8:ОбработчикПриПереходе>
			<v8:ОбработчикПриПринятииКИсполнению/>
			<v8:ОбработчикПроведения/>
			<v8:Описание>Клиент признаёт отказ или отправляет опротестование.

На этом этапе и далее клиент может скачать Заключение инженера в формате .pdf, которое было прикреплено к инциденту по ссылке Файлы на предидущих этапах.</v8:Описание>
			<v8:ПроверятьРезультат>true</v8:ПроверятьРезультат>
			<v8:СрокВыполнения>255</v8:СрокВыполнения>
			<v8:СообщениеНедоступныПереходы/>
			<v8:ОбработчикПриОткрытии/>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">27b1b5ed-427b-11e6-80c3-0cc47a6b63cf</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">07d158b7-54ba-11e7-80ce-001e6707aaa8</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">2152ab22-81fe-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>Если НЕ РольДоступна("ПолныеПрава") Тогда
	Отказ = Истина;
КонецЕсли;
</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">353b40c4-8e59-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>Если НЕ РольДоступна("ПолныеПрава") Тогда
	Отказ = Истина;
КонецЕсли;
</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">b512a77b-8e56-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>Если НЕ РольДоступна("ПолныеПрава") Тогда
	Отказ = Истина;
КонецЕсли;
</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">bd95854f-db3f-11ec-bbaf-00155d258b03</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода/>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">455e5227-8e55-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">1e160f11-bca1-11ec-bba2-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">f9220711-8795-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">c10475bc-8798-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">20e9e340-bc98-11ec-bbaf-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">7770acee-8e55-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">c9ae9a45-d6cc-11ec-bbaf-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">b444c315-5f3e-11ed-bba5-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
		</v8:CatalogObject.КА_ЭтапыИнцидентов>
		<v8:CatalogObject.КА_ЭтапыИнцидентов>
			<v8:Ref xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">fba5303f-81fd-11ec-bb9e-00155d70bd06</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Owner xsi:type="v8:CatalogRef.КА_ВидыИнцидентов">fe697b45-4e2c-11ec-bba8-00155d258b03</v8:Owner>
			<v8:Code>000000036</v8:Code>
			<v8:Description>Проверка главного инженера</v8:Description>
			<v8:АвтоматическийСтартЭтапа>false</v8:АвтоматическийСтартЭтапа>
			<v8:АвтоматическоеЗавершениеЭтапа>false</v8:АвтоматическоеЗавершениеЭтапа>
			<v8:АтрибутыНедоступны>false</v8:АтрибутыНедоступны>
			<v8:АтрибутыСкрыты>false</v8:АтрибутыСкрыты>
			<v8:ЗавершающийЭтап>false</v8:ЗавершающийЭтап>
			<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">00000000-0000-0000-0000-000000000000</v8:Исполнитель>
			<v8:ОбработчикПередВыполнением/>
			<v8:ОбработчикПередЗаписью>ТаблицаАтрибутов = ЭтотОбъект.ЗначенияАтрибутов.Выгрузить();
ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "РешениеИнженера");
РешИнженера = ТаблицаАтрибутов.Найти(ВыбАтрибут, "Атрибут");
ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "Экспертиза");
Эксп = ТаблицаАтрибутов.Найти(ВыбАтрибут, "Атрибут");
ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "ТоварВернуть");
ТовВер = ТаблицаАтрибутов.Найти(ВыбАтрибут, "Атрибут");

ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "ВозвратУтилизация");
ВозврУтил = ТаблицаАтрибутов.Найти(ВыбАтрибут, "Атрибут");
Если ВозврУтил = Неопределено Тогда
	ВозврУтил = ТаблицаАтрибутов.Добавить();
	ВозврУтил.Атрибут = ВыбАтрибут;
КонецЕсли;

Если (Эксп = Неопределено или Эксп.Значение = Перечисления.КА_ДоставитьТоварНаЭкспертизу.Нет) и (ТовВер = Неопределено или ТовВер.Значение = Ложь) Тогда
	ВозврУтил.Значение = Перечисления.КА_ВозвратУтилизация.НеТребуется;	
Иначе
	Если РешИнженера = Неопределено или (не РешИнженера.Значение = Перечисления.КА_РешенияИнженера.НеБракОтказ) Тогда
		ВозврУтил.Значение = Перечисления.КА_ВозвратУтилизация.НеТребуется;	
	Иначе
		Если (не РешИнженера.Значение = Перечисления.КА_РешенияИнженера.НеБракОтказ) и (не ВозврУтил.Значение = Перечисления.КА_ВозвратУтилизация.ДетальУтилизирована) Тогда
			ВозврУтил.Значение = Перечисления.КА_ВозвратУтилизация.ОжидаетсяУтилизацииДетали;	
		Иначе     	
			ВозврУтил.Значение = Перечисления.КА_ВозвратУтилизация.ОжидаетсяВозвратДетали;	
		КонецЕсли;
	КонецЕсли;
КонецЕсли; 
ЭтотОбъект.ЗначенияАтрибутов.Загрузить(ТаблицаАтрибутов);

//Обрабатываем Пользователей  в поля инцидента по этапу 
//Для Каждого Стр из Инцидент.ИсторияВыполнения Цикл
//	Если ЗначениеЗаполнено(Стр.Этап) Тогда
//	Если СтрНайти(Стр.Этап.Наименование,"В работе у Инженера.") Тогда
//		Инцидент.Ответственный = Стр.Исполнитель;
//		Прервать;
//	КонецЕсли;
//	КонецЕсли;
//КонецЦикла;
</v8:ОбработчикПередЗаписью>
			<v8:ОбработчикПослеВыполнения>УстановитьПривилегированныйРежим(Истина);

//Копирование атрибута РешениеИнженера
Для Каждого Связанный из Инцидент.СвязанныеОбъекты Цикл
	Если Связанный.Объект.Ссылка.Метаданные().Имя = "КА_Инцидент" Тогда
		ИнцидентЗапрос = Связанный.Объект.Ссылка.ПолучитьОбъект();
		НаименованиеАтрибута = "РешениеИнженера";
		ИнцидентЗапрос.УстановитьАтрибутИнцидента(НаименованиеАтрибута, ЗначенияАтрибутов[НаименованиеАтрибута]);
	КонецЕсли;
КонецЦикла;

</v8:ОбработчикПослеВыполнения>
			<v8:ОбработчикПриЗаписи/>
			<v8:ОбработчикПриПереходе>Инцидент.СтатусИМ = Перечисления.КА_СтатусИМ.РекламацияПринятаВРаботуГарантийнымОтделом;

//Обрабатываем Пользователей  в поля инцидента по этапу
Инцидент.Ответственный  = Справочники.Пользователи.НайтиПоНаименованию("Жуков");
//Инцидент.Записать();

// Отправка статуса

НастройкаОбмена = Справочники.КА_НастройкиВыгрузкиВИМ.ПолучитьНастройку("Рекламация_СобытиеВыгрузкаСтатуса");

СоответствиеСтатусов = Новый Соответствие;
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ЗапросОтправлен, "SENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВРаботеУМенеджера, "PROCESS_BY_MANAGER");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.УточнитеДанныеОбращения, "CLARIFY_DETAILS");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВРаботеУИнженера, "PROCESS_BY_ENGINEER");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияПринятаВРаботуГарантийнымОтделом, "PROCESS_BY_WARRANTY_DEPARTMENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияПринятаУточняемСрокРассмотрения, "ACCEPTED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВозвратДеталиНаЭкспертизу, "EXPERTIZE");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОдобренаВыберитеСпособКомпенсации, "APPROVED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОтклоненаОзнакомьтесьСЗаключением, "REJECTED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ЗакрытоИПеренесеноВархивПоСрокуДавности, "CLOSED_ON_EXPIRATION");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияЗавершенаКлиентСогласен, "CLOSED_ON_AGREEMENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияЗавершенаКомпенсацияПредоставлена, "COMPENSATED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламациНаправленаВОтделКорпоративныхПродаж, "SENT_TO_SALES");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОдобрена50ВыберитеСпособКомпенсации, "APPROVED_50");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОтклоненаПовторно, "REJECTED_REPEATEDLY");

СтрДанных = Новый Структура;
СтрДанных.Вставить("complaintId", ЗначенияАтрибутов["id"]);
СтрДанных.Вставить("status", СоответствиеСтатусов[Инцидент.СтатусИМ]);

КА_Обмены.ОтправитьВСервис_Рефакторинг(СтрДанных, НастройкаОбмена, "ИМ2");

// Рассылка исполнителям
Тема = СтрШаблон("Обновлен статус рекламации %1", Инцидент.Номер);
ТекстПисьма = СледующийЭтап.Описание;
Документы.КА_Инцидент.ОтправитьОповещениеИсполнителямЭтапа(СледующийЭтап, Тема, ТекстПисьма);</v8:ОбработчикПриПереходе>
			<v8:ОбработчикПриПринятииКИсполнению>УстановитьПривилегированныйРежим(Истина);

//Копирование атрибута РешениеИнженера
Для Каждого Связанный из Инцидент.СвязанныеОбъекты Цикл
	Если Связанный.Объект.Ссылка.Метаданные().Имя = "КА_Инцидент" Тогда
		ИнцидентЗапрос = Связанный.Объект.Ссылка.ПолучитьОбъект();
		НаименованиеАтрибута = "РешениеИнженера";
		ИнцидентЗапрос.УстановитьАтрибутИнцидента(НаименованиеАтрибута, ЗначенияАтрибутов[НаименованиеАтрибута]);
	КонецЕсли;
КонецЦикла;
</v8:ОбработчикПриПринятииКИсполнению>
			<v8:ОбработчикПроведения/>
			<v8:Описание>Инцидент попадает на проверку Главному инженеру, если инженер не нашёл признаков брака. 

Главный инженер изучает материалы и заключение инженера и либо подтверждает отсутствие брака, либо изменяет решение. 

При изменении решения на вкладке Дополнительно необходимо перевыбрать пункт «Брак, компенсация».

При подтверждении решения обязательно проверяется приложение документа в формате .pdf, начинающийся со слов "Заключение инженера".

После проверки нажимаем кнопку «Выполнить» на вкладке «Основное» и инцидент автоматически перейдёт на нужный этап.
</v8:Описание>
			<v8:ПроверятьРезультат>true</v8:ПроверятьРезультат>
			<v8:СрокВыполнения>2</v8:СрокВыполнения>
			<v8:СообщениеНедоступныПереходы/>
			<v8:ОбработчикПриОткрытии/>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">06509fbe-a8c9-11e2-bca0-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">5fe94a47-f3ca-11e8-80d4-3cfdfeaf9019</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">07d158b7-54ba-11e7-80ce-001e6707aaa8</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">024c7839-81fe-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>Если НЕ РольДоступна("ПолныеПрава") Тогда
	Если ЗначенияАтрибутов["РешениеИнженера"] &lt;&gt; Перечисления.КА_РешенияИнженера.НеБракОтказ Тогда
		Отказ = Истина;
	КонецЕсли;
КонецЕсли;

//НайденаЗаявка = Ложь;
//Для каждого ТекСтр из Инцидент.СвязанныеОбъекты Цикл
//	Если ТекСтр.Объект.Ссылка.Метаданные().Имя = "ЗаявкаНаВозвратТоваровОтКлиента" Тогда
//		НайденаЗаявка = (Истина И ТекСтр.Объект.Проведен) или Отказ;
//	КонецЕсли;
//КонецЦикла;
//Отказ = не НайденаЗаявка;
//Если Отказ Тогда
//	Сообщить("Для завершения этапа убедитесь, что документ Зявка на возват товаров от клиента создан и проведен или корректно указано Решение Инженера");
//КонецЕсли;
</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">fba53040-81fd-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>true</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>Если НЕ РольДоступна("ПолныеПрава") Тогда
	Если (ЗначенияАтрибутов["РешениеИнженера"] = Перечисления.КА_РешенияИнженера.БракКомпенсация 
		ИЛИ ЗначенияАтрибутов["РешениеИнженера"] = Перечисления.КА_РешенияИнженера.НеизвестноКомпенсация)
		И ЗначенияАтрибутов["ТоварВернуть"] &lt;&gt; Истина Тогда
		// Все ок
	Иначе	
		Отказ = Истина;
	КонецЕсли;
КонецЕсли;

//НайденаЗаявка = Ложь;
//	Для каждого ТекСтр из Инцидент.СвязанныеОбъекты Цикл
//		Если ТекСтр.Объект.Ссылка.Метаданные().Имя = "ЗаявкаНаВозвратТоваровОтКлиента" Тогда
//			НайденаЗаявка = (Истина И ТекСтр.Объект.Проведен) или Отказ;
//		КонецЕсли;
//	КонецЦикла;
//Отказ = не НайденаЗаявка;
//Если Отказ Тогда
//	Сообщить("Для завершения этапа убедитесь, что документ Зявка на возват товаров от клиента создан и проведен или корректно указано Решение Инженера");
//КонецЕсли;
</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">024c7838-81fe-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>true</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>Если НЕ РольДоступна("ПолныеПрава") Тогда
	Если (ЗначенияАтрибутов["РешениеИнженера"] = Перечисления.КА_РешенияИнженера.БракКомпенсация 
		ИЛИ ЗначенияАтрибутов["РешениеИнженера"] = Перечисления.КА_РешенияИнженера.НеизвестноКомпенсация)
		И ЗначенияАтрибутов["ТоварВернуть"] = Истина Тогда
		// Все ок
	Иначе	
		Отказ = Истина;
	КонецЕсли;
КонецЕсли;

//НайденаЗаявка = Ложь;
//	Для каждого ТекСтр из Инцидент.СвязанныеОбъекты Цикл
//		Если ТекСтр.Объект.Ссылка.Метаданные().Имя = "ЗаявкаНаВозвратТоваровОтКлиента" Тогда
//			НайденаЗаявка = (Истина И ТекСтр.Объект.Проведен) или Отказ;
//		КонецЕсли;
//	КонецЦикла;
//Отказ = не НайденаЗаявка;
//Если Отказ Тогда
//	Сообщить("Для завершения этапа убедитесь, что документ Зявка на возват товаров от клиента создан и проведен или корректно указано Решение Инженера");
//КонецЕсли;
</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">f9220711-8795-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">7770acee-8e55-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">ae2bfd6f-8798-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">c10475bc-8798-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">28c3acd3-ba33-11ec-bba2-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>true</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">20e9e340-bc98-11ec-bbaf-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">e983c36e-bc97-11ec-bbaf-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">578c447d-b974-11ec-bba2-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">1e160f11-bca1-11ec-bba2-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">455e5227-8e55-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">f6327d2c-d1c5-11ec-bbaf-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">b444c315-5f3e-11ed-bba5-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
		</v8:CatalogObject.КА_ЭтапыИнцидентов>
		<v8:CatalogObject.КА_ЭтапыИнцидентов>
			<v8:Ref xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">f3ae00ab-81fd-11ec-bb9e-00155d70bd06</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Owner xsi:type="v8:CatalogRef.КА_ВидыИнцидентов">fe697b45-4e2c-11ec-bba8-00155d258b03</v8:Owner>
			<v8:Code>000000034</v8:Code>
			<v8:Description>Возврат детали на экспертизу. Решение по экспертиз</v8:Description>
			<v8:АвтоматическийСтартЭтапа>false</v8:АвтоматическийСтартЭтапа>
			<v8:АвтоматическоеЗавершениеЭтапа>false</v8:АвтоматическоеЗавершениеЭтапа>
			<v8:АтрибутыНедоступны>false</v8:АтрибутыНедоступны>
			<v8:АтрибутыСкрыты>false</v8:АтрибутыСкрыты>
			<v8:ЗавершающийЭтап>false</v8:ЗавершающийЭтап>
			<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">00000000-0000-0000-0000-000000000000</v8:Исполнитель>
			<v8:ОбработчикПередВыполнением/>
			<v8:ОбработчикПередЗаписью>ТаблицаАтрибутов = ЭтотОбъект.ЗначенияАтрибутов.Выгрузить();
ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "РешениеЭкспертизы");
Стр = ТаблицаАтрибутов.Найти(ВыбАтрибут, "Атрибут");
СтрЭкспетриза = ТаблицаАтрибутов.Найти(ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "Экспертиза"), "Атрибут");
Если СтрЭкспетриза = Неопределено или СтрЭкспетриза.Значение = Перечисления.КА_ДоставитьТоварНаЭкспертизу.Нет Тогда
		ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "ВозвратУтилизация"); 
		СтрИзменение = ТаблицаАтрибутов.Найти(ВыбАтрибут,"Атрибут");
		Если не ЗначениеЗаполнено(СтрИзменение) Тогда
			СтрИзменение = ТаблицаАтрибутов.Добавить();
			СтрИзменение.Атрибут = ВыбАтрибут;
		КонецЕсли;
		Если Стр.Значение = Перечисления.КА_РешениеЭкспертизы.НеБрак Тогда
			СтрИзменение.Значение = Перечисления.КА_ВозвратУтилизация.ОжидаетсяВозвратДетали;
		Иначе
			СтрИзменение.Значение = Перечисления.КА_ВозвратУтилизация.ОжидаетсяУтилизацииДетали;
		КонецЕсли; 
Иначе //строка 17
		ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "ВозвратУтилизация"); 
		СтрИзменение = ТаблицаАтрибутов.Найти(ВыбАтрибут,"Атрибут");
		Если не ЗначениеЗаполнено(СтрИзменение) Тогда
			СтрИзменение = ТаблицаАтрибутов.Добавить();
			СтрИзменение.Атрибут = ВыбАтрибут;
		КонецЕсли;
		Если Стр.Значение = Перечисления.КА_РешениеЭкспертизы.НеБрак Тогда
			СтрИзменение.Значение = Перечисления.КА_ВозвратУтилизация.ОжидаетсяВозвратДетали;
		ИначеЕсли Стр.Значение = Перечисления.КА_РешениеЭкспертизы.Брак Тогда
			СтрИзменение.Значение = Перечисления.КА_ВозвратУтилизация.ОжидаетсяУтилизацииДетали;
		КонецЕсли; 
КонецЕсли;
ЭтотОбъект.ЗначенияАтрибутов.Загрузить(ТаблицаАтрибутов);
</v8:ОбработчикПередЗаписью>
			<v8:ОбработчикПослеВыполнения/>
			<v8:ОбработчикПриЗаписи/>
			<v8:ОбработчикПриПереходе>Инцидент.СтатусИМ = Перечисления.КА_СтатусИМ.ВозвратДеталиНаЭкспертизу;

//Лупонос Д.В. возвращаем Ответственного - из этапа про инженера
ТаблицаИстории = Инцидент.ИсторияВыполнения.Выгрузить();
ТаблицаИстории.Сортировать("ДатаЗавершения УБЫВ");

Для Каждого Стр из ТаблицаИстории Цикл
	Если ЗначениеЗаполнено(Стр.Этап) Тогда
	Если СтрНайти(Стр.Этап.Наименование,"В работе у Инженера.") Тогда
		Инцидент.Ответственный = Стр.Исполнитель;
		Инцидент.Записать();
		Прервать;
	КонецЕсли;
	КонецЕсли;
КонецЦикла;

// Отправка статуса

НастройкаОбмена = Справочники.КА_НастройкиВыгрузкиВИМ.ПолучитьНастройку("Рекламация_СобытиеВыгрузкаСтатуса");

СоответствиеСтатусов = Новый Соответствие;
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ЗапросОтправлен, "SENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВРаботеУМенеджера, "PROCESS_BY_MANAGER");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.УточнитеДанныеОбращения, "CLARIFY_DETAILS");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВРаботеУИнженера, "PROCESS_BY_ENGINEER");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияПринятаВРаботуГарантийнымОтделом, "PROCESS_BY_WARRANTY_DEPARTMENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияПринятаУточняемСрокРассмотрения, "ACCEPTED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВозвратДеталиНаЭкспертизу, "EXPERTIZE");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОдобренаВыберитеСпособКомпенсации, "APPROVED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОтклоненаОзнакомьтесьСЗаключением, "REJECTED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ЗакрытоИПеренесеноВархивПоСрокуДавности, "CLOSED_ON_EXPIRATION");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияЗавершенаКлиентСогласен, "CLOSED_ON_AGREEMENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияЗавершенаКомпенсацияПредоставлена, "COMPENSATED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламациНаправленаВОтделКорпоративныхПродаж, "SENT_TO_SALES");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОдобрена50ВыберитеСпособКомпенсации, "APPROVED_50");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОтклоненаПовторно, "REJECTED_REPEATEDLY");

СтрДанных = Новый Структура;
СтрДанных.Вставить("complaintId", ЗначенияАтрибутов["id"]);
СтрДанных.Вставить("status", СоответствиеСтатусов[Инцидент.СтатусИМ]);

//Пинчук М.Н. 09.11.2022

СтрДанных.Вставить("ДополнитьДанныеВручную", Ложь);


КА_Обмены.ОтправитьВСервис_Рефакторинг(СтрДанных, НастройкаОбмена, "ИМ2");

// Рассылка исполнителям
Тема = СтрШаблон("Обновлен статус рекламации %1", Инцидент.Номер);
ТекстПисьма = "Инженер получает инцидент на проверку. Проводит экспертизу. Принимает решение.";
Документы.КА_Инцидент.ОтправитьОповещениеИсполнителямЭтапа(СледующийЭтап, Тема, ТекстПисьма);</v8:ОбработчикПриПереходе>
			<v8:ОбработчикПриПринятииКИсполнению>//Пинчук М.Н. 09.11.2022
АтрибутСсылка = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор","ДополнитьДанныеВручную");
    
  НС = Инцидент.ЗначенияАтрибутов.НайтиСтроки(Новый Структура("Атрибут",АтрибутСсылка));
  Для каждого ТекАтр из НС Цикл
    Инцидент.ЗначенияАтрибутов.Удалить(ТекАтр);      
  КонецЦикла;
  НовАтр = Инцидент.ЗначенияАтрибутов.Добавить();  
  НовАтр.Атрибут = АтрибутСсылка;
  НовАтр.Значение = Неопределено;
</v8:ОбработчикПриПринятииКИсполнению>
			<v8:ОбработчикПроведения/>
			<v8:Описание>Инженер осматривает деталь, проводит необходимые манипуляции для принятия решения по экспертизе.

Решение необходимо заполнить в атрибутах «Решение по экспертизе» и «Решение инженера» на вкладке Дополнительно:
 
Если после рассмотрения понятно, что у детали – брак, то выбираются пункты «Брак» и «Брак, компенсация» соответственно.

Если после рассмотрения понятно, что у детали – не брак, то выбираются пункты «Не брак» и «Не брак, отказ» соответственно. При отказе обязательно приложить к документу Инцидент по ссылке «Файлы» документ в формате .pdf. Наименование документа должно начинаться со слов "Заключение инженера". Каждый отказ будет проходит проверку у Главного инженера.

Оставлять решение "Запросить срочно" недопстимо.

Все решения необходимо записать по кнопке «Записать» в шапке документа:
 
Переходы с этого этапа заблокированы до тех пор, пока не будет заполнено решение по экспертизе.

После создания документа и заполнения атрибутов нажимаем кнопку «Выполнить» на вкладке «Основное» и инцидент автоматически перейдёт на нужный этап.


</v8:Описание>
			<v8:ПроверятьРезультат>true</v8:ПроверятьРезультат>
			<v8:СрокВыполнения>9</v8:СрокВыполнения>
			<v8:СообщениеНедоступныПереходы/>
			<v8:ОбработчикПриОткрытии/>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">06509fbe-a8c9-11e2-bca0-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">5fe94a47-f3ca-11e8-80d4-3cfdfeaf9019</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">9514bbf0-4093-426e-a611-7f991186491c</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">3066ae6a-9659-4e7d-a45f-557d5426b02e</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">2240a7f1-b122-4059-af3e-2b26895c805d</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">408f3bee-cea7-4a35-ab09-ade297d74fe3</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">7dfb237c-c4ed-4048-9fd3-71b19e087798</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">8deae651-a246-408f-af9e-589cf73f953f</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">fba5303f-81fd-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>Если НЕ РольДоступна("ПолныеПрава") Тогда
	Если ЗначенияАтрибутов["РешениеИнженера"] &lt;&gt; Перечисления.КА_РешенияИнженера.НеБракОтказ 
	ИЛИ ЗначенияАтрибутов["ДополнитьДанныеВручную"] = Истина 
		Тогда
		Отказ = Истина;
	КонецЕсли;

//Если НЕ Отказ Тогда

//	НайденаЗаявка = Ложь;
//		Для каждого ТекСтр из Инцидент.СвязанныеОбъекты Цикл
//			Если ТекСтр.Объект.Ссылка.Метаданные().Имя = "ЗаявкаНаВозвратТоваровОтКлиента" Тогда
//				НайденаЗаявка = (Истина И ТекСтр.Объект.Проведен) или Отказ;
//			КонецЕсли;
//		КонецЦикла;
//	Отказ = не НайденаЗаявка;
//	Если Отказ Тогда
//		Сообщить("Для завершения этапа убедитесь, что документ Зявка на возват товаров от клиента создан и проведен или корректно указано Решение Инженера");
//	КонецЕсли;

КонецЕсли;</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">fba53040-81fd-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>Если НЕ РольДоступна("ПолныеПрава") Тогда
	Если ЗначенияАтрибутов["РешениеИнженера"] &lt;&gt; Перечисления.КА_РешенияИнженера.БракКомпенсация 
		И ЗначенияАтрибутов["РешениеИнженера"] &lt;&gt; Перечисления.КА_РешенияИнженера.НеизвестноКомпенсация
		ИЛИ ЗначенияАтрибутов["ДополнитьДанныеВручную"] = Истина
		Тогда
		Отказ = Истина;
	КонецЕсли;

	УсловиеПроверки = Инцидент.Товары[0].Клиент.КА_Экспорт = Истина;

	Если УсловиеПроверки Тогда
		Отказ = Истина;


КонецЕсли;
	
КонецЕсли;

Если НЕ Отказ Тогда

	НайденаЗаявка = Ложь;
		Для каждого ТекСтр из Инцидент.СвязанныеОбъекты Цикл
			Если ТекСтр.Объект.Ссылка.Метаданные().Имя = "ЗаявкаНаВозвратТоваровОтКлиента" Тогда
				НайденаЗаявка = (Истина И ТекСтр.Объект.Проведен) или Отказ;
			КонецЕсли;
		КонецЦикла;
	Отказ = не НайденаЗаявка;
	Если Отказ Тогда
		Сообщить("Для завершения этапа убедитесь, что документ Зявка на возват товаров от клиента создан и проведен или корректно указано Решение Инженера");
	КонецЕсли;

КонецЕсли;</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">d912235d-81fd-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>Если НЕ РольДоступна("ПолныеПрава") Тогда
	Если ЗначенияАтрибутов["ДополнитьДанныеВручную"] &lt;&gt; Истина 
		Тогда
		Отказ = Истина;
	КонецЕсли;
КонецЕсли;
</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">046ca2f2-7abf-11ed-bbb3-00155d258b03</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода/>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">d912235c-81fd-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода/>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:Команды>
				<v8:Заголовок>Оформить Заявку на возврат</v8:Заголовок>
				<v8:УИ>2ae3108d-a823-4f4a-8068-caffe4442b24</v8:УИ>
				<v8:ОбработчикКлиентПеред/>
				<v8:ОбработчикСервер>СпкДатаНачалаУчетаПослеСвертки = КА_СлужебныеПараметры.ПолучитьЗначение(ПланыВидовХарактеристик.КА_СлужебныеПараметры.ДатаНачалаУчетаПослеСверткиБазы); 
ДатаНУПС = СпкДатаНачалаУчетаПослеСвертки.Получить(0); 

ДатаДень = Число(Сред(ДатаНУПС,1,2));
ДатаМесяц= Число(Сред(ДатаНУПС,4,2));
ДатаГод  = Число(Сред(ДатаНУПС,7,4));
ДатаНУПС = (Дата(ДатаГод, ДатаМесяц, ДатаДень));

ЗаявкаНаВозврат = Документы.ЗаявкаНаВозвратТоваровОтКлиента.ПустаяСсылка();
ДокРТС = Документы.РеализацияТоваровУслуг.ПустаяСсылка();

Для каждого ТекСтр из Объект.СвязанныеОбъекты Цикл
	Если ТекСтр.Объект.Ссылка.Метаданные().Имя = "ЗаявкаНаВозвратТоваровОтКлиента" Тогда
		ЗаявкаНаВозврат = ТекСтр.Объект.Ссылка;
	ИначеЕсли ТекСтр.Объект.Ссылка.Метаданные().Имя = "РеализацияТоваровУслуг" Тогда 
		ДокРТС = ТекСтр.Объект.Ссылка;
	КонецЕсли;
КонецЦикла;
//Стр 19 
ТаблицаТоваров = Объект.Товары.Выгрузить();
ТаблицаТоваров.Колонки.Добавить("ДокументРеализации");
ТаблицаТоваров.Колонки.Добавить("КА_ЗаказКлиента");
ИнцидентОбъект = РеквизитФормыВЗначение("Объект");
СпособОформленияВозврата = ИнцидентОбъект.ПолучитьАтрибутИнцидента("СпособОформленияВозврата");
Если не ЗначениеЗаполнено(СпособОформленияВозврата) Тогда
	СпособОформленияВозврата = Перечисления.КА_СпособыОформленияВозврата.ВозвратныеДокументы;
КонецЕсли; 

ВидОформленияВозвратныхДокументов = ИнцидентОбъект.ПолучитьАтрибутИнцидента("ВидОформленияДокументов");
Если СпособОформленияВозврата = Перечисления.КА_СпособыОформленияВозврата.ВозвратныеДокументы и не ЗначениеЗаполнено(ВидОформленияВозвратныхДокументов) Тогда 
	ВидОформленияВозвратныхДокументов = Перечисления.КА_ВидыОформленияВозвратныхДокументов.ОбратнаяПродажаПолученаСфОтПокупателя;
КонецЕсли;  
 
Для каждого ТекСтр из ТаблицаТоваров Цикл
	ТекСтр.КоличествоУпаковок = ТекСтр.Количество;
	ТекСтр.ДокументРеализации = ДокРТС;
	ТекСтр.КА_ЗаказКлиента = ДокРТС.ЗаказКлиента;
КонецЦикла;
//Стр 31

Если не (ЗаявкаНаВозврат =  Документы.ЗаявкаНаВозвратТоваровОтКлиента.ПустаяСсылка()) Тогда
//	Сообщить(Строка(ЗаявкаНаВозврат) + " уже сформирована в документе"); 	
ИначеЕсли ЗаявкаНаВозврат =  Документы.ЗаявкаНаВозвратТоваровОтКлиента.ПустаяСсылка() и не (ДокРТС = Документы.РеализацияТоваровУслуг.ПустаяСсылка())Тогда
	ЗаявкаНаВозврат = Документы.ЗаявкаНаВозвратТоваровОтКлиента.СоздатьДокумент();
	ЗаявкаНаВозврат.Дата = ТекущаяДата();
//	В связи с проблематикой непровденных РТУ ветвление заполнения ЗВТК на основании РТУ  05.10.2022 Лупонос Д.В.
	Если ДатаНУПС &lt; ДокРтс.Дата Тогда
		ЗаявкаНаВозврат.Заполнить(ДокРТС.Ссылка);
	ИначеЕсли не ДокРТС.Проведен Тогда 
		ЗаполнитьЗначенияСвойств(ЗаявкаНаВозврат, ДокРТС.Ссылка,,"Дата,Номер");
//		ЗаявкаНаВозврат.Дата = ТекущаяДата();
		ЗаявкаНаВозврат.Номер = ""; 
		ЗаявкаНаВозврат.Организация = ДокРТС.Организация; 
		ЗаявкаНаВозврат.Договор = ДокРТС.Договор; 
		ЗаявкаНаВозврат.Валюта = ДокРТС.Валюта; 
		ЗаявкаНаВозврат.Партнер = ДокРТС.Партнер; 
		ЗаявкаНаВозврат.Склад = ДокРТС.Склад; 
		ЗаявкаНаВозврат.Контрагент = ДокРТС.Контрагент; 
		ЗаявкаНаВозврат.Соглашение = ДокРТС.Соглашение; 
	КонецЕсли; 
//	В связи с проблематикой непровденных РТУ ветвление заполнения ЗВТК на основании РТУ  05.10.2022 Лупонос Д.В.
	ЗаявкаНаВозврат.Приоритет = Справочники.Приоритеты.НайтиПоНаименованию("Средний"); 
	ЗаявкаНаВозврат.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.ВозвратТоваровОтКлиента;
	ЗаявкаНаВозврат.Менеджер = ИнцидентОбъект.ПолучитьАтрибутИнцидента("ОтветственныйМКО");
	ЗаявкаНаВозврат.Подразделение = ЗаявкаНаВозврат.Менеджер.Подразделение; 
	ЗаявкаНаВозврат.КА_СпособДоставкиОтКлиента = Перечисления.СпособыДоставки.ДоКлиента;
	ЗаявкаНаВозврат.Комментарий = Строка(Объект.Ссылка);
		
	ЗаявкаНаВозврат.КА_Причина=Справочники.ПричиныВозникновенияПретензий.НайтиПоНаименованию("Брак").Ссылка;
	ЗаявкаНаВозврат.КА_АналитикаПричинБрака = Справочники.КА_АналитикаПричинБрака.НайтиПоНаименованию("Компенсация брака").Ссылка;
//	ЗаявкаНаВозврат.КА_Фиктивный=Истина;//ИнцидентОбъект.ПолучитьАтрибутИнцидента("Товар вернуть");
//	
	ЗаявкаНаВозврат.КА_СпособОформленияВозврата = СпособОформленияВозврата;
	ЗаявкаНаВозврат.КА_ВидОформленияВозвратныхДокументов = ВидОформленияВозвратныхДокументов;
	ЗаявкаНаВозврат.ДокументРеализации = ДокРТС.Ссылка;
	ЗаявкаНаВозврат.КА_Инцидент = Объект.Ссылка;
	ЗаявкаНаВозврат.ВозвращаемыеТовары.Загрузить(ТаблицаТоваров);

	ЭкспертизаТут = ИнцидентОбъект.ПолучитьАтрибутИнцидента("Экспертиза");
	Если ЭкспертизаТут = Перечисления.КА_ДоставитьТоварНаЭкспертизу.Да Тогда
		ЗаявкаНаВозврат.КА_ДоставитьТоварНаЭкспертизу = Истина;
	Иначе
		ЗаявкаНаВозврат.КА_ДоставитьТоварНаЭкспертизу = Ложь;
	КонецЕсли;
	
	ЗаявкаНаВозврат.КА_Причина=Справочники.ПричиныВозникновенияПретензий.НайтиПоНаименованию("Брак").Ссылка;
	ЗаявкаНаВозврат.КА_АналитикаПричинБрака = Справочники.КА_АналитикаПричинБрака.НайтиПоНаименованию("Компенсация брака").Ссылка;

	ЭкспертизаТут = ИнцидентОбъект.ПолучитьАтрибутИнцидента("Экспертиза");
	Если ЭкспертизаТут = Перечисления.КА_ДоставитьТоварНаЭкспертизу.Да Тогда
		ЗаявкаНаВозврат.КА_ДоставитьТоварНаЭкспертизу = Истина;
	Иначе
		ЗаявкаНаВозврат.КА_ДоставитьТоварНаЭкспертизу = Ложь;
	КонецЕсли;

//	В связи с проблематикой непровденных РТУ для корректного проведения установим признак КА_Проверено в каждой строке ТЧ ЗВТК 05.10.2022 Лупонос Д.В.
	Сч = 1;
	Если не ДокРТС.Проведен и ДатаНУПС &gt; ДокРтс.Дата Тогда 	
		ТаблицаТоваров = ЗаявкаНаВозврат.ВозвращаемыеТовары.Выгрузить();
		Для Каждого Стр из ТаблицаТоваров Цикл
			Стр.КА_Проверено = Истина;
//			Стр.КодСтроки = Сч; 
//			Сч = Сч + 1; 
		КонецЦикла;
		ЗаявкаНаВозврат.ВозвращаемыеТовары.Загрузить(ТаблицаТоваров);
	КонецЕсли; 
//	В связи с проблематикой непровденных РТУ для корректного проведения установим признак КА_Проверено в каждой строке ТЧ ЗВТК 05.10.2022 Лупонос Д.В.

	Попытка 
		ЗаявкаНаВозврат.Записать();
	Исключение
		ЗаявкаНаВозврат.Записать(Ложь);
	КонецПопытки; 
	СвязатьСОбъектомИзФормыНаСервере(ЗаявкаНаВозврат.Ссылка);
	ТаблицаАтрибутовДокумента = Объект.ЗначенияАтрибутов.Выгрузить();
	АтрибутИнцидента=ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоНаименованию("ЗаявкаНаВозврат");
	ТаблицаАтрибутовДокумента = Объект.ЗначенияАтрибутов.Выгрузить();
	СтрокаИзм = ТаблицаАтрибутовДокумента.Найти(АтрибутИнцидента,"Атрибут");
	Если СтрокаИзм = Неопределено Тогда
		СтрокаИзм = ТаблицаАтрибутовДокумента.Добавить();
		СтрокаИзм.Атрибут = АтрибутИнцидента;
	КонецЕсли;
	СтрокаИзм.Значение = ЗаявкаНаВозврат.Ссылка;
	Объект.ЗначенияАтрибутов.Загрузить(ТаблицаАтрибутовДокумента);
КонецЕсли;
</v8:ОбработчикСервер>
				<v8:ОбработчикКлиентПосле>ЗаявкаНаВозврат = Неопределено;
Для каждого ТекСтр из Объект.СвязанныеОбъекты Цикл
	Если СтрНайти(Строка(ТекСтр.Объект), "Заявка на возврат товаров от клиента") Тогда
		ЗаявкаНаВозврат = ТекСтр.Объект;
	КонецЕсли;
КонецЦикла;

Если не ЗаявкаНаВозврат=Неопределено тогда
	ОткрытьФорму("Документ.ЗаявкаНаВозвратТоваровОтКлиента.ФормаОбъекта", новый Структура("Ключ",ЗаявкаНаВозврат));
КонецЕсли;</v8:ОбработчикКлиентПосле>
			</v8:Команды>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">f9220711-8795-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">7770acee-8e55-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">ae2bfd6f-8798-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">c10475bc-8798-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">579bcceb-8e55-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">28c3acd3-ba33-11ec-bba2-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">20e9e340-bc98-11ec-bbaf-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">e983c36e-bc97-11ec-bbaf-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">578c447d-b974-11ec-bba2-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">1e160f11-bca1-11ec-bba2-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
		</v8:CatalogObject.КА_ЭтапыИнцидентов>
		<v8:CatalogObject.КА_ЭтапыИнцидентов>
			<v8:Ref xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">eab3acfc-81fd-11ec-bb9e-00155d70bd06</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Owner xsi:type="v8:CatalogRef.КА_ВидыИнцидентов">fe697b45-4e2c-11ec-bba8-00155d258b03</v8:Owner>
			<v8:Code>000000033</v8:Code>
			<v8:Description>Возврат детали на экспертизу. Ожидание доставки</v8:Description>
			<v8:АвтоматическийСтартЭтапа>false</v8:АвтоматическийСтартЭтапа>
			<v8:АвтоматическоеЗавершениеЭтапа>false</v8:АвтоматическоеЗавершениеЭтапа>
			<v8:АтрибутыНедоступны>false</v8:АтрибутыНедоступны>
			<v8:АтрибутыСкрыты>false</v8:АтрибутыСкрыты>
			<v8:ЗавершающийЭтап>false</v8:ЗавершающийЭтап>
			<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">00000000-0000-0000-0000-000000000000</v8:Исполнитель>
			<v8:ОбработчикПередВыполнением/>
			<v8:ОбработчикПередЗаписью>УстановитьПривилегированныйРежим(Истина);

ТаблицаАтрибутов = ЭтотОбъект.ЗначенияАтрибутов.Выгрузить();
ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "Экспертиза");
Стр = ТаблицаАтрибутов.Найти(ВыбАтрибут, "Атрибут");
Если не (Стр=Неопределено) Тогда
	ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "ВозвратУтилизация");
	ИзмСтр = ТаблицаАтрибутов.Найти(ВыбАтрибут, "Атрибут");
	Если ИзмСтр = Неопределено Тогда
		ИзмСтр = ТаблицаАтрибутов.Добавить();
		ИзмСтр.Атрибут = ВыбАтрибут;
	КонецЕсли;
	Если Стр.Значение = Перечисления.КА_ДоставитьТоварНаЭкспертизу.Да Тогда
		ИзмСтр.Значение = Перечисления.КА_ВозвратУтилизация.ОжидаетсяВозвратДетали;
	Иначе
		ИзмСтр.Значение = Перечисления.КА_ВозвратУтилизация.НеТребуется;
	КонецЕсли;
Иначе
	ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "ВозвратУтилизация");
	ИзмСтр = ТаблицаАтрибутов.Найти(ВыбАтрибут, "Атрибут");
	Если ИзмСтр = Неопределено Тогда
		ИзмСтр = ТаблицаАтрибутов.Добавить();
		ИзмСтр.Атрибут = ВыбАтрибут;
	КонецЕсли;
	ИзмСтр.Значение = Перечисления.КА_ВозвратУтилизация.НеТребуется;
КонецЕсли;

ЭтотОбъект.ЗначенияАтрибутов.Загрузить(ТаблицаАтрибутов);

ИнцидентЗапрос = Неопределено;
ЗаявкаНаВозврат = ЭтотОбъект.ПолучитьАтрибутИнцидента("ЗаявкаНаВозврат");
Для Каждого Стр из ЭтотОбъект.СвязанныеОбъекты Цикл
	Если СтрНайти(Строка(Стр.Объект), "запрос поставщику") Тогда
		ИнцидентЗапрос = Стр.Объект.ПолучитьОбъект();
		ТаблицаСвязанных = ИнцидентЗапрос.СвязанныеОбъекты.Выгрузить();
		ЗаявкаНаВозвратЗапрос = ТаблицаСвязанных.Найти(ЗаявкаНаВозврат, "Объект"); 
		Если ЗаявкаНаВозвратЗапрос = Неопределено Тогда
			НовСтр = ТаблицаСвязанных.Добавить();
			НовСтр.Объект = ЗаявкаНаВозврат;
			ИнцидентЗапрос.СвязанныеОбъекты.Загрузить(ТаблицаСвязанных);
		КонецЕсли;
		ТаблицаАтрибутов = ИнцидентЗапрос.ЗначенияАтрибутов.Выгрузить();
		ЕстьАтрибут = ТаблицаАтрибутов.Найти(ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоНаименованию("ЗаявкаНаВозврат"), "Атрибут");
		Если ЕстьАтрибут = Неопределено Тогда
			ЕстьЗначение = ТаблицаАтрибутов.Найти(ЗаявкаНаВозвратЗапрос, "Значение");
			Если не ЕстьЗначение = Неопределено Тогда
				НовСтр = ТаблицаАтрибутов.Добавить();
				НовСтр.Атрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоНаименованию("ЗаявкаНаВозврат");
				НовСтр.Значение = ЗаявкаНаВозврат;
				ИнцидентЗапрос.ЗначенияАтрибутов.Загрузить(ТаблицаАтрибутов);
				ИнцидентЗапрос.Записать();
			Иначе
				ЕстьЗначение.Атрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоНаименованию("ЗаявкаНаВозврат");
				ИнцидентЗапрос.ЗначенияАтрибутов.Загрузить(ТаблицаАтрибутов);
				ИнцидентЗапрос.Записать();
			КонецЕсли;
		Иначе
			ЕстьАтрибут.Значение = ЗаявкаНаВозврат;
			ИнцидентЗапрос.ЗначенияАтрибутов.Загрузить(ТаблицаАтрибутов);
			ИнцидентЗапрос.Записать();
		КонецЕсли;
		Прервать;
	КонецЕсли;
КонецЦикла;

ТаблицаАтрибутов = ЭтотОбъект.ЗначенияАтрибутов.Выгрузить();
ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "ВозвратУтилизация"); 
СтрИзменение = ТаблицаАтрибутов.Найти(ВыбАтрибут,"Атрибут");
Если не ЗначениеЗаполнено(СтрИзменение) Тогда
	СтрИзменение = ТаблицаАтрибутов.Добавить();
	СтрИзменение.Атрибут = ВыбАтрибут;
КонецЕсли;
ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "Экспертиза");
Стр = ТаблицаАтрибутов.Найти(ВыбАтрибут, "Атрибут");
Если Стр = Неопределено или Стр.Значение = Перечисления.КА_ДоставитьТоварНаЭкспертизу.Нет Тогда
	СтрИзменение.Значение = Перечисления.КА_ВозвратУтилизация.НеТребуется;
Иначе
	СтрИзменение.Значение = Перечисления.КА_ВозвратУтилизация.ОжидаетсяВозвратДетали;
КонецЕсли;
ЭтотОбъект.ЗначенияАтрибутов.Загрузить(ТаблицаАтрибутов);


УстановитьПривилегированныйРежим(Ложь);</v8:ОбработчикПередЗаписью>
			<v8:ОбработчикПослеВыполнения/>
			<v8:ОбработчикПриЗаписи/>
			<v8:ОбработчикПриПереходе>Инцидент.СтатусИМ = Перечисления.КА_СтатусИМ.ВозвратДеталиНаЭкспертизу;

Для Каждого Стр из Инцидент.ИсторияВыполнения Цикл
	Если ЗначениеЗаполнено(Стр.Этап) Тогда
	Если СтрНайти(Стр.Этап.Наименование,"В работе у Инженера.") Тогда
		Инцидент.Ответственный = Стр.Исполнитель;
		Инцидент.Записать();
		Прервать;
	КонецЕсли;
	КонецЕсли;
КонецЦикла;

// Отправка статуса

НастройкаОбмена = Справочники.КА_НастройкиВыгрузкиВИМ.ПолучитьНастройку("Рекламация_СобытиеВыгрузкаСтатуса");

СоответствиеСтатусов = Новый Соответствие;
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ЗапросОтправлен, "SENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВРаботеУМенеджера, "PROCESS_BY_MANAGER");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.УточнитеДанныеОбращения, "CLARIFY_DETAILS");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВРаботеУИнженера, "PROCESS_BY_ENGINEER");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияПринятаВРаботуГарантийнымОтделом, "PROCESS_BY_WARRANTY_DEPARTMENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияПринятаУточняемСрокРассмотрения, "ACCEPTED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВозвратДеталиНаЭкспертизу, "EXPERTIZE");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОдобренаВыберитеСпособКомпенсации, "APPROVED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОтклоненаОзнакомьтесьСЗаключением, "REJECTED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ЗакрытоИПеренесеноВархивПоСрокуДавности, "CLOSED_ON_EXPIRATION");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияЗавершенаКлиентСогласен, "CLOSED_ON_AGREEMENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияЗавершенаКомпенсацияПредоставлена, "COMPENSATED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламациНаправленаВОтделКорпоративныхПродаж, "SENT_TO_SALES");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОдобрена50ВыберитеСпособКомпенсации, "APPROVED_50");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОтклоненаПовторно, "REJECTED_REPEATEDLY");

СтрДанных = Новый Структура;
СтрДанных.Вставить("complaintId", ЗначенияАтрибутов["id"]);
СтрДанных.Вставить("status", СоответствиеСтатусов[Инцидент.СтатусИМ]);

КА_Обмены.ОтправитьВСервис_Рефакторинг(СтрДанных, НастройкаОбмена, "ИМ2");</v8:ОбработчикПриПереходе>
			<v8:ОбработчикПриПринятииКИсполнению/>
			<v8:ОбработчикПроведения/>
			<v8:Описание>Необходимо нажать "Принять к исполнению"

Окончание этапа – уведомление в ДО о размещении товара на ячейке Экспертиза на РЦ.

После получения уведомления нажимаем Выполнить, выбираем "Деталь прибыла для экспертизы", и инцидент перейдёт на следующий этап.

______________________________________________________________________________________________________________________
Если поставщик ответил до получения детали на склад, необходимо выяснить у МКО и логистов, успели ли её забрать у клиента, а если доставка региональная - успели ли доставить на РЦ

Если деталь ещё на забрали, просим МКО отменить доставку, пишем в комментарии: "Поставщик признал брак, прошу возместить клиенту".
Далее на вкладне Дополнительно исправляем атрибут Доставить товар на экспертизу = Нет, выбираем решение инженера "Брак, компенсация", нажимаем Выполнить и выбираем "Компенсация без экспертизы"

Если успели забрать, но на РЦ ещё не отправили - отменяем доставку на РЦ, пишем в комментарии: "Поставщик признал брак, прошу возместить клиенту".
Далее на вкладне Дополнительно исправляем атрибут Доставить товар на экспертизу = Нет, проставляем флаг "Товар вернуть", выбираем решение инженера "Брак, компенсация", нажимаем Выполнить и выбираем "Компенсация без экспертизы. Деталь на складе"

Если успели довезти до РЦ - дожидаемся уведомления в ДО о размещении детали на складе, нажимаем Выполнить и выбираем "Деталь прибыла для экспертизы", проходим обычный процесс экспертизы.

Если МКО хочет компенсировать без экспертизы из соображения лояльности, он заходит на вкладку Дополнительно и проставляет признак Компенсация без экспертизы и нажимает кнопку Далее.

Инцидент перейдёт на следующий этап.</v8:Описание>
			<v8:ПроверятьРезультат>false</v8:ПроверятьРезультат>
			<v8:СрокВыполнения>85</v8:СрокВыполнения>
			<v8:СообщениеНедоступныПереходы/>
			<v8:ОбработчикПриОткрытии/>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">06509fbe-a8c9-11e2-bca0-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">5fe94a47-f3ca-11e8-80d4-3cfdfeaf9019</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">9514bbf0-4093-426e-a611-7f991186491c</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">3066ae6a-9659-4e7d-a45f-557d5426b02e</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">2240a7f1-b122-4059-af3e-2b26895c805d</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">408f3bee-cea7-4a35-ab09-ade297d74fe3</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">7dfb237c-c4ed-4048-9fd3-71b19e087798</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">8deae651-a246-408f-af9e-589cf73f953f</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">f3ae00ab-81fd-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды>Деталь прибыла для экспертизы</v8:ИмяКоманды>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>Если НЕ РольДоступна("ПолныеПрава") Тогда

	УсловиеПроверки = ЗначенияАтрибутов["КомпенсацияБезЭкспертизы"] = Истина; 

	Если УсловиеПроверки Тогда
		Отказ = Истина;
	КонецЕсли;

КонецЕсли;</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">fba53040-81fd-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды>Компенсация без экспертизы</v8:ИмяКоманды>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>Если НЕ РольДоступна("ПолныеПрава") Тогда

	УсловиеПроверки = ЗначенияАтрибутов["КомпенсацияБезЭкспертизы"] = Истина; 

	Если УсловиеПроверки Тогда
		Отказ = Истина;
	КонецЕсли;

КонецЕсли;</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">024c7838-81fe-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды>Компенсация без экспертизы. Деталь на складе</v8:ИмяКоманды>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>Если НЕ РольДоступна("ПолныеПрава") Тогда

	УсловиеПроверки = ЗначенияАтрибутов["КомпенсацияБезЭкспертизы"] = Истина; 

	Если УсловиеПроверки Тогда
		Отказ = Истина;
	КонецЕсли;

КонецЕсли;</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">2152ab23-81fe-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>Если НЕ РольДоступна("ПолныеПрава") Тогда
	Если ЗначенияАтрибутов["КомпенсацияБезЭкспертизы"] &lt;&gt; Истина 
		Тогда
		Отказ = Истина;
	КонецЕсли;
КонецЕсли;</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">1e160f11-bca1-11ec-bba2-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">f9220711-8795-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">28c3acd3-ba33-11ec-bba2-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">e983c36e-bc97-11ec-bbaf-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">20e9e340-bc98-11ec-bbaf-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">ae2bfd6f-8798-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">c10475bc-8798-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">7770acee-8e55-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">579bcceb-8e55-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">578c447d-b974-11ec-bba2-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">455e5227-8e55-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
		</v8:CatalogObject.КА_ЭтапыИнцидентов>
		<v8:CatalogObject.КА_ЭтапыИнцидентов>
			<v8:Ref xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">c9c51e03-d7be-11ec-bbaf-00155d258b03</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Owner xsi:type="v8:CatalogRef.КА_ВидыИнцидентов">fe697b45-4e2c-11ec-bba8-00155d258b03</v8:Owner>
			<v8:Code>000000073</v8:Code>
			<v8:Description>Возврат детали на экспертизу. Перемещение детали</v8:Description>
			<v8:АвтоматическийСтартЭтапа>false</v8:АвтоматическийСтартЭтапа>
			<v8:АвтоматическоеЗавершениеЭтапа>false</v8:АвтоматическоеЗавершениеЭтапа>
			<v8:АтрибутыНедоступны>false</v8:АтрибутыНедоступны>
			<v8:АтрибутыСкрыты>false</v8:АтрибутыСкрыты>
			<v8:ЗавершающийЭтап>false</v8:ЗавершающийЭтап>
			<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">00000000-0000-0000-0000-000000000000</v8:Исполнитель>
			<v8:ОбработчикПередВыполнением/>
			<v8:ОбработчикПередЗаписью>ТаблицаАтрибутов = ЭтотОбъект.ЗначенияАтрибутов.Выгрузить();
ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "Экспертиза");
Стр = ТаблицаАтрибутов.Найти(ВыбАтрибут, "Атрибут");
Если Стр=Неопределено Или Стр.Значение = Перечисления.КА_ДоставитьТоварНаЭкспертизу.Нет Тогда
	ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "ВозвратУтилизация");
	ИзмСтр = ТаблицаАтрибутов.Найти(ВыбАтрибут, "Атрибут");
	Если ИзмСтр = Неопределено Тогда
		ИзмСтр = ТаблицаАтрибутов.Добавить();
		ИзмСтр.Атрибут = ВыбАтрибут;
	КонецЕсли;
	ИзмСтр.Значение = Перечисления.КА_ВозвратУтилизация.НеТребуется;
Иначе
	ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "ВозвратУтилизация");
	ИзмСтр = ТаблицаАтрибутов.Найти(ВыбАтрибут, "Атрибут");
	Если ИзмСтр = Неопределено Тогда
		ИзмСтр = ТаблицаАтрибутов.Добавить();
		ИзмСтр.Атрибут = ВыбАтрибут;
	КонецЕсли;
	ИзмСтр.Значение = Перечисления.КА_ВозвратУтилизация.ОжидаетсяВозвратДетали;

КонецЕсли;

ЭтотОбъект.ЗначенияАтрибутов.Загрузить(ТаблицаАтрибутов);
</v8:ОбработчикПередЗаписью>
			<v8:ОбработчикПослеВыполнения/>
			<v8:ОбработчикПриЗаписи/>
			<v8:ОбработчикПриПереходе>
Для Каждого Стр из Инцидент.ИсторияВыполнения Цикл
	Если ЗначениеЗаполнено(Стр.Этап) Тогда
	Если СтрНайти(Стр.Этап.Наименование,"В работе у Инженера.") Тогда
		Инцидент.Ответственный = Стр.Исполнитель;
		Инцидент.Записать();
		Прервать;
	КонецЕсли;
	КонецЕсли;
КонецЦикла;
</v8:ОбработчикПриПереходе>
			<v8:ОбработчикПриПринятииКИсполнению/>
			<v8:ОбработчикПроведения/>
			<v8:Описание>Необходимо нажать "Принять к исполнению"

На этом этапе инженер создаёт заказ на перемещение, используя данные из комментария.

После создания Заказа на перемещение нажимаем Выполнить, выбираем "Готово к перемещению", и инцидент перейдёт на следующий этап.

______________________________________________________________________________________________________________________
Если поставщик ответил до создания перемещения, необходимо выяснить у МКО или логиста, успели ли деталь забрать у клиента.

Если успели забрать, но не успели переместить на РЦ - дожидаемся уведомления в ДО о размещении детали на складе и пишем в комментарии: "Поставщик признал брак, прошу возместить клиенту".
Далее на вкладке Дополнительно исправляем атрибут Доставить товар на экспертизу = Нет, проставляем флаг "Товар вернуть", выбираем решение инженера "Брак, компенсация", нажимаем Выполнить и выбираем "Компенсация без экспертизы. Деталь на складе".

Если деталь ещё на забрали, просим МКО отменить доставку, пишем в комментарии: "Поставщик признал брак, прошу возместить клиенту".
Далее на вкладке Дополнительно исправляем атрибут Доставить товар на экспертизу = Нет, выбираем решение инженера "Брак, компенсация" нажимаем Выполнить и выбираем "Компенсация без экспертизы"


Инцидент перейдёт на следующий этап.</v8:Описание>
			<v8:ПроверятьРезультат>false</v8:ПроверятьРезультат>
			<v8:СрокВыполнения>2</v8:СрокВыполнения>
			<v8:СообщениеНедоступныПереходы/>
			<v8:ОбработчикПриОткрытии/>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">06509fbe-a8c9-11e2-bca0-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">5fe94a47-f3ca-11e8-80d4-3cfdfeaf9019</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">9514bbf0-4093-426e-a611-7f991186491c</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">3066ae6a-9659-4e7d-a45f-557d5426b02e</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">2240a7f1-b122-4059-af3e-2b26895c805d</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">408f3bee-cea7-4a35-ab09-ade297d74fe3</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">7dfb237c-c4ed-4048-9fd3-71b19e087798</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">8deae651-a246-408f-af9e-589cf73f953f</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">eab3acfc-81fd-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды>Готово к перемещению</v8:ИмяКоманды>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>Если НЕ РольДоступна("ПолныеПрава") Тогда

	УсловиеПроверки = ЗначенияАтрибутов["КомпенсацияБезЭкспертизы"] = Истина; 

	Если УсловиеПроверки Тогда
		Отказ = Истина;
	КонецЕсли;

КонецЕсли;</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">fba53040-81fd-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды>Компенсация без экспертизы</v8:ИмяКоманды>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>Если НЕ РольДоступна("ПолныеПрава") Тогда

	УсловиеПроверки = ЗначенияАтрибутов["КомпенсацияБезЭкспертизы"] = Истина; 

	Если УсловиеПроверки Тогда
		Отказ = Истина;
	КонецЕсли;

КонецЕсли;</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">024c7838-81fe-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды>Компенсация без экспертизы. Деталь на складе</v8:ИмяКоманды>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>Если НЕ РольДоступна("ПолныеПрава") Тогда

	УсловиеПроверки = ЗначенияАтрибутов["КомпенсацияБезЭкспертизы"] = Истина; 

	Если УсловиеПроверки Тогда
		Отказ = Истина;
	КонецЕсли;

КонецЕсли;</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">2152ab23-81fe-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>Если НЕ РольДоступна("ПолныеПрава") Тогда
	Если ЗначенияАтрибутов["КомпенсацияБезЭкспертизы"] &lt;&gt; Истина 
		Тогда
		Отказ = Истина;
	КонецЕсли;
КонецЕсли;</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">ae2bfd6f-8798-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">20e9e340-bc98-11ec-bbaf-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">c10475bc-8798-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">455e5227-8e55-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">7770acee-8e55-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">1e160f11-bca1-11ec-bba2-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">f9220711-8795-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
		</v8:CatalogObject.КА_ЭтапыИнцидентов>
		<v8:CatalogObject.КА_ЭтапыИнцидентов>
			<v8:Ref xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">eab3acfb-81fd-11ec-bb9e-00155d70bd06</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Owner xsi:type="v8:CatalogRef.КА_ВидыИнцидентов">fe697b45-4e2c-11ec-bba8-00155d258b03</v8:Owner>
			<v8:Code>000000032</v8:Code>
			<v8:Description>Возврат детали на экспертизу. Организация доставки</v8:Description>
			<v8:АвтоматическийСтартЭтапа>false</v8:АвтоматическийСтартЭтапа>
			<v8:АвтоматическоеЗавершениеЭтапа>false</v8:АвтоматическоеЗавершениеЭтапа>
			<v8:АтрибутыНедоступны>false</v8:АтрибутыНедоступны>
			<v8:АтрибутыСкрыты>false</v8:АтрибутыСкрыты>
			<v8:ЗавершающийЭтап>false</v8:ЗавершающийЭтап>
			<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">00000000-0000-0000-0000-000000000000</v8:Исполнитель>
			<v8:ОбработчикПередВыполнением/>
			<v8:ОбработчикПередЗаписью>УстановитьПривилегированныйРежим(Истина);
ТаблицаАтрибутов = ЭтотОбъект.ЗначенияАтрибутов.Выгрузить();
ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "ТоварВернуть");
Стр = ТаблицаАтрибутов.Найти(ВыбАтрибут, "Атрибут");
Если ЗначениеЗаполнено(Стр) Тогда
	ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "ВозвратУтилизация"); 
	СтрИзменение = ТаблицаАтрибутов.Найти(ВыбАтрибут,"Атрибут");
	Если не ЗначениеЗаполнено(СтрИзменение) Тогда
		СтрИзменение = ТаблицаАтрибутов.Добавить();
		СтрИзменение.Атрибут = ВыбАтрибут;
	КонецЕсли;
	СтрИзменение.Значение = Перечисления.КА_ВозвратУтилизация.НеТребуется;
КонецЕсли;
ЭтотОбъект.ЗначенияАтрибутов.Загрузить(ТаблицаАтрибутов);
УстановитьПривилегированныйРежим(Истина);
</v8:ОбработчикПередЗаписью>
			<v8:ОбработчикПослеВыполнения/>
			<v8:ОбработчикПриЗаписи/>
			<v8:ОбработчикПриПереходе>Инцидент.СтатусИМ = Перечисления.КА_СтатусИМ.ВозвратДеталиНаЭкспертизу;
//Лупонос Д.В. 07.04.2022
Инцидент.Ответственный =  ЗначенияАтрибутов["ОтветственныйМКО"];
//Инцидент.Записать();

//Пинчук М.Н. 14.11.2022
АтрибутСсылкаРучная = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор","КомпенсацияБезЭкспертизы");
    
  НС = Инцидент.ЗначенияАтрибутов.НайтиСтроки(Новый Структура("Атрибут",АтрибутСсылкаРучная));
  Для каждого ТекАтр из НС Цикл
    Инцидент.ЗначенияАтрибутов.Удалить(ТекАтр);      
  КонецЦикла;
  НовАтр = Инцидент.ЗначенияАтрибутов.Добавить();  
  НовАтр.Атрибут = АтрибутСсылкаРучная;
  НовАтр.Значение = Неопределено;

// Отправка статуса

НастройкаОбмена = Справочники.КА_НастройкиВыгрузкиВИМ.ПолучитьНастройку("Рекламация_СобытиеВыгрузкаСтатуса");

СоответствиеСтатусов = Новый Соответствие;
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ЗапросОтправлен, "SENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВРаботеУМенеджера, "PROCESS_BY_MANAGER");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.УточнитеДанныеОбращения, "CLARIFY_DETAILS");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВРаботеУИнженера, "PROCESS_BY_ENGINEER");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияПринятаВРаботуГарантийнымОтделом, "PROCESS_BY_WARRANTY_DEPARTMENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияПринятаУточняемСрокРассмотрения, "ACCEPTED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВозвратДеталиНаЭкспертизу, "EXPERTIZE");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОдобренаВыберитеСпособКомпенсации, "APPROVED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОтклоненаОзнакомьтесьСЗаключением, "REJECTED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ЗакрытоИПеренесеноВархивПоСрокуДавности, "CLOSED_ON_EXPIRATION");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияЗавершенаКлиентСогласен, "CLOSED_ON_AGREEMENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияЗавершенаКомпенсацияПредоставлена, "COMPENSATED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламациНаправленаВОтделКорпоративныхПродаж, "SENT_TO_SALES");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОдобрена50ВыберитеСпособКомпенсации, "APPROVED_50");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОтклоненаПовторно, "REJECTED_REPEATEDLY");

СтрДанных = Новый Структура;
СтрДанных.Вставить("complaintId", ЗначенияАтрибутов["id"]);
СтрДанных.Вставить("status", СоответствиеСтатусов[Инцидент.СтатусИМ]);

КА_Обмены.ОтправитьВСервис_Рефакторинг(СтрДанных, НастройкаОбмена, "ИМ2");

// Рассылка
Получатели = Новый Массив;
Вложения = Новый Соответствие;

ДокРТС = ЗначенияАтрибутов["realizationId"];
Партнер = ДокРТС.Партнер;

Адрес = УправлениеКонтактнойИнформацией.КонтактнаяИнформацияОбъекта(Партнер, Справочники.ВидыКонтактнойИнформации.EmailПартнера);
		
Если ЗначениеЗаполнено(Адрес) Тогда
	Получатели.Добавить(Новый Структура("Адрес, Представление", Адрес, Адрес));
КонецЕсли; 
	
Если Получатели.Количество() &gt; 0 Тогда

	Отправитель = Справочники.УчетныеЗаписиЭлектроннойПочты.СистемнаяУчетнаяЗаписьЭлектроннойПочты;
				
	Тема = "Обработка рекламации";
	ТекстПисьма = "Для корректного рассмотрения рекламации нам необходимо вернуть и осмотреть деталь. Это займет некоторое время.
	|За разъяснениями Вы всего можете обратиться к Вашему менеджеру.";	
			
	//Сообщить(ТекстПисьма);
	
	ПараметрыПисьма = Новый Структура;
	ПараметрыПисьма.Вставить("Кому",Получатели);
	ПараметрыПисьма.Вставить("Тема", Тема);
	ПараметрыПисьма.Вставить("Тело", ТекстПисьма);
	ПараметрыПисьма.Вставить("Вложения", Вложения);
				
	Попытка
		ИдентификаторСообщения = РаботаСПочтовымиСообщениями.ОтправитьПочтовоеСообщение(Отправитель, ПараметрыПисьма);
	Исключение
		Ошибка = ОписаниеОшибки();
		Сообщить(СтрШаблон("При отправке письма произошла ошибка: %1", Ошибка));
	КонецПопытки; 
		
КонецЕсли;

// Рассылка исполнителям
Тема = СтрШаблон("Обновлен статус рекламации %1 %2", Инцидент.Номер, ЗначенияАтрибутов["counterparty_external_id"]);
ТекстПисьма = "Требуется отправить товар на экспертизу.";
М = Новый Массив;
М.Добавить(Инцидент.Ответственный);
Документы.КА_Инцидент.ОтправитьОповещение(М, Тема, ТекстПисьма);
//Документы.КА_Инцидент.ОтправитьОповещениеИсполнителямЭтапа(СледующийЭтап, Тема, ТекстПисьма);</v8:ОбработчикПриПереходе>
			<v8:ОбработчикПриПринятииКИсполнению/>
			<v8:ОбработчикПроведения/>
			<v8:Описание>Этот этап выбирается, когда доставка товара на экспертизу не требует согласования или уже согласована.
МКО создаёт документ Заявка на возврат товаров клиента по кнопке в шапке формы, проверяет его реквизиты и запускает соответствующий процесс.

Если МКО хочет компенсировать без экспертизы из соображения лояльности, он заходит на вкладку Дополнительно и проставляет признак Компенсация без экспертизы. В этом случае ЗНВ формировать на текущем этапе не требуется.

После этого МКО нажимает кнопку "Выполнить" и переводит инцидент на следующий этап.
</v8:Описание>
			<v8:ПроверятьРезультат>false</v8:ПроверятьРезультат>
			<v8:СрокВыполнения>2</v8:СрокВыполнения>
			<v8:СообщениеНедоступныПереходы/>
			<v8:ОбработчикПриОткрытии/>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">3ab46ee4-8b6b-4e27-b05f-aa6c943c5895</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">6547e112-2de4-4388-82f0-4b24ca0eee42</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">6d160a64-dd08-11e4-b0fd-001517ac6c09</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">f6af22ec-7751-4f7a-bc7e-df85edb3c04f</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">97eb7d45-6782-4b33-9909-457572becfa8</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">b783b0ba-74ad-11e1-b634-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">812e0c18-3beb-11e8-80d0-001e6707aaa8</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">f149ab7d-7ada-11e8-80c5-3cfdfeaf9019</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">58a84576-77c0-4e0e-b065-1be30ab00af9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">0cafad1c-4262-11e1-b48c-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">c34b8004-ec1d-11e5-80c5-001e6707aaa8</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">ddcd8a22-00dc-11e4-9396-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">a0477a02-97f8-11e5-9a83-001517ac6c09</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">19daaf30-9a1a-11e8-80c5-3cfdfeaf9019</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">07d158b7-54ba-11e7-80ce-001e6707aaa8</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">df08b5fa-7e84-11e8-80c5-3cfdfeaf9019</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">eab3acfc-81fd-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>Если НЕ РольДоступна("ПолныеПрава") Тогда

	НайденаЗаявка = Ложь;
		Для каждого ТекСтр из Инцидент.СвязанныеОбъекты Цикл
			Если ТекСтр.Объект.Ссылка.Метаданные().Имя = "ЗаявкаНаВозвратТоваровОтКлиента" Тогда
				НайденаЗаявка = Истина И ТекСтр.Объект.Проведен;
			КонецЕсли;
		КонецЦикла;
	Отказ = не НайденаЗаявка;
	НайденаЗаявка = Ложь;
		Для каждого ТекСтр из Инцидент.СвязанныеОбъекты Цикл
			Если ТекСтр.Объект.Ссылка.Метаданные().Имя = "ЗаявкаНаВозвратТоваровОтКлиента" Тогда
				НайденаЗаявка = (Истина И ТекСтр.Объект.Проведен) или Отказ;
			КонецЕсли;
		КонецЦикла;
	Отказ = не НайденаЗаявка;
	Если Отказ Тогда
		Сообщить("Для завершения этапа убедитесь, что документ Зявка на возват товаров от клиента создан и проведен или корректно указано Решение Инженера");
	КонецЕсли;

КонецЕсли;

//Склад = Распределительный центр

Если НЕ РольДоступна("ПолныеПрава") Тогда

	УсловиеПроверки = ЗначенияАтрибутов["Склад"] = Справочники.Склады.ПолучитьСсылку(Новый УникальныйИдентификатор("24b4dd59-88cc-11e7-80cf-001e6707aaa8")); 

	Если НЕ УсловиеПроверки Тогда
		Отказ = Истина;
	КонецЕсли;

КонецЕсли;

Если НЕ Отказ Тогда

	НайденаЗаявка = Ложь;
		Для каждого ТекСтр из Инцидент.СвязанныеОбъекты Цикл
			Если ТекСтр.Объект.Ссылка.Метаданные().Имя = "ЗаявкаНаВозвратТоваровОтКлиента" Тогда
				НайденаЗаявка = (Истина И ТекСтр.Объект.Проведен) или Отказ;
			КонецЕсли;
		КонецЦикла;
	Отказ = не НайденаЗаявка;
	Если Отказ Тогда
		Сообщить("Для завершения этапа убедитесь, что документ Зявка на возват товаров от клиента создан и проведен или корректно указано Решение Инженера");
	КонецЕсли;

КонецЕсли;</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">c9c51e03-d7be-11ec-bbaf-00155d258b03</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>//Склад != Распределительный центр

Если НЕ РольДоступна("ПолныеПрава") Тогда

	УсловиеПроверки = ЗначенияАтрибутов["Склад"] &lt;&gt; Справочники.Склады.ПолучитьСсылку(Новый УникальныйИдентификатор("24b4dd59-88cc-11e7-80cf-001e6707aaa8")); 

	Если НЕ УсловиеПроверки Тогда
		Отказ = Истина;
	КонецЕсли;

КонецЕсли;

Если НЕ Отказ Тогда

	НайденаЗаявка = Ложь;
		Для каждого ТекСтр из Инцидент.СвязанныеОбъекты Цикл
			Если ТекСтр.Объект.Ссылка.Метаданные().Имя = "ЗаявкаНаВозвратТоваровОтКлиента" Тогда
				НайденаЗаявка = (Истина И ТекСтр.Объект.Проведен) или Отказ;
			КонецЕсли;
		КонецЦикла;
	Отказ = не НайденаЗаявка;
	Если Отказ Тогда
		Сообщить("Для завершения этапа убедитесь, что документ Зявка на возват товаров от клиента создан и проведен или корректно указано Решение Инженера");
	КонецЕсли;

КонецЕсли;</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">2152ab23-81fe-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>Если НЕ РольДоступна("ПолныеПрава") Тогда
	Если ЗначенияАтрибутов["КомпенсацияБезЭкспертизы"] &lt;&gt; Истина 
		Тогда
		Отказ = Истина;
	КонецЕсли;
КонецЕсли;</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">d912235d-81fd-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>Если НЕ РольДоступна("ПолныеПрава") Тогда
	Если ЗначенияАтрибутов["ДополнитьДанныеВручную"] &lt;&gt; Истина 
		Тогда
		Отказ = Истина;
	КонецЕсли;
КонецЕсли;</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:Команды>
				<v8:Заголовок>Оформить Заявку на возврат товара</v8:Заголовок>
				<v8:УИ>a6485445-0e93-4ccd-b2ee-9e3f4ad38635</v8:УИ>
				<v8:ОбработчикКлиентПеред/>
				<v8:ОбработчикСервер>СпкДатаНачалаУчетаПослеСвертки = КА_СлужебныеПараметры.ПолучитьЗначение(ПланыВидовХарактеристик.КА_СлужебныеПараметры.ДатаНачалаУчетаПослеСверткиБазы); 
ДатаНУПС = СпкДатаНачалаУчетаПослеСвертки.Получить(0); 

ДатаДень = Число(Сред(ДатаНУПС,1,2));
ДатаМесяц= Число(Сред(ДатаНУПС,4,2));
ДатаГод  = Число(Сред(ДатаНУПС,7,4));
ДатаНУПС = (Дата(ДатаГод, ДатаМесяц, ДатаДень));

ЗаявкаНаВозврат = Документы.ЗаявкаНаВозвратТоваровОтКлиента.ПустаяСсылка();
ДокРТС = Документы.РеализацияТоваровУслуг.ПустаяСсылка();

Для каждого ТекСтр из Объект.СвязанныеОбъекты Цикл
	Если ТекСтр.Объект.Ссылка.Метаданные().Имя = "ЗаявкаНаВозвратТоваровОтКлиента" Тогда
		ЗаявкаНаВозврат = ТекСтр.Объект.Ссылка;
	ИначеЕсли ТекСтр.Объект.Ссылка.Метаданные().Имя = "РеализацияТоваровУслуг" Тогда 
		ДокРТС = ТекСтр.Объект.Ссылка;
	КонецЕсли;
КонецЦикла;
//Стр 19 
ТаблицаТоваров = Объект.Товары.Выгрузить();
ТаблицаТоваров.Колонки.Добавить("ДокументРеализации");
ТаблицаТоваров.Колонки.Добавить("КА_ЗаказКлиента");
ИнцидентОбъект = РеквизитФормыВЗначение("Объект");
СпособОформленияВозврата = ИнцидентОбъект.ПолучитьАтрибутИнцидента("СпособОформленияВозврата");
Если не ЗначениеЗаполнено(СпособОформленияВозврата) Тогда
	СпособОформленияВозврата = Перечисления.КА_СпособыОформленияВозврата.ВозвратныеДокументы;
КонецЕсли; 

ВидОформленияВозвратныхДокументов = ИнцидентОбъект.ПолучитьАтрибутИнцидента("ВидОформленияДокументов");
Если СпособОформленияВозврата = Перечисления.КА_СпособыОформленияВозврата.ВозвратныеДокументы и не ЗначениеЗаполнено(ВидОформленияВозвратныхДокументов) Тогда 
	ВидОформленияВозвратныхДокументов = Перечисления.КА_ВидыОформленияВозвратныхДокументов.КлиентНеПринялТоварСОформлениемТорг2;
КонецЕсли;  
 
Для каждого ТекСтр из ТаблицаТоваров Цикл
	ТекСтр.КоличествоУпаковок = ТекСтр.Количество;
	ТекСтр.ДокументРеализации = ДокРТС;
	ТекСтр.КА_ЗаказКлиента = ДокРТС.ЗаказКлиента;
КонецЦикла;
//Стр 31

Если не (ЗаявкаНаВозврат =  Документы.ЗаявкаНаВозвратТоваровОтКлиента.ПустаяСсылка()) Тогда
//	Сообщить(Строка(ЗаявкаНаВозврат) + " уже сформирована в документе"); 	
ИначеЕсли ЗаявкаНаВозврат =  Документы.ЗаявкаНаВозвратТоваровОтКлиента.ПустаяСсылка() и не (ДокРТС = Документы.РеализацияТоваровУслуг.ПустаяСсылка())Тогда
	ЗаявкаНаВозврат = Документы.ЗаявкаНаВозвратТоваровОтКлиента.СоздатьДокумент();
	ЗаявкаНаВозврат.Дата = ТекущаяДата();
//	В связи с проблематикой непровденных РТУ ветвление заполнения ЗВТК на основании РТУ  05.10.2022 Лупонос Д.В.
	Если ДатаНУПС &lt; ДокРтс.Дата Тогда
		ЗаявкаНаВозврат.Заполнить(ДокРТС.Ссылка);
	ИначеЕсли не ДокРТС.Проведен Тогда 
		ЗаполнитьЗначенияСвойств(ЗаявкаНаВозврат, ДокРТС.Ссылка,,"Дата,Номер");
//		ЗаявкаНаВозврат.Дата = ТекущаяДата();
		ЗаявкаНаВозврат.Номер = ""; 
		ЗаявкаНаВозврат.Организация = ДокРТС.Организация; 
		ЗаявкаНаВозврат.Договор = ДокРТС.Договор; 
		ЗаявкаНаВозврат.Валюта = ДокРТС.Валюта; 
		ЗаявкаНаВозврат.Партнер = ДокРТС.Партнер; 
		ЗаявкаНаВозврат.Склад = ДокРТС.Склад; 
		ЗаявкаНаВозврат.Контрагент = ДокРТС.Контрагент; 
		ЗаявкаНаВозврат.Соглашение = ДокРТС.Соглашение; 
	КонецЕсли; 
//	В связи с проблематикой непровденных РТУ ветвление заполнения ЗВТК на основании РТУ  05.10.2022 Лупонос Д.В.
	ЗаявкаНаВозврат.Приоритет = Справочники.Приоритеты.НайтиПоНаименованию("Средний"); 
	ЗаявкаНаВозврат.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.ВозвратТоваровОтКлиента;
	ЗаявкаНаВозврат.Менеджер = ИнцидентОбъект.ПолучитьАтрибутИнцидента("ОтветственныйМКО");
	ЗаявкаНаВозврат.Подразделение = ЗаявкаНаВозврат.Менеджер.Подразделение; 
	ЗаявкаНаВозврат.КА_СпособДоставкиОтКлиента = Перечисления.СпособыДоставки.ДоКлиента;
	ЗаявкаНаВозврат.Комментарий = Строка(Объект.Ссылка);
		
	ЗаявкаНаВозврат.КА_Причина=Справочники.ПричиныВозникновенияПретензий.НайтиПоНаименованию("Брак").Ссылка;
	ЗаявкаНаВозврат.КА_АналитикаПричинБрака = Справочники.КА_АналитикаПричинБрака.НайтиПоНаименованию("Компенсация брака").Ссылка;
//	
	ЗаявкаНаВозврат.КА_СпособОформленияВозврата = СпособОформленияВозврата;
	ЗаявкаНаВозврат.КА_ВидОформленияВозвратныхДокументов = ВидОформленияВозвратныхДокументов;
	ЗаявкаНаВозврат.ДокументРеализации = ДокРТС.Ссылка;
	ЗаявкаНаВозврат.КА_Инцидент = Объект.Ссылка;
	ЗаявкаНаВозврат.ВозвращаемыеТовары.Загрузить(ТаблицаТоваров);

	ЭкспертизаТут = ИнцидентОбъект.ПолучитьАтрибутИнцидента("Экспертиза");
	Если ЭкспертизаТут = Перечисления.КА_ДоставитьТоварНаЭкспертизу.Да Тогда
		ЗаявкаНаВозврат.КА_ДоставитьТоварНаЭкспертизу = Истина;
	Иначе
		ЗаявкаНаВозврат.КА_ДоставитьТоварНаЭкспертизу = Ложь;
	КонецЕсли;	
//	
	Если не СтрНайти(ЗаявкаНаВозврат.Комментарий, "ЭКСПЕРТИЗА!!!") Тогда 
		ЗаявкаНаВозврат.Комментарий = "ЭКСПЕРТИЗА!!!" + ЗаявкаНаВозврат.Комментарий;
	КонецЕсли;

//	В связи с проблематикой непровденных РТУ для корректного проведения установим признак КА_Проверено в каждой строке ТЧ ЗВТК 05.10.2022 Лупонос Д.В.
	Сч = 1;
	Если не ДокРТС.Проведен и ДатаНУПС &gt; ДокРтс.Дата Тогда 	
		ТаблицаТоваров = ЗаявкаНаВозврат.ВозвращаемыеТовары.Выгрузить();
		Для Каждого Стр из ТаблицаТоваров Цикл
			Стр.КА_Проверено = Истина;
//			Стр.КодСтроки = Сч; 
//			Сч = Сч + 1; 
		КонецЦикла;
		ЗаявкаНаВозврат.ВозвращаемыеТовары.Загрузить(ТаблицаТоваров);
	КонецЕсли; 
//	В связи с проблематикой непровденных РТУ для корректного проведения установим признак КА_Проверено в каждой строке ТЧ ЗВТК 05.10.2022 Лупонос Д.В.

	Попытка 
		ЗаявкаНаВозврат.Записать();
	Исключение
		ЗаявкаНаВозврат.Записать(Ложь);
	КонецПопытки; 
	СвязатьСОбъектомИзФормыНаСервере(ЗаявкаНаВозврат.Ссылка);
	ТаблицаАтрибутовДокумента = Объект.ЗначенияАтрибутов.Выгрузить();
	АтрибутИнцидента=ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоНаименованию("ЗаявкаНаВозврат");
	ТаблицаАтрибутовДокумента = Объект.ЗначенияАтрибутов.Выгрузить();
	СтрокаИзм = ТаблицаАтрибутовДокумента.Найти(АтрибутИнцидента,"Атрибут");
	Если СтрокаИзм = Неопределено Тогда
		СтрокаИзм = ТаблицаАтрибутовДокумента.Добавить();
		СтрокаИзм.Атрибут = АтрибутИнцидента;
	КонецЕсли;
	СтрокаИзм.Значение = ЗаявкаНаВозврат.Ссылка;
	Объект.ЗначенияАтрибутов.Загрузить(ТаблицаАтрибутовДокумента);
КонецЕсли;
</v8:ОбработчикСервер>
				<v8:ОбработчикКлиентПосле>//Записать();
ЗаявкаНаВозврат = Неопределено;
Для каждого ТекСтр из Объект.СвязанныеОбъекты Цикл
	Если СтрНайти(Строка(ТекСтр.Объект), "Заявка на возврат товаров от клиента") Тогда
		ЗаявкаНаВозврат = ТекСтр.Объект;
	КонецЕсли;
КонецЦикла;

Если не ЗаявкаНаВозврат=Неопределено тогда
	ОткрытьФорму("Документ.ЗаявкаНаВозвратТоваровОтКлиента.ФормаОбъекта", новый Структура("Ключ",ЗаявкаНаВозврат));
КонецЕсли;</v8:ОбработчикКлиентПосле>
			</v8:Команды>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">c10475bc-8798-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">ae2bfd6f-8798-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">7770acee-8e55-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">f9220711-8795-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">579bcceb-8e55-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">28c3acd3-ba33-11ec-bba2-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">20e9e340-bc98-11ec-bbaf-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">e983c36e-bc97-11ec-bbaf-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">1e160f11-bca1-11ec-bba2-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
		</v8:CatalogObject.КА_ЭтапыИнцидентов>
		<v8:CatalogObject.КА_ЭтапыИнцидентов>
			<v8:Ref xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">f3ae00ac-81fd-11ec-bb9e-00155d70bd06</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Owner xsi:type="v8:CatalogRef.КА_ВидыИнцидентов">fe697b45-4e2c-11ec-bba8-00155d258b03</v8:Owner>
			<v8:Code>000000035</v8:Code>
			<v8:Description>Вышел срок. Компенсация</v8:Description>
			<v8:АвтоматическийСтартЭтапа>false</v8:АвтоматическийСтартЭтапа>
			<v8:АвтоматическоеЗавершениеЭтапа>false</v8:АвтоматическоеЗавершениеЭтапа>
			<v8:АтрибутыНедоступны>false</v8:АтрибутыНедоступны>
			<v8:АтрибутыСкрыты>false</v8:АтрибутыСкрыты>
			<v8:ЗавершающийЭтап>false</v8:ЗавершающийЭтап>
			<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">00000000-0000-0000-0000-000000000000</v8:Исполнитель>
			<v8:ОбработчикПередВыполнением/>
			<v8:ОбработчикПередЗаписью>УстановитьПривилегированныйРежим(Истина);
ТаблицаАтрибутов = ЭтотОбъект.ЗначенияАтрибутов.Выгрузить();
	ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "ВозвратУтилизация"); 
	СтрИзменение = ТаблицаАтрибутов.Найти(ВыбАтрибут,"Атрибут");
	Если не ЗначениеЗаполнено(СтрИзменение) Тогда
		СтрИзменение = ТаблицаАтрибутов.Добавить();
		СтрИзменение.Атрибут = ВыбАтрибут;
	КонецЕсли;
	СтрИзменение.Значение = Перечисления.КА_ВозвратУтилизация.НеТребуется;
ЭтотОбъект.ЗначенияАтрибутов.Загрузить(ТаблицаАтрибутов);

ИнцидентЗапрос = Неопределено;
ЗаявкаНаВозврат = ЭтотОбъект.ПолучитьАтрибутИнцидента("ЗаявкаНаВозврат");
Для Каждого Стр из ЭтотОбъект.СвязанныеОбъекты Цикл
	Если СтрНайти(Строка(Стр.Объект), "запрос поставщику") Тогда
		ИнцидентЗапрос = Стр.Объект.ПолучитьОбъект();
		ТаблицаСвязанных = ИнцидентЗапрос.СвязанныеОбъекты.Выгрузить();
		ЗаявкаНаВозвратЗапрос = ТаблицаСвязанных.Найти(ЗаявкаНаВозврат, "Объект"); 
		Если ЗаявкаНаВозвратЗапрос = Неопределено Тогда
			НовСтр = ТаблицаСвязанных.Добавить();
			НовСтр.Объект = ЗаявкаНаВозврат;
			ИнцидентЗапрос.СвязанныеОбъекты.Загрузить(ТаблицаСвязанных);
		КонецЕсли;
		ТаблицаАтрибутов = ИнцидентЗапрос.ЗначенияАтрибутов.Выгрузить();
		ЕстьАтрибут = ТаблицаАтрибутов.Найти(ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоНаименованию("ЗаявкаНаВозврат"), "Атрибут");
		Если ЕстьАтрибут = Неопределено Тогда
			ЕстьЗначение = ТаблицаАтрибутов.Найти(ЗаявкаНаВозвратЗапрос, "Значение");
			Если не ЕстьЗначение = Неопределено Тогда
				НовСтр = ТаблицаАтрибутов.Добавить();
				НовСтр.Атрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоНаименованию("ЗаявкаНаВозврат");
				НовСтр.Значение = ЗаявкаНаВозврат;
				ИнцидентЗапрос.ЗначенияАтрибутов.Загрузить(ТаблицаАтрибутов);
				ИнцидентЗапрос.Записать();
			Иначе
				ЕстьЗначение.Атрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоНаименованию("ЗаявкаНаВозврат");
				ИнцидентЗапрос.ЗначенияАтрибутов.Загрузить(ТаблицаАтрибутов);
				ИнцидентЗапрос.Записать();
			КонецЕсли;
		Иначе
			ЕстьАтрибут.Значение = ЗаявкаНаВозврат;
			ИнцидентЗапрос.ЗначенияАтрибутов.Загрузить(ТаблицаАтрибутов);
			ИнцидентЗапрос.Записать();
		КонецЕсли;
		Прервать;
	КонецЕсли;
КонецЦикла;

УстановитьПривилегированныйРежим(Ложь);</v8:ОбработчикПередЗаписью>
			<v8:ОбработчикПослеВыполнения/>
			<v8:ОбработчикПриЗаписи/>
			<v8:ОбработчикПриПереходе>Инцидент.СтатусИМ = Перечисления.КА_СтатусИМ.РекламацияПринятаВРаботуГарантийнымОтделом;

// Отправка статуса

НастройкаОбмена = Справочники.КА_НастройкиВыгрузкиВИМ.ПолучитьНастройку("Рекламация_СобытиеВыгрузкаСтатуса");

СоответствиеСтатусов = Новый Соответствие;
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ЗапросОтправлен, "SENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВРаботеУМенеджера, "PROCESS_BY_MANAGER");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.УточнитеДанныеОбращения, "CLARIFY_DETAILS");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВРаботеУИнженера, "PROCESS_BY_ENGINEER");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияПринятаВРаботуГарантийнымОтделом, "PROCESS_BY_WARRANTY_DEPARTMENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияПринятаУточняемСрокРассмотрения, "ACCEPTED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВозвратДеталиНаЭкспертизу, "EXPERTIZE");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОдобренаВыберитеСпособКомпенсации, "APPROVED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОтклоненаОзнакомьтесьСЗаключением, "REJECTED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ЗакрытоИПеренесеноВархивПоСрокуДавности, "CLOSED_ON_EXPIRATION");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияЗавершенаКлиентСогласен, "CLOSED_ON_AGREEMENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияЗавершенаКомпенсацияПредоставлена, "COMPENSATED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламациНаправленаВОтделКорпоративныхПродаж, "SENT_TO_SALES");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОдобрена50ВыберитеСпособКомпенсации, "APPROVED_50");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОтклоненаПовторно, "REJECTED_REPEATEDLY");

СтрДанных = Новый Структура;
СтрДанных.Вставить("complaintId", ЗначенияАтрибутов["id"]);
СтрДанных.Вставить("status", СоответствиеСтатусов[Инцидент.СтатусИМ]);

КА_Обмены.ОтправитьВСервис_Рефакторинг(СтрДанных, НастройкаОбмена, "ИМ2");

//Обрабатываем Пользователей  в поля инцидента по этапу 
Для Каждого Стр из Инцидент.ИсторияВыполнения Цикл
	Если ЗначениеЗаполнено(Стр.Этап) Тогда
	Если СтрНайти(Стр.Этап.Наименование,"В работе у Инженера.") Тогда
		Инцидент.Ответственный = Стр.Исполнитель;
		Прервать;
	КонецЕсли;
	КонецЕсли;
КонецЦикла;

// Рассылка исполнителям
Тема = СтрШаблон("Обновлен статус рекламации %1 %2", Инцидент.Номер, ЗначенияАтрибутов["counterparty_external_id"]);
ТекстПисьма = "Инженер получил инцидент и не принял никакого решения в срок по нему. Рекламация будет компенсирована.";
М = Новый Массив;
М.Добавить(Инцидент.Ответственный);
Документы.КА_Инцидент.ОтправитьОповещение(М, Тема, ТекстПисьма);
//Документы.КА_Инцидент.ОтправитьОповещениеИсполнителямЭтапа(СледующийЭтап, Тема, ТекстПисьма);</v8:ОбработчикПриПереходе>
			<v8:ОбработчикПриПринятииКИсполнению/>
			<v8:ОбработчикПроведения/>
			<v8:Описание>Срок вышел.
МКО принимает инцидент в работу.

Это вариант компенсации без возврата товара. Он идёт после рассмотрения брака, решение по которому не было принято в срок.

МКО создаёт документ Заявка на возврат товаров клиента, проверяет его реквизиты и запускает соответствующий процесс.

Когда в процессе возникает потребность в решении клиента - какую компенсацию он предпочтёт, МКО нажимает кнопку "Выполнить" и переводт инцидент на следующий этап.</v8:Описание>
			<v8:ПроверятьРезультат>false</v8:ПроверятьРезультат>
			<v8:СрокВыполнения>2</v8:СрокВыполнения>
			<v8:СообщениеНедоступныПереходы/>
			<v8:ОбработчикПриОткрытии/>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">3ab46ee4-8b6b-4e27-b05f-aa6c943c5895</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">6547e112-2de4-4388-82f0-4b24ca0eee42</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">6d160a64-dd08-11e4-b0fd-001517ac6c09</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">f6af22ec-7751-4f7a-bc7e-df85edb3c04f</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">19daaf30-9a1a-11e8-80c5-3cfdfeaf9019</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">97eb7d45-6782-4b33-9909-457572becfa8</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">b783b0ba-74ad-11e1-b634-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">812e0c18-3beb-11e8-80d0-001e6707aaa8</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">f149ab7d-7ada-11e8-80c5-3cfdfeaf9019</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">58a84576-77c0-4e0e-b065-1be30ab00af9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">c34b8004-ec1d-11e5-80c5-001e6707aaa8</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">ddcd8a22-00dc-11e4-9396-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">a0477a02-97f8-11e5-9a83-001517ac6c09</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">0a67f064-81fe-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>НайденаЗаявка = Ложь;
	Для каждого ТекСтр из Инцидент.СвязанныеОбъекты Цикл
		Если ТекСтр.Объект.Ссылка.Метаданные().Имя = "ЗаявкаНаВозвратТоваровОтКлиента" Тогда
			НайденаЗаявка = (Истина И ТекСтр.Объект.Проведен) или Отказ;
		КонецЕсли;
	КонецЦикла;
Отказ = не НайденаЗаявка;
НайденаЗаявка = Ложь;
	Для каждого ТекСтр из Инцидент.СвязанныеОбъекты Цикл
		Если ТекСтр.Объект.Ссылка.Метаданные().Имя = "ЗаявкаНаВозвратТоваровОтКлиента" Тогда
			НайденаЗаявка = (Истина И ТекСтр.Объект.Проведен) или Отказ;
		КонецЕсли;
	КонецЦикла;
Отказ = не НайденаЗаявка;
Если Отказ Тогда
	Сообщить("Для завершения этапа убедитесь, что документ Зявка на возват товаров от клиента создан и проведен или корректно указано Решение Инженера");
КонецЕсли;
</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:Команды>
				<v8:Заголовок>Оформить Заявку на возврат</v8:Заголовок>
				<v8:УИ>4e7fb52c-c004-40e6-ad70-b2cd096b6b1c</v8:УИ>
				<v8:ОбработчикКлиентПеред/>
				<v8:ОбработчикСервер>СпкДатаНачалаУчетаПослеСвертки = КА_СлужебныеПараметры.ПолучитьЗначение(ПланыВидовХарактеристик.КА_СлужебныеПараметры.ДатаНачалаУчетаПослеСверткиБазы); 
ДатаНУПС = СпкДатаНачалаУчетаПослеСвертки.Получить(0); 

ДатаДень = Число(Сред(ДатаНУПС,1,2));
ДатаМесяц= Число(Сред(ДатаНУПС,4,2));
ДатаГод  = Число(Сред(ДатаНУПС,7,4));
ДатаНУПС = (Дата(ДатаГод, ДатаМесяц, ДатаДень));

ЗаявкаНаВозврат = Документы.ЗаявкаНаВозвратТоваровОтКлиента.ПустаяСсылка();
ДокРТС = Документы.РеализацияТоваровУслуг.ПустаяСсылка();

Для каждого ТекСтр из Объект.СвязанныеОбъекты Цикл
	Если ТекСтр.Объект.Ссылка.Метаданные().Имя = "ЗаявкаНаВозвратТоваровОтКлиента" Тогда
		ЗаявкаНаВозврат = ТекСтр.Объект.Ссылка;
	ИначеЕсли ТекСтр.Объект.Ссылка.Метаданные().Имя = "РеализацияТоваровУслуг" Тогда 
		ДокРТС = ТекСтр.Объект.Ссылка;
	КонецЕсли;
КонецЦикла;
//Стр 19 
ТаблицаТоваров = Объект.Товары.Выгрузить();
ТаблицаТоваров.Колонки.Добавить("ДокументРеализации");
ТаблицаТоваров.Колонки.Добавить("КА_ЗаказКлиента");
ИнцидентОбъект = РеквизитФормыВЗначение("Объект");
СпособОформленияВозврата = ИнцидентОбъект.ПолучитьАтрибутИнцидента("СпособОформленияВозврата");
Если не ЗначениеЗаполнено(СпособОформленияВозврата) Тогда
	СпособОформленияВозврата = Перечисления.КА_СпособыОформленияВозврата.ВозвратныеДокументы;
КонецЕсли; 

ВидОформленияВозвратныхДокументов = ИнцидентОбъект.ПолучитьАтрибутИнцидента("ВидОформленияДокументов");
Если СпособОформленияВозврата = Перечисления.КА_СпособыОформленияВозврата.ВозвратныеДокументы и не ЗначениеЗаполнено(ВидОформленияВозвратныхДокументов) Тогда 
	ВидОформленияВозвратныхДокументов = Перечисления.КА_ВидыОформленияВозвратныхДокументов.КлиентНеПринялТоварСОформлениемТорг2;
КонецЕсли;  
 
Для каждого ТекСтр из ТаблицаТоваров Цикл
	ТекСтр.КоличествоУпаковок = ТекСтр.Количество;
	ТекСтр.ДокументРеализации = ДокРТС;
	ТекСтр.КА_ЗаказКлиента = ДокРТС.ЗаказКлиента;
КонецЦикла;
//Стр 31

Если не (ЗаявкаНаВозврат =  Документы.ЗаявкаНаВозвратТоваровОтКлиента.ПустаяСсылка()) Тогда
//	Сообщить(Строка(ЗаявкаНаВозврат) + " уже сформирована в документе"); 	
ИначеЕсли ЗаявкаНаВозврат =  Документы.ЗаявкаНаВозвратТоваровОтКлиента.ПустаяСсылка() и не (ДокРТС = Документы.РеализацияТоваровУслуг.ПустаяСсылка())Тогда
	ЗаявкаНаВозврат = Документы.ЗаявкаНаВозвратТоваровОтКлиента.СоздатьДокумент();
	ЗаявкаНаВозврат.Дата = ТекущаяДата();
//	В связи с проблематикой непровденных РТУ ветвление заполнения ЗВТК на основании РТУ  05.10.2022 Лупонос Д.В.
	Если ДатаНУПС &lt; ДокРтс.Дата Тогда
		ЗаявкаНаВозврат.Заполнить(ДокРТС.Ссылка);
	ИначеЕсли не ДокРТС.Проведен Тогда 
		ЗаполнитьЗначенияСвойств(ЗаявкаНаВозврат, ДокРТС.Ссылка,,"Дата,Номер");
//		ЗаявкаНаВозврат.Дата = ТекущаяДата();
		ЗаявкаНаВозврат.Номер = ""; 
		ЗаявкаНаВозврат.Организация = ДокРТС.Организация; 
		ЗаявкаНаВозврат.Договор = ДокРТС.Договор; 
		ЗаявкаНаВозврат.Валюта = ДокРТС.Валюта; 
		ЗаявкаНаВозврат.Партнер = ДокРТС.Партнер; 
		ЗаявкаНаВозврат.Склад = ДокРТС.Склад; 
		ЗаявкаНаВозврат.Контрагент = ДокРТС.Контрагент; 
		ЗаявкаНаВозврат.Соглашение = ДокРТС.Соглашение; 
	КонецЕсли; 
//	В связи с проблематикой непровденных РТУ ветвление заполнения ЗВТК на основании РТУ  05.10.2022 Лупонос Д.В.
	ЗаявкаНаВозврат.Приоритет = Справочники.Приоритеты.НайтиПоНаименованию("Средний"); 
	ЗаявкаНаВозврат.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.ВозвратТоваровОтКлиента;
	ЗаявкаНаВозврат.Менеджер = ИнцидентОбъект.ПолучитьАтрибутИнцидента("ОтветственныйМКО");
	ЗаявкаНаВозврат.Подразделение = ЗаявкаНаВозврат.Менеджер.Подразделение; 
	ЗаявкаНаВозврат.КА_СпособДоставкиОтКлиента = Перечисления.СпособыДоставки.ДоКлиента;
	ЗаявкаНаВозврат.Комментарий = Строка(Объект.Ссылка);
		
	ЗаявкаНаВозврат.КА_Причина=Справочники.ПричиныВозникновенияПретензий.НайтиПоНаименованию("Брак").Ссылка;
	ЗаявкаНаВозврат.КА_АналитикаПричинБрака = Справочники.КА_АналитикаПричинБрака.НайтиПоНаименованию("Компенсация брака").Ссылка;
	Если не ИнцидентОбъект.ПолучитьАтрибутИнцидента("Товар вернуть")=Истина Тогда 
		ЗаявкаНаВозврат.КА_Фиктивный=Истина;
	КонецЕсли; 
//	
	ЗаявкаНаВозврат.КА_СпособОформленияВозврата = СпособОформленияВозврата;
	ЗаявкаНаВозврат.КА_ВидОформленияВозвратныхДокументов = ВидОформленияВозвратныхДокументов;
	ЗаявкаНаВозврат.ДокументРеализации = ДокРТС.Ссылка;
	ЗаявкаНаВозврат.КА_Инцидент = Объект.Ссылка;
	ЗаявкаНаВозврат.ВозвращаемыеТовары.Загрузить(ТаблицаТоваров);

	ЭкспертизаТут = ИнцидентОбъект.ПолучитьАтрибутИнцидента("Экспертиза");
	Если ЭкспертизаТут = Перечисления.КА_ДоставитьТоварНаЭкспертизу.Да Тогда
		ЗаявкаНаВозврат.КА_ДоставитьТоварНаЭкспертизу = Истина;
	Иначе
		ЗаявкаНаВозврат.КА_ДоставитьТоварНаЭкспертизу = Ложь;
	КонецЕсли;

//	В связи с проблематикой непровденных РТУ для корректного проведения установим признак КА_Проверено в каждой строке ТЧ ЗВТК 05.10.2022 Лупонос Д.В.
	Сч = 1;
	Если не ДокРТС.Проведен и ДатаНУПС &gt; ДокРтс.Дата Тогда 	
		ТаблицаТоваров = ЗаявкаНаВозврат.ВозвращаемыеТовары.Выгрузить();
		Для Каждого Стр из ТаблицаТоваров Цикл
			Стр.КА_Проверено = Истина;
//			Стр.КодСтроки = Сч; 
//			Сч = Сч + 1; 
		КонецЦикла;
		ЗаявкаНаВозврат.ВозвращаемыеТовары.Загрузить(ТаблицаТоваров);
	КонецЕсли; 
//	В связи с проблематикой непровденных РТУ для корректного проведения установим признак КА_Проверено в каждой строке ТЧ ЗВТК 05.10.2022 Лупонос Д.В.

	Попытка 
		ЗаявкаНаВозврат.Записать();
	Исключение
		ЗаявкаНаВозврат.Записать(Ложь);
	КонецПопытки; 
	СвязатьСОбъектомИзФормыНаСервере(ЗаявкаНаВозврат.Ссылка);
	ТаблицаАтрибутовДокумента = Объект.ЗначенияАтрибутов.Выгрузить();
	АтрибутИнцидента=ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоНаименованию("ЗаявкаНаВозврат");
	ТаблицаАтрибутовДокумента = Объект.ЗначенияАтрибутов.Выгрузить();
	СтрокаИзм = ТаблицаАтрибутовДокумента.Найти(АтрибутИнцидента,"Атрибут");
	Если СтрокаИзм = Неопределено Тогда
		СтрокаИзм = ТаблицаАтрибутовДокумента.Добавить();
		СтрокаИзм.Атрибут = АтрибутИнцидента;
	КонецЕсли;
	СтрокаИзм.Значение = ЗаявкаНаВозврат.Ссылка;
	Объект.ЗначенияАтрибутов.Загрузить(ТаблицаАтрибутовДокумента);
КонецЕсли;
</v8:ОбработчикСервер>
				<v8:ОбработчикКлиентПосле>ЗаявкаНаВозврат = Неопределено;
Для каждого ТекСтр из Объект.СвязанныеОбъекты Цикл
	Если СтрНайти(Строка(ТекСтр.Объект), "Заявка на возврат товаров от клиента") Тогда
		ЗаявкаНаВозврат = ТекСтр.Объект;
	КонецЕсли;
КонецЦикла;

Если не ЗаявкаНаВозврат=Неопределено тогда
	ОткрытьФорму("Документ.ЗаявкаНаВозвратТоваровОтКлиента.ФормаОбъекта", новый Структура("Ключ",ЗаявкаНаВозврат));
КонецЕсли;</v8:ОбработчикКлиентПосле>
			</v8:Команды>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">579bcceb-8e55-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>true</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">c10475bc-8798-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">ae2bfd6f-8798-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">7770acee-8e55-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">f9220711-8795-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">20e9e340-bc98-11ec-bbaf-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">578c447d-b974-11ec-bba2-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>true</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">1e160f11-bca1-11ec-bba2-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">455e5227-8e55-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">28c3acd3-ba33-11ec-bba2-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>true</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">b444c315-5f3e-11ed-bba5-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
		</v8:CatalogObject.КА_ЭтапыИнцидентов>
		<v8:CatalogObject.КА_ЭтапыИнцидентов>
			<v8:Ref xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">9acfe5bf-d790-11ec-bbaf-00155d258b03</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Owner xsi:type="v8:CatalogRef.КА_ВидыИнцидентов">fe697b45-4e2c-11ec-bba8-00155d258b03</v8:Owner>
			<v8:Code>000000071</v8:Code>
			<v8:Description>Согласование межскладской перевозки. МКО</v8:Description>
			<v8:АвтоматическийСтартЭтапа>false</v8:АвтоматическийСтартЭтапа>
			<v8:АвтоматическоеЗавершениеЭтапа>false</v8:АвтоматическоеЗавершениеЭтапа>
			<v8:АтрибутыНедоступны>false</v8:АтрибутыНедоступны>
			<v8:АтрибутыСкрыты>false</v8:АтрибутыСкрыты>
			<v8:ЗавершающийЭтап>false</v8:ЗавершающийЭтап>
			<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">00000000-0000-0000-0000-000000000000</v8:Исполнитель>
			<v8:ОбработчикПередВыполнением/>
			<v8:ОбработчикПередЗаписью>ТаблицаАтрибутов = ЭтотОбъект.ЗначенияАтрибутов.Выгрузить();
ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "ВозвратУтилизация");
Стр = ТаблицаАтрибутов.Найти(ВыбАтрибут, "Атрибут");
Если Стр = Неопределено Тогда 
	Стр = ТаблицаАтрибутов.Добавить();
	Стр.Атрибут = ВыбАтрибут;
КонецЕсли; 
Стр.Значение = Перечисления.КА_ВозвратУтилизация.НеТребуется;
ЭтотОбъект.ЗначенияАтрибутов.Загрузить(ТаблицаАтрибутов);
</v8:ОбработчикПередЗаписью>
			<v8:ОбработчикПослеВыполнения>АтрибутСсылкаРучная = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор","КомпенсацияБезЭкспертизы");
    
  НС = Инцидент.ЗначенияАтрибутов.НайтиСтроки(Новый Структура("Атрибут",АтрибутСсылкаРучная));
  Для каждого ТекАтр из НС Цикл
    Инцидент.ЗначенияАтрибутов.Удалить(ТекАтр);      
  КонецЦикла;
  НовАтр = Инцидент.ЗначенияАтрибутов.Добавить();  
  НовАтр.Атрибут = АтрибутСсылкаРучная;
  НовАтр.Значение = Неопределено;</v8:ОбработчикПослеВыполнения>
			<v8:ОбработчикПриЗаписи/>
			<v8:ОбработчикПриПереходе>//Обрабатываем Пользователей  в поля инцидента по этапу 
Инцидент.Ответственный  = ЗначенияАтрибутов["ОтветственныйМКО"];
Инцидент.Записать();</v8:ОбработчикПриПереходе>
			<v8:ОбработчикПриПринятииКИсполнению/>
			<v8:ОбработчикПроведения/>
			<v8:Описание>МКО нажимает Принять к исполнению.

Происходит процедура согласования доставки с регионального склада. МКО или согласует доставку на экспертизу, выбирая Возврат на экспертизу, или выбирает Согласование компенсацию без экспертизы через цепочку МКО - НКО 

МКО запрашивает у логистов данные по межскладской переброске, которые пишет в комментарий. Туда же пишется оценка, согласовать без экспертизы, или организовать доставку товара.

Далее МКО нажимает кнопку Выполнено и выбирает вариант:

- Возврат на экспертизу - если возвращаем в обычном порядке
- Согласование компенсации без экспертизы - если просят согласовать без экаспертизы</v8:Описание>
			<v8:ПроверятьРезультат>false</v8:ПроверятьРезультат>
			<v8:СрокВыполнения>4</v8:СрокВыполнения>
			<v8:СообщениеНедоступныПереходы/>
			<v8:ОбработчикПриОткрытии/>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">58a84576-77c0-4e0e-b065-1be30ab00af9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">3ab46ee4-8b6b-4e27-b05f-aa6c943c5895</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">6547e112-2de4-4388-82f0-4b24ca0eee42</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">6d160a64-dd08-11e4-b0fd-001517ac6c09</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">f6af22ec-7751-4f7a-bc7e-df85edb3c04f</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">19daaf30-9a1a-11e8-80c5-3cfdfeaf9019</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">97eb7d45-6782-4b33-9909-457572becfa8</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">b783b0ba-74ad-11e1-b634-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">812e0c18-3beb-11e8-80d0-001e6707aaa8</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">f149ab7d-7ada-11e8-80c5-3cfdfeaf9019</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">0cafad1c-4262-11e1-b48c-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">c34b8004-ec1d-11e5-80c5-001e6707aaa8</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">ddcd8a22-00dc-11e4-9396-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">a0477a02-97f8-11e5-9a83-001517ac6c09</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">07d158b7-54ba-11e7-80ce-001e6707aaa8</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">df08b5fa-7e84-11e8-80c5-3cfdfeaf9019</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">eab3acfb-81fd-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды>Возврат на экспертизу</v8:ИмяКоманды>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода/>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">2152ab23-81fe-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды>Согласование компенсации без экспертизы</v8:ИмяКоманды>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода/>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">ae2bfd6f-8798-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">c10475bc-8798-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">7770acee-8e55-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">20e9e340-bc98-11ec-bbaf-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">1e160f11-bca1-11ec-bba2-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">e983c36e-bc97-11ec-bbaf-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">579bcceb-8e55-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">1cf61873-ba50-11ec-bba2-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">455e5227-8e55-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">f9220711-8795-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">f6327d2c-d1c5-11ec-bbaf-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
		</v8:CatalogObject.КА_ЭтапыИнцидентов>
		<v8:CatalogObject.КА_ЭтапыИнцидентов>
			<v8:Ref xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">d912235c-81fd-11ec-bb9e-00155d70bd06</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Owner xsi:type="v8:CatalogRef.КА_ВидыИнцидентов">fe697b45-4e2c-11ec-bba8-00155d258b03</v8:Owner>
			<v8:Code>000000028</v8:Code>
			<v8:Description>В работе у Инженера. Стандартный срок рассмотрения</v8:Description>
			<v8:АвтоматическийСтартЭтапа>false</v8:АвтоматическийСтартЭтапа>
			<v8:АвтоматическоеЗавершениеЭтапа>false</v8:АвтоматическоеЗавершениеЭтапа>
			<v8:АтрибутыНедоступны>false</v8:АтрибутыНедоступны>
			<v8:АтрибутыСкрыты>false</v8:АтрибутыСкрыты>
			<v8:ЗавершающийЭтап>false</v8:ЗавершающийЭтап>
			<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">00000000-0000-0000-0000-000000000000</v8:Исполнитель>
			<v8:ОбработчикПередВыполнением>ЗапросПоставщику = Неопределено;
Для каждого ТекСтр из Инцидент.СвязанныеОбъекты Цикл
	Если СтрНайти(Строка(ТекСтр.Объект), "Рекламация от клиента: запрос поставщику") Тогда
		ЗапросПоставщику = ТекСтр.Объект;
	КонецЕсли;
КонецЦикла;

Если ЗапросПоставщику=Неопределено тогда
	Сообщить("Перед завершением этапа необходимо создать запрос поставщику!");
	Отказ = Истина;
КонецЕсли;</v8:ОбработчикПередВыполнением>
			<v8:ОбработчикПередЗаписью>УстановитьПривилегированныйРежим(Истина);
ТаблицаАтрибутов = ЭтотОбъект.ЗначенияАтрибутов.Выгрузить();
ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "ТоварВернуть");
Стр = ТаблицаАтрибутов.Найти(ВыбАтрибут, "Атрибут");
Если ЗначениеЗаполнено(Стр) Тогда
	ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "ВозвратУтилизация"); 
	СтрИзменение = ТаблицаАтрибутов.Найти(ВыбАтрибут,"Атрибут");
	Если СтрИзменение=Неопределено Тогда
		СтрИзменение = ТаблицаАтрибутов.Добавить();
		СтрИзменение.Атрибут = ВыбАтрибут;
	КонецЕсли;
	Если Стр.Значение = Истина Тогда
		СтрИзменение.Значение = Перечисления.КА_ВозвратУтилизация.ОжидаетсяУтилизацииДетали;
	Иначе
		СтрИзменение.Значение = Перечисления.КА_ВозвратУтилизация.НеТребуется;
	КонецЕсли;
КонецЕсли;
ЭтотОбъект.ЗначенияАтрибутов.Загрузить(ТаблицаАтрибутов);

ТаблицаСвязанных = ЭтотОбъект.СвязанныеОбъекты.Выгрузить();
ИнцидентЗапрос = Неопределено;
Для каждого Стр из ТаблицаСвязанных Цикл
	Если СтрНайти(Строка(Стр.Объект),"Рекламация от клиента: запрос поставщику") Тогда
		ИнцидентЗапрос = Стр.Объект.Ссылка.ПолучитьОбъект();
	КонецЕсли;
КонецЦикла;
//Стр 27
Если не ИнцидентЗапрос = Неопределено Тогда
	ТаблицаАтрибутовЗапроса = ИнцидентЗапрос.ЗначенияАтрибутов.Выгрузить();
	Для Каждого Стр из ТаблицаАтрибутов  Цикл
		Если СокрЛП(Стр.Атрибут.Идентификатор)="ТоварВернуть" или СокрЛП(Стр.Атрибут.Идентификатор)="ВозвратУтилизация" Тогда 
			НашСтр = ТаблицаАтрибутовЗапроса.Найти(Стр.Атрибут,"Атрибут");
			Если НашСтр = Неопределено Тогда
				НашСтр = ТаблицаАтрибутовЗапроса.Добавить();
				НашСтр.Атрибут = Стр.Атрибут;
			КонецЕсли;
			НашСтр.Значение = Стр.Значение;
		КонецЕсли; 
	КонецЦикла;
	ИнцидентЗапрос.ЗначенияАтрибутов.Загрузить(ТаблицаАтрибутовЗапроса);
	ИнцидентЗапрос.Записать();
КонецЕсли;
УстановитьПривилегированныйРежим(Ложь);</v8:ОбработчикПередЗаписью>
			<v8:ОбработчикПослеВыполнения/>
			<v8:ОбработчикПриЗаписи/>
			<v8:ОбработчикПриПереходе>Инцидент.СтатусИМ = Перечисления.КА_СтатусИМ.РекламацияПринятаВРаботуГарантийнымОтделом;

// Отправка статуса

НастройкаОбмена = Справочники.КА_НастройкиВыгрузкиВИМ.ПолучитьНастройку("Рекламация_СобытиеВыгрузкаСтатуса");

СоответствиеСтатусов = Новый Соответствие;
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ЗапросОтправлен, "SENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВРаботеУМенеджера, "PROCESS_BY_MANAGER");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.УточнитеДанныеОбращения, "CLARIFY_DETAILS");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВРаботеУИнженера, "PROCESS_BY_ENGINEER");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияПринятаВРаботуГарантийнымОтделом, "PROCESS_BY_WARRANTY_DEPARTMENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияПринятаУточняемСрокРассмотрения, "ACCEPTED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВозвратДеталиНаЭкспертизу, "EXPERTIZE");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОдобренаВыберитеСпособКомпенсации, "APPROVED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОтклоненаОзнакомьтесьСЗаключением, "REJECTED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ЗакрытоИПеренесеноВархивПоСрокуДавности, "CLOSED_ON_EXPIRATION");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияЗавершенаКлиентСогласен, "CLOSED_ON_AGREEMENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияЗавершенаКомпенсацияПредоставлена, "COMPENSATED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламациНаправленаВОтделКорпоративныхПродаж, "SENT_TO_SALES");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОдобрена50ВыберитеСпособКомпенсации, "APPROVED_50");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОтклоненаПовторно, "REJECTED_REPEATEDLY");

СтрДанных = Новый Структура;
СтрДанных.Вставить("complaintId", ЗначенияАтрибутов["id"]);
СтрДанных.Вставить("status", СоответствиеСтатусов[Инцидент.СтатусИМ]);

КА_Обмены.ОтправитьВСервис_Рефакторинг(СтрДанных, НастройкаОбмена, "ИМ2");

УстановитьПривилегированныйРежим(Истина);

//Обрабатываем Пользователей  в поля инцидента по этапу
Инцидент.Ответственный  = ЗначенияАтрибутов["ОтветственныйИнженер"];
//Инцидент.Записать();

//Пинчук М.Н. 09.11.2022
АтрибутСсылкаРучная = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор","ДополнитьДанныеВручную");
    
  НСР = Инцидент.ЗначенияАтрибутов.НайтиСтроки(Новый Структура("Атрибут",АтрибутСсылкаРучная));
  Для каждого ТекАтр из НСР Цикл
    Инцидент.ЗначенияАтрибутов.Удалить(ТекАтр);      
  КонецЦикла;
  НовАтр = Инцидент.ЗначенияАтрибутов.Добавить();  
  НовАтр.Атрибут = АтрибутСсылкаРучная;
  НовАтр.Значение = Неопределено;
  
  //Экспертиза
  АтрибутСсылкаЭкспертиза = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор","Экспертиза");
    
  НСЭ = Инцидент.ЗначенияАтрибутов.НайтиСтроки(Новый Структура("Атрибут",АтрибутСсылкаЭкспертиза));
  Для каждого ТекАтр из НСЭ Цикл
    Инцидент.ЗначенияАтрибутов.Удалить(ТекАтр);      
  КонецЦикла;
  НовАтр = Инцидент.ЗначенияАтрибутов.Добавить();  
  НовАтр.Атрибут = АтрибутСсылкаЭкспертиза;
  НовАтр.Значение = Перечисления.КА_ДоставитьТоварНаЭкспертизу.Нет;
  
  АтрибутСсылкаИнженер = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор","РешениеИнженера");
    
  НСИ = Инцидент.ЗначенияАтрибутов.НайтиСтроки(Новый Структура("Атрибут",АтрибутСсылкаИнженер));
  Для каждого ТекАтр из НСИ Цикл
    Инцидент.ЗначенияАтрибутов.Удалить(ТекАтр);      
  КонецЦикла;
  НовАтр = Инцидент.ЗначенияАтрибутов.Добавить();  
  НовАтр.Атрибут = АтрибутСсылкаИнженер;
  НовАтр.Значение = Неопределено;
  
  АтрибутСсылкаРешение = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор","РешениеЭкспертизы");
    
  НСРШ = Инцидент.ЗначенияАтрибутов.НайтиСтроки(Новый Структура("Атрибут",АтрибутСсылкаРешение));
  Для каждого ТекАтр из НСРШ Цикл
    Инцидент.ЗначенияАтрибутов.Удалить(ТекАтр);      
  КонецЦикла;
  НовАтр = Инцидент.ЗначенияАтрибутов.Добавить();  
  НовАтр.Атрибут = АтрибутСсылкаРешение;
  НовАтр.Значение = Неопределено;


// Рассылка
Получатели = Новый Массив;
Вложения = Новый Соответствие;

ДокРТС = ЗначенияАтрибутов["realizationId"];
Партнер = ДокРТС.Партнер;

Адрес = УправлениеКонтактнойИнформацией.КонтактнаяИнформацияОбъекта(Партнер, Справочники.ВидыКонтактнойИнформации.EmailПартнера);
		
Если ЗначениеЗаполнено(Адрес) Тогда
	Получатели.Добавить(Новый Структура("Адрес, Представление", Адрес, Адрес));
КонецЕсли; 
	
Если Получатели.Количество() &gt; 0 Тогда

	Отправитель = Справочники.УчетныеЗаписиЭлектроннойПочты.СистемнаяУчетнаяЗаписьЭлектроннойПочты;
		
	ДатаОтсчета = Инцидент.ИсторияВыполнения[Инцидент.ИсторияВыполнения.Количество()-1].ДатаПостановки;
	ДатаОтвета = ДатаОтсчета + 3*24*60*60;
	ДатаОтвета = Справочники.КА_ВидыИнцидентов.ОкруглитьДатуДоПолучаса(ДатаОтвета);
		
	Тема = "Обработка рекламации";
	ТекстПисьма = СтрШаблон("Спасибо за обращение. Мы предоставим ответ не позднее %1", ДатаОтвета);	
			
	//Сообщить(ТекстПисьма);
	
	ПараметрыПисьма = Новый Структура;
	ПараметрыПисьма.Вставить("Кому",Получатели);
	ПараметрыПисьма.Вставить("Тема", Тема);
	ПараметрыПисьма.Вставить("Тело", ТекстПисьма);
	ПараметрыПисьма.Вставить("Вложения", Вложения);
				
	Попытка
		ИдентификаторСообщения = РаботаСПочтовымиСообщениями.ОтправитьПочтовоеСообщение(Отправитель, ПараметрыПисьма);
	Исключение
		Ошибка = ОписаниеОшибки();
		Сообщить(СтрШаблон("При отправке письма произошла ошибка: %1", Ошибка));
	КонецПопытки; 
		
КонецЕсли;</v8:ОбработчикПриПереходе>
			<v8:ОбработчикПриПринятииКИсполнению/>
			<v8:ОбработчикПроведения/>
			<v8:Описание>Нажимаем «Принять к исполнению»
С этого момента есть 72 часа для принятия решения по рекламации.
Его необходимо заполнить в атрибуте "Решение инженера» на вкладке Дополнительно:
 
Если по предоставленным материалам понятно, что у детали – брак, то выбирается пункт «Брак, компенсация». Если при этом инженер считает, что товар нужно вернуть, он проставляет флаг в атрибуте «Товар вернуть».

Если по предоставленным материалам понятно, что у детали – не брак, то выбирается пункт «Не брак, отказ». При отказе обязательно приложить к документу Инцидент по ссылке «Файлы» документ в формате .pdf. Наименование документа должно начинаться со слов "Заключение инженера". Каждый отказ будет проходит проверку у Главного инженера.

В случае спорной ситуации по инциденту можно выбрать пункт «Не знаю, компенсация». Этот пункт – проявление лояльности к клиентам.

Есть возможность запросить мнение поставщика у менеджеров снабжения. Для этого в атрибуте «Решение инженера» выбирается вариант «Запросить срочно» и создаётся Инцидент с видом «Запрос поставщику» по кнопке "Создание запроса поставщику". Это станет сигналом для менеджера, что ответ поставщика желательно получить в течение 48 часов.

ВНИМАНИЕ!!! При получение ответа поставщика менеджер ДС указывает его решение в своём инциденте, и значение НЕ ПЕРЕНОСЯТСЯ в головной инцидент. Для получения этого значения себе, необходимо на любом этапе НАЖАТЬ кнопку "Записать". Данные подтянутся и отобразатся в инциденте "Брак".

Если решение по инциденту без осмотра товара принять невозможно, можно запросить доставку товара на экспертизу. Для этого в атрибуте «Доставить товар на экспертизу» необходимо выбрать «Да». При этом заполнять решение инженера не требуется, можно оставить поле пустым или выбрать «Запросить срочно», если требуется мнение поставщика.

Добавлена процедура согласования доставки с регионального склада. Инцидент перейдёт на МКО, который или согласует доставки с НКО, или согласует компенсацию без экспертизы через цепочку МКО - НКО - МОР - НОР. Переход на согласование доставки происходит автоматически, если склад региональный.

Создавать Инцидент "Запрос поставщику" по кнопке "Создание запроса поставщику" НЕОБХОДИМО В ЛЮБОМ СЛУЧАЕ, даже если решение по инциденту ещё не принято.

Переходы с этого этапа заблокированы до тех пор, пока не будут выполнены следующие действия:
•	заполнен атрибут «Решение инженера», ЛИБО атрибут «Доставить товар на экспертизу» - "Да" на вкладке Дополнительно;
•	создан Инцидент "Запрос поставщику" по кнопке "Создание запроса поставщику"; 

После создания документа и заполнения атрибутов нажимаем кнопку «Выполнить» на вкладке «Основное» и инцидент автоматически перейдёт на нужный этап.



</v8:Описание>
			<v8:ПроверятьРезультат>false</v8:ПроверятьРезультат>
			<v8:СрокВыполнения>26</v8:СрокВыполнения>
			<v8:СообщениеНедоступныПереходы/>
			<v8:ОбработчикПриОткрытии/>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">06509fbe-a8c9-11e2-bca0-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">5fe94a47-f3ca-11e8-80d4-3cfdfeaf9019</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">9514bbf0-4093-426e-a611-7f991186491c</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">3066ae6a-9659-4e7d-a45f-557d5426b02e</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">2240a7f1-b122-4059-af3e-2b26895c805d</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">408f3bee-cea7-4a35-ab09-ade297d74fe3</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">7dfb237c-c4ed-4048-9fd3-71b19e087798</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">8deae651-a246-408f-af9e-589cf73f953f</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">07d158b7-54ba-11e7-80ce-001e6707aaa8</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">eab3acfb-81fd-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>//Склад = Распределительный центр
//Доставить товар на экспертизу = "Да", (ИСТИНА?)


Если НЕ РольДоступна("ПолныеПрава") Тогда


	УсловиеПроверки = ЗначенияАтрибутов["Склад"] = Справочники.Склады.ПолучитьСсылку(Новый УникальныйИдентификатор("24b4dd59-88cc-11e7-80cf-001e6707aaa8"))
					И ЗначенияАтрибутов["Экспертиза"] = Перечисления.КА_ДоставитьТоварНаЭкспертизу.Да; 

	Если НЕ УсловиеПроверки Тогда
		Отказ = Истина;
	КонецЕсли;


	Если ЗначенияАтрибутов["Экспертиза"] &lt;&gt; Перечисления.КА_ДоставитьТоварНаЭкспертизу.Да Тогда
		//Отказ = Истина;
	КонецЕсли;
	
КонецЕсли;
	</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">f3ae00ac-81fd-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>Если НЕ РольДоступна("ПолныеПрава") Тогда

	Отказ = Истина;

КонецЕсли;
</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">fba5303f-81fd-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>Если НЕ РольДоступна("ПолныеПрава") Тогда

	Если ЗначенияАтрибутов["РешениеИнженера"] &lt;&gt; Перечисления.КА_РешенияИнженера.НеБракОтказ Тогда
		Отказ = Истина;
		Иначе

			Для Каждого Стр из Инцидент.Товары Цикл
				Если ЗначениеЗаполнено(Стр.ВидНоменклатуры) Тогда
				Если СтрНайти(Стр.ВидНоменклатуры.Наименование,"легковые") Тогда
					Отказ = Истина;
					Прервать;

					// Все ок
					Иначе	
						Отказ = Ложь;
				КонецЕсли;
				КонецЕсли;
			КонецЦикла;
	КонецЕсли;
КонецЕсли;</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">fba53040-81fd-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>Если НЕ РольДоступна("ПолныеПрава") Тогда

	Если (ЗначенияАтрибутов["РешениеИнженера"] = Перечисления.КА_РешенияИнженера.БракКомпенсация 
		ИЛИ ЗначенияАтрибутов["РешениеИнженера"] = Перечисления.КА_РешенияИнженера.НеизвестноКомпенсация)
		И ЗначенияАтрибутов["ТоварВернуть"] &lt;&gt; Истина Тогда
		// Все ок
	Иначе	
		Отказ = Истина;
	КонецЕсли;
		
	УсловиеПроверки = Инцидент.Товары[0].Договор.КА_ВидДоговораКорона = Перечисления.КА_ВидСоглашенияКорона.Б
					И Инцидент.Товары[0].Договор.Контрагент.ЮрФизЛицо = Перечисления.ЮрФизЛицо.ЮрЛицоНеРезидент;

	Если УсловиеПроверки Тогда
	
		Отказ = Истина;
		
	КонецЕсли;


КонецЕсли;
</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">024c7838-81fe-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>Если НЕ РольДоступна("ПолныеПрава") Тогда

	Если (ЗначенияАтрибутов["РешениеИнженера"] = Перечисления.КА_РешенияИнженера.БракКомпенсация 
		ИЛИ ЗначенияАтрибутов["РешениеИнженера"] = Перечисления.КА_РешенияИнженера.НеизвестноКомпенсация)
		И ЗначенияАтрибутов["ТоварВернуть"] = Истина Тогда
		// Все ок
	Иначе	
		Отказ = Истина;
	КонецЕсли;
	
	УсловиеПроверки = Инцидент.Товары[0].Договор.КА_ВидДоговораКорона = Перечисления.КА_ВидСоглашенияКорона.Б
					И Инцидент.Товары[0].Договор.Контрагент.ЮрФизЛицо = Перечисления.ЮрФизЛицо.ЮрЛицоНеРезидент;

	Если УсловиеПроверки Тогда
	
		Отказ = Истина;
	КонецЕсли;


КонецЕсли;
</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">9acfe5bf-d790-11ec-bbaf-00155d258b03</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>//Склад != Распределительный центр
//Доставить товар на экспертизу = "Да", (ИСТИНА?)

Если НЕ РольДоступна("ПолныеПрава") Тогда

	УсловиеПроверки = ЗначенияАтрибутов["Склад"] &lt;&gt; Справочники.Склады.ПолучитьСсылку(Новый УникальныйИдентификатор("24b4dd59-88cc-11e7-80cf-001e6707aaa8"))
					И ЗначенияАтрибутов["Экспертиза"] = Перечисления.КА_ДоставитьТоварНаЭкспертизу.Да; 

	Если НЕ УсловиеПроверки Тогда
		Отказ = Истина;
	КонецЕсли;

КонецЕсли;</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">024c7839-81fe-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>Если НЕ РольДоступна("ПолныеПрава") Тогда

	Если ЗначенияАтрибутов["РешениеИнженера"] &lt;&gt; Перечисления.КА_РешенияИнженера.НеБракОтказ Тогда
		Отказ = Истина;
		Иначе

			Для Каждого Стр из Инцидент.Товары Цикл
				Если ЗначениеЗаполнено(Стр.ВидНоменклатуры) Тогда
				Если СтрНайти(Стр.ВидНоменклатуры.Наименование,"легковые") Тогда
					Отказ = Ложь;
					Прервать;

					// Все ок
					Иначе	
						Отказ = Истина;
				КонецЕсли;
				КонецЕсли;
			КонецЦикла;
		КонецЕсли;

КонецЕсли;</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">046ca2f2-7abf-11ed-bbb3-00155d258b03</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>Если НЕ РольДоступна("ПолныеПрава") Тогда

	Если (ЗначенияАтрибутов["РешениеИнженера"] = Перечисления.КА_РешенияИнженера.БракКомпенсация 
		ИЛИ ЗначенияАтрибутов["РешениеИнженера"] = Перечисления.КА_РешенияИнженера.НеизвестноКомпенсация) Тогда
		//И ЗначенияАтрибутов["ТоварВернуть"] &lt;&gt; Истина Тогда
		// Все ок
	Иначе	
		Отказ = Истина;
	КонецЕсли;

	УсловиеПроверки = Инцидент.Товары[0].Договор.КА_ВидДоговораКорона = Перечисления.КА_ВидСоглашенияКорона.Б
					И Инцидент.Товары[0].Договор.Контрагент.ЮрФизЛицо = Перечисления.ЮрФизЛицо.ЮрЛицоНеРезидент;

	Если НЕ УсловиеПроверки Тогда
		Отказ = Истина;
	КонецЕсли;

КонецЕсли;</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:Команды>
				<v8:Заголовок>Создание запроса поставщику</v8:Заголовок>
				<v8:УИ>97b7bed0-dcf4-4d09-b11b-87128b179e2c</v8:УИ>
				<v8:ОбработчикКлиентПеред/>
				<v8:ОбработчикСервер>УстановитьПривилегированныйРежим(Истина);

ВидСоздаваемогоИнцидента = Справочники.КА_ВидыИнцидентов.НайтиПоРеквизиту("ИдентификаторВида","РекламацияОтКлиентаЗапросПоставщику");
ИнцидентЗапрос = Документы.КА_Инцидент.ПустаяСсылка();
Для каждого ТекСтр Из Объект.СвязанныеОбъекты Цикл
	Если ТекСтр.Объект.Ссылка.Метаданные().Имя = "КА_Инцидент" Тогда
		Если ТекСтр.Объект.ВидИнцидента = ВидСоздаваемогоИнцидента Тогда
			ИнцидентЗапрос = ТекСтр.Объект.Ссылка;
		КонецЕсли;
	КонецЕсли;
КонецЦикла;
ИнцидентОбъект = РеквизитФормыВЗначение("Объект");
РешениеИнженера = ИнцидентОбъект.ПолучитьАтрибутИнцидента("РешениеИнженера");
Если ИнцидентЗапрос = Документы.КА_Инцидент.ПустаяСсылка() Тогда
//	Если ЗначениеЗаполнено(РешениеИнженера) Тогда
		//Дублирование Инцидента
		ИнцидентЗапрос = Документы.КА_Инцидент.СоздатьДокумент();
		ИнцидентЗапрос.Дата = ТекущаяДата();
		ИнцидентЗапрос.ВидИнцидента = ВидСоздаваемогоИнцидента;
		ИнцидентЗапрос.Записать();
		Инцидент = Объект;
		//Вот не работает тут форма никак 
		//Инцидент.СвязатьСОбъектом(ИнцидентЗапрос.Ссылка);
		НовОбъект = Объект.СвязанныеОбъекты.Добавить();
		НовОбъект.Объект = ИнцидентЗапрос.Ссылка;
		НовОбъект.Этап = Объект.ТекущийЭтап; 
		Записать();
		ЗнакКавычки = """";
		ДанныеПакета = "{ "+ЗнакКавычки+"IncidentOrigGUID"+ЗнакКавычки+": ";
		ДанныеПакета = ДанныеПакета + ЗнакКавычки +Инцидент.Ссылка.УникальныйИдентификатор()+ ЗнакКавычки + ", ";
		ДанныеПакета = ДанныеПакета + ЗнакКавычки+"incident_external_id"+ЗнакКавычки+": "; 
		ДанныеПакета = ДанныеПакета + ЗнакКавычки +ИнцидентЗапрос.Ссылка.УникальныйИдентификатор()+ ЗнакКавычки + " ";
		ДанныеПакета =  ДанныеПакета + "}";
		ЧтениеJSON  = Новый ЧтениеJSON;
		ЧтениеJSON.УстановитьСтроку(ДанныеПакета);
		Данные = ПрочитатьJSON(ЧтениеJSON,Истина);
		Документы.КА_Инцидент.ОбработатьВходящийПакет(Данные,"РекламацияОтКлиентаЗапросПоставщику");
//	Иначе
//		Сообщить("Решение инженера не заполнено, поэтому документ не может быть создан");
//	КонецЕсли;
КонецЕсли;
</v8:ОбработчикСервер>
				<v8:ОбработчикКлиентПосле>ИнцидентЗапрос = Неопределено;
Для каждого ТекСтр из Объект.СвязанныеОбъекты Цикл
	Если СтрНайти(Строка(ТекСтр.Объект), ": запрос поставщику") Тогда
		ИнцидентЗапрос = ТекСтр.Объект;
	КонецЕсли;
КонецЦикла;

Если не ИнцидентЗапрос=Неопределено тогда
	Сообщить("Документ создан: " + Строка(ИнцидентЗапрос));
//	ОткрытьФорму("Документ.КА_Инцидент.ФормаОбъекта", новый Структура("Ключ",ИнцидентЗапрос));
КонецЕсли;</v8:ОбработчикКлиентПосле>
			</v8:Команды>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">c10475bc-8798-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">ae2bfd6f-8798-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">7770acee-8e55-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">f9220711-8795-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">20e9e340-bc98-11ec-bbaf-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">e983c36e-bc97-11ec-bbaf-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">1e160f11-bca1-11ec-bba2-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">455e5227-8e55-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">f6327d2c-d1c5-11ec-bbaf-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">b444c315-5f3e-11ed-bba5-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
		</v8:CatalogObject.КА_ЭтапыИнцидентов>
		<v8:CatalogObject.КА_ЭтапыИнцидентов>
			<v8:Ref xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">e212d35a-81fd-11ec-bb9e-00155d70bd06</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Owner xsi:type="v8:CatalogRef.КА_ВидыИнцидентов">fe697b45-4e2c-11ec-bba8-00155d258b03</v8:Owner>
			<v8:Code>000000031</v8:Code>
			<v8:Description>В работе у Инженера. Увеличенный срок рассмотрения</v8:Description>
			<v8:АвтоматическийСтартЭтапа>false</v8:АвтоматическийСтартЭтапа>
			<v8:АвтоматическоеЗавершениеЭтапа>false</v8:АвтоматическоеЗавершениеЭтапа>
			<v8:АтрибутыНедоступны>false</v8:АтрибутыНедоступны>
			<v8:АтрибутыСкрыты>false</v8:АтрибутыСкрыты>
			<v8:ЗавершающийЭтап>false</v8:ЗавершающийЭтап>
			<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">00000000-0000-0000-0000-000000000000</v8:Исполнитель>
			<v8:ОбработчикПередВыполнением>ЗапросПоставщику = Неопределено;
Для каждого ТекСтр из Инцидент.СвязанныеОбъекты Цикл
	Если СтрНайти(Строка(ТекСтр.Объект), "Рекламация от клиента: запрос поставщику") Тогда
		ЗапросПоставщику = ТекСтр.Объект;
	КонецЕсли;
КонецЦикла;

Если ЗапросПоставщику=Неопределено тогда
	Сообщить("Перед завершением этапа необходимо создать запрос поставщику!");
	Отказ = Истина;
КонецЕсли;</v8:ОбработчикПередВыполнением>
			<v8:ОбработчикПередЗаписью>УстановитьПривилегированныйРежим(Истина);
ТаблицаАтрибутов = ЭтотОбъект.ЗначенияАтрибутов.Выгрузить();
ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "ТоварВернуть");
Стр = ТаблицаАтрибутов.Найти(ВыбАтрибут, "Атрибут");
Если ЗначениеЗаполнено(Стр) Тогда
	ВыбАтрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "ВозвратУтилизация"); 
	СтрИзменение = ТаблицаАтрибутов.Найти(ВыбАтрибут,"Атрибут");
	Если не ЗначениеЗаполнено(СтрИзменение) Тогда
		СтрИзменение = ТаблицаАтрибутов.Добавить();
		СтрИзменение.Атрибут = ВыбАтрибут;
	КонецЕсли;
	Если Стр.Значение = Истина Тогда
		СтрИзменение.Значение = Перечисления.КА_ВозвратУтилизация.ОжидаетсяУтилизацииДетали;
	Иначе
		СтрИзменение.Значение = Перечисления.КА_ВозвратУтилизация.НеТребуется;
	КонецЕсли;
КонецЕсли;
ЭтотОбъект.ЗначенияАтрибутов.Загрузить(ТаблицаАтрибутов);

ТаблицаСвязанных = ЭтотОбъект.СвязанныеОбъекты.Выгрузить();
ИнцидентЗапрос = Неопределено;
Для каждого Стр из ТаблицаСвязанных Цикл
	Если СтрНайти(Строка(Стр.Объект),"Рекламация от клиента: запрос поставщику") Тогда
		ИнцидентЗапрос = Стр.Объект.Ссылка.ПолучитьОбъект();
	КонецЕсли;
КонецЦикла;
//Стр 27
Если не ИнцидентЗапрос = Неопределено Тогда
	ТаблицаАтрибутовЗапроса = ИнцидентЗапрос.ЗначенияАтрибутов.Выгрузить();
	Для Каждого Стр из ТаблицаАтрибутов  Цикл
		Если СокрЛП(Стр.Атрибут.Идентификатор)="ТоварВернуть" или СокрЛП(Стр.Атрибут.Идентификатор)="ВозвратУтилизация" Тогда 
			НашСтр = ТаблицаАтрибутовЗапроса.Найти(Стр.Атрибут,"Атрибут");
			Если НашСтр = Неопределено Тогда
				НашСтр = ТаблицаАтрибутовЗапроса.Добавить();
				НашСтр.Атрибут = Стр.Атрибут;
			КонецЕсли;
			НашСтр.Значение = Стр.Значение;
		КонецЕсли; 
	КонецЦикла;
	ИнцидентЗапрос.ЗначенияАтрибутов.Загрузить(ТаблицаАтрибутовЗапроса);
	ИнцидентЗапрос.Записать();
КонецЕсли;
УстановитьПривилегированныйРежим(Ложь);</v8:ОбработчикПередЗаписью>
			<v8:ОбработчикПослеВыполнения/>
			<v8:ОбработчикПриЗаписи/>
			<v8:ОбработчикПриПереходе>Инцидент.СтатусИМ = Перечисления.КА_СтатусИМ.РекламацияПринятаВРаботуГарантийнымОтделом;

// Отправка статуса

НастройкаОбмена = Справочники.КА_НастройкиВыгрузкиВИМ.ПолучитьНастройку("Рекламация_СобытиеВыгрузкаСтатуса");

СоответствиеСтатусов = Новый Соответствие;
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ЗапросОтправлен, "SENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВРаботеУМенеджера, "PROCESS_BY_MANAGER");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.УточнитеДанныеОбращения, "CLARIFY_DETAILS");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВРаботеУИнженера, "PROCESS_BY_ENGINEER");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияПринятаВРаботуГарантийнымОтделом, "PROCESS_BY_WARRANTY_DEPARTMENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияПринятаУточняемСрокРассмотрения, "ACCEPTED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВозвратДеталиНаЭкспертизу, "EXPERTIZE");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОдобренаВыберитеСпособКомпенсации, "APPROVED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОтклоненаОзнакомьтесьСЗаключением, "REJECTED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ЗакрытоИПеренесеноВархивПоСрокуДавности, "CLOSED_ON_EXPIRATION");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияЗавершенаКлиентСогласен, "CLOSED_ON_AGREEMENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияЗавершенаКомпенсацияПредоставлена, "COMPENSATED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламациНаправленаВОтделКорпоративныхПродаж, "SENT_TO_SALES");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОдобрена50ВыберитеСпособКомпенсации, "APPROVED_50");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОтклоненаПовторно, "REJECTED_REPEATEDLY");

СтрДанных = Новый Структура;
СтрДанных.Вставить("complaintId", ЗначенияАтрибутов["id"]);
СтрДанных.Вставить("status", СоответствиеСтатусов[Инцидент.СтатусИМ]);

КА_Обмены.ОтправитьВСервис_Рефакторинг(СтрДанных, НастройкаОбмена, "ИМ2");

//Обрабатываем Пользователей  в поля инцидента по этапу
Инцидент.Ответственный  = ЗначенияАтрибутов["ОтветственныйИнженер"];

// Рассылка
Получатели = Новый Массив;
Вложения = Новый Соответствие;

ДокРТС = ЗначенияАтрибутов["realizationId"];
Партнер = ДокРТС.Партнер;

Адрес = УправлениеКонтактнойИнформацией.КонтактнаяИнформацияОбъекта(Партнер, Справочники.ВидыКонтактнойИнформации.EmailПартнера);
		
Если ЗначениеЗаполнено(Адрес) Тогда
	Получатели.Добавить(Новый Структура("Адрес, Представление", Адрес, Адрес));
КонецЕсли; 
	
Если Получатели.Количество() &gt; 0 Тогда

	Отправитель = Справочники.УчетныеЗаписиЭлектроннойПочты.СистемнаяУчетнаяЗаписьЭлектроннойПочты;
		
	ДатаОтсчета = Инцидент.ИсторияВыполнения[Инцидент.ИсторияВыполнения.Количество()-1].ДатаПостановки;
	ДатаОтвета = ДатаОтсчета + 3*24*60*60;
	ДатаОтвета = Справочники.КА_ВидыИнцидентов.ОкруглитьДатуДоПолучаса(ДатаОтвета);
		
	Тема = "Обработка рекламации";
	ТекстПисьма = СтрШаблон("Спасибо за обращение. Мы предоставим ответ не позднее %1", ДатаОтвета);	
			
	//Сообщить(ТекстПисьма);
	
	ПараметрыПисьма = Новый Структура;
	ПараметрыПисьма.Вставить("Кому",Получатели);
	ПараметрыПисьма.Вставить("Тема", Тема);
	ПараметрыПисьма.Вставить("Тело", ТекстПисьма);
	ПараметрыПисьма.Вставить("Вложения", Вложения);
				
	Попытка
		ИдентификаторСообщения = РаботаСПочтовымиСообщениями.ОтправитьПочтовоеСообщение(Отправитель, ПараметрыПисьма);
	Исключение
		Ошибка = ОписаниеОшибки();
		Сообщить(СтрШаблон("При отправке письма произошла ошибка: %1", Ошибка));
	КонецПопытки; 
		
КонецЕсли;

// Рассылка исполнителям
Тема = СтрШаблон("Обновлен статус рекламации %1", Инцидент.Номер);
ТекстПисьма = Инцидент.ИсторияВыполнения[Инцидент.ИсторияВыполнения.Количество()-1].Результат;
Документы.КА_Инцидент.ОтправитьОповещениеИсполнителямЭтапа(СледующийЭтап, Тема, ТекстПисьма);</v8:ОбработчикПриПереходе>
			<v8:ОбработчикПриПринятииКИсполнению/>
			<v8:ОбработчикПроведения/>
			<v8:Описание>Нажимаем «Принять к исполнению»
Крайний срок для принятия решения по рекламации можно увидеть на вкладке "История" в строке с Вашим этапом, в колонке "Срок выполнения"

Решение необходимо заполнить в атрибуте "Решение инженера» на вкладке Дополнительно:
 
Если по предоставленным материалам понятно, что у детали – брак, то выбирается пункт «Брак, компенсация». Если при этом инженер считает, что товар нужно вернуть, он проставляет флаг в атрибуте «Товар вернуть».

Если по предоставленным материалам понятно, что у детали – не брак, то выбирается пункт «Не брак, отказ». При отказе обязательно приложить к документу Инцидент по ссылке «Файлы» документ в формате .pdf. Наименование документа должно начинаться со слов "Заключение инженера". Каждый отказ будет проходит проверку у Главного инженера.

В случае спорной ситуации по инциденту можно выбрать пункт «Не знаю, компенсация». Этот пункт – проявление лояльности к клиентам.

Есть возможность запросить мнение поставщика у менеджеров снабжения. Для этого в атрибуте «Решение инженера» выбирается вариант «Запросить срочно» и создаётся Инцидент с видом «Запрос поставщику» по кнопке "Создание запроса поставщику". Это станет сигналом для менеджера, что ответ поставщика желательно получить в течение 48 часов.

ВНИМАНИЕ!!! При получение ответа поставщика менеджер ДС указывает его решение в своём инциденте, и значение НЕ ПЕРЕНОСЯТСЯ в головной инцидент. Для получения этого значения себе, необходимо на любом этапе НАЖАТЬ кнопку "Записать". Данные подтянутся и отобразатся в инциденте "Брак".

Если решение по инциденту без осмотра товара принять невозможно, можно запросить доставку товара на экспертизу. Для этого в атрибуте «Доставить товар на экспертизу» необходимо выбрать «Да». При этом заполнять решение инженера не требуется, можно оставить поле пустым или выбрать «Запросить срочно», если требуется мнение поставщика.

Добавлена процедура согласования доставки с регионального склада. Инцидент перейдёт на МКО, который или согласует доставки с НКО, или согласует компенсацию без экспертизы через цепочку МКО - НКО - МОР - НОР. Переход на согласование доставки происходит автоматически, если склад региональный.

Создавать Инцидент "Запрос поставщику" по кнопке "Создание запроса поставщику" НЕОБХОДИМО В ЛЮБОМ СЛУЧАЕ, даже если решение по инциденту ещё не принято.

Переходы с этого этапа заблокированы до тех пор, пока не будут выполнены следующие действия:
•	заполнен атрибут «Решение инженера», ЛИБО атрибут «Доставить товар на экспертизу» - "Да" на вкладке Дополнительно;
•	создан Инцидент "Запрос поставщику" по кнопке "Создание запроса поставщику"; 

После создания документа и заполнения атрибутов нажимаем кнопку «Выполнить» на вкладке «Основное» и инцидент автоматически перейдёт на нужный этап.</v8:Описание>
			<v8:ПроверятьРезультат>false</v8:ПроверятьРезультат>
			<v8:СрокВыполнения>26</v8:СрокВыполнения>
			<v8:СообщениеНедоступныПереходы/>
			<v8:ОбработчикПриОткрытии/>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">06509fbe-a8c9-11e2-bca0-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">5fe94a47-f3ca-11e8-80d4-3cfdfeaf9019</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">9514bbf0-4093-426e-a611-7f991186491c</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">3066ae6a-9659-4e7d-a45f-557d5426b02e</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">2240a7f1-b122-4059-af3e-2b26895c805d</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">408f3bee-cea7-4a35-ab09-ade297d74fe3</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">7dfb237c-c4ed-4048-9fd3-71b19e087798</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">8deae651-a246-408f-af9e-589cf73f953f</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">eab3acfb-81fd-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>Если НЕ РольДоступна("ПолныеПрава") Тогда

	Если ЗначенияАтрибутов["Экспертиза"] &lt;&gt; Перечисления.КА_ДоставитьТоварНаЭкспертизу.Да Тогда
		Отказ = Истина;
	КонецЕсли;
	
КонецЕсли;

</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">f3ae00ac-81fd-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>Если НЕ РольДоступна("ПолныеПрава") Тогда
	Отказ = Истина;
КонецЕсли;
</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">fba5303f-81fd-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>Если НЕ РольДоступна("ПолныеПрава") Тогда

	Если ЗначенияАтрибутов["РешениеИнженера"] &lt;&gt; Перечисления.КА_РешенияИнженера.НеБракОтказ Тогда
		Отказ = Истина;
	КонецЕсли;
	
КонецЕсли;
</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">fba53040-81fd-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>Если НЕ РольДоступна("ПолныеПрава") Тогда
	Если (ЗначенияАтрибутов["РешениеИнженера"] = Перечисления.КА_РешенияИнженера.БракКомпенсация 
		ИЛИ ЗначенияАтрибутов["РешениеИнженера"] = Перечисления.КА_РешенияИнженера.НеизвестноКомпенсация)
		И ЗначенияАтрибутов["ТоварВернуть"] &lt;&gt; Истина Тогда
		// Все ок
	Иначе	
		Отказ = Истина;
	КонецЕсли;
	
	УсловиеПроверки = Инцидент.Товары[0].СтавкаНДС = Перечисления.СтавкиНДС.НДС0;

	Если УсловиеПроверки Тогда
		Отказ = Истина;

КонецЕсли;
	
КонецЕсли;

</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">024c7838-81fe-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>Если НЕ РольДоступна("ПолныеПрава") Тогда
	Если (ЗначенияАтрибутов["РешениеИнженера"] = Перечисления.КА_РешенияИнженера.БракКомпенсация 
		ИЛИ ЗначенияАтрибутов["РешениеИнженера"] = Перечисления.КА_РешенияИнженера.НеизвестноКомпенсация)
		И ЗначенияАтрибутов["ТоварВернуть"] = Истина Тогда
		// Все ок
	Иначе	
		Отказ = Истина;
	КонецЕсли;
КонецЕсли;

</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">9acfe5bf-d790-11ec-bbaf-00155d258b03</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>//Склад != Распределительный центр
//Доставить товар на экспертизу = "Да", (ИСТИНА?)

Если НЕ РольДоступна("ПолныеПрава") Тогда

	УсловиеПроверки = ЗначенияАтрибутов["Склад"] &lt;&gt; Справочники.Склады.ПолучитьСсылку(Новый УникальныйИдентификатор("24b4dd59-88cc-11e7-80cf-001e6707aaa8"))
					И ЗначенияАтрибутов["Экспертиза"] = Перечисления.КА_ДоставитьТоварНаЭкспертизу.Да; 

	Если НЕ УсловиеПроверки Тогда
		Отказ = Истина;
	КонецЕсли;

КонецЕсли;</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">046ca2f2-7abf-11ed-bbb3-00155d258b03</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>Если НЕ РольДоступна("ПолныеПрава") Тогда

	УсловиеПроверки = Инцидент.Товары[0].СтавкаНДС = Перечисления.СтавкиНДС.НДС0;

	Если НЕ УсловиеПроверки Тогда
		Отказ = Истина;
	КонецЕсли;

КонецЕсли;</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:Команды>
				<v8:Заголовок>Создание заявки поставщику</v8:Заголовок>
				<v8:УИ>0eb34846-e286-4fb4-81b5-19ec8b05cc87</v8:УИ>
				<v8:ОбработчикКлиентПеред/>
				<v8:ОбработчикСервер>УстановитьПривилегированныйРежим(Истина);

ВидСоздаваемогоИнцидента = Справочники.КА_ВидыИнцидентов.НайтиПоРеквизиту("ИдентификаторВида","РекламацияОтКлиентаЗапросПоставщику");
ИнцидентЗапрос = Документы.КА_Инцидент.ПустаяСсылка();
Для каждого ТекСтр Из Объект.СвязанныеОбъекты Цикл
	Если ТекСтр.Объект.Ссылка.Метаданные().Имя = "КА_Инцидент" Тогда
		Если ТекСтр.Объект.ВидИнцидента = ВидСоздаваемогоИнцидента Тогда
			ИнцидентЗапрос = ТекСтр.Объект.Ссылка;
		КонецЕсли;
	КонецЕсли;
КонецЦикла;
ИнцидентОбъект = РеквизитФормыВЗначение("Объект");
РешениеИнженера = ИнцидентОбъект.ПолучитьАтрибутИнцидента("РешениеИнженера");
Если ИнцидентЗапрос = Документы.КА_Инцидент.ПустаяСсылка() Тогда
//	Если ЗначениеЗаполнено(РешениеИнженера) Тогда
		//Дублирование Инцидента
		ИнцидентЗапрос = Документы.КА_Инцидент.СоздатьДокумент();
		ИнцидентЗапрос.Дата = ТекущаяДата();
		ИнцидентЗапрос.ВидИнцидента = ВидСоздаваемогоИнцидента;
		ИнцидентЗапрос.Записать();
		Инцидент = Объект;
		//Вот не работает тут форма никак 
		//Инцидент.СвязатьСОбъектом(ИнцидентЗапрос.Ссылка);
		НовОбъект = Объект.СвязанныеОбъекты.Добавить();
		НовОбъект.Объект = ИнцидентЗапрос.Ссылка;
		НовОбъект.Этап = Объект.ТекущийЭтап; 
		Записать();
		ЗнакКавычки = """";
		ДанныеПакета = "{ "+ЗнакКавычки+"IncidentOrigGUID"+ЗнакКавычки+": ";
		ДанныеПакета = ДанныеПакета + ЗнакКавычки +Инцидент.Ссылка.УникальныйИдентификатор()+ ЗнакКавычки + ", ";
		ДанныеПакета = ДанныеПакета + ЗнакКавычки+"incident_external_id"+ЗнакКавычки+": "; 
		ДанныеПакета = ДанныеПакета + ЗнакКавычки +ИнцидентЗапрос.Ссылка.УникальныйИдентификатор()+ ЗнакКавычки + " ";
		ДанныеПакета =  ДанныеПакета + "}";
		ЧтениеJSON  = Новый ЧтениеJSON;
		ЧтениеJSON.УстановитьСтроку(ДанныеПакета);
		Данные = ПрочитатьJSON(ЧтениеJSON,Истина);
		Документы.КА_Инцидент.ОбработатьВходящийПакет(Данные,"РекламацияОтКлиентаЗапросПоставщику");
//	Иначе
//		Сообщить("Решение инженера не заполнено, поэтому документ не может быть создан");
//	КонецЕсли;
КонецЕсли;
</v8:ОбработчикСервер>
				<v8:ОбработчикКлиентПосле>ИнцидентЗапрос = Неопределено;
Для каждого ТекСтр из Объект.СвязанныеОбъекты Цикл
	Если СтрНайти(Строка(ТекСтр.Объект), ": запрос поставщику") Тогда
		ИнцидентЗапрос = ТекСтр.Объект;
	КонецЕсли;
КонецЦикла;

Если не ИнцидентЗапрос=Неопределено тогда
	Сообщить("Документ создан: " + Строка(ИнцидентЗапрос));
//	ОткрытьФорму("Документ.КА_Инцидент.ФормаОбъекта", новый Структура("Ключ",ИнцидентЗапрос));
КонецЕсли;</v8:ОбработчикКлиентПосле>
			</v8:Команды>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">f9220711-8795-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">7770acee-8e55-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">ae2bfd6f-8798-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">c10475bc-8798-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">20e9e340-bc98-11ec-bbaf-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">e983c36e-bc97-11ec-bbaf-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">1e160f11-bca1-11ec-bba2-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">455e5227-8e55-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">f6327d2c-d1c5-11ec-bbaf-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">b444c315-5f3e-11ed-bba5-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
		</v8:CatalogObject.КА_ЭтапыИнцидентов>
		<v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
			<v8:Ref xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">1b4886c4-d6cd-11ec-bbaf-00155d258b03</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Code>000000167</v8:Code>
			<v8:Description>Ячейка</v8:Description>
			<v8:ValueType>
				<Type xmlns="http://v8.1c.ru/8.1/data/core">v8:CatalogRef.СкладскиеЯчейки</Type>
			</v8:ValueType>
			<v8:Заголовок>Ячейка</v8:Заголовок>
			<v8:Список>true</v8:Список>
			<v8:Таблица>false</v8:Таблица>
			<v8:Идентификатор>Ячейка</v8:Идентификатор>
		</v8:ChartOfCharacteristicTypesObject.КА_АтрибутыИнцидентов>
		<v8:CatalogObject.КА_ЭтапыИнцидентов>
			<v8:Ref xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">e212d359-81fd-11ec-bb9e-00155d70bd06</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Owner xsi:type="v8:CatalogRef.КА_ВидыИнцидентов">fe697b45-4e2c-11ec-bba8-00155d258b03</v8:Owner>
			<v8:Code>000000030</v8:Code>
			<v8:Description>Уточнение срока рассмотрения</v8:Description>
			<v8:АвтоматическийСтартЭтапа>false</v8:АвтоматическийСтартЭтапа>
			<v8:АвтоматическоеЗавершениеЭтапа>false</v8:АвтоматическоеЗавершениеЭтапа>
			<v8:АтрибутыНедоступны>false</v8:АтрибутыНедоступны>
			<v8:АтрибутыСкрыты>false</v8:АтрибутыСкрыты>
			<v8:ЗавершающийЭтап>false</v8:ЗавершающийЭтап>
			<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">00000000-0000-0000-0000-000000000000</v8:Исполнитель>
			<v8:ОбработчикПередВыполнением/>
			<v8:ОбработчикПередЗаписью/>
			<v8:ОбработчикПослеВыполнения/>
			<v8:ОбработчикПриЗаписи/>
			<v8:ОбработчикПриПереходе>Инцидент.СтатусИМ = Перечисления.КА_СтатусИМ.ВРаботеУМенеджера;

// Отправка статуса

НастройкаОбмена = Справочники.КА_НастройкиВыгрузкиВИМ.ПолучитьНастройку("Рекламация_СобытиеВыгрузкаСтатуса");

СоответствиеСтатусов = Новый Соответствие;
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ЗапросОтправлен, "SENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВРаботеУМенеджера, "PROCESS_BY_MANAGER");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.УточнитеДанныеОбращения, "CLARIFY_DETAILS");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВРаботеУИнженера, "PROCESS_BY_ENGINEER");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияПринятаВРаботуГарантийнымОтделом, "PROCESS_BY_WARRANTY_DEPARTMENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияПринятаУточняемСрокРассмотрения, "ACCEPTED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВозвратДеталиНаЭкспертизу, "EXPERTIZE");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОдобренаВыберитеСпособКомпенсации, "APPROVED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОтклоненаОзнакомьтесьСЗаключением, "REJECTED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ЗакрытоИПеренесеноВархивПоСрокуДавности, "CLOSED_ON_EXPIRATION");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияЗавершенаКлиентСогласен, "CLOSED_ON_AGREEMENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияЗавершенаКомпенсацияПредоставлена, "COMPENSATED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламациНаправленаВОтделКорпоративныхПродаж, "SENT_TO_SALES");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОдобрена50ВыберитеСпособКомпенсации, "APPROVED_50");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОтклоненаПовторно, "REJECTED_REPEATEDLY");

СтрДанных = Новый Структура;
СтрДанных.Вставить("complaintId", ЗначенияАтрибутов["id"]);
СтрДанных.Вставить("status", СоответствиеСтатусов[Инцидент.СтатусИМ]);

КА_Обмены.ОтправитьВСервис_Рефакторинг(СтрДанных, НастройкаОбмена, "ИМ2");

//Обрабатываем Пользователей  в поля инцидента по этапу 
Инцидент.Ответственный  = ЗначенияАтрибутов["ОтветственныйМКО"];

// Рассылка исполнителям
Тема = СтрШаблон("Обновлен статус рекламации %1 %2", Инцидент.Номер, ЗначенияАтрибутов["counterparty_external_id"]);
ТекстПисьма = Инцидент.ИсторияВыполнения[Инцидент.ИсторияВыполнения.Количество()-1].Результат;
М = Новый Массив;
М.Добавить(Инцидент.Ответственный);
Документы.КА_Инцидент.ОтправитьОповещение(М, Тема, ТекстПисьма);
//Документы.КА_Инцидент.ОтправитьОповещениеИсполнителямЭтапа(СледующийЭтап, Тема, ТекстПисьма);;</v8:ОбработчикПриПереходе>
			<v8:ОбработчикПриПринятииКИсполнению/>
			<v8:ОбработчикПроведения/>
			<v8:Описание>МКО по запросу инженера по своим каналам, минуя ИМ, согласовывает увеличенный срок рассмотрения для рекламации.
После получения нового срока, требуется указать его в АРМ Инциденты по кнопке "Изменить срок".

Следует помнить, что указывается новая дата и время, а не количество часов, к которому инженеру нужно принять решение.
Результатом переноса срока станет откорректированная запись во вкладе История после перехода на следующий этап по кнопке Выполнено</v8:Описание>
			<v8:ПроверятьРезультат>true</v8:ПроверятьРезультат>
			<v8:СрокВыполнения>2</v8:СрокВыполнения>
			<v8:СообщениеНедоступныПереходы/>
			<v8:ОбработчикПриОткрытии/>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">3ab46ee4-8b6b-4e27-b05f-aa6c943c5895</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">6547e112-2de4-4388-82f0-4b24ca0eee42</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">6d160a64-dd08-11e4-b0fd-001517ac6c09</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">f6af22ec-7751-4f7a-bc7e-df85edb3c04f</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">19daaf30-9a1a-11e8-80c5-3cfdfeaf9019</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">97eb7d45-6782-4b33-9909-457572becfa8</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">b783b0ba-74ad-11e1-b634-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">812e0c18-3beb-11e8-80d0-001e6707aaa8</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">f149ab7d-7ada-11e8-80c5-3cfdfeaf9019</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">58a84576-77c0-4e0e-b065-1be30ab00af9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">0cafad1c-4262-11e1-b48c-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">c34b8004-ec1d-11e5-80c5-001e6707aaa8</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">ddcd8a22-00dc-11e4-9396-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">a0477a02-97f8-11e5-9a83-001517ac6c09</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">d912235c-81fd-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода/>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">e212d35a-81fd-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода/>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">c10475bc-8798-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">ae2bfd6f-8798-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">7770acee-8e55-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">f9220711-8795-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">e5acad73-a62b-11ec-bba8-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">579bcceb-8e55-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">28c3acd3-ba33-11ec-bba2-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">20e9e340-bc98-11ec-bbaf-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">e983c36e-bc97-11ec-bbaf-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">578c447d-b974-11ec-bba2-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">1e160f11-bca1-11ec-bba2-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">455e5227-8e55-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">c9ae9a45-d6cc-11ec-bbaf-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">1b4886c4-d6cd-11ec-bbaf-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">b444c315-5f3e-11ed-bba5-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
		</v8:CatalogObject.КА_ЭтапыИнцидентов>
		<v8:CatalogObject.КА_ЭтапыИнцидентов>
			<v8:Ref xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">d2b59609-81fd-11ec-bb9e-00155d70bd06</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Owner xsi:type="v8:CatalogRef.КА_ВидыИнцидентов">fe697b45-4e2c-11ec-bba8-00155d258b03</v8:Owner>
			<v8:Code>000000027</v8:Code>
			<v8:Description>В работе у Инженера</v8:Description>
			<v8:АвтоматическийСтартЭтапа>false</v8:АвтоматическийСтартЭтапа>
			<v8:АвтоматическоеЗавершениеЭтапа>false</v8:АвтоматическоеЗавершениеЭтапа>
			<v8:АтрибутыНедоступны>false</v8:АтрибутыНедоступны>
			<v8:АтрибутыСкрыты>false</v8:АтрибутыСкрыты>
			<v8:ЗавершающийЭтап>false</v8:ЗавершающийЭтап>
			<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">00000000-0000-0000-0000-000000000000</v8:Исполнитель>
			<v8:ОбработчикПередВыполнением/>
			<v8:ОбработчикПередЗаписью/>
			<v8:ОбработчикПослеВыполнения/>
			<v8:ОбработчикПриЗаписи/>
			<v8:ОбработчикПриПереходе>Инцидент.СтатусИМ = Перечисления.КА_СтатусИМ.ВРаботеУИнженера;

// Отправка статуса

НастройкаОбмена = Справочники.КА_НастройкиВыгрузкиВИМ.ПолучитьНастройку("Рекламация_СобытиеВыгрузкаСтатуса");

СоответствиеСтатусов = Новый Соответствие;
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ЗапросОтправлен, "SENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВРаботеУМенеджера, "PROCESS_BY_MANAGER");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.УточнитеДанныеОбращения, "CLARIFY_DETAILS");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВРаботеУИнженера, "PROCESS_BY_ENGINEER");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияПринятаВРаботуГарантийнымОтделом, "PROCESS_BY_WARRANTY_DEPARTMENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияПринятаУточняемСрокРассмотрения, "ACCEPTED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВозвратДеталиНаЭкспертизу, "EXPERTIZE");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОдобренаВыберитеСпособКомпенсации, "APPROVED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОтклоненаОзнакомьтесьСЗаключением, "REJECTED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ЗакрытоИПеренесеноВархивПоСрокуДавности, "CLOSED_ON_EXPIRATION");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияЗавершенаКлиентСогласен, "CLOSED_ON_AGREEMENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияЗавершенаКомпенсацияПредоставлена, "COMPENSATED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламациНаправленаВОтделКорпоративныхПродаж, "SENT_TO_SALES");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОдобрена50ВыберитеСпособКомпенсации, "APPROVED_50");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОтклоненаПовторно, "REJECTED_REPEATEDLY");

СтрДанных = Новый Структура;
СтрДанных.Вставить("complaintId", ЗначенияАтрибутов["id"]);
СтрДанных.Вставить("status", СоответствиеСтатусов[Инцидент.СтатусИМ]);

КА_Обмены.ОтправитьВСервис_Рефакторинг(СтрДанных, НастройкаОбмена, "ИМ2");


//Обрабатываем Пользователей  в поля инцидента по этапу
Инцидент.Ответственный  = ЗначенияАтрибутов["ОтветственныйИнженер"];

// Рассылка исполнителям
Тема = СтрШаблон("Обновлен статус рекламации %1", Инцидент.Номер);
ТекстПисьма = СледующийЭтап.Описание;
Документы.КА_Инцидент.ОтправитьОповещениеИсполнителямЭтапа(СледующийЭтап, Тема, ТекстПисьма);</v8:ОбработчикПриПереходе>
			<v8:ОбработчикПриПринятииКИсполнению/>
			<v8:ОбработчикПроведения/>
			<v8:Описание>Инженер нажимает кнопку «Принять к исполнению»

Он проверяет все данные, фото- и видеоматериалы, оценивет, уложится ли он в срок.

После чего нажимает кнопку "Выполнено" и выбирает один из вариантов:

- "В работе у МКО" - если данных недостаточно, и требуется запросить что-либо дополнительно
- "В работе у Инженера. Стандартный срок рассмотрения" - если данных достаточно и инженер готов приступить к рассмотрению инцидента
- "Уточнение срока рассмотрения" - если данных достаточно, но времени на рассмотрение инцидента объективно не хватает. В этом случае МКО может согласовать срок рассмотрения, отличный от стандартного</v8:Описание>
			<v8:ПроверятьРезультат>true</v8:ПроверятьРезультат>
			<v8:СрокВыполнения>2</v8:СрокВыполнения>
			<v8:СообщениеНедоступныПереходы/>
			<v8:ОбработчикПриОткрытии/>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">06509fbe-a8c9-11e2-bca0-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">5fe94a47-f3ca-11e8-80d4-3cfdfeaf9019</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">9514bbf0-4093-426e-a611-7f991186491c</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">3066ae6a-9659-4e7d-a45f-557d5426b02e</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">2240a7f1-b122-4059-af3e-2b26895c805d</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">408f3bee-cea7-4a35-ab09-ade297d74fe3</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">7dfb237c-c4ed-4048-9fd3-71b19e087798</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">8deae651-a246-408f-af9e-589cf73f953f</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">07d158b7-54ba-11e7-80ce-001e6707aaa8</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">c9cc2bd9-81fd-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода/>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">d912235c-81fd-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>true</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода/>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">e212d359-81fd-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода/>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">f9220711-8795-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">7770acee-8e55-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">e5acad73-a62b-11ec-bba8-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">ae2bfd6f-8798-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">c10475bc-8798-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">579bcceb-8e55-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">28c3acd3-ba33-11ec-bba2-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">20e9e340-bc98-11ec-bbaf-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">e983c36e-bc97-11ec-bbaf-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">578c447d-b974-11ec-bba2-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">1e160f11-bca1-11ec-bba2-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">455e5227-8e55-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">f6327d2c-d1c5-11ec-bbaf-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">1cf61873-ba50-11ec-bba2-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">a40c9242-5e35-11ec-bba8-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">c9ae9a45-d6cc-11ec-bbaf-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">b444c315-5f3e-11ed-bba5-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
		</v8:CatalogObject.КА_ЭтапыИнцидентов>
		<v8:CatalogObject.КА_ЭтапыИнцидентов>
			<v8:Ref xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">d912235d-81fd-11ec-bb9e-00155d70bd06</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Owner xsi:type="v8:CatalogRef.КА_ВидыИнцидентов">fe697b45-4e2c-11ec-bba8-00155d258b03</v8:Owner>
			<v8:Code>000000029</v8:Code>
			<v8:Description>Уточнение данных рекламации </v8:Description>
			<v8:АвтоматическийСтартЭтапа>false</v8:АвтоматическийСтартЭтапа>
			<v8:АвтоматическоеЗавершениеЭтапа>false</v8:АвтоматическоеЗавершениеЭтапа>
			<v8:АтрибутыНедоступны>false</v8:АтрибутыНедоступны>
			<v8:АтрибутыСкрыты>false</v8:АтрибутыСкрыты>
			<v8:ЗавершающийЭтап>false</v8:ЗавершающийЭтап>
			<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">00000000-0000-0000-0000-000000000000</v8:Исполнитель>
			<v8:ОбработчикПередВыполнением/>
			<v8:ОбработчикПередЗаписью>Инцидент = ЭтотОбъект; 

ДокРТС = Инцидент.ПолучитьАтрибутИнцидента("realizationId");
НоменклатураСтрокиТаблицы = Инцидент.ПолучитьАтрибутИнцидента("productId");
ОтборКолонкиТовары = Новый Структура("Номенклатура",НоменклатураСтрокиТаблицы); 
//стр 7
ДанныеАналитикиДефекта = Новый Структура;
ДанныеАналитикиДефекта.Вставить("Наименование","");
ДанныеАналитикиДефекта.Вставить("МаркаТС",Инцидент.ПолучитьАтрибутИнцидента("brand"));
ДанныеАналитикиДефекта.Вставить("МодельТС",Инцидент.ПолучитьАтрибутИнцидента("model"));
ДанныеАналитикиДефекта.Вставить("VIN",Инцидент.ПолучитьАтрибутИнцидента("vin"));
ДанныеАналитикиДефекта.Вставить("УсловияПриКоторыхОбнаруженДеффект",Инцидент.ПолучитьАтрибутИнцидента("defectFound"));
ДанныеАналитикиДефекта.Вставить("СпособМонтажаДетали",Инцидент.ПолучитьАтрибутИнцидента("installation"));
ДанныеАналитикиДефекта.Вставить("ДатаМонтажаДетали",Инцидент.ПолучитьАтрибутИнцидента("installationDate"));
ДанныеАналитикиДефекта.Вставить("ПробегТСМонтаж",Инцидент.ПолучитьАтрибутИнцидента("mileageInstallation"));
ДанныеАналитикиДефекта.Вставить("ДатаДемонтажаДетали",Инцидент.ПолучитьАтрибутИнцидента("dismantlingDate"));
ДанныеАналитикиДефекта.Вставить("ПробегТСДемонтаж",Инцидент.ПолучитьАтрибутИнцидента("mileageDismantling"));
ЭлементАналитикиДефекта = Справочники.КА_АналитикаДефекта.СоздатьЭлементСправочника(ДанныеАналитикиДефекта);

//Заполним таблицу атрибутов документа
Инцидент.УстановитьАтрибутИнцидента("Товар вернуть", Инцидент.ПолучитьАтрибутИнцидента("Товар вернуть"),Ложь);
Инцидент.УстановитьАтрибутИнцидента("ОтветственныйМКО", ДокРТС.Ссылка.Партнер.ОсновнойМенеджер,Ложь);
Инцидент.УстановитьАтрибутИнцидента("Ответственный МОР", ДокРТС.Ссылка.Партнер.КА_ОсновнойКураторПокупателя,Ложь);
//СТр 109 Ответственный НОР из реализации
ФлНОР = ДокРТС.Партнер.КА_ПризнакГруппыКлиентов.ТекущийРуководитель;
ПоискНОР = Справочники.Пользователи.НайтиПоРеквизиту("ФизическоеЛицо", ФлНОР);
Если ЗначениеЗаполнено(ПоискНор) Тогда
	Инцидент.УстановитьАтрибутИнцидента("ОтветственныйНОР", ПоискНор.Ссылка,Ложь);
КонецЕсли;
пОтветственныйИнженер = Инцидент.ПолучитьАтрибутИнцидента("ОтветственныйИнженер");
пОтветственныйЗаТГ = Инцидент.ПолучитьАтрибутИнцидента("ОтветственныйЗаТГ");
МассивАтрибутов = Инцидент.ВидИнцидента.НаборАтрибутов.ВыгрузитьКолонку("Атрибут");
МассивАтрибутов = ОбщегоНазначенияКлиентСервер.СвернутьМассив(МассивАтрибутов);

ТаблицаАтрибутовДокумента = Инцидент.ЗначенияАтрибутов.Выгрузить();
ТаблицаЗначенийАтрибутов = ТаблицаАтрибутовДокумента.Скопировать();
//Стр 44  
//НомерСтрокиТаблицы = ТаблицаЗначенийАтрибутов[0].НомерСтрокиТаблицы;
//ТаблицаОриг = ТаблицаЗначенийАтрибутов[0].Таблица;
//Для Каждого ТекАтрибут из МассивАтрибутов Цикл
//	НС = ТаблицаАтрибутовДокумента.НайтиСтроки(Новый Структура("Атрибут", ТекАтрибут));
//	Если НС = Неопределено Тогда
//		Продолжить;
//	ИначеЕсли НС.Количество()=0 Тогда 
//	    НС = ТаблицаАтрибутовДокумента.Добавить();
//	    НС.Атрибут = ТекАтрибут;
//	    НС.Таблица = ТаблицаОриг;
//	    НС.НомерСтрокиТаблицы = НомерСтрокиТаблицы;
//	    НС.Значение = Инцидент.ПолучитьАтрибутИнцидента(ТекАтрибут.Идентификатор);
//	ИначеЕсли НС.Количество() &gt; 0 Тогда
//		НС[0].Значение = Инцидент.ПолучитьАтрибутИнцидента(ТекАтрибут.Идентификатор);
//	КонецЕсли;
//КонецЦикла;
//Инцидент.ЗначенияАтрибутов.Загрузить(ТаблицаАтрибутовДокумента);
//Стр 62
ТаблицаТовары = ДокРТС.Товары.Выгрузить();

СтрокаРТС = ТаблицаТовары.Скопировать(ОтборКолонкиТовары);
Инцидент.Товары.Очистить();
Инцидент.Товары.Загрузить(СтрокаРТС.Скопировать());

ТаблицаТоваров = Инцидент.Товары.Выгрузить();

//Стр 71
НайденСклад = Справочники.Склады.ПустаяСсылка();
Если ЗначениеЗаполнено(ДокРТС.Ссылка.Склад) Тогда
	НайденСклад =  ДокРТС.Ссылка.Склад;
КонецЕсли; 
Инцидент.УстановитьАтрибутИнцидента("Склад", НайденСклад,Ложь);
Инцидент.УстановитьАтрибутИнцидента("Клиент", ДокРТС.Партнер);
Инцидент.УстановитьАтрибутИнцидента("Контрагент", ДокРТС.Контрагент);
АтрибутПоступление = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоНаименованию("ДокументПоступления");
АтрибутСклад = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоНаименованию("Склад");
СписокПоступление = Новый СписокЗначений;
КоличествоПоРекламации = Инцидент.ПолучитьАтрибутИнцидента("count"); 
СвязОбъекты = Инцидент.СвязанныеОбъекты.Выгрузить();
Для каждого ТекСтрока Из ТаблицаТоваров Цикл
	Если КоличествоПоРекламации&gt;0 Тогда
		ТекСтрока.КА_КоличествоПродано = ТекСтрока.Количество;
	    Если КоличествоПоРекламации &lt; ТекСтрока.Количество Тогда
			ТекСтрока.Цена = ТекСтрока.Сумма/ТекСтрока.Количество;
			ТекСтрока.Сумма = КоличествоПоРекламации * ТекСтрока.Цена;
			ТекСтрока.СуммаНДС = (ТекСтрока.СуммаНДС / ТекСтрока.Количество) * КоличествоПоРекламации;
			ТекСтрока.СуммаСНДС = (ТекСтрока.СуммаСНДС/ТекСтрока.Количество) * КоличествоПоРекламации;
			ТекСтрока.Количество = КоличествоПоРекламации;
			КоличествоПоРекламации = 0;
	    Иначе
			ТекСтрока.Сумма = ТекСтрока.Сумма;
			ТекСтрока.Количество = ТекСтрока.Количество;
			ТекСтрока.СуммаНДС = ТекСтрока.СуммаНДС;
			ТекСтрока.СуммаСНДС = ТекСтрока.СуммаСНДС;
			КоличествоПоРекламации = КоличествоПоРекламации - ТекСтрока.Количество;
	    КонецЕсли;
		Если ЗначениеЗаполнено(ТекСтрока.Серия) Тогда
			Если не (ТекСтрока.Серия.КА_ДокументПоступления = Документы.ПоступлениеТоваровУслуг.ПустаяСсылка()) Тогда
				СписокПоступление.Добавить(ТекСтрока.Серия.КА_ДокументПоступления,"ДокументПоступления");
				ДобОбъект = СвязОбъекты.Найти(ТекСтрока.Серия.КА_ДокументПоступления, "Объект");
				Если ДобОбъект = Неопределено Тогда 
					ДобОбъект = СвязОбъекты.Добавить();
					ДобОбъект.Объект = ТекСтрока.Серия.КА_ДокументПоступления;
				КонецЕсли;
//				Инцидент.СвязатьСОбъектом(ТекСтрока.Серия.КА_ДокументПоступления);
			КонецЕсли;
		КонецЕсли;
	Иначе
	    ТекСтрока.Количество = 0;
	    ТекСтрока.КоличествоУпаковок = 0; 
	    ТекСтрока.Сумма  = 0;
	    ТекСтрока.СуммаНДС = 0;
	    ТекСтрока.СуммаСНДС = 0;
	КонецЕсли;
//Стр 112
	ТекСтрока.КоличествоУпаковок = ТекСтрока.Количество;
	ТекСтрока.ВидНоменклатуры = ТекСтрока.Номенклатура.ВидНоменклатуры;
	ТекСтрока.Бренд = ТекСтрока.Номенклатура.Марка;
	ТекСтрока.Организация = ДокРТС.Ссылка.Организация;
	ТекСтрока.Клиент = ДокРТС.Ссылка.Партнер;
	ТекСтрока.Контрагент = ДокРТС.Ссылка.Контрагент;
	ТекСтрока.Склад = ДокРТС.Ссылка.Склад;
	ТекСтрока.Соглашение = ДокРТС.Ссылка.Соглашение;
	ТекСтрока.Договор = ДокРТС.Ссылка.Договор;
	ТекСтрока.ЗаказКлиента = ДокРТС.Ссылка.ЗаказКлиента;
    ТекСтрока.Валюта = ДокРТС.Валюта;
  	ТекСтрока.АналитикаДефекта = ЭлементАналитикиДефекта;
	Если не ЗначениеЗаполнено(ТекСтрока.Упаковка) Тогда
		ТекСтрока.Упаковка = ТекСтрока.Номенклатура.ЕдиницаИзмерения;
	КонецЕсли;
	ТекСтрока.НомерГТД = ТекСтрока.Серия.КА_НомерГТД;
	НомерГТД = Строка(ТекСтрока.НомерГТД.Код); 
	ПозДатыГТД=СтрНайти(НомерГТД, "/");
	Если ПозДатыГТД &gt; 0 Тогда 
		ДатаГТД = Сред(НомерГТД, ПозДатыГТД+1, 8);
		ТекСтрока.ДатаГТД = Дата("20"+Сред(ДатаГТД,5,2),Сред(ДатаГТД,3,2),Сред(ДатаГТД,1,2));
	КонецЕсли; 
    Если не ЗначениеЗаполнено(ТекСтрока.Валюта) Тогда
   		ТекСтрока.Валюта = ДокРТС.Ссылка.Валюта; 
   	КонецЕсли;
	Если не ЗначениеЗаполнено(пОтветственныйИнженер) или пОтветственныйИнженер = Справочники.Пользователи.ПустаяСсылка() Тогда 
		пОтветственныйИнженер = ТекСтрока.Номенклатура.ВидНоменклатуры.КА_ОтветственныйИнженер;
	КонецЕсли; 
	Если не ЗначениеЗаполнено(пОтветственныйЗаТГ) или пОтветственныйЗаТГ = Справочники.Пользователи.ПустаяСсылка() Тогда 
		//пОтветственныйЗаТГ = ТекСтрока.Номенклатура.ВидНоменклатуры.КА_ОтветственныйЗаТГ;
		Запрос = Новый Запрос; 
		Запрос.Текст = "ВЫБРАТЬ
		|	КА_ОтветственныеЗаТоварныеГруппы.Исполнитель КАК Исполнитель
		|ИЗ
		|	РегистрСведений.КА_ОтветственныеЗаТоварныеГруппы КАК КА_ОтветственныеЗаТоварныеГруппы
		|ГДЕ
		|	КА_ОтветственныеЗаТоварныеГруппы.ВидНоменклатуры = &amp;ВидНоменклатуры
		|	И КА_ОтветственныеЗаТоварныеГруппы.ДатаНачала &lt;= &amp;ВыбДата
		|	И КА_ОтветственныеЗаТоварныеГруппы.ДатаОкончания &gt;= &amp;ВыбДата";
		Запрос.УстановитьПараметр("ВидНоменклатуры", ТекСтрока.Номенклатура.ВидНоменклатуры); 
		Запрос.УстановитьПараметр("ВыбДата", ТекущаяДата());
		Рез = Запрос.Выполнить().Выгрузить();  
		Если Рез.Количество() &gt; 0 Тогда 
			пОтветственныйЗаТГ = Рез[0].Исполнитель; 
		КонецЕсли;
	КонецЕсли; 
КонецЦикла;

//Стр 145
//Лупонос Д.В. Чистим строки с количеством = 0 
//Для Каждого ТекСтр Из ТаблицаТоваров Цикл
//	Если не ТекСтр.КоличествоУпаковок &gt; 0 Тогда 
//		ТаблицаТоваров.Удалить(ТекСтр);
//	КонецЕсли;	
//КонецЦикла;
СтрокиСНулевымКоличеством = ТаблицаТоваров.НайтиСтроки(Новый Структура("КоличествоУпаковок",0));
Если не СтрокиСНулевымКоличеством = Неопределено Тогда 
	МаксимальныйНомерСтроки = СтрокиСНулевымКоличеством.Количество()-1;
	Для ТекСтрСч = 0 по МаксимальныйНомерСтроки Цикл 
		ТаблицаТоваров.Удалить(СтрокиСНулевымКоличеством[МаксимальныйНомерСтроки - ТекСтрСч]);
	КонецЦикла;
КонецЕсли; 
//Лупонос Д.В. Чистим строки с количеством = 0 

Инцидент.Товары.Загрузить(ТаблицаТоваров);

ТаблицаАтрибутовДокумента = Инцидент.ЗначенияАтрибутов.Выгрузить();
АтрибутПоиск = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоНаименованию("ОтветственныйИнженер");
Стр = ТаблицаАтрибутовДокумента.Найти(АтрибутПоиск,"Атрибут");
Если Стр = Неопределено Тогда
	Стр = ТаблицаАтрибутовДокумента.Добавить();
	Стр.Атрибут = АтрибутПоиск;
КонецЕсли;
Стр.Значение = пОтветственныйИнженер; 
АтрибутПоиск = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоНаименованию("ОтветственныйЗаТГ");
Стр = ТаблицаАтрибутовДокумента.Найти(АтрибутПоиск,"Атрибут");
Если Стр = Неопределено Тогда
	Стр = ТаблицаАтрибутовДокумента.Добавить();
	Стр.Атрибут = АтрибутПоиск;
КонецЕсли;
Стр.Значение = пОтветственныйЗаТГ; 
Инцидент.ЗначенияАтрибутов.Загрузить(ТаблицаАтрибутовДокумента);

Если ЗначениеЗаполнено(Инцидент.ПолучитьАтрибутИнцидента("realizationId")) Тогда
	ДобОбъект = СвязОбъекты.Найти(Инцидент.ПолучитьАтрибутИнцидента("realizationId"), "Объект");
	Если ДобОбъект = Неопределено Тогда 
		ДобОбъект = СвязОбъекты.Добавить();
		ДобОбъект.Объект = Инцидент.ПолучитьАтрибутИнцидента("realizationId");
	КонецЕсли;
КонецЕсли;

Инцидент.СвязанныеОбъекты.Загрузить(СвязОбъекты);


</v8:ОбработчикПередЗаписью>
			<v8:ОбработчикПослеВыполнения>ИнцидентЗапрос = Документы.КА_Инцидент.ПустаяСсылка(); 

Для Каждого Стр из Инцидент.СвязанныеОбъекты Цикл
	Если ТипЗнч(Стр.Объект) = Тип("ДокументСсылка.КА_Инцидент") Тогда 
		Если СтрНайти(Стр.Объект.ВидИнцидента.Наименование, "запрос поставщику") &gt;0 Тогда 
			Если СтрНайти(Стр.Объект.ТекущийЭтап.Наименование, "менеджера ДС") &gt; 0 Тогда 
				ИнцидентЗапрос = Стр.Объект;
				Прервать; 
			КонецЕсли; 
		КонецЕсли; 
	КонецЕсли; 
КонецЦикла; 

Если не ИнцидентЗапрос = Документы.КА_Инцидент.ПустаяСсылка() Тогда 
	ИнцидентОбъект = ИнцидентЗапрос.Ссылка.ПолучитьОбъект(); 
	СпкАтрибутов = Новый СписокЗначений; 
	НовРТУ = ЗначенияАтрибутов["realizationID"]; 
//	НовРТУ = ЭтотИнцидент.ПолучитьАтрибут("realizationID"); //Стр17	
	СпкАтрибутов.Добавить(НовРТУ,"realizationID");
	СпкАтрибутов.Добавить(ЗначенияАтрибутов["count"],"count"); 	
//	СпкАтрибутов.Добавить(ЭтотИнцидент.ПолучитьАтрибут("count"),"count"); 	
	ИнцидентОбъект.УстановитьАтрибутыИнцидента(СпкАтрибутов,Ложь);
//	ИнцидентОбъект.СвязатьСОбъектом(ИнцидентОбъект.ПолучитьАтрибут("realizationID"), Ложь);
	СвязОб = ИнцидентОбъект.СвязанныеОбъекты.Выгрузить(); 
	НайденРТУ = СвязОб.Найти(НовРТУ, "Объект");
	Если НайденРТУ = Неопределено Тогда 
		НайденРТУ = СвязОб.Добавить();
		НайденРТУ.Объект = НовРТУ;
		ИнцидентОбъект.СвязанныеОбъекты.Загрузить(СвязОб); 
	КонецЕсли;
	ИнцидентОбъект.Товары.Загрузить(Инцидент.Товары.Выгрузить());
	ИнцидентОбъект.Записать();
КонецЕсли; 
</v8:ОбработчикПослеВыполнения>
			<v8:ОбработчикПриЗаписи/>
			<v8:ОбработчикПриПереходе>Инцидент.СтатусИМ = Перечисления.КА_СтатусИМ.ВРаботеУМенеджера;

Инцидент.Ответственный =  ЗначенияАтрибутов["ОтветственныйМКО"];

// Отправка статуса

НастройкаОбмена = Справочники.КА_НастройкиВыгрузкиВИМ.ПолучитьНастройку("Рекламация_СобытиеВыгрузкаСтатуса");

СоответствиеСтатусов = Новый Соответствие;
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ЗапросОтправлен, "SENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВРаботеУМенеджера, "PROCESS_BY_MANAGER");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.УточнитеДанныеОбращения, "CLARIFY_DETAILS");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВРаботеУИнженера, "PROCESS_BY_ENGINEER");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияПринятаВРаботуГарантийнымОтделом, "PROCESS_BY_WARRANTY_DEPARTMENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияПринятаУточняемСрокРассмотрения, "ACCEPTED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВозвратДеталиНаЭкспертизу, "EXPERTIZE");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОдобренаВыберитеСпособКомпенсации, "APPROVED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОтклоненаОзнакомьтесьСЗаключением, "REJECTED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ЗакрытоИПеренесеноВархивПоСрокуДавности, "CLOSED_ON_EXPIRATION");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияЗавершенаКлиентСогласен, "CLOSED_ON_AGREEMENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияЗавершенаКомпенсацияПредоставлена, "COMPENSATED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламациНаправленаВОтделКорпоративныхПродаж, "SENT_TO_SALES");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОдобрена50ВыберитеСпособКомпенсации, "APPROVED_50");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОтклоненаПовторно, "REJECTED_REPEATEDLY");

СтрДанных = Новый Структура;
СтрДанных.Вставить("complaintId", ЗначенияАтрибутов["id"]);
СтрДанных.Вставить("status", СоответствиеСтатусов[Инцидент.СтатусИМ]);

КА_Обмены.ОтправитьВСервис_Рефакторинг(СтрДанных, НастройкаОбмена, "ИМ2");

// Рассылка исполнителям
Тема = СтрШаблон("Обновлен статус рекламации %1 %2", Инцидент.Номер, ЗначенияАтрибутов["counterparty_external_id"]);
ТекстПисьма = Инцидент.ИсторияВыполнения[Инцидент.ИсторияВыполнения.Количество()-1].Результат;
М = Новый Массив;
М.Добавить(Инцидент.Ответственный);
Документы.КА_Инцидент.ОтправитьОповещение(М, Тема, ТекстПисьма);
//Документы.КА_Инцидент.ОтправитьОповещениеИсполнителямЭтапа(СледующийЭтап, Тема, ТекстПисьма);;</v8:ОбработчикПриПереходе>
			<v8:ОбработчикПриПринятииКИсполнению/>
			<v8:ОбработчикПроведения/>
			<v8:Описание>МКО нажимает Принять к исполнению.
В случае, если клиент не может/ не хочет вносить изменения на сайте, МКО может заполнить дополнительные данные вручную, не через сайт.
После внесения изменений МКО нажимает "Выполнено" и инцидент переходит на этап "В работе у Инженера"</v8:Описание>
			<v8:ПроверятьРезультат>true</v8:ПроверятьРезультат>
			<v8:СрокВыполнения>255</v8:СрокВыполнения>
			<v8:СообщениеНедоступныПереходы/>
			<v8:ОбработчикПриОткрытии>Элементы.ТаблицаОбращение.ТолькоПросмотр = Ложь;
Элементы.ТоварыОбращение.ТолькоПросмотр = Ложь;

Элементы.ТаблицаРассмотрение.ТолькоПросмотр = Ложь;
Элементы.ТоварыРассмотрение.ТолькоПросмотр = Ложь;</v8:ОбработчикПриОткрытии>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">3ab46ee4-8b6b-4e27-b05f-aa6c943c5895</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">6547e112-2de4-4388-82f0-4b24ca0eee42</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">6d160a64-dd08-11e4-b0fd-001517ac6c09</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">f6af22ec-7751-4f7a-bc7e-df85edb3c04f</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">19daaf30-9a1a-11e8-80c5-3cfdfeaf9019</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">97eb7d45-6782-4b33-9909-457572becfa8</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">b783b0ba-74ad-11e1-b634-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">812e0c18-3beb-11e8-80d0-001e6707aaa8</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">f149ab7d-7ada-11e8-80c5-3cfdfeaf9019</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">58a84576-77c0-4e0e-b065-1be30ab00af9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">0cafad1c-4262-11e1-b48c-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">c34b8004-ec1d-11e5-80c5-001e6707aaa8</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">ddcd8a22-00dc-11e4-9396-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">a0477a02-97f8-11e5-9a83-001517ac6c09</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">d2b59609-81fd-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>Если НЕ РольДоступна("ПолныеПрава") Тогда
	Если ЗначенияАтрибутов["ДополнитьДанныеВручную"] = Истина 
		Тогда
		Отказ = Истина;
	КонецЕсли;
КонецЕсли;
</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">024c7838-81fe-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>Если НЕ РольДоступна("ПолныеПрава") Тогда
	Если ЗначенияАтрибутов["ТоварВернуть"] &lt;&gt; Истина 
		Тогда
		Отказ = Истина;
	КонецЕсли;
КонецЕсли;
</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">fba53040-81fd-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>Если НЕ РольДоступна("ПолныеПрава") Тогда
	Если ЗначенияАтрибутов["ТоварВернуть"] = Истина
	ИЛИ
	ЗначенияАтрибутов["Экспертиза"] = Перечисления.КА_ДоставитьТоварНаЭкспертизу.Да
	//ЗначенияАтрибутов["Экспертиза"] = Истина
			Тогда
		Отказ = Истина;
	КонецЕсли;
	
КонецЕсли;
</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">d912235c-81fd-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>Если НЕ РольДоступна("ПолныеПрава") Тогда

	Для Каждого Стр из Инцидент.ИсторияВыполнения Цикл
		Если ЗначениеЗаполнено(Стр.Этап) Тогда
		Если СтрНайти(Стр.Этап.Наименование,"Возврат детали на экспертизу. Решение по экспертиз") Тогда
			Отказ = Ложь;
			Прервать;

			// Все ок
			Иначе	
				Отказ = Истина;
		КонецЕсли;
		КонецЕсли;
	КонецЦикла;

КонецЕсли;</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">e5acad73-a62b-11ec-bba8-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">f9220711-8795-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">7770acee-8e55-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">ae2bfd6f-8798-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">c10475bc-8798-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">28c3acd3-ba33-11ec-bba2-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">20e9e340-bc98-11ec-bbaf-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">e983c36e-bc97-11ec-bbaf-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">578c447d-b974-11ec-bba2-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">1e160f11-bca1-11ec-bba2-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">c41bdd9c-67ef-11ec-bba8-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">413c9a50-673f-11ec-bba8-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>true</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">3da7cce6-6746-11ec-bba8-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>true</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">a40c9242-5e35-11ec-bba8-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>true</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">06653895-673f-11ec-bba8-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">82011875-6746-11ec-bba8-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">edb75284-673e-11ec-bba8-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">6d505a82-67f0-11ec-bba8-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">5953c67e-67f0-11ec-bba8-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">a7ce5483-67ef-11ec-bba8-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">cccbef96-673e-11ec-bba8-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>true</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">b41ea743-66f8-11ec-bba8-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>true</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">b926251e-39ba-11e9-80cc-00155d049008</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">c9ae9a45-d6cc-11ec-bbaf-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">1b4886c4-d6cd-11ec-bbaf-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">b444c315-5f3e-11ed-bba5-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
		</v8:CatalogObject.КА_ЭтапыИнцидентов>
		<v8:CatalogObject.КА_ЭтапыИнцидентов>
			<v8:Ref xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">c9cc2bda-81fd-11ec-bb9e-00155d70bd06</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Owner xsi:type="v8:CatalogRef.КА_ВидыИнцидентов">fe697b45-4e2c-11ec-bba8-00155d258b03</v8:Owner>
			<v8:Code>000000026</v8:Code>
			<v8:Description>В работе у клиента. Уточнение данных</v8:Description>
			<v8:АвтоматическийСтартЭтапа>false</v8:АвтоматическийСтартЭтапа>
			<v8:АвтоматическоеЗавершениеЭтапа>true</v8:АвтоматическоеЗавершениеЭтапа>
			<v8:АтрибутыНедоступны>false</v8:АтрибутыНедоступны>
			<v8:АтрибутыСкрыты>false</v8:АтрибутыСкрыты>
			<v8:ЗавершающийЭтап>false</v8:ЗавершающийЭтап>
			<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">00000000-0000-0000-0000-000000000000</v8:Исполнитель>
			<v8:ОбработчикПередВыполнением/>
			<v8:ОбработчикПередЗаписью>
Если ЗначениеЗаполнено(ДополнительныеСвойства.ЗначенияАтрибутов["realizationId"])
	И ЗначениеЗаполнено(ДополнительныеСвойства.ЗначенияАтрибутов["productId"])
	И ЗначениеЗаполнено(ДополнительныеСвойства.ЗначенияАтрибутов["ОтветственныйМКО"])
	И НЕ ДополнительныеСвойства.Свойство("ПроверкаРекурсии") Тогда
		
	ДополнительныеСвойства.Вставить("ПроверкаРекурсии", Истина);
	
	ПринятьКИсполнению();
	
	П = Новый Структура;
	П.Вставить("СледующийЭтап", Справочники.КА_ЭтапыИнцидентов.ПолучитьСсылку(Новый УникальныйИдентификатор("c9cc2bd9-81fd-11ec-bb9e-00155d70bd06")));
	
	ВыполнитьТекущийЭтап("Автозавершение", П);	
	
КонецЕсли;</v8:ОбработчикПередЗаписью>
			<v8:ОбработчикПослеВыполнения/>
			<v8:ОбработчикПриЗаписи/>
			<v8:ОбработчикПриПереходе>Инцидент.СтатусИМ = Перечисления.КА_СтатусИМ.УточнитеДанныеОбращения;

// Отправка статуса

НастройкаОбмена = Справочники.КА_НастройкиВыгрузкиВИМ.ПолучитьНастройку("Рекламация_СобытиеВыгрузкаСтатуса");

СоответствиеСтатусов = Новый Соответствие;
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ЗапросОтправлен, "SENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВРаботеУМенеджера, "PROCESS_BY_MANAGER");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.УточнитеДанныеОбращения, "CLARIFY_DETAILS");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВРаботеУИнженера, "PROCESS_BY_ENGINEER");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияПринятаВРаботуГарантийнымОтделом, "PROCESS_BY_WARRANTY_DEPARTMENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияПринятаУточняемСрокРассмотрения, "ACCEPTED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВозвратДеталиНаЭкспертизу, "EXPERTIZE");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОдобренаВыберитеСпособКомпенсации, "APPROVED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОтклоненаОзнакомьтесьСЗаключением, "REJECTED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ЗакрытоИПеренесеноВархивПоСрокуДавности, "CLOSED_ON_EXPIRATION");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияЗавершенаКлиентСогласен, "CLOSED_ON_AGREEMENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияЗавершенаКомпенсацияПредоставлена, "COMPENSATED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламациНаправленаВОтделКорпоративныхПродаж, "SENT_TO_SALES");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОдобрена50ВыберитеСпособКомпенсации, "APPROVED_50");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОтклоненаПовторно, "REJECTED_REPEATEDLY");

СтрДанных = Новый Структура;
СтрДанных.Вставить("complaintId", ЗначенияАтрибутов["id"]);
СтрДанных.Вставить("status", СоответствиеСтатусов[Инцидент.СтатусИМ]);

КА_Обмены.ОтправитьВСервис_Рефакторинг(СтрДанных, НастройкаОбмена, "ИМ2");

// Рассылка
Получатели = Новый Массив;
Вложения = Новый Соответствие;

ДокРТС = ЗначенияАтрибутов["realizationId"];
Партнер = ДокРТС.Партнер;

Адрес = УправлениеКонтактнойИнформацией.КонтактнаяИнформацияОбъекта(Партнер, Справочники.ВидыКонтактнойИнформации.EmailПартнера);
		
Если ЗначениеЗаполнено(Адрес) Тогда
	Получатели.Добавить(Новый Структура("Адрес, Представление", Адрес, Адрес));
КонецЕсли; 
	
Если Получатели.Количество() &gt; 0 Тогда

	Отправитель = Справочники.УчетныеЗаписиЭлектроннойПочты.СистемнаяУчетнаяЗаписьЭлектроннойПочты;
		
	ПредыдущийКомментарий = Инцидент.ИсторияВыполнения[Инцидент.ИсторияВыполнения.Количество()-1].Результат;
	
	ДатаОтвета = ТекущаяДата() + 30*24*60*60;
	ДатаОтвета = Справочники.КА_ВидыИнцидентов.ОкруглитьДатуДоПолучаса(ДатаОтвета);
	
	Тема = "Обработка рекламации";
	ТекстПисьма = СтрШаблон("Мы не сможем рассмотреть Ваше обращение, пока Вы не дополните его недостающей информацией.
	|Комментарий менеджера: %1
	|Пожалуйста сделайте это в срок до %2
	|За разъяснениями Вы всегда можете обратиться к Вашему менеджеру", ПредыдущийКомментарий, ДатаОтвета);	
			
	//Сообщить(ТекстПисьма);
	
	ПараметрыПисьма = Новый Структура;
	ПараметрыПисьма.Вставить("Кому",Получатели);
	ПараметрыПисьма.Вставить("Тема", Тема);
	ПараметрыПисьма.Вставить("Тело", ТекстПисьма);
	ПараметрыПисьма.Вставить("Вложения", Вложения);
				
	Попытка
		ИдентификаторСообщения = РаботаСПочтовымиСообщениями.ОтправитьПочтовоеСообщение(Отправитель, ПараметрыПисьма);
	Исключение
		Ошибка = ОписаниеОшибки();
		Сообщить(СтрШаблон("При отправке письма произошла ошибка: %1", Ошибка));
	КонецПопытки; 
		
КонецЕсли;</v8:ОбработчикПриПереходе>
			<v8:ОбработчикПриПринятииКИсполнению/>
			<v8:ОбработчикПроведения/>
			<v8:Описание>Необходимо ззакрыть (х) инцидент, не принимая этап в работу.

Клиент дополняет запрошенную информацию. 

После окончания редактирования данные приходят в 1С и этап завершается автоматически</v8:Описание>
			<v8:ПроверятьРезультат>false</v8:ПроверятьРезультат>
			<v8:СрокВыполнения>255</v8:СрокВыполнения>
			<v8:СообщениеНедоступныПереходы/>
			<v8:ОбработчикПриОткрытии/>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">3ab46ee4-8b6b-4e27-b05f-aa6c943c5895</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">6547e112-2de4-4388-82f0-4b24ca0eee42</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">6d160a64-dd08-11e4-b0fd-001517ac6c09</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">f6af22ec-7751-4f7a-bc7e-df85edb3c04f</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">19daaf30-9a1a-11e8-80c5-3cfdfeaf9019</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">97eb7d45-6782-4b33-9909-457572becfa8</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">b783b0ba-74ad-11e1-b634-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">812e0c18-3beb-11e8-80d0-001e6707aaa8</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">f149ab7d-7ada-11e8-80c5-3cfdfeaf9019</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">58a84576-77c0-4e0e-b065-1be30ab00af9</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">0cafad1c-4262-11e1-b48c-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">c34b8004-ec1d-11e5-80c5-001e6707aaa8</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">ddcd8a22-00dc-11e4-9396-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">a0477a02-97f8-11e5-9a83-001517ac6c09</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">c9cc2bd9-81fd-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>Если НЕ РольДоступна("ПолныеПрава") Тогда

	Отказ = Истина;

КонецЕсли;
</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">d912235d-81fd-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода/>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">b512a77b-8e56-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода>Если НЕ РольДоступна("ПолныеПрава") Тогда
	Отказ = Истина;
КонецЕсли;

</v8:ОбработчикПроверкиПерехода>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">ae2bfd6f-8798-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">28c3acd3-ba33-11ec-bba2-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">20e9e340-bc98-11ec-bbaf-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">e983c36e-bc97-11ec-bbaf-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">578c447d-b974-11ec-bba2-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">579bcceb-8e55-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">1e160f11-bca1-11ec-bba2-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">c10475bc-8798-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">7770acee-8e55-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">e5acad73-a62b-11ec-bba8-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">f9220711-8795-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">c9ae9a45-d6cc-11ec-bbaf-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">b444c315-5f3e-11ed-bba5-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
		</v8:CatalogObject.КА_ЭтапыИнцидентов>
		<v8:CatalogObject.КА_ЭтапыИнцидентов>
			<v8:Ref xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">c9cc2bd9-81fd-11ec-bb9e-00155d70bd06</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Owner xsi:type="v8:CatalogRef.КА_ВидыИнцидентов">fe697b45-4e2c-11ec-bba8-00155d258b03</v8:Owner>
			<v8:Code>000000025</v8:Code>
			<v8:Description>В работе у МКО</v8:Description>
			<v8:АвтоматическийСтартЭтапа>false</v8:АвтоматическийСтартЭтапа>
			<v8:АвтоматическоеЗавершениеЭтапа>false</v8:АвтоматическоеЗавершениеЭтапа>
			<v8:АтрибутыНедоступны>false</v8:АтрибутыНедоступны>
			<v8:АтрибутыСкрыты>false</v8:АтрибутыСкрыты>
			<v8:ЗавершающийЭтап>false</v8:ЗавершающийЭтап>
			<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">00000000-0000-0000-0000-000000000000</v8:Исполнитель>
			<v8:ОбработчикПередВыполнением/>
			<v8:ОбработчикПередЗаписью/>
			<v8:ОбработчикПослеВыполнения>Инцидент.СтатусИМ = Перечисления.КА_СтатусИМ.ВРаботеУМенеджера;</v8:ОбработчикПослеВыполнения>
			<v8:ОбработчикПриЗаписи/>
			<v8:ОбработчикПриПереходе>Инцидент.СтатусИМ = Перечисления.КА_СтатусИМ.ЗапросОтправлен;

// Отправка статуса

НастройкаОбмена = Справочники.КА_НастройкиВыгрузкиВИМ.ПолучитьНастройку("Рекламация_СобытиеВыгрузкаСтатуса");

СоответствиеСтатусов = Новый Соответствие;
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ЗапросОтправлен, "SENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВРаботеУМенеджера, "PROCESS_BY_MANAGER");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.УточнитеДанныеОбращения, "CLARIFY_DETAILS");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВРаботеУИнженера, "PROCESS_BY_ENGINEER");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияПринятаВРаботуГарантийнымОтделом, "PROCESS_BY_WARRANTY_DEPARTMENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияПринятаУточняемСрокРассмотрения, "ACCEPTED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВозвратДеталиНаЭкспертизу, "EXPERTIZE");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОдобренаВыберитеСпособКомпенсации, "APPROVED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОтклоненаОзнакомьтесьСЗаключением, "REJECTED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ЗакрытоИПеренесеноВархивПоСрокуДавности, "CLOSED_ON_EXPIRATION");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияЗавершенаКлиентСогласен, "CLOSED_ON_AGREEMENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияЗавершенаКомпенсацияПредоставлена, "COMPENSATED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламациНаправленаВОтделКорпоративныхПродаж, "SENT_TO_SALES");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОдобрена50ВыберитеСпособКомпенсации, "APPROVED_50");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОтклоненаПовторно, "REJECTED_REPEATEDLY");

СтрДанных = Новый Структура;
СтрДанных.Вставить("complaintId", ЗначенияАтрибутов["id"]);
СтрДанных.Вставить("status", СоответствиеСтатусов[Инцидент.СтатусИМ]);

КА_Обмены.ОтправитьВСервис_Рефакторинг(СтрДанных, НастройкаОбмена, "ИМ2");

// Рассылка
Получатели = Новый Массив;
Вложения = Новый Соответствие;

ДокРТС = ЗначенияАтрибутов["realizationId"];
Партнер = ДокРТС.Партнер;

Адрес = УправлениеКонтактнойИнформацией.КонтактнаяИнформацияОбъекта(Партнер, Справочники.ВидыКонтактнойИнформации.EmailПартнера);
		
Если ЗначениеЗаполнено(Адрес) Тогда
	Получатели.Добавить(Новый Структура("Адрес, Представление", Адрес, Адрес));
КонецЕсли; 
	
Если Получатели.Количество() &gt; 0 Тогда

	Отправитель = Справочники.УчетныеЗаписиЭлектроннойПочты.СистемнаяУчетнаяЗаписьЭлектроннойПочты;
		
	ДатаОтсчета = Инцидент.Дата;
	ДатаОтвета = Справочники.КА_ВидыИнцидентов.РассчитатьСрокВыполнения(Инцидент.Дата, 1);
	ДатаОтвета = Справочники.КА_ВидыИнцидентов.ОкруглитьДатуДоПолучаса(ДатаОтвета);
		
	Тема = "Обработка рекламации";
	ТекстПисьма = СтрШаблон("Дождитесь подтверждения от менеджера клиентского отдела.
	|Срок ответа - %1", ДатаОтвета);	
			
	ПараметрыПисьма = Новый Структура;
	ПараметрыПисьма.Вставить("Кому",Получатели);
	ПараметрыПисьма.Вставить("Тема", Тема);
	ПараметрыПисьма.Вставить("Тело", ТекстПисьма);
	ПараметрыПисьма.Вставить("Вложения", Вложения);
				
	Попытка
		ИдентификаторСообщения = РаботаСПочтовымиСообщениями.ОтправитьПочтовоеСообщение(Отправитель, ПараметрыПисьма);
	Исключение
		Ошибка = ОписаниеОшибки();
		Сообщить(СтрШаблон("При отправке письма произошла ошибка: %1", Ошибка));
	КонецПопытки; 
		
КонецЕсли;

//Обрабатываем Пользователей  в поля инцидента по этапу 
Инцидент.Ответственный  = ЗначенияАтрибутов["ОтветственныйМКО"];

//Пинчук М.Н. 21.11.2022 ответственные за ТГ для легкового проекта (при переходе "В работе у МКО")

Для Каждого Стр из Инцидент.Товары Цикл
	Если ЗначениеЗаполнено(Стр.ВидНоменклатуры) Тогда
		Если СтрНайти(Стр.ВидНоменклатуры.Наименование,"легковые") Тогда

				АтрибутСсылкаРучная = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор","ОтветственныйЗаТГ");
				    
				  НС = Инцидент.ЗначенияАтрибутов.НайтиСтроки(Новый Структура("Атрибут",АтрибутСсылкаРучная));
				  Для каждого ТекАтр из НС Цикл
				    Инцидент.ЗначенияАтрибутов.Удалить(ТекАтр);      
				  КонецЦикла;
				  НовАтр = Инцидент.ЗначенияАтрибутов.Добавить();  
				  НовАтр.Атрибут = АтрибутСсылкаРучная;
				  НовАтр.Значение = ЗначенияАтрибутов["ОтветственныйИнженер"];
				Прервать;

		КонецЕсли;
	КонецЕсли;
КонецЦикла;


// Рассылка исполнителям
Тема = СтрШаблон("Новая рекламация %1 %2", Инцидент.Номер, ЗначенияАтрибутов["counterparty_external_id"]);
ТекстПисьма = СледующийЭтап.Описание;
М = Новый Массив;
М.Добавить(Инцидент.Ответственный);
//М.Добавить("leonid.lichko@korona-auto.com");
Документы.КА_Инцидент.ОтправитьОповещение(М, Тема, ТекстПисьма);
//Документы.КА_Инцидент.ОтправитьОповещениеИсполнителямЭтапа(СледующийЭтап, Тема, ТекстПисьма);</v8:ОбработчикПриПереходе>
			<v8:ОбработчикПриПринятииКИсполнению>Инцидент.СтатусИМ = Перечисления.КА_СтатусИМ.ВРаботеУМенеджера;

// Отправка статуса

НастройкаОбмена = Справочники.КА_НастройкиВыгрузкиВИМ.ПолучитьНастройку("Рекламация_СобытиеВыгрузкаСтатуса");

СоответствиеСтатусов = Новый Соответствие;
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ЗапросОтправлен, "SENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВРаботеУМенеджера, "PROCESS_BY_MANAGER");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.УточнитеДанныеОбращения, "CLARIFY_DETAILS");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВРаботеУИнженера, "PROCESS_BY_ENGINEER");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияПринятаВРаботуГарантийнымОтделом, "PROCESS_BY_WARRANTY_DEPARTMENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияПринятаУточняемСрокРассмотрения, "ACCEPTED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВозвратДеталиНаЭкспертизу, "EXPERTIZE");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОдобренаВыберитеСпособКомпенсации, "APPROVED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОтклоненаОзнакомьтесьСЗаключением, "REJECTED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ЗакрытоИПеренесеноВархивПоСрокуДавности, "CLOSED_ON_EXPIRATION");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияЗавершенаКлиентСогласен, "CLOSED_ON_AGREEMENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияЗавершенаКомпенсацияПредоставлена, "COMPENSATED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламациНаправленаВОтделКорпоративныхПродаж, "SENT_TO_SALES");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОдобрена50ВыберитеСпособКомпенсации, "APPROVED_50");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОтклоненаПовторно, "REJECTED_REPEATEDLY");

СтрДанных = Новый Структура;
СтрДанных.Вставить("complaintId", ЗначенияАтрибутов["id"]);
СтрДанных.Вставить("status", СоответствиеСтатусов[Инцидент.СтатусИМ]);

КА_Обмены.ОтправитьВСервис_Рефакторинг(СтрДанных, НастройкаОбмена, "ИМ2");

// Рассылка
Получатели = Новый Массив;
Вложения = Новый Соответствие;

ДокРТС = ЗначенияАтрибутов["realizationId"];
Партнер = ДокРТС.Партнер;

Адрес = УправлениеКонтактнойИнформацией.КонтактнаяИнформацияОбъекта(Партнер, Справочники.ВидыКонтактнойИнформации.EmailПартнера);
		
Если ЗначениеЗаполнено(Адрес) Тогда
	Получатели.Добавить(Новый Структура("Адрес, Представление", Адрес, Адрес));
КонецЕсли; 
	
Если Получатели.Количество() &gt; 0 Тогда

	Отправитель = Справочники.УчетныеЗаписиЭлектроннойПочты.СистемнаяУчетнаяЗаписьЭлектроннойПочты;
		
	ДатаОтсчета = Инцидент.ИсторияВыполнения[Инцидент.ИсторияВыполнения.Количество()-1].ДатаПостановки;
	ДатаОтвета = Справочники.КА_ВидыИнцидентов.РассчитатьСрокВыполнения(ДатаОтсчета, 2);
	ДатаОтвета = Справочники.КА_ВидыИнцидентов.ОкруглитьДатуДоПолучаса(ДатаОтвета);
	
	Тема = "Обработка рекламации";
	ТекстПисьма = СтрШаблон("Рекламация передана в гарантийный отдел. Просим учесть и отнестись с пониманием к тому, что сотрудники гарантийного отдела могут запросить дополнительную информацию.
	|Срок ответа - %1", ДатаОтвета);	
				
	ПараметрыПисьма = Новый Структура;
	ПараметрыПисьма.Вставить("Кому",Получатели);
	ПараметрыПисьма.Вставить("Тема", Тема);
	ПараметрыПисьма.Вставить("Тело", ТекстПисьма);
	ПараметрыПисьма.Вставить("Вложения", Вложения);
				
	Попытка
		ИдентификаторСообщения = РаботаСПочтовымиСообщениями.ОтправитьПочтовоеСообщение(Отправитель, ПараметрыПисьма);
	Исключение
		Ошибка = ОписаниеОшибки();
		Сообщить(СтрШаблон("При отправке письма произошла ошибка: %1", Ошибка));
	КонецПопытки; 
		
КонецЕсли;</v8:ОбработчикПриПринятииКИсполнению>
			<v8:ОбработчикПроведения/>
			<v8:Описание>Нажать Принять к исполнению.
МКО проверяет правильность заполнения обращения, наличие адекватных фото- или видеоматериалов.
Затем необходимо нажать "Выполнено" и выбрать один из вариантов:

- "В работе у инженера" - если всё верно, МКО выбирает вариант "В работе у инженера", 
- "В работе у клиента. Уточнение данных" - если требуется запросить у клиента данные через ИМ. Фраза, прописанная в окне "Результат" транслируется на почту клиенту как запрос.
- "Уточнение данных рекламации" - если нет необходимости уточнять данные на сайте. Информация становится доступной для редактирования для МКО. Передача уточнённых данных на сайт не предусмотрена текущим функционалом.
- "Уточнение срока рассмотрения" - в случае, если инженер запросил дополнительный срок рассмотрения, на время согласования этого срока с клиентом по каналам, отличным от ИМ, устанавливается этот этап. С него можно перейти на этап В работе у инженера. Увеличенный срок рассмотрения
- "Завершен. Истечение срока давности" - стандартный способ завершения инцидента при отзыве рекламации или отказе от предоставления достаточных для принятия решения данных.
</v8:Описание>
			<v8:ПроверятьРезультат>true</v8:ПроверятьРезультат>
			<v8:СрокВыполнения>2</v8:СрокВыполнения>
			<v8:СообщениеНедоступныПереходы/>
			<v8:ОбработчикПриОткрытии/>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">3ab46ee4-8b6b-4e27-b05f-aa6c943c5895</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">6547e112-2de4-4388-82f0-4b24ca0eee42</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">6d160a64-dd08-11e4-b0fd-001517ac6c09</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">f6af22ec-7751-4f7a-bc7e-df85edb3c04f</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">19daaf30-9a1a-11e8-80c5-3cfdfeaf9019</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">97eb7d45-6782-4b33-9909-457572becfa8</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">b783b0ba-74ad-11e1-b634-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">812e0c18-3beb-11e8-80d0-001e6707aaa8</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">f149ab7d-7ada-11e8-80c5-3cfdfeaf9019</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">58a84576-77c0-4e0e-b065-1be30ab00af9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">0cafad1c-4262-11e1-b48c-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">c34b8004-ec1d-11e5-80c5-001e6707aaa8</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">ddcd8a22-00dc-11e4-9396-001517d416c9</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">a0477a02-97f8-11e5-9a83-001517ac6c09</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">07d158b7-54ba-11e7-80ce-001e6707aaa8</v8:Исполнитель>
				<v8:Оповещать>true</v8:Оповещать>
			</v8:Исполнители>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">c9cc2bda-81fd-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода/>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">e212d359-81fd-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>true</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода/>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">d2b59609-81fd-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>true</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода/>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">d912235d-81fd-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода/>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">b512a77b-8e56-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода/>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:Команды>
				<v8:Заголовок>Отобразить элементы формы</v8:Заголовок>
				<v8:УИ>96e51265-8c89-42cc-b228-6fd114ef8571</v8:УИ>
				<v8:ОбработчикКлиентПеред>	Для Каждого Элем из ЭтаФорма.Элементы Цикл
		Попытка 
			Если не Элем = Неопределено и (Элем.Вид = ВидПоляФормы.ПолеВвода) Тогда
				Сообщить(Строка(Элем) + ": " + Элем.Имя);
			КонецЕсли; 
		Исключение
			Сообщить(Элем);	
		КонецПопытки; 
	КонецЦикла;
</v8:ОбработчикКлиентПеред>
				<v8:ОбработчикСервер/>
				<v8:ОбработчикКлиентПосле/>
			</v8:Команды>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">579bcceb-8e55-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">7770acee-8e55-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">f9220711-8795-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">ae2bfd6f-8798-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">c10475bc-8798-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">e5acad73-a62b-11ec-bba8-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">28c3acd3-ba33-11ec-bba2-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">578c447d-b974-11ec-bba2-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">e983c36e-bc97-11ec-bbaf-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">20e9e340-bc98-11ec-bbaf-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">1e160f11-bca1-11ec-bba2-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">455e5227-8e55-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">f6327d2c-d1c5-11ec-bbaf-00155d258b03</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">1cf61873-ba50-11ec-bba2-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">b444c315-5f3e-11ed-bba5-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
		</v8:CatalogObject.КА_ЭтапыИнцидентов>
		<v8:CatalogObject.КА_ЭтапыИнцидентов>
			<v8:Ref xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">fe697b46-4e2c-11ec-bba8-00155d258b03</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Owner xsi:type="v8:CatalogRef.КА_ВидыИнцидентов">fe697b45-4e2c-11ec-bba8-00155d258b03</v8:Owner>
			<v8:Code>000000024</v8:Code>
			<v8:Description>Рекламация: Обработка инцидента</v8:Description>
			<v8:АвтоматическийСтартЭтапа>true</v8:АвтоматическийСтартЭтапа>
			<v8:АвтоматическоеЗавершениеЭтапа>true</v8:АвтоматическоеЗавершениеЭтапа>
			<v8:АтрибутыНедоступны>false</v8:АтрибутыНедоступны>
			<v8:АтрибутыСкрыты>false</v8:АтрибутыСкрыты>
			<v8:ЗавершающийЭтап>false</v8:ЗавершающийЭтап>
			<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">27b1b5ed-427b-11e6-80c3-0cc47a6b63cf</v8:Исполнитель>
			<v8:ОбработчикПередВыполнением>Инцидент.СтатусИМ = Перечисления.КА_СтатусИМ.ЗапросОтправлен;</v8:ОбработчикПередВыполнением>
			<v8:ОбработчикПередЗаписью>Инцидент = ЭтотОбъект;
Если не Инцидент.Товары.Количество() = 0 Тогда
	ДокументИнцидент = Инцидент.Ссылка;
	ДокументРеализации = Инцидент.ПолучитьАтрибутИнцидента("realizationId");
	ПартнерПокупатель = ДокументРеализации.Партнер;
	ПартнерРегион = ПартнерПокупатель.БизнесРегион;
	ПартнерОсновнойМенеджер = ПартнерПокупатель.КА_ОсновнойКураторПокупателя;
	Поставщик = Справочники.Партнеры.ПустаяСсылка();
	Для каждого ТекСтр из ДокументИнцидент.СвязанныеОбъекты Цикл
		Если ТекСтр.Объект.Ссылка.Метаданные().Имя = "ПоступлениеТоваровУслуг" Тогда
			ДокПоступление = ТекСтр.Объект.Ссылка;	
			Поставщик = ДокПоступление.Партнер;	
		КонецЕсли;
	КонецЦикла;
	ТаблицаДвижений = Инцидент.ПолучитьСписокПараметровПроведения(Истина);
//Строка 16
	Для Каждого ТекСтрокаТовары Из Инцидент.Товары Цикл
		Движение = ТаблицаДвижений.Добавить();
		Движение.ВидИнцидента = Инцидент.ВидИнцидента;
		Движение.ЭтапИнцидента =  Инцидент.ТекущийЭтап;
		Движение.ВидДвижения = ВидДвиженияНакопления.Приход;
		Движение.Период = Инцидент.Ссылка.Дата;
		Движение.НоменклатураБренд = ТекСтрокаТовары.Номенклатура.Производитель;
		Движение.ТоварнаяГруппа = ТекСтрокаТовары.Номенклатура.ВидНоменклатуры;
		Движение.Номенклатура = ТекСтрокаТовары.Номенклатура;
		Движение.ДокументРеализации = ДокументРеализации;
		Движение.ДокументРекламации = ДокументИнцидент;
		Движение.Партнер = ПартнерПокупатель;
		Движение.Валюта = ТекСтрокаТовары.Валюта;
		Движение.ПартнерБизнесРегион = ПартнерРегион;
		Движение.ПартнерОсновнойМенеджер = ПартнерОсновнойМенеджер;
		Движение.АналитикаДефекта = ТекСтрокаТовары.АналитикаДефекта;
		Движение.КоличествоККомпенсации = ТекСтрокаТовары.Количество;
		Движение.КоличествоКомпенсированоКлиенту = 0;
		Движение.КоличествоПредъявленоПоставщику = 0;
		Движение.КоличествоКомпенсированоПоставщиком = 0;
		Движение.СуммаВал = ТекСтрокаТовары.Сумма;//СуммаВВалюте;
		Движение.СуммаБезНДСВал = ТекСтрокаТовары.СуммаСНДС-ТекСтрокаТовары.СуммаНДС;//СуммаВВалютеБезНДС;
		Движение.Сумма = ТекСтрокаТовары.Сумма;
		Движение.СуммаБезНДС = ТекСтрокаТовары.СуммаСНДС-ТекСтрокаТовары.СуммаНДС;
		Движение.РеализацияТоваровУслуг = ДокументРеализации;
		Движение.ДокументИнцидент = ДокументИнцидент;
		Движение.Склад = ТекСтрокаТовары.Склад;
		Движение.Регион = ТекСтрокаТовары.Склад.БизнесРегион;
		Движение.Поставщик = ТекСтрокаТовары.Серия.КА_ДокументПоступления.Партнер;
		Движение.РешениеПоИнциденту = ТекСтрокаТовары.РешениеИнженера;
	КонецЦикла;
	Инцидент. УстановитьСписокПараметровПроведения(Инцидент.ВидИнцидента, Инцидент.ТекущийЭтап, ТаблицаДвижений);
КонецЕсли;</v8:ОбработчикПередЗаписью>
			<v8:ОбработчикПослеВыполнения>// Отправка номера

СоответствиеСтатусов = Новый Соответствие;
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ЗапросОтправлен, "SENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВРаботеУМенеджера, "PROCESS_BY_MANAGER");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.УточнитеДанныеОбращения, "CLARIFY_DETAILS");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВРаботеУИнженера, "PROCESS_BY_ENGINEER");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияПринятаВРаботуГарантийнымОтделом, "PROCESS_BY_WARRANTY_DEPARTMENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияПринятаУточняемСрокРассмотрения, "ACCEPTED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ВозвратДеталиНаЭкспертизу, "EXPERTIZE");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОдобренаВыберитеСпособКомпенсации, "APPROVED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОтклоненаОзнакомьтесьСЗаключением, "REJECTED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.ЗакрытоИПеренесеноВархивПоСрокуДавности, "CLOSED_ON_EXPIRATION");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияЗавершенаКлиентСогласен, "CLOSED_ON_AGREEMENT");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияЗавершенаКомпенсацияПредоставлена, "COMPENSATED");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламациНаправленаВОтделКорпоративныхПродаж, "SENT_TO_SALES");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОдобрена50ВыберитеСпособКомпенсации, "APPROVED_50");
СоответствиеСтатусов.Вставить(Перечисления.КА_СтатусИМ.РекламацияОтклоненаПовторно, "REJECTED_REPEATEDLY");

СтрДанных = Новый Структура;
СтрДанных.Вставить("complaintId", ЗначенияАтрибутов["id"]);
СтрДанных.Вставить("complaintStatus", СоответствиеСтатусов[Инцидент.СтатусИМ]);
СтрДанных.Вставить("complaintNumber", Число(Инцидент.Номер));
СтрДанных.Вставить("registrationDate", Формат(Инцидент.Дата, "ДФ=yyyy-MM-ddTHH:mm:ssZ"));   //2022-02-07T12:50:30Z

МКО = ЗначенияАтрибутов["ОтветственныйМКО"];

СтрДанных.Вставить("managerName", МКО.Наименование);
СтрДанных.Вставить("email", УправлениеКонтактнойИнформацией.КонтактнаяИнформацияОбъекта(МКО, Справочники.ВидыКонтактнойИнформации.EmailПользователя));
СтрДанных.Вставить("icq", "");

КА_Обмены.ОтправитьВСервис_Рефакторинг(СтрДанных, "804", "ИМ2");</v8:ОбработчикПослеВыполнения>
			<v8:ОбработчикПриЗаписи/>
			<v8:ОбработчикПриПереходе>//Инцидент.СтатусИМ = Перечисления.КА_СтатусИМ.ЗапросОтправлен;

Инцидент.СтатусИМ = Перечисления.КА_СтатусИМ.РекламацияПолученаИзИМ;
ДокРТС = ЗначенияАтрибутов["realizationId"];
НоменклатураСтрокиТаблицы = ЗначенияАтрибутов["productId"];
ОтборКолонкиТовары = Новый Структура("Номенклатура",НоменклатураСтрокиТаблицы);
//стр 7
ДанныеАналитикиДефекта = Новый Структура;
ДанныеАналитикиДефекта.Вставить("Наименование","");
ДанныеАналитикиДефекта.Вставить("МаркаТС",ЗначенияАтрибутов["brand"]);
ДанныеАналитикиДефекта.Вставить("МодельТС",ЗначенияАтрибутов["model"]);
ДанныеАналитикиДефекта.Вставить("VIN",ЗначенияАтрибутов["vin"]);
ДанныеАналитикиДефекта.Вставить("УсловияПриКоторыхОбнаруженДеффект",ЗначенияАтрибутов["defectFound"]);
ДанныеАналитикиДефекта.Вставить("СпособМонтажаДетали",ЗначенияАтрибутов["installation"]);
ДанныеАналитикиДефекта.Вставить("ДатаМонтажаДетали",ЗначенияАтрибутов["installationDate"]);
ДанныеАналитикиДефекта.Вставить("ПробегТСМонтаж",ЗначенияАтрибутов["mileageInstallation"]);
ДанныеАналитикиДефекта.Вставить("ДатаДемонтажаДетали",ЗначенияАтрибутов["dismantlingDate"]);
ДанныеАналитикиДефекта.Вставить("ПробегТСДемонтаж",ЗначенияАтрибутов["mileageDismantling"]);
ЭлементАналитикиДефекта = Справочники.КА_АналитикаДефекта.СоздатьЭлементСправочника(ДанныеАналитикиДефекта);
//ЭлементАналитикиДефекта = Справочники.КА_АналитикаДефекта.ПустаяСсылка();
//Стр 21
//Заполним таблицу атрибутов документа строка 29
ЗначенияАтрибутов["ОтветственныйМКО"] = ДокРТС.Ссылка.Партнер.ОсновнойМенеджер;
ЗначенияАтрибутов["Ответственный МОР"] = ДокРТС.Ссылка.Партнер.КА_ОсновнойКураторПокупателя;
ЗначенияАтрибутов["Экспертиза"] = Перечисления.КА_ДоставитьТоварНаЭкспертизу.Нет;
//СТр 109 Ответственный НОР из реализации
ФлНОР = ДокРТС.Партнер.КА_ПризнакГруппыКлиентов.ТекущийРуководитель;
ПоискНОР = Справочники.Пользователи.НайтиПоРеквизиту("ФизическоеЛицо", ФлНОР);
Если ЗначениеЗаполнено(ПоискНор) Тогда
	ЗначенияАтрибутов["ОтветственныйНОР"] = ПоискНор.Ссылка;
КонецЕсли;
ЗначенияАтрибутов["ВозвратУтилизация"] = Перечисления.КА_ВозвратУтилизация.НеТребуется;
ЗначенияАтрибутов["РешениеИнженера"]=Неопределено;//18.04.22 замена Перечисления.КА_РешенияИнженера.Неизвестно;
//Стр 34
Если не ЗначениеЗаполнено(ЗначенияАтрибутов["ИнцидентИМID"]) Тогда
	ЗначенияАтрибутов["ИнцидентИМID"] = Инцидент.Ссылка.УникальныйИдентификатор();
КонецЕсли;

пОтветственныйИнженер = ЗначенияАтрибутов["ОтветственныйИнженер"];
пОтветственныйЗаТГ = ЗначенияАтрибутов["ОтветственныйЗаТГ"];
МассивАтрибутов = Инцидент.ВидИнцидента.НаборАтрибутов.ВыгрузитьКолонку("Атрибут");
МассивАтрибутов = ОбщегоНазначенияКлиентСервер.СвернутьМассив(МассивАтрибутов);

ТаблицаАтрибутовДокумента = Инцидент.ЗначенияАтрибутов.Выгрузить();
ТаблицаЗначенийАтрибутов = ТаблицаАтрибутовДокумента.Скопировать();
//Стр 44  
НомерСтрокиТаблицы = ТаблицаЗначенийАтрибутов[0].НомерСтрокиТаблицы;
ТаблицаОриг = ТаблицаЗначенийАтрибутов[0].Таблица;
Для Каждого ТекАтрибут из МассивАтрибутов Цикл
	НС = ТаблицаАтрибутовДокумента.НайтиСтроки(Новый Структура("Атрибут", ТекАтрибут));
	Если НС = Неопределено Тогда
		Продолжить;
	ИначеЕсли НС.Количество()=0 Тогда 
	    НС = ТаблицаАтрибутовДокумента.Добавить();
	    НС.Атрибут = ТекАтрибут;
	    НС.Таблица = ТаблицаОриг;
	    НС.НомерСтрокиТаблицы = НомерСтрокиТаблицы;
	    НС.Значение = ЗначенияАтрибутов[ТекАтрибут.Идентификатор];
	ИначеЕсли НС.Количество() &gt; 0 Тогда
		НС[0].Значение = ЗначенияАтрибутов[ТекАтрибут.Идентификатор];
	КонецЕсли;
КонецЦикла;
Инцидент.ЗначенияАтрибутов.Загрузить(ТаблицаАтрибутовДокумента);
//Стр 62
ТаблицаТовары = ДокРТС.Товары.Выгрузить();

СтрокаРТС = ТаблицаТовары.Скопировать(ОтборКолонкиТовары);
Инцидент.Товары.Очистить();
Инцидент.Товары.Загрузить(СтрокаРТС.Скопировать());

ТаблицаТоваров = Инцидент.Товары.Выгрузить();

//Стр 71
НайденСклад = Справочники.Склады.ПустаяСсылка();
Если ЗначениеЗаполнено(ДокРТС.Ссылка.Склад) Тогда
	НайденСклад =  ДокРТС.Ссылка.Склад;
КонецЕсли;
ЗначенияАтрибутов["Склад"] = НайденСклад;
АтрибутПоступление = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоНаименованию("ДокументПоступления");
АтрибутСклад = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоНаименованию("Склад");
СписокПоступление = Новый СписокЗначений;
КоличествоПоРекламации = ЗначенияАтрибутов["count"]; 
СвязОбъекты = Инцидент.СвязанныеОбъекты.Выгрузить();
Для каждого ТекСтрока Из ТаблицаТоваров Цикл
	Если КоличествоПоРекламации&gt;0 Тогда
		ТекСтрока.КА_КоличествоПродано = ТекСтрока.Количество;
	    Если КоличествоПоРекламации &lt; ТекСтрока.Количество Тогда
			ТекСтрока.Цена = ТекСтрока.Сумма/ТекСтрока.Количество;
			ТекСтрока.Сумма = КоличествоПоРекламации * ТекСтрока.Цена;
			ТекСтрока.СуммаНДС = (ТекСтрока.СуммаНДС / ТекСтрока.Количество) * КоличествоПоРекламации;
			ТекСтрока.СуммаСНДС = (ТекСтрока.СуммаСНДС/ТекСтрока.Количество) * КоличествоПоРекламации;
			ТекСтрока.Количество = КоличествоПоРекламации;
			КоличествоПоРекламации = 0;
	    Иначе
			ТекСтрока.Сумма = ТекСтрока.Сумма;
			ТекСтрока.Количество = ТекСтрока.Количество;
			ТекСтрока.СуммаНДС = ТекСтрока.СуммаНДС;
			ТекСтрока.СуммаСНДС = ТекСтрока.СуммаСНДС;
			КоличествоПоРекламации = КоличествоПоРекламации - ТекСтрока.Количество;
	    КонецЕсли;
		Если ЗначениеЗаполнено(ТекСтрока.Серия) Тогда
			Если не (ТекСтрока.Серия.КА_ДокументПоступления = Документы.ПоступлениеТоваровУслуг.ПустаяСсылка()) Тогда
				СписокПоступление.Добавить(ТекСтрока.Серия.КА_ДокументПоступления,"ДокументПоступления");
				ДобОбъект = СвязОбъекты.Найти(ТекСтрока.Серия.КА_ДокументПоступления, "Объект");
				Если ДобОбъект = Неопределено Тогда 
					ДобОбъект = СвязОбъекты.Добавить();
					ДобОбъект.Объект = ТекСтрока.Серия.КА_ДокументПоступления;
				КонецЕсли;
//				Инцидент.СвязатьСОбъектом(ТекСтрока.Серия.КА_ДокументПоступления);
			КонецЕсли;
		КонецЕсли;
	Иначе
	    ТекСтрока.Количество = 0;
	    ТекСтрока.КоличествоУпаковок = 0; 
	    ТекСтрока.Сумма  = 0;
	    ТекСтрока.СуммаНДС = 0;
	    ТекСтрока.СуммаСНДС = 0;
	КонецЕсли;
//Стр 112
	ТекСтрока.КоличествоУпаковок = ТекСтрока.Количество;
	ТекСтрока.ВидНоменклатуры = ТекСтрока.Номенклатура.ВидНоменклатуры;
	ТекСтрока.Бренд = ТекСтрока.Номенклатура.Марка;
	ТекСтрока.Организация = ДокРТС.Ссылка.Организация;
	ТекСтрока.Клиент = ДокРТС.Ссылка.Партнер;
	ТекСтрока.Контрагент = ДокРТС.Ссылка.Контрагент;
	ТекСтрока.Склад = ДокРТС.Ссылка.Склад;
	ТекСтрока.Соглашение = ДокРТС.Ссылка.Соглашение;
	ТекСтрока.Договор = ДокРТС.Ссылка.Договор;
	ТекСтрока.ЗаказКлиента = ДокРТС.Ссылка.ЗаказКлиента;
    ТекСтрока.Валюта = ДокРТС.Валюта;
  	ТекСтрока.АналитикаДефекта = ЭлементАналитикиДефекта;
	Если не ЗначениеЗаполнено(ТекСтрока.Упаковка) Тогда
		ТекСтрока.Упаковка = ТекСтрока.Номенклатура.ЕдиницаИзмерения;
	КонецЕсли;
	ТекСтрока.НомерГТД = ТекСтрока.Серия.КА_НомерГТД;
	НомерГТД = Строка(ТекСтрока.НомерГТД.Код); 
	ПозДатыГТД=СтрНайти(НомерГТД, "/");
	Если ПозДатыГТД &gt; 0 Тогда 
		ДатаГТД = Сред(НомерГТД, ПозДатыГТД+1, 8);
		ТекСтрока.ДатаГТД = Дата("20"+Сред(ДатаГТД,5,2),Сред(ДатаГТД,3,2),Сред(ДатаГТД,1,2));
	КонецЕсли; 
    Если не ЗначениеЗаполнено(ТекСтрока.Валюта) Тогда
   		ТекСтрока.Валюта = ДокРТС.Ссылка.Валюта; 
   	КонецЕсли;
	Если не ЗначениеЗаполнено(пОтветственныйИнженер) или пОтветственныйИнженер = Справочники.Пользователи.ПустаяСсылка() Тогда 
		пОтветственныйИнженер = ТекСтрока.Номенклатура.ВидНоменклатуры.КА_ОтветственныйИнженер;
	КонецЕсли; 
	Если не ЗначениеЗаполнено(пОтветственныйЗаТГ) или пОтветственныйЗаТГ = Справочники.Пользователи.ПустаяСсылка() Тогда 
		//пОтветственныйЗаТГ = ТекСтрока.Номенклатура.ВидНоменклатуры.КА_ОтветственныйЗаТГ;
		Запрос = Новый Запрос; 
		Запрос.Текст = "ВЫБРАТЬ
		|	КА_ОтветственныеЗаТоварныеГруппы.Исполнитель КАК Исполнитель
		|ИЗ
		|	РегистрСведений.КА_ОтветственныеЗаТоварныеГруппы КАК КА_ОтветственныеЗаТоварныеГруппы
		|ГДЕ
		|	КА_ОтветственныеЗаТоварныеГруппы.ВидНоменклатуры = &amp;ВидНоменклатуры
		|	И КА_ОтветственныеЗаТоварныеГруппы.ДатаНачала &lt;= &amp;ВыбДата
		|	И КА_ОтветственныеЗаТоварныеГруппы.ДатаОкончания &gt;= &amp;ВыбДата";
		Запрос.УстановитьПараметр("ВидНоменклатуры", ТекСтрока.Номенклатура.ВидНоменклатуры); 
		Запрос.УстановитьПараметр("ВыбДата", ТекущаяДата());
		Рез = Запрос.Выполнить().Выгрузить();  
		Если Рез.Количество() &gt; 0 Тогда 
			пОтветственныйЗаТГ = Рез[0].Исполнитель; 
		КонецЕсли;
	КонецЕсли; 
КонецЦикла;

//Стр 145
//Лупонос Д.В. Чистим строки с количеством = 0 
//Для Каждого ТекСтр Из ТаблицаТоваров Цикл
//	Если не ТекСтр.КоличествоУпаковок &gt; 0 Тогда 
//		ТаблицаТоваров.Удалить(ТекСтр);
//	КонецЕсли;	
//КонецЦикла;
СтрокиСНулевымКоличеством = ТаблицаТоваров.НайтиСтроки(Новый Структура("КоличествоУпаковок",0));
Если не СтрокиСНулевымКоличеством = Неопределено Тогда 
	МаксимальныйНомерСтроки = СтрокиСНулевымКоличеством.Количество()-1;
	Для ТекСтрСч = 0 по МаксимальныйНомерСтроки Цикл 
		ТаблицаТоваров.Удалить(СтрокиСНулевымКоличеством[МаксимальныйНомерСтроки - ТекСтрСч]);
	КонецЦикла;
КонецЕсли; 
//Лупонос Д.В. Чистим строки с количеством = 0 

Инцидент.Товары.Загрузить(ТаблицаТоваров);

ТаблицаАтрибутовДокумента = Инцидент.ЗначенияАтрибутов.Выгрузить();
АтрибутПоиск = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоНаименованию("ОтветственныйИнженер");
Стр = ТаблицаАтрибутовДокумента.Найти(АтрибутПоиск,"Атрибут");
Если Стр = Неопределено Тогда
	Стр = ТаблицаАтрибутовДокумента.Добавить();
	Стр.Атрибут = АтрибутПоиск;
КонецЕсли;
Стр.Значение = пОтветственныйИнженер; 
АтрибутПоиск = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоНаименованию("ОтветственныйЗаТГ");
Стр = ТаблицаАтрибутовДокумента.Найти(АтрибутПоиск,"Атрибут");
Если Стр = Неопределено Тогда
	Стр = ТаблицаАтрибутовДокумента.Добавить();
	Стр.Атрибут = АтрибутПоиск;
КонецЕсли;
Стр.Значение = пОтветственныйЗаТГ; 
Инцидент.ЗначенияАтрибутов.Загрузить(ТаблицаАтрибутовДокумента);

//Инцидент.Записать();
Если ЗначениеЗаполнено(ЗначенияАтрибутов["realizationId"]) Тогда
	ДобОбъект = СвязОбъекты.Найти(ЗначенияАтрибутов["realizationId"], "Объект");
	Если ДобОбъект = Неопределено Тогда 
		ДобОбъект = СвязОбъекты.Добавить();
		ДобОбъект.Объект = ЗначенияАтрибутов["realizationId"];
	КонецЕсли;
//	Инцидент.СвязатьСОбъектом(ЗначенияАтрибутов["realizationId"]);
КонецЕсли;


Инцидент.СвязанныеОбъекты.Загрузить(СвязОбъекты);

//Стр 167
Для каждого Стр из СписокПоступление Цикл
	НайденоЗначение = Инцидент.ЗначенияАтрибутов.Найти(Стр.Значение,"Значение");
	Если не ЗначениеЗаполнено(НайденоЗначение) Тогда
		НовСтр = Инцидент.ЗначенияАтрибутов.Добавить();
		НовСтр.Атрибут = АтрибутПоступление;
		НовСтр.Значение = Стр.Значение;
	КонецЕсли;
КонецЦикла;
//Сообщить("Стр 176: КонецЗаполенния Таблиц"); 
//Стр 177
// Загрузка файлов
Если Ложь Тогда
	ФайлыИнцидента = ЗначенияАтрибутов.Получить("ФайлыРекламации");
	ЧтениеJSON  = Новый ЧтениеJSON;
	ЧтениеJSON.УстановитьСтроку(ФайлыИнцидента);
	МассивФайлов = ПрочитатьJSON(ЧтениеJSON,Истина);

	ТекПользователь = Пользователи.АвторизованныйПользователь();

	Для каждого ТекСтр из МассивФайлов Цикл
			
		ДД = КА_Обмены.ПолучитьДанныеИзСервисаФайлов(ТекСтр["link"]);
		
		АдресХранилища = ПоместитьВоВременноеХранилище(ДД);
		Имя = Сред(ТекСтр["originalName"], 1, Найти(ТекСтр["originalName"], ".")-1);
		Расширение = Сред(ТекСтр["originalName"], Найти(ТекСтр["originalName"], ".")+1);
		
		Описание = СтрШаблон("%1
							|%2", ТекСтр["fileType"], ТекСтр["link"]);  
				
		ПараметрыФайла = Новый Структура;
		ПараметрыФайла.Вставить("Автор", ТекПользователь);
		ПараметрыФайла.Вставить("ВладелецФайлов", Инцидент.Ссылка);
		ПараметрыФайла.Вставить("ИмяБезРасширения", Имя);
		ПараметрыФайла.Вставить("РасширениеБезТочки", Расширение);
		ПараметрыФайла.Вставить("ВремяИзмененияУниверсальное", );
			
		ПрисоединенныеФайлы.ДобавитьПрисоединенныйФайл(ПараметрыФайла, АдресХранилища,, Описание)	

	КонецЦикла;
КонецЕсли;
//Сообщить("Строка 209");//Стр 209
// Загрузка файлов
ФайлыИнцидента = ЗначенияАтрибутов.Получить("ФайлыРекламации");
//Сообщить("Строка 212");//Стр 212
МассивФайлов = Новый Массив;
Если ТипЗнч(ФайлыИнцидента) = Тип("Массив") Тогда
	Для каждого ТекСтр из ФайлыИнцидента Цикл
	
		ЧтениеJSON  = Новый ЧтениеJSON;
		ЧтениеJSON.УстановитьСтроку(ТекСтр);
		ТекЭл = ПрочитатьJSON(ЧтениеJSON,Истина);
		МассивФайлов.Добавить(ТекЭл);
	
	КонецЦикла;
КонецЕсли;
//Сообщить("Строка 224");//Стр 224
СерверФайлов = Константы.КА_АдресСервисаХраненияФайлов.Получить();

Атрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "СсылкиНаИзображения");

НС = Инцидент.ЗначенияАтрибутов.НайтиСтроки(Новый Структура("Атрибут", Атрибут));  
Для каждого Стр из НС Цикл
	Инцидент.ЗначенияАтрибутов.Удалить(Стр);
КонецЦикла;
//Сообщить("Строка 233");//Стр 233
Для каждого ТекСтр из МассивФайлов Цикл
		
	Путь = СерверФайлов + ТекСтр["link"];
	НовСтр = Инцидент.ЗначенияАтрибутов.Добавить();
	НовСтр.Атрибут = Атрибут;
	НовСтр.Значение = "http://"+Путь;
	НовСтр.Представление = ТекСтр["originalName"] + "." + ТекСтр["type"];
КонецЦикла;
Инцидент.Записать();
//Сообщить("Строка 242");//Стр 242</v8:ОбработчикПриПереходе>
			<v8:ОбработчикПриПринятииКИсполнению/>
			<v8:ОбработчикПроведения/>
			<v8:Описание/>
			<v8:ПроверятьРезультат>false</v8:ПроверятьРезультат>
			<v8:СрокВыполнения>1</v8:СрокВыполнения>
			<v8:СообщениеНедоступныПереходы/>
			<v8:ОбработчикПриОткрытии/>
			<v8:Исполнители>
				<v8:Исполнитель xsi:type="v8:CatalogRef.Пользователи">27b1b5ed-427b-11e6-80c3-0cc47a6b63cf</v8:Исполнитель>
				<v8:Оповещать>false</v8:Оповещать>
			</v8:Исполнители>
			<v8:ВариантыПерехода>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">c9cc2bd9-81fd-11ec-bb9e-00155d70bd06</v8:Этап>
				<v8:ИмяКоманды/>
				<v8:Пиктограмма/>
				<v8:ВариантЗавершения/>
				<v8:ПропускатьПроверку>false</v8:ПропускатьПроверку>
				<v8:ОбработчикПроверкиПерехода/>
				<v8:ПриАвтоматическомЗавершении>false</v8:ПриАвтоматическомЗавершении>
			</v8:ВариантыПерехода>
			<v8:Команды>
				<v8:Заголовок>В работе у МКО</v8:Заголовок>
				<v8:УИ>2383c2b1-3dab-453b-911e-c6c9ad953d6d</v8:УИ>
				<v8:ОбработчикКлиентПеред>СтатусПриИзменении(Объект.ЗначенияАтрибутов); </v8:ОбработчикКлиентПеред>
				<v8:ОбработчикСервер/>
				<v8:ОбработчикКлиентПосле/>
			</v8:Команды>
			<v8:Команды>
				<v8:Заголовок>Заполнить изображения</v8:Заголовок>
				<v8:УИ>0dcd1b60-7e8a-4e98-99d1-e3290a5e0213</v8:УИ>
				<v8:ОбработчикКлиентПеред/>
				<v8:ОбработчикСервер>ЗначенияАтрибутов = Документы.КА_Инцидент.ПолучитьЗначенияАтрибутов(Объект);

// Загрузка файлов
ФайлыИнцидента = ЗначенияАтрибутов.Получить("ФайлыРекламации");
ЧтениеJSON  = Новый ЧтениеJSON;
ЧтениеJSON.УстановитьСтроку(ФайлыИнцидента);
МассивФайлов = ПрочитатьJSON(ЧтениеJSON,Истина);

ТекПользователь = Пользователи.АвторизованныйПользователь();

СерверФайлов = Константы.КА_АдресСервисаХраненияФайлов.Получить();

Атрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "СсылкиНаИзображения");

НС = Объект.ЗначенияАтрибутов.НайтиСтроки(Новый Структура("Атрибут", Атрибут));  
Для каждого Стр из НС Цикл
	Объект.ЗначенияАтрибутов.Удалить(Стр);
КонецЦикла;

Для каждого ТекСтр из МассивФайлов Цикл
		
	Путь = СерверФайлов + ТекСтр["link"];
	НовСтр = Объект.ЗначенияАтрибутов.Добавить();
	НовСтр.Атрибут = Атрибут;
	НовСтр.Значение = Путь;
	НовСтр.Представление = ТекСтр["originalName"] + "." + ТекСтр["type"];
	
КонецЦикла;</v8:ОбработчикСервер>
				<v8:ОбработчикКлиентПосле/>
			</v8:Команды>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">eade99cb-7eb0-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>true</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">b41ea743-66f8-11ec-bba8-00155d258b03</v8:Атрибут>
				<v8:Недоступен>true</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">f6477028-7eb0-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>true</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">0bfaa900-7eb1-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>true</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
			<v8:НастройкиАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">e379ced7-7eb0-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Недоступен>true</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Расположение/>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
			</v8:НастройкиАтрибутов>
		</v8:CatalogObject.КА_ЭтапыИнцидентов>
		<v8:CatalogObject.КА_ВидыИнцидентов>
			<v8:Ref xsi:type="v8:CatalogRef.КА_ВидыИнцидентов">fe697b45-4e2c-11ec-bba8-00155d258b03</v8:Ref>
			<v8:DeletionMark>false</v8:DeletionMark>
			<v8:Code>000000016</v8:Code>
			<v8:Description>Рекламация от клиента: брак</v8:Description>
			<v8:Автостарт>true</v8:Автостарт>
			<v8:АдресСобытияВСервисе>805</v8:АдресСобытияВСервисе>
			<v8:ЗавершатьПриСогласованииДО>false</v8:ЗавершатьПриСогласованииДО>
			<v8:ИдентификаторВида>РекламацияОтКлиента</v8:ИдентификаторВида>
			<v8:ИнтеграцияДО>false</v8:ИнтеграцияДО>
			<v8:ОбработчикПередЗаписью>УстановитьПривилегированныйРежим(Истина);

Если ЗначениеЗаполнено(ДополнительныеСвойства.ЗначенияАтрибутов["realizationId"]) Тогда
	ЗначениеКлиент = ДополнительныеСвойства.ЗначенияАтрибутов["realizationId"].Партнер;
Иначе
	ЗначениеКлиент = Неопределено;
КонецЕсли;

ИнцидентЗапрос = Документы.КА_Инцидент.ПустаяСсылка(); 
ТаблицаСвязанных = СвязанныеОбъекты.Выгрузить();
Для Каждого Стр из ТаблицаСвязанных Цикл
	Если ТипЗнч(Стр.Объект) = Тип("ДокументСсылка.КА_Инцидент") Тогда 
		Если Стр.Объект.ВидИнцидента = Справочники.КА_ВидыИнцидентов.НайтиПоНаименованию("Рекламация от клиента: запрос поставщику") Тогда
			ИнцидентЗапрос = Стр.Объект; 
		КонецЕсли; 
	КонецЕсли; 
КонецЦикла; 

Если не ИнцидентЗапрос = Документы.КА_Инцидент.ПустаяСсылка() Тогда 
	ТаблицаАтрибутов = ЗначенияАтрибутов.Выгрузить(); 
	ТабАтрЗапрос = ИнцидентЗапрос.ЗначенияАтрибутов.Выгрузить();
	АтрибутИнцидента=ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоНаименованию("СкладскаяЯчейка");
	СтрБрак = ТаблицаАтрибутов.Найти(АтрибутИнцидента,"Атрибут");
	СтрПоставщику = ИнцидентЗапрос.ЗначенияАтрибутов.Найти(АтрибутИнцидента,"Атрибут");
	Если СтрБрак = Неопределено  Тогда 
		Если НЕ СтрПоставщику = Неопределено и ЗначениеЗаполнено(СтрПоставщику.Значение) Тогда 
			СтрБрак = ТаблицаАтрибутов.Добавить();
			СтрБрак.Атрибут = АтрибутИнцидента; 
			СтрБрак.Значение = СтрПоставщику.Значение;
		КонецЕсли; 
	ИначеЕсли НЕ ЗначениеЗаполнено(СтрБрак.Значение) И (НЕ СтрПоставщику = Неопределено) Тогда 
		СтрБрак.Значение = СтрПоставщику.Значение;
	КонецЕслИ; 
	ЭтотОбъект.ЗначенияАтрибутов.Загрузить(ТаблицаАтрибутов);
КонецЕсли; 

Атрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "counterparty_external_id");
НС_Удалить = ЗначенияАтрибутов.НайтиСтроки(Новый Структура("Атрибут", Атрибут));
Для каждого Стр из НС_Удалить Цикл
	ЗначенияАтрибутов.Удалить(Стр);
КонецЦикла;
//Стр 13
НовСтр = ЗначенияАтрибутов.Добавить();
НовСтр.Атрибут = Атрибут;
НовСтр.Значение = ЗначениеКлиент;

//Синхроизация Атрибутов Инцидента: Запрос поставщику
ИнцидентЗапрос = Неопределено;
Для Каждого Стр Из ЭтотОбъект.СвязанныеОбъекты Цикл
	Если СтрНайти(Строка(Стр.Объект),"Рекламация от клиента: запрос поставщику") Тогда
		ИнцидентЗапрос = Стр.Объект.Ссылка.ПолучитьОбъект();
	КонецЕсли;
КонецЦикла;
//Стр25

Если не ИнцидентЗапрос = Неопределено Тогда 
	ТаблицаОбъектов = ЭтотОбъект.СвязанныеОбъекты.Выгрузить();
	ТаблицаОбъектовЗапрос = ИнцидентЗапрос.СвязанныеОбъекты.Выгрузить();
	Для каждого Стр из ТаблицаОбъектов Цикл
		СтрПоиск = ТаблицаОбъектовЗапрос.Найти(Стр.Объект, "Объект");
		Если (не СтрПоиск = Неопределено) и (СтрПоиск.Объект.Ссылка = ИнцидентЗапрос.Ссылка) Тогда
			Продолжить;
		КонецЕсли;
		Если СтрПоиск = Неопределено Тогда
			НовСтр = ТаблицаОбъектовЗапрос.Добавить();
			НовСтр.Объект = Стр.Объект;
		КонецЕсли;
	КонецЦикла;
	ИнцидентЗапрос.СвязанныеОбъекты.Загрузить(ТаблицаОбъектовЗапрос);
КонецЕсли;

Если не ИнцидентЗапрос=Неопределено Тогда
	ТабАтрибутов = ЭтотОбъект.ЗначенияАтрибутов.Выгрузить();
	ТаблицаАтрибутов = ИнцидентЗапрос.ЗначенияАтрибутов.Выгрузить();
	АтрибутПоиск = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоНаименованию("РешениеИнженера");
	Стр = ТаблицаАтрибутов.Найти(АтрибутПоиск,"Атрибут");
	Если Стр = Неопределено Тогда
		Стр = ТаблицаАтрибутов.Добавить();
		Стр.Атрибут = АтрибутПоиск;
	КонецЕсли;
	ЗамСтр = ТабАтрибутов.Найти(АтрибутПоиск, "Атрибут"); 
	Если не ЗамСтр = Неопределено Тогда 
		Стр.Значение = ЗамСтр.Значение;
	КонецЕсли;
	Если СтрНайти(Строка(ЭтотОбъект.ТекущийЭтап), "Организация доставки") Тогда
		АтрибутПоиск = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоНаименованию("Экспертиза");
		Стр = ТаблицаАтрибутов.Найти(АтрибутПоиск,"Атрибут");
		Если Стр = Неопределено Тогда
			Стр = ТаблицаАтрибутов.Добавить();
			Стр.Атрибут = АтрибутПоиск;
		КонецЕсли;
		ТаблицаОбъекта = ЭтотОбъект.ЗначенияАтрибутов.Выгрузить();
		СтрПоиск = ТаблицаОбъекта.Найти(АтрибутПоиск,"Атрибут");
		Стр.Значение = СтрПоиск.Значение;
	КонецЕсли;
	//РешениеНОР
	АтрибутПоиск = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоНаименованию("РешениеНОР");
	Стр = ТаблицаАтрибутов.Найти(АтрибутПоиск,"Атрибут");
	Если Стр = Неопределено Тогда
		Стр = ТаблицаАтрибутов.Добавить();
		Стр.Атрибут = АтрибутПоиск;
	КонецЕсли;
	НашАтрибут = ТабАтрибутов.Найти(АтрибутПоиск,"Атрибут");
	Если не НашАтрибут = Неопределено Тогда 
		Стр.Значение = НашАтрибут.Значение;
	КонецЕсли;
	
	ТекущийЭтапСтр = Строка(ЭтотОбъект.ТекущийЭтап);
	Если СтрНайти(ТекущийЭтапСтр, "Брак. Компенсация. Возврат детали") Тогда
		АтрибутПоиск = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоНаименованию("Товар вернуть");
		Стр = ТаблицаАтрибутов.Найти(АтрибутПоиск,"Атрибут");
		Если Стр = Неопределено Тогда
			Стр = ТаблицаАтрибутов.Добавить();
			Стр.Атрибут = АтрибутПоиск;
		КонецЕсли;
		Стр.Значение = Истина;
		ТаблицаОбъекта = ЭтотОбъект.ЗначенияАтрибутов.Выгрузить();
		Стр = ТаблицаОбъекта.Найти(АтрибутПоиск,"Атрибут");
		Если Стр = Неопределено Тогда
			Стр = ТаблицаОбъекта.Добавить();
			Стр.Атрибут = АтрибутПоиск;
		КонецЕсли;
		Стр.Значение = Истина;
		ЭтотОбъект.ЗначенияАтрибутов.Загрузить(ТаблицаОбъекта);
	КонецЕсли;

	АтрибутПоиск = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоНаименованию("Экспертиза");
	Стр = ТаблицаАтрибутов.Найти(АтрибутПоиск, "Атрибут"); 
	Если Стр = Неопределено Тогда
		Стр = ТаблицаАтрибутов.Добавить();
		Стр.Атрибут = АтрибутПоиск;
	КонецЕсли;
	ЗамСтр = ТабАтрибутов.Найти(АтрибутПоиск, "Атрибут"); 
	Если не ЗамСтр = Неопределено Тогда 
		Стр.Значение = ЗамСтр.Значение;
	КонецЕсли;

	АтрибутПоиск = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоНаименованию("РешениеИнженера");
	Стр = ТаблицаАтрибутов.Найти(АтрибутПоиск, "Атрибут"); 
	Если Стр = Неопределено Тогда
		Стр = ТаблицаАтрибутов.Добавить();
		Стр.Атрибут = АтрибутПоиск;
	КонецЕсли;
	ЗамСтр = ТабАтрибутов.Найти(АтрибутПоиск, "Атрибут"); 
	Если не ЗамСтр = Неопределено Тогда 
		Стр.Значение = ЗамСтр.Значение;
	КонецЕсли;

	АтрибутПоиск = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоНаименованию("ВозвратУтилизация");
	Стр = ТаблицаАтрибутов.Найти(АтрибутПоиск, "Атрибут"); 
	Если Стр = Неопределено Тогда
		Стр = ТаблицаАтрибутов.Добавить();
		Стр.Атрибут = АтрибутПоиск;
	КонецЕсли;
	ЗамСтр = ТабАтрибутов.Найти(АтрибутПоиск, "Атрибут"); 
	Если не ЗамСтр = Неопределено Тогда 
		Стр.Значение = ЗамСтр.Значение;
	КонецЕсли;
//ЗВТК 
	АтрибутПоиск = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоНаименованию("ЗаявкаНаВозвратТовара");
	Стр = ТаблицаАтрибутов.Найти(АтрибутПоиск, "Атрибут"); 
	Если Стр = Неопределено Тогда
		Стр = ТаблицаАтрибутов.Добавить();
		Стр.Атрибут = АтрибутПоиск;
	КонецЕсли;
	ЗамСтр = ТабАтрибутов.Найти(АтрибутПоиск, "Атрибут"); 
	Если не ЗамСтр = Неопределено Тогда 
		Если не Стр.Значение = ЗамСтр.Значение Тогда
			Стр.Значение = ЗамСтр.Значение;
		КонецЕсли;
	КонецЕсли;

	ИнцидентЗапрос.ЗначенияАтрибутов.Загрузить(ТаблицаАтрибутов);
	ИнцидентЗапрос.Записать();
//Синхронизация привязанных файлов документа Инцидент из вида в вид: брак-&gt;заявка на возврат

//Получаем значения из Инцидент: Заявка поставщику 
	АтрибутПоиск = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоНаименованию("vendorsolution");
	Стр = ТаблицаАтрибутов.Найти(АтрибутПоиск, "Атрибут");
	Если не Стр = Неопределено Тогда 
		Если ЗначениеЗаполнено(Стр.Значение) Тогда 
			СтрЗам = ТабАтрибутов.Найти(АтрибутПоиск, "Атрибут");
			Если СтрЗам = Неопределено Тогда 
				СтрЗам = ТабАтрибутов.Добавить();
				СтрЗам.Атрибут = АтрибутПоиск;
			КонецЕсли;
			СтрЗам.Значение = Стр.Значение;
			ЭтотОбъект.ЗначенияАтрибутов.Загрузить(ТабАтрибутов);
		КонецЕсли;
	КонецЕсли;

КонецЕсли;

//Проверка количества к рекламации
ЭтапРедактирования = Справочники.КА_ЭтапыИнцидентов.НайтиПоНаименованию("Уточнение данных рекламации"); 
ТабАтрибутов = ЭтотОбъект.ЗначенияАтрибутов.Выгрузить();
Если ЭтотОбъект.ТекущийЭтап &lt;&gt; ЭтапРедактирования Тогда 
	ВсегоТоваров = ЭтотОбъект.Товары.Итог("Количество");
	АтрибутПоиск = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоНаименованию("count");
	Стр = ТабАтрибутов.Найти(АтрибутПоиск, "Атрибут");
	Если Стр = Неопределено Тогда
		Стр = ТабАтрибутов.Добавить();
		Стр.Атрибут = АтрибутПоиск;
		Стр.Значение = ВсегоТоваров;
		ЭтотОбъект.ЗначенияАтрибутов.Загрузить(ТабАтрибутов);
	ИначеЕсли Стр.Значение &lt;&gt; ВсегоТоваров и ВсегоТоваров &gt; 0 Тогда
		Стр.Значение = ВсегоТоваров;
		ЭтотОбъект.ЗначенияАтрибутов.Загрузить(ТабАтрибутов);
	КонецЕсли; 
КонецЕсли; 

//Проверка заполнения поля Склад
АтрибутПоиск = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоНаименованию("Склад");
Стр = ТабАтрибутов.Найти(АтрибутПоиск, "Атрибут");
Если Стр = Неопределено  Тогда
	Стр = ТабАтрибутов.Добавить();
	Стр.Атрибут = АтрибутПоиск;
КонецЕсли;

Если не ЗначениеЗаполнено(Стр.Значение) Тогда 
	ТаблицаТовары = ЭтотОбъект.Товары.Выгрузить(); 
	Для Каждого СтрТов из ТаблицаТовары Цикл 
		Если ЗначениеЗаполнено(СтрТов.Склад) Тогда
			Стр.Значение=СтрТов.Склад;
			ЭтотОбъект.ЗначенияАтрибутов.Загрузить(ТабАтрибутов);
			Прервать;
		КонецЕсли; 
	КонецЦикла;
КонецЕсли;
 
УстановитьПривилегированныйРежим(Ложь);
</v8:ОбработчикПередЗаписью>
			<v8:ОбработчикПоискаОбъекта>Если ДанныеПакета.Получить("incident_external_id") &lt;&gt; Неопределено Тогда

	ГУИД = ДанныеПакета.Получить("incident_external_id");

	СсылкаИнцидент = Документы.КА_Инцидент.ПолучитьСсылка(Новый УникальныйИдентификатор(ГУИД));

	Если ЗначениеЗаполнено(СсылкаИнцидент) Тогда
		Инцидент = СсылкаИнцидент;
	КонецЕсли;
	
КонецЕсли;</v8:ОбработчикПоискаОбъекта>
			<v8:ОбработчикПриЗаписи/>
			<v8:ОбработчикПроведения/>
			<v8:ОбработчикПроверкиЗавершенияДО/>
			<v8:Ответственный xsi:type="v8:CatalogRef.Пользователи">27b1b5ed-427b-11e6-80c3-0cc47a6b63cf</v8:Ответственный>
			<v8:ПлановыйСрок>0</v8:ПлановыйСрок>
			<v8:ПравилоИнтеграцииДО xsi:type="v8:CatalogRef.ПравилаИнтеграцииС1СДокументооборотом">00000000-0000-0000-0000-000000000000</v8:ПравилоИнтеграцииДО>
			<v8:ПроверятьВыполнение>true</v8:ПроверятьВыполнение>
			<v8:ШаблонПроцессаДО>AQEIAAAAAAAAAO+7v3siVSJ9</v8:ШаблонПроцессаДО>
			<v8:НаборАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">dadc519d-bbf7-11ec-bba2-00155d70bd06</v8:Атрибут>
				<v8:Наследуется>false</v8:Наследуется>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:Технический>false</v8:Технический>
				<v8:Идентификатор>false</v8:Идентификатор>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Шрифт/>
				<v8:Цвет/>
				<v8:ОтступСтрок>0</v8:ОтступСтрок>
				<v8:Гиперссылка>true</v8:Гиперссылка>
			</v8:НаборАтрибутов>
			<v8:НаборАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">f6327d2c-d1c5-11ec-bbaf-00155d258b03</v8:Атрибут>
				<v8:Наследуется>false</v8:Наследуется>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:Технический>false</v8:Технический>
				<v8:Идентификатор>false</v8:Идентификатор>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Шрифт>{"#",9cd510c8-abfc-11d4-9434-004095e12fc7,1,
{7,2,62,
{0,6ad12c53-94df-4fe9-a345-7fcb14322c4a},100,700,0,0,0,1,100},0}</v8:Шрифт>
				<v8:Цвет>{"#",9cd510c7-abfc-11d4-9434-004095e12fc7,2,
{3,3,
{0,757b547b-b79c-459a-a64a-eef19a09a38f}
}
}</v8:Цвет>
				<v8:ОтступСтрок>1</v8:ОтступСтрок>
				<v8:Гиперссылка>false</v8:Гиперссылка>
			</v8:НаборАтрибутов>
			<v8:НаборАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">e379ced7-7eb0-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Наследуется>false</v8:Наследуется>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:Технический>false</v8:Технический>
				<v8:Идентификатор>false</v8:Идентификатор>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
				<v8:Недоступен>true</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Шрифт/>
				<v8:Цвет>{"#",9cd510c7-abfc-11d4-9434-004095e12fc7,2,
{3,0,
{0}
}
}</v8:Цвет>
				<v8:ОтступСтрок>0</v8:ОтступСтрок>
				<v8:Гиперссылка>false</v8:Гиперссылка>
			</v8:НаборАтрибутов>
			<v8:НаборАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">455e5227-8e55-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Наследуется>false</v8:Наследуется>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:Технический>false</v8:Технический>
				<v8:Идентификатор>false</v8:Идентификатор>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Шрифт/>
				<v8:Цвет/>
				<v8:ОтступСтрок>1</v8:ОтступСтрок>
				<v8:Гиперссылка>false</v8:Гиперссылка>
			</v8:НаборАтрибутов>
			<v8:НаборАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">ae2bfd6f-8798-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Наследуется>false</v8:Наследуется>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:Технический>false</v8:Технический>
				<v8:Идентификатор>false</v8:Идентификатор>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Шрифт>{"#",9cd510c8-abfc-11d4-9434-004095e12fc7,1,
{7,2,62,
{0,6ad12c53-94df-4fe9-a345-7fcb14322c4a},110,700,0,1,0,1,100},0}</v8:Шрифт>
				<v8:Цвет>{"#",9cd510c7-abfc-11d4-9434-004095e12fc7,2,
{3,3,
{0,757b547b-b79c-459a-a64a-eef19a09a38f}
}
}</v8:Цвет>
				<v8:ОтступСтрок>1</v8:ОтступСтрок>
				<v8:Гиперссылка>false</v8:Гиперссылка>
			</v8:НаборАтрибутов>
			<v8:НаборАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">b444c315-5f3e-11ed-bba5-00155d70bd06</v8:Атрибут>
				<v8:Наследуется>false</v8:Наследуется>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:Технический>false</v8:Технический>
				<v8:Идентификатор>false</v8:Идентификатор>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Шрифт/>
				<v8:Цвет/>
				<v8:ОтступСтрок>0</v8:ОтступСтрок>
				<v8:Гиперссылка>false</v8:Гиперссылка>
			</v8:НаборАтрибутов>
			<v8:НаборАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">c10475bc-8798-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Наследуется>false</v8:Наследуется>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:Технический>false</v8:Технический>
				<v8:Идентификатор>false</v8:Идентификатор>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
				<v8:Недоступен>true</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Шрифт>{"#",9cd510c8-abfc-11d4-9434-004095e12fc7,1,
{7,2,62,
{0,6ad12c53-94df-4fe9-a345-7fcb14322c4a},100,400,1,0,0,1,100},0}</v8:Шрифт>
				<v8:Цвет>{"#",9cd510c7-abfc-11d4-9434-004095e12fc7,2,
{3,3,
{0,757b547b-b79c-459a-a64a-eef19a09a38f}
}
}</v8:Цвет>
				<v8:ОтступСтрок>1</v8:ОтступСтрок>
				<v8:Гиперссылка>false</v8:Гиперссылка>
			</v8:НаборАтрибутов>
			<v8:НаборАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">7770acee-8e55-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Наследуется>false</v8:Наследуется>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:Технический>false</v8:Технический>
				<v8:Идентификатор>false</v8:Идентификатор>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Шрифт/>
				<v8:Цвет/>
				<v8:ОтступСтрок>1</v8:ОтступСтрок>
				<v8:Гиперссылка>false</v8:Гиперссылка>
			</v8:НаборАтрибутов>
			<v8:НаборАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">06421d01-b654-11ec-bba1-00155d70bd06</v8:Атрибут>
				<v8:Наследуется>false</v8:Наследуется>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:Технический>false</v8:Технический>
				<v8:Идентификатор>false</v8:Идентификатор>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
				<v8:Недоступен>true</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Шрифт/>
				<v8:Цвет/>
				<v8:ОтступСтрок>1</v8:ОтступСтрок>
				<v8:Гиперссылка>false</v8:Гиперссылка>
			</v8:НаборАтрибутов>
			<v8:НаборАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">20e9e340-bc98-11ec-bbaf-00155d258b03</v8:Атрибут>
				<v8:Наследуется>false</v8:Наследуется>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:Технический>false</v8:Технический>
				<v8:Идентификатор>false</v8:Идентификатор>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Шрифт>{"#",9cd510c8-abfc-11d4-9434-004095e12fc7,1,
{7,2,62,
{0,6ad12c53-94df-4fe9-a345-7fcb14322c4a},120,700,0,1,0,1,100},0}</v8:Шрифт>
				<v8:Цвет>{"#",9cd510c7-abfc-11d4-9434-004095e12fc7,2,
{3,3,
{0,ca0d938b-244e-421f-9fa4-320784b9f416}
}
}</v8:Цвет>
				<v8:ОтступСтрок>1</v8:ОтступСтрок>
				<v8:Гиперссылка>false</v8:Гиперссылка>
			</v8:НаборАтрибутов>
			<v8:НаборАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">f6477028-7eb0-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Наследуется>false</v8:Наследуется>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:Технический>false</v8:Технический>
				<v8:Идентификатор>false</v8:Идентификатор>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
				<v8:Недоступен>true</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Шрифт/>
				<v8:Цвет/>
				<v8:ОтступСтрок>1</v8:ОтступСтрок>
				<v8:Гиперссылка>false</v8:Гиперссылка>
			</v8:НаборАтрибутов>
			<v8:НаборАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">0bfaa900-7eb1-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Наследуется>false</v8:Наследуется>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:Технический>false</v8:Технический>
				<v8:Идентификатор>false</v8:Идентификатор>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Шрифт/>
				<v8:Цвет/>
				<v8:ОтступСтрок>0</v8:ОтступСтрок>
				<v8:Гиперссылка>false</v8:Гиперссылка>
			</v8:НаборАтрибутов>
			<v8:НаборАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">28c3acd3-ba33-11ec-bba2-00155d70bd06</v8:Атрибут>
				<v8:Наследуется>false</v8:Наследуется>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:Технический>false</v8:Технический>
				<v8:Идентификатор>false</v8:Идентификатор>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Шрифт>{"#",9cd510c8-abfc-11d4-9434-004095e12fc7,1,
{7,2,62,
{0,6ad12c53-94df-4fe9-a345-7fcb14322c4a},120,700,0,0,0,1,100},0}</v8:Шрифт>
				<v8:Цвет>{"#",9cd510c7-abfc-11d4-9434-004095e12fc7,2,
{3,3,
{0,102bce74-47ef-4afc-a98d-12f48fac3f82}
}
}</v8:Цвет>
				<v8:ОтступСтрок>1</v8:ОтступСтрок>
				<v8:Гиперссылка>false</v8:Гиперссылка>
			</v8:НаборАтрибутов>
			<v8:НаборАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">e5acad73-a62b-11ec-bba8-00155d258b03</v8:Атрибут>
				<v8:Наследуется>false</v8:Наследуется>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:Технический>false</v8:Технический>
				<v8:Идентификатор>false</v8:Идентификатор>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
				<v8:Недоступен>true</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Шрифт>{"#",9cd510c8-abfc-11d4-9434-004095e12fc7,1,
{7,1,62,
{0},110,700,0,0,0,1,100},0}</v8:Шрифт>
				<v8:Цвет>{"#",9cd510c7-abfc-11d4-9434-004095e12fc7,2,
{3,3,
{0,0c44fdea-7b81-45be-87f5-d64456a9d379}
}
}</v8:Цвет>
				<v8:ОтступСтрок>1</v8:ОтступСтрок>
				<v8:Гиперссылка>false</v8:Гиперссылка>
			</v8:НаборАтрибутов>
			<v8:НаборАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">1e160f11-bca1-11ec-bba2-00155d70bd06</v8:Атрибут>
				<v8:Наследуется>false</v8:Наследуется>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:Технический>false</v8:Технический>
				<v8:Идентификатор>false</v8:Идентификатор>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Шрифт/>
				<v8:Цвет/>
				<v8:ОтступСтрок>1</v8:ОтступСтрок>
				<v8:Гиперссылка>false</v8:Гиперссылка>
			</v8:НаборАтрибутов>
			<v8:НаборАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">578c447d-b974-11ec-bba2-00155d70bd06</v8:Атрибут>
				<v8:Наследуется>false</v8:Наследуется>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:Технический>false</v8:Технический>
				<v8:Идентификатор>false</v8:Идентификатор>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Шрифт/>
				<v8:Цвет/>
				<v8:ОтступСтрок>1</v8:ОтступСтрок>
				<v8:Гиперссылка>false</v8:Гиперссылка>
			</v8:НаборАтрибутов>
			<v8:НаборАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">e983c36e-bc97-11ec-bbaf-00155d258b03</v8:Атрибут>
				<v8:Наследуется>false</v8:Наследуется>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:Технический>false</v8:Технический>
				<v8:Идентификатор>false</v8:Идентификатор>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Шрифт/>
				<v8:Цвет/>
				<v8:ОтступСтрок>0</v8:ОтступСтрок>
				<v8:Гиперссылка>false</v8:Гиперссылка>
			</v8:НаборАтрибутов>
			<v8:НаборАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">579bcceb-8e55-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Наследуется>false</v8:Наследуется>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:Технический>false</v8:Технический>
				<v8:Идентификатор>false</v8:Идентификатор>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Шрифт>{"#",9cd510c8-abfc-11d4-9434-004095e12fc7,1,
{7,1,62,
{0},110,700,0,1,0,1,100},0}</v8:Шрифт>
				<v8:Цвет>{"#",9cd510c7-abfc-11d4-9434-004095e12fc7,2,
{3,3,
{0,757b547b-b79c-459a-a64a-eef19a09a38f}
}
}</v8:Цвет>
				<v8:ОтступСтрок>1</v8:ОтступСтрок>
				<v8:Гиперссылка>false</v8:Гиперссылка>
			</v8:НаборАтрибутов>
			<v8:НаборАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">c9ae9a45-d6cc-11ec-bbaf-00155d258b03</v8:Атрибут>
				<v8:Наследуется>false</v8:Наследуется>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:Технический>false</v8:Технический>
				<v8:Идентификатор>false</v8:Идентификатор>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
				<v8:Недоступен>true</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Шрифт/>
				<v8:Цвет/>
				<v8:ОтступСтрок>1</v8:ОтступСтрок>
				<v8:Гиперссылка>false</v8:Гиперссылка>
			</v8:НаборАтрибутов>
			<v8:НаборАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">1cf61873-ba50-11ec-bba2-00155d70bd06</v8:Атрибут>
				<v8:Наследуется>false</v8:Наследуется>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:Технический>false</v8:Технический>
				<v8:Идентификатор>false</v8:Идентификатор>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Шрифт>{"#",9cd510c8-abfc-11d4-9434-004095e12fc7,1,
{7,2,62,
{0,6ad12c53-94df-4fe9-a345-7fcb14322c4a},100,700,0,0,0,1,100},0}</v8:Шрифт>
				<v8:Цвет>{"#",9cd510c7-abfc-11d4-9434-004095e12fc7,2,
{3,3,
{0,757b547b-b79c-459a-a64a-eef19a09a38f}
}
}</v8:Цвет>
				<v8:ОтступСтрок>1</v8:ОтступСтрок>
				<v8:Гиперссылка>false</v8:Гиперссылка>
			</v8:НаборАтрибутов>
			<v8:НаборАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">eade99cb-7eb0-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Наследуется>false</v8:Наследуется>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:Технический>false</v8:Технический>
				<v8:Идентификатор>false</v8:Идентификатор>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
				<v8:Недоступен>true</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Шрифт/>
				<v8:Цвет>{"#",9cd510c7-abfc-11d4-9434-004095e12fc7,2,
{3,0,
{0}
}
}</v8:Цвет>
				<v8:ОтступСтрок>1</v8:ОтступСтрок>
				<v8:Гиперссылка>false</v8:Гиперссылка>
			</v8:НаборАтрибутов>
			<v8:НаборАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">f9220711-8795-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Наследуется>false</v8:Наследуется>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:Технический>false</v8:Технический>
				<v8:Идентификатор>false</v8:Идентификатор>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Шрифт>{"#",9cd510c8-abfc-11d4-9434-004095e12fc7,1,
{7,1,62,
{0},120,700,0,0,0,1,100},0}</v8:Шрифт>
				<v8:Цвет>{"#",9cd510c7-abfc-11d4-9434-004095e12fc7,2,
{3,3,
{0,757b547b-b79c-459a-a64a-eef19a09a38f}
}
}</v8:Цвет>
				<v8:ОтступСтрок>1</v8:ОтступСтрок>
				<v8:Гиперссылка>false</v8:Гиперссылка>
			</v8:НаборАтрибутов>
			<v8:НаборАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">b41ea743-66f8-11ec-bba8-00155d258b03</v8:Атрибут>
				<v8:Наследуется>false</v8:Наследуется>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:Технический>false</v8:Технический>
				<v8:Идентификатор>false</v8:Идентификатор>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
				<v8:Недоступен>true</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Шрифт/>
				<v8:Цвет/>
				<v8:ОтступСтрок>1</v8:ОтступСтрок>
				<v8:Гиперссылка>false</v8:Гиперссылка>
			</v8:НаборАтрибутов>
			<v8:НаборАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">f94c9679-7ab8-11ed-bbb3-00155d258b03</v8:Атрибут>
				<v8:Наследуется>false</v8:Наследуется>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:Технический>false</v8:Технический>
				<v8:Идентификатор>false</v8:Идентификатор>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Шрифт/>
				<v8:Цвет/>
				<v8:ОтступСтрок>0</v8:ОтступСтрок>
				<v8:Гиперссылка>false</v8:Гиперссылка>
			</v8:НаборАтрибутов>
			<v8:НаборАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">f72ce76b-2ae2-11e9-80cc-00155d049008</v8:Атрибут>
				<v8:Наследуется>false</v8:Наследуется>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:Технический>false</v8:Технический>
				<v8:Идентификатор>false</v8:Идентификатор>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Шрифт>{"#",9cd510c8-abfc-11d4-9434-004095e12fc7,1,
{7,1,62,
{0},110,700,0,0,0,1,100},0}</v8:Шрифт>
				<v8:Цвет>{"#",9cd510c7-abfc-11d4-9434-004095e12fc7,2,
{3,3,
{0,289a2d84-2477-4177-a6ef-507e2cadeea2}
}
}</v8:Цвет>
				<v8:ОтступСтрок>1</v8:ОтступСтрок>
				<v8:Гиперссылка>false</v8:Гиперссылка>
			</v8:НаборАтрибутов>
			<v8:НаборАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">cccbef96-673e-11ec-bba8-00155d258b03</v8:Атрибут>
				<v8:Наследуется>false</v8:Наследуется>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:Технический>false</v8:Технический>
				<v8:Идентификатор>false</v8:Идентификатор>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
				<v8:Недоступен>true</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Шрифт>{"#",9cd510c8-abfc-11d4-9434-004095e12fc7,1,
{7,1,62,
{0},100,700,0,0,0,1,100},0}</v8:Шрифт>
				<v8:Цвет/>
				<v8:ОтступСтрок>0</v8:ОтступСтрок>
				<v8:Гиперссылка>false</v8:Гиперссылка>
			</v8:НаборАтрибутов>
			<v8:НаборАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">413c9a50-673f-11ec-bba8-00155d258b03</v8:Атрибут>
				<v8:Наследуется>false</v8:Наследуется>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:Технический>false</v8:Технический>
				<v8:Идентификатор>false</v8:Идентификатор>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Шрифт/>
				<v8:Цвет/>
				<v8:ОтступСтрок>1</v8:ОтступСтрок>
				<v8:Гиперссылка>false</v8:Гиперссылка>
			</v8:НаборАтрибутов>
			<v8:НаборАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">a40c9242-5e35-11ec-bba8-00155d258b03</v8:Атрибут>
				<v8:Наследуется>false</v8:Наследуется>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:Технический>false</v8:Технический>
				<v8:Идентификатор>false</v8:Идентификатор>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
				<v8:Недоступен>true</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Шрифт>{"#",9cd510c8-abfc-11d4-9434-004095e12fc7,1,
{7,1,62,
{0},90,400,1,0,0,1,100},0}</v8:Шрифт>
				<v8:Цвет/>
				<v8:ОтступСтрок>1</v8:ОтступСтрок>
				<v8:Гиперссылка>false</v8:Гиперссылка>
			</v8:НаборАтрибутов>
			<v8:НаборАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">b926251e-39ba-11e9-80cc-00155d049008</v8:Атрибут>
				<v8:Наследуется>false</v8:Наследуется>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:Технический>false</v8:Технический>
				<v8:Идентификатор>false</v8:Идентификатор>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
				<v8:Недоступен>true</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Шрифт/>
				<v8:Цвет/>
				<v8:ОтступСтрок>1</v8:ОтступСтрок>
				<v8:Гиперссылка>false</v8:Гиперссылка>
			</v8:НаборАтрибутов>
			<v8:НаборАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">a7ce5483-67ef-11ec-bba8-00155d258b03</v8:Атрибут>
				<v8:Наследуется>false</v8:Наследуется>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:Технический>false</v8:Технический>
				<v8:Идентификатор>false</v8:Идентификатор>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
				<v8:Недоступен>true</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Шрифт/>
				<v8:Цвет/>
				<v8:ОтступСтрок>0</v8:ОтступСтрок>
				<v8:Гиперссылка>false</v8:Гиперссылка>
			</v8:НаборАтрибутов>
			<v8:НаборАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">c41bdd9c-67ef-11ec-bba8-00155d258b03</v8:Атрибут>
				<v8:Наследуется>false</v8:Наследуется>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:Технический>false</v8:Технический>
				<v8:Идентификатор>false</v8:Идентификатор>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
				<v8:Недоступен>true</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Шрифт/>
				<v8:Цвет/>
				<v8:ОтступСтрок>0</v8:ОтступСтрок>
				<v8:Гиперссылка>false</v8:Гиперссылка>
			</v8:НаборАтрибутов>
			<v8:НаборАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">3da7cce6-6746-11ec-bba8-00155d258b03</v8:Атрибут>
				<v8:Наследуется>false</v8:Наследуется>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:Технический>false</v8:Технический>
				<v8:Идентификатор>false</v8:Идентификатор>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
				<v8:Недоступен>true</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Шрифт/>
				<v8:Цвет/>
				<v8:ОтступСтрок>1</v8:ОтступСтрок>
				<v8:Гиперссылка>false</v8:Гиперссылка>
			</v8:НаборАтрибутов>
			<v8:НаборАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">82011875-6746-11ec-bba8-00155d258b03</v8:Атрибут>
				<v8:Наследуется>false</v8:Наследуется>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:Технический>false</v8:Технический>
				<v8:Идентификатор>false</v8:Идентификатор>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
				<v8:Недоступен>true</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Шрифт/>
				<v8:Цвет/>
				<v8:ОтступСтрок>0</v8:ОтступСтрок>
				<v8:Гиперссылка>false</v8:Гиперссылка>
			</v8:НаборАтрибутов>
			<v8:НаборАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">edb75284-673e-11ec-bba8-00155d258b03</v8:Атрибут>
				<v8:Наследуется>false</v8:Наследуется>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:Технический>false</v8:Технический>
				<v8:Идентификатор>false</v8:Идентификатор>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
				<v8:Недоступен>true</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Шрифт/>
				<v8:Цвет/>
				<v8:ОтступСтрок>0</v8:ОтступСтрок>
				<v8:Гиперссылка>false</v8:Гиперссылка>
			</v8:НаборАтрибутов>
			<v8:НаборАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">5953c67e-67f0-11ec-bba8-00155d258b03</v8:Атрибут>
				<v8:Наследуется>false</v8:Наследуется>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:Технический>false</v8:Технический>
				<v8:Идентификатор>false</v8:Идентификатор>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
				<v8:Недоступен>true</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Шрифт/>
				<v8:Цвет/>
				<v8:ОтступСтрок>0</v8:ОтступСтрок>
				<v8:Гиперссылка>false</v8:Гиперссылка>
			</v8:НаборАтрибутов>
			<v8:НаборАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">06653895-673f-11ec-bba8-00155d258b03</v8:Атрибут>
				<v8:Наследуется>false</v8:Наследуется>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:Технический>false</v8:Технический>
				<v8:Идентификатор>false</v8:Идентификатор>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
				<v8:Недоступен>true</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Шрифт/>
				<v8:Цвет/>
				<v8:ОтступСтрок>0</v8:ОтступСтрок>
				<v8:Гиперссылка>false</v8:Гиперссылка>
			</v8:НаборАтрибутов>
			<v8:НаборАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">6d505a82-67f0-11ec-bba8-00155d258b03</v8:Атрибут>
				<v8:Наследуется>false</v8:Наследуется>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:Технический>false</v8:Технический>
				<v8:Идентификатор>false</v8:Идентификатор>
				<v8:ВыводитьВОписание>true</v8:ВыводитьВОписание>
				<v8:Недоступен>true</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Шрифт/>
				<v8:Цвет/>
				<v8:ОтступСтрок>0</v8:ОтступСтрок>
				<v8:Гиперссылка>false</v8:Гиперссылка>
			</v8:НаборАтрибутов>
			<v8:НаборАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">94c4c7f2-8e55-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Наследуется>false</v8:Наследуется>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:Технический>false</v8:Технический>
				<v8:Идентификатор>false</v8:Идентификатор>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Шрифт/>
				<v8:Цвет/>
				<v8:ОтступСтрок>0</v8:ОтступСтрок>
				<v8:Гиперссылка>false</v8:Гиперссылка>
			</v8:НаборАтрибутов>
			<v8:НаборАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">acfbb3b4-8e55-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Наследуется>false</v8:Наследуется>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:Технический>false</v8:Технический>
				<v8:Идентификатор>false</v8:Идентификатор>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Шрифт/>
				<v8:Цвет/>
				<v8:ОтступСтрок>0</v8:ОтступСтрок>
				<v8:Гиперссылка>false</v8:Гиперссылка>
			</v8:НаборАтрибутов>
			<v8:НаборАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">b5cd8a51-8e55-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Наследуется>false</v8:Наследуется>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:Технический>false</v8:Технический>
				<v8:Идентификатор>false</v8:Идентификатор>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Шрифт/>
				<v8:Цвет/>
				<v8:ОтступСтрок>0</v8:ОтступСтрок>
				<v8:Гиперссылка>false</v8:Гиперссылка>
			</v8:НаборАтрибутов>
			<v8:НаборАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">c27fe7b5-8e55-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Наследуется>false</v8:Наследуется>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:Технический>false</v8:Технический>
				<v8:Идентификатор>false</v8:Идентификатор>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Шрифт/>
				<v8:Цвет/>
				<v8:ОтступСтрок>0</v8:ОтступСтрок>
				<v8:Гиперссылка>false</v8:Гиперссылка>
			</v8:НаборАтрибутов>
			<v8:НаборАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">cd3d1690-8e55-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Наследуется>false</v8:Наследуется>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:Технический>false</v8:Технический>
				<v8:Идентификатор>false</v8:Идентификатор>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Шрифт/>
				<v8:Цвет/>
				<v8:ОтступСтрок>0</v8:ОтступСтрок>
				<v8:Гиперссылка>false</v8:Гиперссылка>
			</v8:НаборАтрибутов>
			<v8:НаборАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">7070b387-2ac0-11e9-80cc-00155d049008</v8:Атрибут>
				<v8:Наследуется>false</v8:Наследуется>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:Технический>false</v8:Технический>
				<v8:Идентификатор>true</v8:Идентификатор>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
				<v8:Недоступен>true</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Шрифт/>
				<v8:Цвет/>
				<v8:ОтступСтрок>0</v8:ОтступСтрок>
				<v8:Гиперссылка>false</v8:Гиперссылка>
			</v8:НаборАтрибутов>
			<v8:НаборАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">f50dd77c-7e9a-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Наследуется>false</v8:Наследуется>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:Технический>false</v8:Технический>
				<v8:Идентификатор>false</v8:Идентификатор>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
				<v8:Недоступен>true</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Шрифт/>
				<v8:Цвет/>
				<v8:ОтступСтрок>0</v8:ОтступСтрок>
				<v8:Гиперссылка>false</v8:Гиперссылка>
			</v8:НаборАтрибутов>
			<v8:НаборАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">7729298e-bf2c-11ec-bba2-00155d70bd06</v8:Атрибут>
				<v8:Наследуется>false</v8:Наследуется>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:Технический>false</v8:Технический>
				<v8:Идентификатор>false</v8:Идентификатор>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>true</v8:Скрыт>
				<v8:Шрифт/>
				<v8:Цвет/>
				<v8:ОтступСтрок>0</v8:ОтступСтрок>
				<v8:Гиперссылка>false</v8:Гиперссылка>
			</v8:НаборАтрибутов>
			<v8:НаборАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">6681ac20-7ab9-11ed-bbb3-00155d258b03</v8:Атрибут>
				<v8:Наследуется>false</v8:Наследуется>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:Технический>false</v8:Технический>
				<v8:Идентификатор>false</v8:Идентификатор>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Шрифт/>
				<v8:Цвет/>
				<v8:ОтступСтрок>0</v8:ОтступСтрок>
				<v8:Гиперссылка>false</v8:Гиперссылка>
			</v8:НаборАтрибутов>
			<v8:НаборАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">6ebbf22b-7bbc-11ed-bbb3-00155d258b03</v8:Атрибут>
				<v8:Наследуется>false</v8:Наследуется>
				<v8:ПроверятьЗаполнение>false</v8:ПроверятьЗаполнение>
				<v8:Технический>false</v8:Технический>
				<v8:Идентификатор>false</v8:Идентификатор>
				<v8:ВыводитьВОписание>false</v8:ВыводитьВОписание>
				<v8:Недоступен>false</v8:Недоступен>
				<v8:Скрыт>false</v8:Скрыт>
				<v8:Шрифт/>
				<v8:Цвет/>
				<v8:ОтступСтрок>0</v8:ОтступСтрок>
				<v8:Гиперссылка>false</v8:Гиперссылка>
			</v8:НаборАтрибутов>
			<v8:ПравилаВыгрузки>
				<v8:Тег>id</v8:Тег>
				<v8:Родитель/>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">a7ce5483-67ef-11ec-bba8-00155d258b03</v8:Атрибут>
				<v8:Обработчик/>
				<v8:Массив>false</v8:Массив>
			</v8:ПравилаВыгрузки>
			<v8:ПравилаВыгрузки>
				<v8:Тег>realizationId</v8:Тег>
				<v8:Родитель/>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">b41ea743-66f8-11ec-bba8-00155d258b03</v8:Атрибут>
				<v8:Обработчик>Если ЗначениеЗаполнено(Источник) Тогда
	Результат = ""+Источник.УникальныйИдентификатор();	
Иначе
	Результат = "";
КонецЕсли;</v8:Обработчик>
				<v8:Массив>false</v8:Массив>
			</v8:ПравилаВыгрузки>
			<v8:ПравилаВыгрузки>
				<v8:Тег>productId</v8:Тег>
				<v8:Родитель/>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">cccbef96-673e-11ec-bba8-00155d258b03</v8:Атрибут>
				<v8:Обработчик>Если ЗначениеЗаполнено(Источник) Тогда
	Результат = ""+Источник.УникальныйИдентификатор();	
Иначе
	Результат = "";
КонецЕсли;</v8:Обработчик>
				<v8:Массив>false</v8:Массив>
			</v8:ПравилаВыгрузки>
			<v8:ПравилаВыгрузки>
				<v8:Тег>count</v8:Тег>
				<v8:Родитель/>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">413c9a50-673f-11ec-bba8-00155d258b03</v8:Атрибут>
				<v8:Обработчик/>
				<v8:Массив>false</v8:Массив>
			</v8:ПравилаВыгрузки>
			<v8:ПравилаВыгрузки>
				<v8:Тег>description</v8:Тег>
				<v8:Родитель/>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">a40c9242-5e35-11ec-bba8-00155d258b03</v8:Атрибут>
				<v8:Обработчик/>
				<v8:Массив>false</v8:Массив>
			</v8:ПравилаВыгрузки>
			<v8:ПравилаВыгрузки>
				<v8:Тег>installationDate</v8:Тег>
				<v8:Родитель/>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">edb75284-673e-11ec-bba8-00155d258b03</v8:Атрибут>
				<v8:Обработчик>Если ЗначениеЗаполнено(Источник) Тогда	
	Результат = Формат(Источник, "ДФ=yyyy-MM-ddTHH:mm:ssZ"); 
Иначе
	Результат = "";	
КонецЕсли;</v8:Обработчик>
				<v8:Массив>false</v8:Массив>
			</v8:ПравилаВыгрузки>
			<v8:ПравилаВыгрузки>
				<v8:Тег>dismantlingDate</v8:Тег>
				<v8:Родитель/>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">06653895-673f-11ec-bba8-00155d258b03</v8:Атрибут>
				<v8:Обработчик>Если ЗначениеЗаполнено(Источник) Тогда	
	Результат = Формат(Источник, "ДФ=yyyy-MM-ddTHH:mm:ssZ"); 
Иначе
	Результат = "";	
КонецЕсли;</v8:Обработчик>
				<v8:Массив>false</v8:Массив>
			</v8:ПравилаВыгрузки>
			<v8:ПравилаВыгрузки>
				<v8:Тег>mileageInstallation</v8:Тег>
				<v8:Родитель/>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">5953c67e-67f0-11ec-bba8-00155d258b03</v8:Атрибут>
				<v8:Обработчик/>
				<v8:Массив>false</v8:Массив>
			</v8:ПравилаВыгрузки>
			<v8:ПравилаВыгрузки>
				<v8:Тег>mileageDismantling</v8:Тег>
				<v8:Родитель/>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">6d505a82-67f0-11ec-bba8-00155d258b03</v8:Атрибут>
				<v8:Обработчик/>
				<v8:Массив>false</v8:Массив>
			</v8:ПравилаВыгрузки>
			<v8:ПравилаВыгрузки>
				<v8:Тег>brand</v8:Тег>
				<v8:Родитель/>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">c41bdd9c-67ef-11ec-bba8-00155d258b03</v8:Атрибут>
				<v8:Обработчик/>
				<v8:Массив>false</v8:Массив>
			</v8:ПравилаВыгрузки>
			<v8:ПравилаВыгрузки>
				<v8:Тег>model</v8:Тег>
				<v8:Родитель/>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">a7ce5483-67ef-11ec-bba8-00155d258b03</v8:Атрибут>
				<v8:Обработчик/>
				<v8:Массив>false</v8:Массив>
			</v8:ПравилаВыгрузки>
			<v8:ПравилаВыгрузки>
				<v8:Тег>vin</v8:Тег>
				<v8:Родитель/>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">b926251e-39ba-11e9-80cc-00155d049008</v8:Атрибут>
				<v8:Обработчик/>
				<v8:Массив>false</v8:Массив>
			</v8:ПравилаВыгрузки>
			<v8:ПравилаВыгрузки>
				<v8:Тег>defectFound</v8:Тег>
				<v8:Родитель/>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">3da7cce6-6746-11ec-bba8-00155d258b03</v8:Атрибут>
				<v8:Обработчик>Если ЗначениеЗаполнено(Источник) Тогда
	Результат = Источник.Ключ;
Иначе
	Результат = "";
КонецЕсли;</v8:Обработчик>
				<v8:Массив>false</v8:Массив>
			</v8:ПравилаВыгрузки>
			<v8:ПравилаВыгрузки>
				<v8:Тег>installation</v8:Тег>
				<v8:Родитель/>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">82011875-6746-11ec-bba8-00155d258b03</v8:Атрибут>
				<v8:Обработчик>Если ЗначениеЗаполнено(Источник) Тогда
	Результат = Источник.Ключ;
Иначе
	Результат = "";
КонецЕсли;</v8:Обработчик>
				<v8:Массив>false</v8:Массив>
			</v8:ПравилаВыгрузки>
			<v8:ПравилаЗагрузки>
				<v8:Тег>id</v8:Тег>
				<v8:Родитель/>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">7070b387-2ac0-11e9-80cc-00155d049008</v8:Атрибут>
				<v8:Обработчик>Инцидент.НомерИМ = Формат(Источник,"ЧГ=0");</v8:Обработчик>
				<v8:Массив>false</v8:Массив>
				<v8:Обязательный>false</v8:Обязательный>
			</v8:ПравилаЗагрузки>
			<v8:ПравилаЗагрузки>
				<v8:Тег>realizationId</v8:Тег>
				<v8:Родитель/>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">b41ea743-66f8-11ec-bba8-00155d258b03</v8:Атрибут>
				<v8:Обработчик>Если ЗначениеЗаполнено(Источник) Тогда
	Результат = Документы.РеализацияТоваровУслуг.ПолучитьСсылку(Новый УникальныйИдентификатор(Источник));	
КонецЕсли;</v8:Обработчик>
				<v8:Массив>false</v8:Массив>
				<v8:Обязательный>false</v8:Обязательный>
			</v8:ПравилаЗагрузки>
			<v8:ПравилаЗагрузки>
				<v8:Тег>productId</v8:Тег>
				<v8:Родитель/>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">cccbef96-673e-11ec-bba8-00155d258b03</v8:Атрибут>
				<v8:Обработчик>//Результат = Число(Источник)

Если ЗначениеЗаполнено(Источник) Тогда
	Результат = Справочники.Номенклатура.ПолучитьСсылку(Новый УникальныйИдентификатор(Источник));	
КонецЕсли;</v8:Обработчик>
				<v8:Массив>false</v8:Массив>
				<v8:Обязательный>false</v8:Обязательный>
			</v8:ПравилаЗагрузки>
			<v8:ПравилаЗагрузки>
				<v8:Тег>count</v8:Тег>
				<v8:Родитель/>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">413c9a50-673f-11ec-bba8-00155d258b03</v8:Атрибут>
				<v8:Обработчик>Если ЗначениеЗаполнено(Источник) Тогда
	Результат = Число(Источник);
КонецЕсли;</v8:Обработчик>
				<v8:Массив>false</v8:Массив>
				<v8:Обязательный>false</v8:Обязательный>
			</v8:ПравилаЗагрузки>
			<v8:ПравилаЗагрузки>
				<v8:Тег>description</v8:Тег>
				<v8:Родитель/>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">a40c9242-5e35-11ec-bba8-00155d258b03</v8:Атрибут>
				<v8:Обработчик>Результат=Строка(Источник);</v8:Обработчик>
				<v8:Массив>false</v8:Массив>
				<v8:Обязательный>false</v8:Обязательный>
			</v8:ПравилаЗагрузки>
			<v8:ПравилаЗагрузки>
				<v8:Тег>installationDate</v8:Тег>
				<v8:Родитель/>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">edb75284-673e-11ec-bba8-00155d258b03</v8:Атрибут>
				<v8:Обработчик>Если ЗначениеЗаполнено(Источник) Тогда
	
	ДатаСтрокой = Сред(Источник,1,4)
	+ Сред(Источник,6,2)
	+ Сред(Источник,9,2)
	+ Сред(Источник,12,2)
	+ Сред(Источник,15,2)
	+ Сред(Источник,18,2);

	Результат = Дата(ДатаСтрокой);
	
КонецЕсли;</v8:Обработчик>
				<v8:Массив>false</v8:Массив>
				<v8:Обязательный>false</v8:Обязательный>
			</v8:ПравилаЗагрузки>
			<v8:ПравилаЗагрузки>
				<v8:Тег>dismantlingDate</v8:Тег>
				<v8:Родитель/>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">06653895-673f-11ec-bba8-00155d258b03</v8:Атрибут>
				<v8:Обработчик>Если ЗначениеЗаполнено(Источник) Тогда

	ДатаСтрокой = Сред(Источник,1,4)
	+ Сред(Источник,6,2)
	+ Сред(Источник,9,2)
	+ Сред(Источник,12,2)
	+ Сред(Источник,15,2)
	+ Сред(Источник,18,2);

	Результат = Дата(ДатаСтрокой);
	
КонецЕсли;</v8:Обработчик>
				<v8:Массив>false</v8:Массив>
				<v8:Обязательный>false</v8:Обязательный>
			</v8:ПравилаЗагрузки>
			<v8:ПравилаЗагрузки>
				<v8:Тег>mileageInstallation</v8:Тег>
				<v8:Родитель/>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">5953c67e-67f0-11ec-bba8-00155d258b03</v8:Атрибут>
				<v8:Обработчик>Результат = Число(Источник);</v8:Обработчик>
				<v8:Массив>false</v8:Массив>
				<v8:Обязательный>false</v8:Обязательный>
			</v8:ПравилаЗагрузки>
			<v8:ПравилаЗагрузки>
				<v8:Тег>mileageDismantling</v8:Тег>
				<v8:Родитель/>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">6d505a82-67f0-11ec-bba8-00155d258b03</v8:Атрибут>
				<v8:Обработчик>Результат = Число(Источник);</v8:Обработчик>
				<v8:Массив>false</v8:Массив>
				<v8:Обязательный>false</v8:Обязательный>
			</v8:ПравилаЗагрузки>
			<v8:ПравилаЗагрузки>
				<v8:Тег>brand</v8:Тег>
				<v8:Родитель/>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">c41bdd9c-67ef-11ec-bba8-00155d258b03</v8:Атрибут>
				<v8:Обработчик>Результат=Строка(Источник);</v8:Обработчик>
				<v8:Массив>false</v8:Массив>
				<v8:Обязательный>false</v8:Обязательный>
			</v8:ПравилаЗагрузки>
			<v8:ПравилаЗагрузки>
				<v8:Тег>model</v8:Тег>
				<v8:Родитель/>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">a7ce5483-67ef-11ec-bba8-00155d258b03</v8:Атрибут>
				<v8:Обработчик>Результат=Строка(Источник);</v8:Обработчик>
				<v8:Массив>false</v8:Массив>
				<v8:Обязательный>false</v8:Обязательный>
			</v8:ПравилаЗагрузки>
			<v8:ПравилаЗагрузки>
				<v8:Тег>vin</v8:Тег>
				<v8:Родитель/>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">b926251e-39ba-11e9-80cc-00155d049008</v8:Атрибут>
				<v8:Обработчик/>
				<v8:Массив>false</v8:Массив>
				<v8:Обязательный>false</v8:Обязательный>
			</v8:ПравилаЗагрузки>
			<v8:ПравилаЗагрузки>
				<v8:Тег>defectFound</v8:Тег>
				<v8:Родитель/>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">3da7cce6-6746-11ec-bba8-00155d258b03</v8:Атрибут>
				<v8:Обработчик>Если ЗначениеЗаполнено(Источник) Тогда
	Результат = Справочники.КА_ДополнительныеЗначенияАтрибутов.НайтиПоРеквизиту("Ключ", Источник, , Приемник);
КонецЕсли;</v8:Обработчик>
				<v8:Массив>false</v8:Массив>
				<v8:Обязательный>false</v8:Обязательный>
			</v8:ПравилаЗагрузки>
			<v8:ПравилаЗагрузки>
				<v8:Тег>installation</v8:Тег>
				<v8:Родитель/>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">82011875-6746-11ec-bba8-00155d258b03</v8:Атрибут>
				<v8:Обработчик>Если ЗначениеЗаполнено(Источник) Тогда
	Результат = Справочники.КА_ДополнительныеЗначенияАтрибутов.НайтиПоРеквизиту("Ключ", Источник, , Приемник);
КонецЕсли;</v8:Обработчик>
				<v8:Массив>false</v8:Массив>
				<v8:Обязательный>false</v8:Обязательный>
			</v8:ПравилаЗагрузки>
			<v8:ПравилаЗагрузки>
				<v8:Тег>files</v8:Тег>
				<v8:Родитель/>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">f50dd77c-7e9a-11ec-bb9e-00155d70bd06</v8:Атрибут>
				<v8:Обработчик>Результат = Новый Массив;

Для каждого Стр из Источник Цикл

	ЗаписьJSON = Новый ЗаписьJSON;
	ЗаписьJSON.УстановитьСтроку();
	ЗаписатьJSON(ЗаписьJSON, Стр);
	ТекСтр = ЗаписьJSON.Закрыть();
	Результат.Добавить(ТекСтр);

КонецЦикла; 

//Результат = М;


МассивФайлов = Источник;

СерверФайлов = Константы.КА_АдресСервисаХраненияФайлов.Получить();

Атрибут = ПланыВидовХарактеристик.КА_АтрибутыИнцидентов.НайтиПоРеквизиту("Идентификатор", "СсылкиНаИзображения");

НС = Инцидент.ЗначенияАтрибутов.НайтиСтроки(Новый Структура("Атрибут", Атрибут));  
Для каждого Стр из НС Цикл
	Инцидент.ЗначенияАтрибутов.Удалить(Стр);
КонецЦикла;

Для каждого ТекСтр из МассивФайлов Цикл
		
	Путь = СерверФайлов + ТекСтр["link"];
	НовСтр = Инцидент.ЗначенияАтрибутов.Добавить();
	НовСтр.Атрибут = Атрибут;
	НовСтр.Значение = "http://"+Путь;
	НовСтр.Представление = ТекСтр["originalName"] + "." + ТекСтр["type"];
	
КонецЦикла;

Если ЛОЖЬ И ЗначениеЗаполнено(Инцидент.Ссылка) Тогда

	МассивФайлов = Источник;

	ТекПользователь = Пользователи.АвторизованныйПользователь();

	Для каждого ТекСтр из МассивФайлов Цикл
			
		ДД = КА_Обмены.ПолучитьДанныеИзСервисаФайлов(ТекСтр["link"]);
		
		АдресХранилища = ПоместитьВоВременноеХранилище(ДД);
		Имя = Сред(ТекСтр["originalName"], 1, Найти(ТекСтр["originalName"], ".")-1);
		Расширение = Сред(ТекСтр["originalName"], Найти(ТекСтр["originalName"], ".")+1);
		
		Описание = СтрШаблон("%1
							|%2", ТекСтр["fileType"], ТекСтр["link"]);  
				
		Запрос = Новый Запрос;
		Запрос.Текст = "ВЫБРАТЬ Т.Ссылка ИЗ Справочник.КА_ИнцидентПрисоединенныеФайлы КАК Т ГДЕ Т.ВладелецФайла = &amp;Владелец И ВЫРАЗИТЬ(Т.Описание КАК СТРОКА(1024)) ПОДОБНО &amp;Путь";	
		Запрос.УстановитьПараметр("Путь", "%"+ТекСтр["link"]+"%");
		Запрос.УстановитьПараметр("Владелец", Инцидент.Ссылка);
		
		Выборка = Запрос.Выполнить().Выбрать();
		
		Если Выборка.Следующий() Тогда
			Продолжить;
		КонецЕсли;						
							
		ПараметрыФайла = Новый Структура;
		ПараметрыФайла.Вставить("Автор", ТекПользователь);
		ПараметрыФайла.Вставить("ВладелецФайлов", Инцидент.Ссылка);
		ПараметрыФайла.Вставить("ИмяБезРасширения", Имя);
		ПараметрыФайла.Вставить("РасширениеБезТочки", Расширение);
		ПараметрыФайла.Вставить("ВремяИзмененияУниверсальное", );
			
		ПрисоединенныеФайлы.ДобавитьПрисоединенныйФайл(ПараметрыФайла, АдресХранилища,, Описание)	

	КонецЦикла;

КонецЕсли;</v8:Обработчик>
				<v8:Массив>false</v8:Массив>
				<v8:Обязательный>false</v8:Обязательный>
			</v8:ПравилаЗагрузки>
			<v8:Этапы>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">fe697b46-4e2c-11ec-bba8-00155d258b03</v8:Этап>
			</v8:Этапы>
			<v8:Этапы>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">c9cc2bd9-81fd-11ec-bb9e-00155d70bd06</v8:Этап>
			</v8:Этапы>
			<v8:Этапы>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">c9cc2bda-81fd-11ec-bb9e-00155d70bd06</v8:Этап>
			</v8:Этапы>
			<v8:Этапы>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">d2b59609-81fd-11ec-bb9e-00155d70bd06</v8:Этап>
			</v8:Этапы>
			<v8:Этапы>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">d912235c-81fd-11ec-bb9e-00155d70bd06</v8:Этап>
			</v8:Этапы>
			<v8:Этапы>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">d912235d-81fd-11ec-bb9e-00155d70bd06</v8:Этап>
			</v8:Этапы>
			<v8:Этапы>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">e212d359-81fd-11ec-bb9e-00155d70bd06</v8:Этап>
			</v8:Этапы>
			<v8:Этапы>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">e212d35a-81fd-11ec-bb9e-00155d70bd06</v8:Этап>
			</v8:Этапы>
			<v8:Этапы>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">eab3acfb-81fd-11ec-bb9e-00155d70bd06</v8:Этап>
			</v8:Этапы>
			<v8:Этапы>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">eab3acfc-81fd-11ec-bb9e-00155d70bd06</v8:Этап>
			</v8:Этапы>
			<v8:Этапы>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">f3ae00ab-81fd-11ec-bb9e-00155d70bd06</v8:Этап>
			</v8:Этапы>
			<v8:Этапы>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">f3ae00ac-81fd-11ec-bb9e-00155d70bd06</v8:Этап>
			</v8:Этапы>
			<v8:Этапы>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">fba5303f-81fd-11ec-bb9e-00155d70bd06</v8:Этап>
			</v8:Этапы>
			<v8:Этапы>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">fba53040-81fd-11ec-bb9e-00155d70bd06</v8:Этап>
			</v8:Этапы>
			<v8:Этапы>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">024c7838-81fe-11ec-bb9e-00155d70bd06</v8:Этап>
			</v8:Этапы>
			<v8:Этапы>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">024c7839-81fe-11ec-bb9e-00155d70bd06</v8:Этап>
			</v8:Этапы>
			<v8:Этапы>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">0a67f064-81fe-11ec-bb9e-00155d70bd06</v8:Этап>
			</v8:Этапы>
			<v8:Этапы>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">0a67f065-81fe-11ec-bb9e-00155d70bd06</v8:Этап>
			</v8:Этапы>
			<v8:Этапы>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">129df58b-81fe-11ec-bb9e-00155d70bd06</v8:Этап>
			</v8:Этапы>
			<v8:Этапы>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">129df58a-81fe-11ec-bb9e-00155d70bd06</v8:Этап>
			</v8:Этапы>
			<v8:Этапы>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">1a70361f-81fe-11ec-bb9e-00155d70bd06</v8:Этап>
			</v8:Этапы>
			<v8:Этапы>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">2152ab22-81fe-11ec-bb9e-00155d70bd06</v8:Этап>
			</v8:Этапы>
			<v8:Этапы>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">2152ab23-81fe-11ec-bb9e-00155d70bd06</v8:Этап>
			</v8:Этапы>
			<v8:Этапы>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">291059d5-81fe-11ec-bb9e-00155d70bd06</v8:Этап>
			</v8:Этапы>
			<v8:Этапы>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">291059d6-81fe-11ec-bb9e-00155d70bd06</v8:Этап>
			</v8:Этапы>
			<v8:Этапы>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">b512a77b-8e56-11ec-bb9e-00155d70bd06</v8:Этап>
			</v8:Этапы>
			<v8:Этапы>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">d4c8e7bf-8e57-11ec-bb9e-00155d70bd06</v8:Этап>
			</v8:Этапы>
			<v8:Этапы>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">0358fd4f-8e58-11ec-bb9e-00155d70bd06</v8:Этап>
			</v8:Этапы>
			<v8:Этапы>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">7e7bc00e-8e58-11ec-bb9e-00155d70bd06</v8:Этап>
			</v8:Этапы>
			<v8:Этапы>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">353b40c4-8e59-11ec-bb9e-00155d70bd06</v8:Этап>
			</v8:Этапы>
			<v8:Этапы>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">4a3602ca-8e59-11ec-bb9e-00155d70bd06</v8:Этап>
			</v8:Этапы>
			<v8:Этапы>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">9acfe5bf-d790-11ec-bbaf-00155d258b03</v8:Этап>
			</v8:Этапы>
			<v8:Этапы>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">c9c51e03-d7be-11ec-bbaf-00155d258b03</v8:Этап>
			</v8:Этапы>
			<v8:Этапы>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">b39a8a2d-d7c2-11ec-bbaf-00155d258b03</v8:Этап>
			</v8:Этапы>
			<v8:Этапы>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">99c177aa-d7c3-11ec-bbaf-00155d258b03</v8:Этап>
			</v8:Этапы>
			<v8:Этапы>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">0a485bfa-d7c4-11ec-bbaf-00155d258b03</v8:Этап>
			</v8:Этапы>
			<v8:Этапы>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">633abd82-d806-11ec-bbaf-00155d258b03</v8:Этап>
			</v8:Этапы>
			<v8:Этапы>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">66c30864-d807-11ec-bbaf-00155d258b03</v8:Этап>
			</v8:Этапы>
			<v8:Этапы>
				<v8:Этап xsi:type="v8:CatalogRef.КА_ЭтапыИнцидентов">046ca2f2-7abf-11ed-bbb3-00155d258b03</v8:Этап>
			</v8:Этапы>
			<v8:СвязиОтборовАтрибутов>
				<v8:Атрибут xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">6ebbf22b-7bbc-11ed-bbb3-00155d258b03</v8:Атрибут>
				<v8:АтрибутОтбора xsi:type="v8:ChartOfCharacteristicTypesRef.КА_АтрибутыИнцидентов">c9ae9a45-d6cc-11ec-bbaf-00155d258b03</v8:АтрибутОтбора>
				<v8:ПравилоАктивно>true</v8:ПравилоАктивно>
				<v8:ПараметрОтбора>Владелец</v8:ПараметрОтбора>
			</v8:СвязиОтборовАтрибутов>
		</v8:CatalogObject.КА_ВидыИнцидентов>
	</V8Exch:Data>
	<PredefinedData/>
</V8Exch:_1CV8DtUD>